<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>所有文章 - SAMZONG</title><link>https://samzong.me/posts/</link><description>所有文章 | SAMZONG</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><lastBuildDate>Sat, 28 May 2022 22:27:18 +0000</lastBuildDate><atom:link href="https://samzong.me/posts/" rel="self" type="application/rss+xml"/><item><title>MacTips 单独设置程序语言</title><link>https://samzong.me/mactips-choose-apps-defaults-language/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/mactips-choose-apps-defaults-language/</guid><description><![CDATA[<p>Mac 上系统语言设置成英文查看起来是最舒适的，所以我很早就将系统语言改成英文，但是在自身英语水平有限，应对基本的单词没有问题，但是在查看例如Word、PowerPoint这类应用时，有大量的选项大脑转化速度较慢，影响工作效率，所以有时在做PPT时，不得已要将系统切换到中文，这对我来说是一件很麻烦的事情，但是今天在网上找到一个帖子<a href="http://www.viblue.com/wiki/469264501.html" target="_blank" rel="noopener noreferrer">原文</a>，其实一个命令就可以搞定我的问题，修改某一软件的默认语言。</p>
<h5 id="command" class="headerLink">
    <a href="#command" class="header-mark"></a>0.0.0.1 Command</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults write &#39;{AppName}&#39; AppleLanguages &#39;(&#34;Your choose language&#34;)&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>这不会影响到我们其他软件的使用。</p>
<h5 id="tips" class="headerLink">
    <a href="#tips" class="header-mark"></a>0.0.0.2 Tips:</h5><p>我在一次切换Outlook语言时使用上面的命令不能生效，经过研究稍微改造了一下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults write com.microsoft.Outlook AppleLanguages -array zh
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="例子" class="headerLink">
    <a href="#%e4%be%8b%e5%ad%90" class="header-mark"></a>0.0.0.3 例子</h5><ol>
<li>修改Microsoft Office Applocation.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults write com.microsoft.Word AppleLanguages &#39;(&#34;zh-CN&#34;)&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults write com.microsoft.Excel AppleLanguages &#39;(&#34;zh-CN&#34;)&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults write com.microsoft.Powerpoint AppleLanguages &#39;(&#34;zh-CN&#34;)&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Mac 自带地图应</li>
</ol>
<p>Mac 自带地图非常的好用，但是中文会更适合我们的查看和标记</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults write com.apple.Maps AppleLanguages &#39;(&#34;zh-CN&#34;)&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Tip：如果不知道程序名称时，可以在<code>com.</code>使用三次<code>Tab</code>键来查找程序名称.</p>
</blockquote>
<h5 id="结语" class="headerLink">
    <a href="#%e7%bb%93%e8%af%ad" class="header-mark"></a>0.0.0.4 结语</h5><p>如上操作，仅适合本身支持中英文的应用程序，如果程序本身不带有中文或者英文是无法使用的，当然有些应用也内置了语言切换按钮，可以优先使用程序自带的设置选项。</p>
<h5 id="去除设置" class="headerLink">
    <a href="#%e5%8e%bb%e9%99%a4%e8%ae%be%e7%bd%ae" class="header-mark"></a>0.0.0.5 去除设置</h5><p>ok，在我们增加了特定程序语言环境之后，如果手动切换系统语言之后，已设置的程序语言环境仍保留我们的手动设置情境，如若不需要，可以采用以下命令去除。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">defaults delete &#39;{AppName}&#39; AppleLanguages
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>参考链接：http://www.viblue.com/wiki/469264501.html</li>
</ul>
]]></description></item><item><title>Jmeter 使用BlazeMeter为Jmeter录制脚本</title><link>https://samzong.me/blazemeter_recoding_jmx/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/blazemeter_recoding_jmx/</guid><description><![CDATA[<p>之前一直使用阿里云的PTS服务作为测试，但是今天发现阿里云的PTS服务正在升级无法使用，所以打算用Jmeter来做压力测试，并使用Chrome插件BlazeMeter来录制.jmx脚本。</p>
<h4 id="安装blazemeter插件" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85blazemeter%e6%8f%92%e4%bb%b6" class="header-mark"></a>0.0.1 安装BlazeMeter插件</h4><p><a href="https://chrome.google.com/webstore/search/blazemeter" target="_blank" rel="noopener noreferrer">插件安装</a> , 需要能登录到Chrome应用商店，如果不能登录的话，可以在网上搜索下载crx包，手动加载到Chrome中即可。</p>
<p>安装成功之后，在Chrome插件栏可以看到程序入口，<a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r0ps7.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r0ps7.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r0ps7.jpg">
        
    </a></p>
<p>BlazeMeter限制需要登录才能导出jmx脚本，所以首先需要注册账号。成功登陆后，完整界面如图所示：</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/oamv4.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/oamv4.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/oamv4.png">
        
    </a></p>
<h4 id="录制过程" class="headerLink">
    <a href="#%e5%bd%95%e5%88%b6%e8%bf%87%e7%a8%8b" class="header-mark"></a>0.0.2 录制过程</h4><p>填写测试脚本名称后，点击开始录制，执行一系列操作后，点停止录制，然后到处jmx文件到本地。</p>
<h4 id="导入脚本到jmeter" class="headerLink">
    <a href="#%e5%af%bc%e5%85%a5%e8%84%9a%e6%9c%ac%e5%88%b0jmeter" class="header-mark"></a>0.0.3 导入脚本到Jmeter</h4><p>在Jmeter中&quot;File-Open&quot;导入你jmx脚本，为了方便观察结果，我们需要增加一些察看报告。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/uxe75.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/uxe75.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/uxe75.jpg">
        
    </a></p>
<h5 id="聚合报告aggregate-report" class="headerLink">
    <a href="#%e8%81%9a%e5%90%88%e6%8a%a5%e5%91%8aaggregate-report" class="header-mark"></a>0.0.3.1 聚合报告(Aggregate Report)</h5><p>我们可以在聚合报告中一些非常有用的信息，这有助于对性能测试的分析。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/j93gs.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/j93gs.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/j93gs.png">
        
    </a></p>
<ul>
<li>Samples ： 一共完成了多少事务</li>
<li>Averge ： 平均响应时间</li>
<li>Median ： 统计意义上的响应时间的中值</li>
<li>90% Line ：90%的事务响应时间都小于xx ms</li>
<li>Min ：最小响应时间 ms</li>
<li>Max :  最大响应时间 ms</li>
<li>Eror %  : 出错率</li>
<li>Throughput ： 吞吐量，事务/秒</li>
<li>KB/sec ： 用流量来衡量的吞吐量</li>
</ul>
<blockquote>
<p>吞吐量=完成的事务数/完成这些事务数所需要的时间；</p>
<p>平均响应时间=所有响应时间的总和/完成的事务数；</p>
<p>失败率=失败的个数/事务数。</p>
</blockquote>
<h5 id="查看结果树view-results-tree" class="headerLink">
    <a href="#%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c%e6%a0%91view-results-tree" class="header-mark"></a>0.0.3.2 查看结果树(View Results Tree)</h5><p>通过查看结果树，可以看到每个事务的返回结果，其中红色是出错，绿色则为正常。建议在测试开始前将log/Display Only中Errors打上勾即可，不然会输出很多东西，不方便查看。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/moo9h.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/moo9h.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/moo9h.png">
        
    </a></p>
]]></description></item><item><title>HowTo use TortoiseGit for Windows</title><link>https://samzong.me/howto-use-tortoisegit-for-windows/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-use-tortoisegit-for-windows/</guid><description><![CDATA[<p>Git是目前最先进的版本控制系统，越来越多的业务场景都在使用Git，风靡全球的Github更是让Git版本控制系统名声大震，但是GitHub旨在建立一个开源的生态环境，所以不适合企业内部的管理系统，在之前的文章中，我也讲到了如何搭建GitLab，可以在企业内部自建一套功能完善的Git版本控制系统。</p>
<p>GitLab是一个非常成熟的服务端应用，但是作为一名开发人员，我们在使用GitLab与其他人员协同版本时，需要有一个工作对我们的每次修改更新以及推送，这也是版本控制工具的真正精髓；在不同的平台有着很多丰富的应用软件，所以挑选一款适合自己的Git GUI工具很重要。</p>
<p>目前在众多Git Client之中做的比较好的是SourceTree，并且同时支持Mac和Windows双平台，但是有一个问题，当我们在初次安装时需要验证Atlassian账号，但是Atlassian的注册页面用了requirejs，而且是用了Google的CDN服务，所以必须翻墙，这对很多中国用户的使用造成了不变；所以，今天我在这里推荐一个在Windows平台下同样可以作为Git图形化客户端工具的：<a href="https://tortoisegit.org/" target="_blank" rel="noopener noreferrer">TortoiseGit</a></p>
<p>TortoiseGit 是 TortoiseSVN 的 Git 版本，TortoiseGit用于迁移 TortoiseSVN 到 TortoiseGit，解决了在Windows平台之上没有合适Git图形化客户端的问题，TortoiseGit不仅免费，而且同样支持丰富的语言包，但是需要独立下载语言包安装，默认只有英文，注意语言包与程序版本一定要匹配。</p>
<h4 id="下载" class="headerLink">
    <a href="#%e4%b8%8b%e8%bd%bd" class="header-mark"></a>0.0.1 下载</h4><p>TortoiseGit的官方下载地址是这里：https://tortoisegit.org/download/ ，下载时请注意与你系统的兼容性。</p>
<blockquote>
<p>注意TortoiseGit 1.8.16之后的版本不在支持Windows XP 和 Server 2003</p>
</blockquote>
<p>因为TortoiseGit官网不在国内，所以在访问下载时速度非常的慢，我将目前的稳定版本2.4上传到我的百度云盘，但是以后我可能不能及时更新，所以如果你对版本要求不是很高，可以点击下面链接下载。</p>
<p>链接: <a href="https://pan.baidu.com/s/1eScNjA6" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1eScNjA6</a> 密码: 31hu</p>
<blockquote>
<p>如链接失效，您可以通过本页面右下角展开通过邮箱，与我取得联系。</p>
</blockquote>
<h4 id="安装" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>0.0.2 安装</h4><h5 id="git-for-windows" class="headerLink">
    <a href="#git-for-windows" class="header-mark"></a>0.0.2.1 Git for Windows</h5><p>首先，我们需要安装Git在你的电脑上，这保证你的TortoiseGit运行时所需要的依赖环境。</p>
<p>下载地址：https://git-for-windows.github.io/</p>
<p>同样，因为某些网络的原因，导致我们在下载时也会很慢，所以我也将目前最新2.13版本上传到了我的百度云盘：</p>
<p>链接: <a href="https://pan.baidu.com/s/1c12ZvRq" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1c12ZvRq</a> 密码: 43yt</p>
<p>安装过程，这里不在展示，通常情况下，你只需要一路点击Next即可，但是如果你想要修改一些设置，例如默认的安装位置，那么你需要注意下，在TortoiseGit初次启动时，你需要手动设置Git.exe的位置。</p>
<h5 id="tortoisegit" class="headerLink">
    <a href="#tortoisegit" class="header-mark"></a>0.0.2.2 TortoiseGit</h5><p>我的测试系统是Windows 7 旗舰版 64位，并且支持TortoiseGit最新的版本。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/q39b4.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/q39b4.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/q39b4.jpg">
        
    </a></p>
<p>请依次安装上图中两个软件，注意LanguagePack应该在主程序之后安装，同样，你也只需要一路点击Next即可。</p>
<p>在你安装完成之后，在该目录的空白区域，单击鼠标右键，你应该会看到新增了TortoiseGit的选项，我们选择&quot;TortoiseGit&quot;&gt;&ldquo;Settings&quot;来初始化我们设置。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/educ5.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/educ5.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/educ5.jpg">
        
    </a></p>
<h5 id="修改程序语言为中文" class="headerLink">
    <a href="#%e4%bf%ae%e6%94%b9%e7%a8%8b%e5%ba%8f%e8%af%ad%e8%a8%80%e4%b8%ba%e4%b8%ad%e6%96%87" class="header-mark"></a>0.0.2.3 修改程序语言为中文</h5><p>如果英文你的使用不会有影响，你可以略过这一步骤，同样你也不需要下载上面的LanguagePack包。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/afmvd.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/afmvd.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/afmvd.jpg">
        
    </a></p>
<p>好了，按照如上图中操作，你应该已经修改了程序语言为中文，再次到空白区域单击测试就可以看到了。</p>
<h4 id="使用tortoisegit克隆你的项目" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8tortoisegit%e5%85%8b%e9%9a%86%e4%bd%a0%e7%9a%84%e9%a1%b9%e7%9b%ae" class="header-mark"></a>0.0.3 使用TortoiseGit克隆你的项目</h4><p>在我们安装了好TortoiseGit和Git的基本基础环境之后，我们需要使用TortoiseGit克隆项目，这里我们是在GitHub创建了一个测试项目，你可以直接使用你的项目地址即可。</p>
<h5 id="测试项目" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e9%a1%b9%e7%9b%ae" class="header-mark"></a>0.0.3.1 测试项目</h5><p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ot84j.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ot84j.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ot84j.jpg">
        
    </a></p>
<p>GitHub和GitLab都提供了通过使用HTTPS和SSH的方式，这两种方式有些不同，我会在下面分开讲述如何使用。</p>
<h5 id="ssh验证方式" class="headerLink">
    <a href="#ssh%e9%aa%8c%e8%af%81%e6%96%b9%e5%bc%8f" class="header-mark"></a>0.0.3.2 SSH验证方式</h5><p>如果采用SSH验证方式，那么你需要生成一对公钥和私钥，并且将公钥上传到你的GitLab或GitHub上，然后在克隆你的项目时，使用匹配的私钥即可。</p>
<p>那在Windows如何上生成私钥呢？其实我们在安装TortoiseGit时已经默认安装PuTTYgen工具，我们可以利用它来创建秘钥。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/dh1fb.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/dh1fb.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/dh1fb.jpg">
        
    </a></p>
<p>打开PuTTYgen，点击generate即可创建密钥，PuTTYgen其实是按照鼠标运行的轨迹来计算的，所以在点击后，我们不停的使用鼠标移动，等待进度条完成就可以了。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/2uyf3.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/2uyf3.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/2uyf3.jpg">
        
    </a></p>
<p>当创建完成之后，你可以看到以下以下内容，注意不要关闭，我们要点击<code>Save public key</code>和<code>Save private key</code>，并将上public key传到你的GitHub或GitLab账户之中。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/stgw9.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/stgw9.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/stgw9.jpg">
        
    </a></p>
<blockquote>
<p>注意，我在图中隐去了其他SSH keys信息，我建议你在做类似分享时也注意隐去你的重要信息</p>
</blockquote>
<p>好了，接下来，我们就要开克隆我们的项目了，在你想要存放项目的目录内，鼠标右键选择”Git克隆“，然后输入你的项目URL，并且加载我们刚刚生产私钥文件。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/y7dsh.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/y7dsh.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/y7dsh.jpg">
        
    </a></p>
<p>注意，在你确认都没问题的情况下，点击确认，然后你就会看到如下页面，如果这个过程中出现问题，请注意检查项目URL和私钥文件是否正确。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/bltrs.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/bltrs.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/bltrs.jpg">
        
    </a></p>
<p>到这里，我们SSH验证仓库的方式就全好，接下来我们就可以使用开始进行我们的工作，但在首次提交我们的项目时，需要设置用户名和密码，这是为了方便验证我们的身份。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/07sxd.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/07sxd.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/07sxd.jpg">
        
    </a></p>
<p>点击”是“，在弹出的窗口中设定用户名和邮箱，保存即可。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/wid9v.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/wid9v.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/wid9v.jpg">
        
    </a></p>
<h5 id="https-or-http" class="headerLink">
    <a href="#https-or-http" class="header-mark"></a>0.0.3.3 HTTPS or HTTP</h5><p>在使用GitLab为公司内部仓库时，可以不开通HTTPS验证，HTTP也不会影响我们的验证方式，但是从安全的角度上来说，强烈建议启用HTTPS，HTTPS加密传输可以给我们的代码和用户信息的安全提供更好的保护。</p>
<p>如果使用HTTPS or HTTP的方式，我们不需要增加任何密钥文件或怎样，只需要使用我们现有的GitHub或GitLab账号即可；在你想要存放项目的目录内，鼠标右键选择”Git克隆“，在弹出的窗口中，注意项目URL要是用HTTPS，并且去掉勾选加载密钥选项。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/givvr.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/givvr.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/givvr.jpg">
        
    </a></p>
<p><strong>如果你的项目在GitLab上</strong>，并且这个项目是一个私有项目，那么这里就会要求你输入你的GitLab用户名和密码，输入正确的用户和密码就可以成功克隆了。</p>
<p>但是，由于我的测试项目在GitHub上，GitHub上的项目默认都是公开项目，所以在这一步骤不会询问我的用户名和密码，只有在我需要将本地更新推送到GitHub时才会验证；所以接下来我在项目目录下新增文件newfile2.txt，</p>
<blockquote>
<p>注意，Git不同SVN，Git的提交不会将更新推送到远端服务器，所以我们在提交成功之后，再去手动推送</p>
</blockquote>
<p>右键选择Git提交，会弹出提交页面，我们需要这里，输入提交说明信息，和需要提交的文件。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ata4r.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ata4r.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ata4r.jpg">
        
    </a></p>
<p>点击”提交之后“，我们会看成功提交的窗口，然后在窗口选择点击推送；</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/q4cq7.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/q4cq7.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/q4cq7.jpg">
        
    </a></p>
<p>当我们点击推送之后，会要求输入对应的GitHub用户名和密码：</p>
]]></description></item><item><title>HowTo Use SSR Service on Mac</title><link>https://samzong.me/howto-use-ssr-on-mac/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-use-ssr-on-mac/</guid><description><![CDATA[<p>应邀制作一份关于Mac SSR的连接使用。</p>
<h2 id="准备" class="headerLink">
    <a href="#%e5%87%86%e5%a4%87" class="header-mark"></a>1. 准备</h2><ol>
<li>SSR 服务提供商，<a href="http://www.ssglobal.co/wp/" target="_blank" rel="noopener noreferrer">SSGlobal</a> ，你可以到Telegram加入我们。<a href="https://t.me/joinchat/ESwgR0Ckp_zXMCuRKqykqA" target="_blank" rel="noopener noreferrer">SSGlobal Group</a></li>
<li>MacOS 版本 10.12.6，经过实测OS版本对实际使用影响并不大。</li>
<li>SSR Client， <a href="http://www.ssglobal.co/wp/wp-content/uploads/2017/02/ShadowsocksX-NG-R8.dmg" target="_blank" rel="noopener noreferrer">下载</a></li>
</ol>
<h2 id="ssr服务" class="headerLink">
    <a href="#ssr%e6%9c%8d%e5%8a%a1" class="header-mark"></a>2. SSR服务</h2><p>如果你需要科学上网的话，非常愿意给你推荐我正在使用的SSR服务商，但是由于其官方网站和客户沟通工具TG需要科学上网才能使用，所以你可以联系到我来介绍你们。</p>
<p>最新定价计划：</p>
<ul>
<li>Plan-A：<strong>¥15.00元</strong>，1个月，无限流量，不限速，可自助切换节点。</li>
<li>Plan-B：<strong>¥15.00元</strong>，3个月，6G流量包，不限速，可自助切换节点。</li>
<li>增加线路：<strong>¥8.00元</strong>，1个月，1条。</li>
</ul>
<blockquote>
<p>注：增加线路仅支持Plan-A用户配套购买，不超过主线路最长期限，不足1个月剩余时限用户不支持购买</p>
</blockquote>
<h3 id="注册账号" class="headerLink">
    <a href="#%e6%b3%a8%e5%86%8c%e8%b4%a6%e5%8f%b7" class="header-mark"></a>2.1 注册账号</h3><p><a href="http://www.ssglobal.co/wp/registration/?action=register" target="_blank" rel="noopener noreferrer">立即注册</a></p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/x6fbl.jpg" title="05" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/x6fbl.jpg">
        
    </a></p>
<blockquote>
<p>这里alexman@mac.local 仅仅是演示邮箱，请填写对应属于你的邮箱.</p>
</blockquote>
<p>当你点击提交完成后，在你的邮箱会收到一封激活邮件，点击其中链接或将链接复制到浏览器中即可激活。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r4oo0.jpg" title="07" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r4oo0.jpg">
        
    </a></p>
<blockquote>
<p>这里同样是激活链接，同样仅作为演示。</p>
</blockquote>
<h3 id="登录系统" class="headerLink">
    <a href="#%e7%99%bb%e5%bd%95%e7%b3%bb%e7%bb%9f" class="header-mark"></a>2.2 登录系统</h3><p><a href="http://www.ssglobal.co/wp/login-2/?redirect_to=http://www.ssglobal.co/wp/registration/" target="_blank" rel="noopener noreferrer">立即登录</a></p>
<p>输入注册时的用户名密码，即可登录到系统内，然后在首页找到进入后台按钮，即可看到试用信息。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/lmcst.jpg" title="06" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/lmcst.jpg">
        
    </a></p>
<blockquote>
<p>这里填写用户名或邮箱都可以。</p>
</blockquote>
<p>进入系统后，找到订阅链接信息，默认情况下，你应该只有一条线路信息，付费用户享有应急通道。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/xba0a.jpg" title="04" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/xba0a.jpg">
        
    </a></p>
<blockquote>
<p>上图中”切换“，用来切换不同服务器节点，注意，切换后要到客户端内刷新订阅信息，下面会讲到。</p>
</blockquote>
<h2 id="ssr-client-安装" class="headerLink">
    <a href="#ssr-client-%e5%ae%89%e8%a3%85" class="header-mark"></a>3. SSR Client 安装</h2><p>在本文最上面已经有了，如何下载SSR 客户端的地方，细心的朋友，应该已经在SSGlobal官网上找到了对应下载页面，其中包含全平台的客户端工具。</p>
<h3 id="下载" class="headerLink">
    <a href="#%e4%b8%8b%e8%bd%bd" class="header-mark"></a>3.1 下载</h3><p><a href="http://www.ssglobal.co/wp/wp-content/uploads/2017/02/ShadowsocksX-NG-R8.dmg" target="_blank" rel="noopener noreferrer">立即下载</a></p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/bc4jy.jpg" title="01" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/bc4jy.jpg">
        
    </a></p>
<p>下载完成后，找到你的下载文件，双击打开，将程序拖到Mac程序目录即完成安装，和Mac其他软件安装并无不同。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/p7wkf.jpg" title="02" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/p7wkf.jpg">
        
    </a></p>
<h2 id="启动程序" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8%e7%a8%8b%e5%ba%8f" class="header-mark"></a>4. 启动程序</h2><p>在Launchpad中找到最近安装的 Shadowsocks NG R8，点击启动后，Mac右上角导航栏中会有一个小飞机的图标，点击可以看到以下信息：</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/iycjw.jpg" title="03" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/iycjw.jpg">
        
    </a></p>
<blockquote>
<p>上图中已经有我的订阅信息，请忽略</p>
</blockquote>
<h2 id="编辑订阅信息" class="headerLink">
    <a href="#%e7%bc%96%e8%be%91%e8%ae%a2%e9%98%85%e4%bf%a1%e6%81%af" class="header-mark"></a>5. 编辑订阅信息</h2><p>选择编辑订阅信息，然后将你在SSGlobal 网站后台拿到的订阅信息添加到其中</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7bbj6.jpg" title="09" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7bbj6.jpg">
        
    </a></p>
<blockquote>
<p>注意只要添加URL信息即可，不需要修改其他。</p>
</blockquote>
<p>然后选择手动更新订阅，这里在你的服务列表内，就有了你的服务器节点信息，选择对应节点即可开启科学上网</p>
<h3 id="pac-规则" class="headerLink">
    <a href="#pac-%e8%a7%84%e5%88%99" class="header-mark"></a>5.1 PAC 规则</h3><p>首次使用PAC需要更新一次PAC规则，操作如下图。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/gzrb5.jpg" title="10" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/gzrb5.jpg">
        
    </a></p>
<p>这里的PAC规则是从GFWLists更新的，由于其更新速度较慢，所以如果日常使用发现某些网站无法使用，可以手动添加到PAC规则内</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9rhe6.jpg" title="11" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9rhe6.jpg">
        
    </a></p>
<blockquote>
<p>|| domain , 这里表示匹配所有代理</p>
</blockquote>
<p>更多关于用户规则，可以查看这里，<a href="https://adblockplus.org/en/filter-cheatsheet" target="_blank" rel="noopener noreferrer">使用手册</a></p>
<h2 id="结语" class="headerLink">
    <a href="#%e7%bb%93%e8%af%ad" class="header-mark"></a>6. 结语</h2><p>到这里，基本常用的安装和使用已经完成了，如果测试后仍旧无法正常使用，请仔细检查是否遗漏步骤，也可以与我取得沟通。</p>
]]></description></item><item><title>HowTo Skip Atlassian Auth for SourceTree</title><link>https://samzong.me/howto-skip-atlassian-auth-for-sourcetree/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-skip-atlassian-auth-for-sourcetree/</guid><description><![CDATA[<h4 id="问题" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98" class="header-mark"></a>0.0.1 问题</h4><p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/eaxem.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/eaxem.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/eaxem.png">
        
    </a></p>
<p>因为国内的网络的原因，导致我们在首次打开SourceTree时需要验证Atlassian账号，但是Atlassian的注册页面使用requirejs是用了Google的CDN服务，所以无法正常通过验证，如果你有翻墙工具，那么这就没有问题，下面我要讲的方法是在不翻墙的情况下跳过初始化验证。</p>
<blockquote>
<p>目前我解决的是在Windows平台上的问题，关于Mac平台，我稍后会更新到文档中。</p>
</blockquote>
<h4 id="解决思路" class="headerLink">
    <a href="#%e8%a7%a3%e5%86%b3%e6%80%9d%e8%b7%af" class="header-mark"></a>0.0.2 解决思路</h4><p>我的想法是通过增加<code>account</code>信息，让<code>SourceTree</code>跳过验证；经过测试<code>2.0.19</code>及以下版本都支持，但是SourceTree在最新版本2.0.20时可能修订验证方式，所以导致我的这个方式不适用，大家可以在我的百度云盘共享中下载2.0.19，功能上并没发生多少变化。</p>
<p>链接: <a href="https://pan.baidu.com/s/1qYsHKWs" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1qYsHKWs</a> 密码: wnc3</p>
<h4 id="解决步骤" class="headerLink">
    <a href="#%e8%a7%a3%e5%86%b3%e6%ad%a5%e9%aa%a4" class="header-mark"></a>0.0.3 解决步骤</h4><h5 id="net-452" class="headerLink">
    <a href="#net-452" class="header-mark"></a>0.0.3.1 .NET 4.5.2</h5><p>SourceTree 依赖的.NET环境最低是4.5.2，当然在你安装的过程中，会提示你下载安装，你只需要确认即可，不过这样下载会比较慢，所以建议你使用Offline的形式安装，下面是微软官方下载地址：</p>
<p><a href="https://www.microsoft.com/en-us/download/confirmation.aspx?id=42642" target="_blank" rel="noopener noreferrer">https://www.microsoft.com/en-us/download/confirmation.aspx?id=42642</a></p>
<h5 id="sourcetree" class="headerLink">
    <a href="#sourcetree" class="header-mark"></a>0.0.3.2 SourceTree</h5><p>安装过程中，默认一路“Next”即可，在安装完成之后，我们需要找到SourceTree在LocalAppData中的路径，请打开资源管理窗口，然后输入以下地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">%LocalAppData%<span class="se">\A</span>tlassian<span class="se">\S</span>ourceTree<span class="se">\
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果路径不存在，创建目录即可</p>
</blockquote>
<p>然后将之前百度云盘的文件<code>accounts.json</code>复制到这个位置，它的路径应该是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">%LocalAppData%<span class="se">\A</span>tlassian<span class="se">\S</span>ourceTree<span class="se">\a</span>ccounts.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>文件内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;$id&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;$type&#34;</span><span class="p">:</span> <span class="s2">&#34;SourceTree.Api.Host.Identity.Model.IdentityAccount, SourceTree.Api.Host.Identity&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Authenticate&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;HostInstance&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;$id&#34;</span><span class="p">:</span> <span class="s2">&#34;2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;$type&#34;</span><span class="p">:</span> <span class="s2">&#34;SourceTree.Host.Atlassianaccount.AtlassianAccountInstance, SourceTree.Host.AtlassianAccount&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Host&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;$id&#34;</span><span class="p">:</span> <span class="s2">&#34;3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;$type&#34;</span><span class="p">:</span> <span class="s2">&#34;SourceTree.Host.Atlassianaccount.AtlassianAccountHost, SourceTree.Host.AtlassianAccount&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;Id&#34;</span><span class="p">:</span> <span class="s2">&#34;atlassian account&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;BaseUrl&#34;</span><span class="p">:</span> <span class="s2">&#34;https://id.atlassian.com/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Credentials&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;$id&#34;</span><span class="p">:</span> <span class="s2">&#34;4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;$type&#34;</span><span class="p">:</span> <span class="s2">&#34;SourceTree.Model.BasicAuthCredentials, SourceTree.Api.Account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Username&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Email&#34;</span><span class="p">:</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;IsDefault&#34;</span><span class="p">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>添加完成之后，启动SourceTree即可发现已经跳过了验证界面。</p>
]]></description></item><item><title>Howto Install Redmine on Ubuntu 16.04</title><link>https://samzong.me/install_redmine3.4_rbuy2.4.1_passenger_nginx_mysql_ubuntu16.04/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/install_redmine3.4_rbuy2.4.1_passenger_nginx_mysql_ubuntu16.04/</guid><description><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># base
</span></span><span class="line"><span class="cl">apt install mysql-server libmysqlclient-dev git-core subversion imagemagick libmagickwand-dev libcurl4-openssl-dev 
</span></span><span class="line"><span class="cl">apt install build-essential mysql-server ruby ruby-dev libmysqlclient-dev imagemagick libmagickwand-dev
</span></span><span class="line"><span class="cl"># install mysql
</span></span><span class="line"><span class="cl">systemctl enable mysql.service
</span></span><span class="line"><span class="cl">systemctl start mysql.service
</span></span><span class="line"><span class="cl">create database redmine character set utf8;
</span></span><span class="line"><span class="cl">grant all privileges on redmine.* to redmine@&#39;localhost&#39; identified by &#39;redmine&#39;;
</span></span><span class="line"><span class="cl">flush privileges;
</span></span><span class="line"><span class="cl"># Install ruby
</span></span><span class="line"><span class="cl">gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
</span></span><span class="line"><span class="cl">curl -sSL https://get.rvm.io | bash -s stable
</span></span><span class="line"><span class="cl">source /etc/profile.d/rvm.sh
</span></span><span class="line"><span class="cl">rvm requirements
</span></span><span class="line"><span class="cl">rvm install 2.4.1
</span></span><span class="line"><span class="cl">rvm use 2.4.1 --default
</span></span><span class="line"><span class="cl"># install passenger and nginx 
</span></span><span class="line"><span class="cl">gem install passenger --no-ri --no-rdoc
</span></span><span class="line"><span class="cl">passenger-install-nginx-module
</span></span><span class="line"><span class="cl"># 1. auto install nginx.
</span></span><span class="line"><span class="cl">curl https://raw.githubusercontent.com/makevoid/nginx-passenger-ubuntu/master/nginx/nginx.service &gt; /lib/systemd/system/nginx.service
</span></span><span class="line"><span class="cl">systemctl daemon-reload
</span></span><span class="line"><span class="cl">systemctl enable nginx
</span></span><span class="line"><span class="cl">vim /opt/nginx/conf/nginx.conf # 注销 location / {} 的配置
</span></span><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">  listen  80;
</span></span><span class="line"><span class="cl">  server_name [your_server_domain_name] # redmine.com;
</span></span><span class="line"><span class="cl">  root /var/data/redmine/public;
</span></span><span class="line"><span class="cl">  passenger_enabled on;
</span></span><span class="line"><span class="cl">  client_max_body_size      10m; # Max attachemnt size
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl start nginx
</span></span><span class="line"><span class="cl"># install redmine
</span></span><span class="line"><span class="cl">mkdir /var/data
</span></span><span class="line"><span class="cl">cd /var/data
</span></span><span class="line"><span class="cl">svn co http://svn.redmine.org/redmine/branches/3.4-stable redmine
</span></span><span class="line"><span class="cl">cd /var/data/redmine
</span></span><span class="line"><span class="cl">cp -pR /var/data/redmine/config/database.yml.example /var/data/redmine/config/database.yml
</span></span><span class="line"><span class="cl">vim config/database.yml  # set redmine db user and password
</span></span><span class="line"><span class="cl"># Install Plugins
</span></span><span class="line"><span class="cl">cd /var/data/redmine
</span></span><span class="line"><span class="cl">gem install bundler --no-ri --no-rdoc
</span></span><span class="line"><span class="cl">bundle install
</span></span><span class="line"><span class="cl"># configure redmine
</span></span><span class="line"><span class="cl">cd /var/data/redmine
</span></span><span class="line"><span class="cl">mkdir public/plugin_assets
</span></span><span class="line"><span class="cl">chown -R www-data:www-data files log tmp public/plugin_assets config.ru
</span></span><span class="line"><span class="cl">chmod -R 755 files log tmp public/plugin_assets
</span></span><span class="line"><span class="cl"># input database and base file.
</span></span><span class="line"><span class="cl">RAILS_ENV=production bundle exec rake db:migrate
</span></span><span class="line"><span class="cl">RAILS_ENV=production bundle exec rake redmine:load_default_data
</span></span><span class="line"><span class="cl">bundle exec rake generate_secret_token
</span></span><span class="line"><span class="cl"># restart nginx, install ok.
</span></span><span class="line"><span class="cl">systemctl restart nginx
</span></span><span class="line"><span class="cl"># restart redmine
</span></span><span class="line"><span class="cl">touch /var/data/redmine/tmp/restart.txt
</span></span><span class="line"><span class="cl"># configure email service
</span></span><span class="line"><span class="cl">vim /var/data/redmine/config/configuration.yml
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Automatic EasyBackup MysqlDB</title><link>https://samzong.me/howto-automatic-easybackup-mysqldb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-automatic-easybackup-mysqldb/</guid><description><![CDATA[<p>mysql是一个免费、开源中一款非常优秀关系型数据库，在现在的互联网中使用的非常广泛，无论是大型IT项目还是个人开发者的小项目，mysql都能很好的协助人们处理数据库相关的工作，同时数据库对于我们来说是非常重要，所以经常备份数据库是一个基本的操作，这会为你或者你的团队，减少非常多不必要的麻烦。</p>
<p><code>mysqldump</code>是一个简单而且非常流行的mysql全量备份方式，配合<code>crontab</code>添加自动备份任务，很好的完成了我们针对数据库备份的需求，下面我会通过一个例子来说明如何完成这项操作。</p>
<blockquote>
<p>mysqldump是mysql自带的备份工具，所以只要你安装mysql应用包，就无需单独安装mysqldump</p>
</blockquote>
<h4 id="测试环境" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.1 测试环境</h4><p>我搭建了一个Ghost博客环境，数据库采用是的Mysql，接下来我想在每天00:00执行数据库备份操作，并在备份完成之后，告诉我是否备份成功。</p>
<p><a class="lightgallery" href="http://ww1.sinaimg.cn/large/006tKfTcgy1ffogclgk9dj30f00cq3zf.jpg" title="http://ww1.sinaimg.cn/large/006tKfTcgy1ffogclgk9dj30f00cq3zf.jpg" data-thumbnail="http://ww1.sinaimg.cn/large/006tKfTcgy1ffogclgk9dj30f00cq3zf.jpg">
        
    </a></p>
<p>所以我们的步骤应该：</p>
<ol>
<li>测试备份命令是否可以正常执行</li>
<li>安装测试命令行邮件工具mailx</li>
<li>安装计划任务工具Crontab</li>
<li>编写备份脚本</li>
<li>添加计划任务</li>
</ol>
<h4 id="测试备份命令" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e5%a4%87%e4%bb%bd%e5%91%bd%e4%bb%a4" class="header-mark"></a>0.0.2 测试备份命令</h4><p>首先你要获得你要备份的数据库对应的select权限，仅需要select权限即可，mysql在管理方面，应该坚持只赋予必须权限的原则。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">grant</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">ghost</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s1">&#39;ghost_backuser&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="k">identified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">&#39;backupPass&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="nf">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>因为我只在本地执行备份操作，所以我只赋予了<code>localhost</code>的权限，你的权限应该要是执行备份工作的服务器主机信息。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="c1"># 创建仅授权本地访问的用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">dbackuser</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 创建授权所有来源地址的用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">dbackuser</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 创建仅授权从特定IP的用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">dbackuser</span><span class="o">@</span><span class="s1">&#39;192.168.0.230&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 创建仅授权从特定IP段访问的用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">dbackuser</span><span class="o">@</span><span class="s1">&#39;192.168.0.0/23&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1"># 创建仅授权从特定域名来访问的用户
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">dbackuser</span><span class="o">@</span><span class="s1">&#39;samzong.me&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>好了，接下来我们测试对应用户是否有权限。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="err">➜</span><span class="w">  </span><span class="o">~</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">ghost_backuser</span><span class="w"> </span><span class="o">-</span><span class="n">pbackupPass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Warning</span><span class="p">:</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">insecure</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Welcome</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">monitor</span><span class="p">.</span><span class="w">  </span><span class="n">Commands</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="err">\</span><span class="n">g</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Your</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="mi">7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Server</span><span class="w"> </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">6</span><span class="p">.</span><span class="mi">35</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">Community</span><span class="w"> </span><span class="nf">Server</span><span class="w"> </span><span class="p">(</span><span class="n">GPL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nf">Copyright</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">2016</span><span class="p">,</span><span class="w"> </span><span class="n">Oracle</span><span class="w"> </span><span class="k">and</span><span class="o">/</span><span class="k">or</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">affiliates</span><span class="p">.</span><span class="w"> </span><span class="k">All</span><span class="w"> </span><span class="n">rights</span><span class="w"> </span><span class="n">reserved</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Oracle</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">registered</span><span class="w"> </span><span class="n">trademark</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Oracle</span><span class="w"> </span><span class="n">Corporation</span><span class="w"> </span><span class="k">and</span><span class="o">/</span><span class="k">or</span><span class="w"> </span><span class="n">its</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">affiliates</span><span class="p">.</span><span class="w"> </span><span class="n">Other</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">trademarks</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">respective</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">owners</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Type</span><span class="w"> </span><span class="s1">&#39;help;&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="s1">&#39;\h&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">help</span><span class="p">.</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="s1">&#39;\c&#39;</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">statement</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="k">databases</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="k">Database</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">information_schema</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">ghost</span><span class="w">              </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+--------------------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">2</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">ghost</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Reading</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">completion</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">names</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quicker</span><span class="w"> </span><span class="n">startup</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="o">-</span><span class="n">A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">Database</span><span class="w"> </span><span class="n">changed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">users</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="n">ALEX</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">+------+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>测试<code>mysqldump</code>备份命令，注意mysqldump备份会锁表，但对于正在工作的数据库，锁表会影响到正常业务，所以我们可以使用<code>&ndash;single-transaction</code>参数，不锁表备份。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  ~ mysqldump -u ghost_backuser -pbackupPass ghost &gt; ghost.bak.sql
</span></span><span class="line"><span class="cl">Warning: Using a password on the <span class="nb">command</span> line interface can be insecure.
</span></span><span class="line"><span class="cl">mysqldump: Got error: 1044: Access denied <span class="k">for</span> user <span class="s1">&#39;ghost_backuser&#39;</span>@<span class="s1">&#39;localhost&#39;</span> to database <span class="s1">&#39;ghost&#39;</span> when using LOCK TABLES
</span></span><span class="line"><span class="cl">➜  ~ mysqldump -u ghost_backuser -pbackupPass --single-transaction ghost &gt; ghost.bak.sql
</span></span><span class="line"><span class="cl">Warning: Using a password on the <span class="nb">command</span> line interface can be insecure.
</span></span><span class="line"><span class="cl">➜  ~ ls -lh
</span></span><span class="line"><span class="cl">total 780K
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root   root  780K May <span class="m">17</span> 16:24 ghost.bak.sql
</span></span><span class="line"><span class="cl">➜  ~
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装命令行邮件工具mailx" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e5%91%bd%e4%bb%a4%e8%a1%8c%e9%82%ae%e4%bb%b6%e5%b7%a5%e5%85%b7mailx" class="header-mark"></a>0.0.3 安装命令行邮件工具mailx</h4><p>安装mailx 在CentOS/RehHat:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  ~ yum install -y mailx
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试发送邮件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  ~ <span class="nb">echo</span> <span class="s2">&#34;test&#34;</span> <span class="p">|</span> mail -s <span class="s2">&#34;this a test email&#34;</span> samzong.lu@gmail.com
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="http://ww2.sinaimg.cn/large/006tKfTcgy1ffogc7wksdj30ms03t3ym.jpg" title="http://ww2.sinaimg.cn/large/006tKfTcgy1ffogc7wksdj30ms03t3ym.jpg" data-thumbnail="http://ww2.sinaimg.cn/large/006tKfTcgy1ffogc7wksdj30ms03t3ym.jpg">
        
    </a></p>
<h4 id="安装计划任务工具crontab" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1%e5%b7%a5%e5%85%b7crontab" class="header-mark"></a>0.0.4 安装计划任务工具Crontab</h4><p>crontab命令常见于Unix和类Unix的操作系统之中，用于设置周期性被执行的指令。该命令从标准输入设备读取指令，并将其存放于“crontab”文件中。通常，crontab储存的指令被守护进程激活， crond常常在后台运行，每一分钟检查是否有预定的作业需要执行。这类作业一般称为cron jobs。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  ~ yum install vixie-cron
</span></span><span class="line"><span class="cl">➜  ~ yum install crontabs
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>vixie-cron软件包是cron的主程序；</p>
<p>crontabs软件包是用来安装、卸装、或列举用来驱动 cron 守护进程的表格的程序。</p>
</blockquote>
<p>启动crond并设置为开机自启动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  ~ service crond start
</span></span><span class="line"><span class="cl">Starting crond:                                            <span class="o">[</span>  OK  <span class="o">]</span>
</span></span><span class="line"><span class="cl">➜  ~ chkconfig crond on
</span></span></code></pre></td></tr></table>
</div>
</div><p>crontab 基础命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">语　　法：crontab <span class="o">[</span>-u &lt;用户名称&gt;<span class="o">][</span>配置文件<span class="o">]</span> 或 crontab <span class="o">[</span>-u &lt;用户名称&gt;<span class="o">][</span>-elr<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">补充说明：cron是一个常驻服务，它提供计时器的功能，让用户在特定的时间得以执行预设的指令或程序。只要用户会编辑计时器的配置文件，就可以使用计时器的功能。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">配置文件格式：Minute Hour Day Month DayOFWeek Command
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">参　　数：
</span></span><span class="line"><span class="cl">-e 　编辑该用户的计时器设置。
</span></span><span class="line"><span class="cl">-l 　列出该用户的计时器设置。
</span></span><span class="line"><span class="cl">-r 　删除该用户的计时器设置。
</span></span><span class="line"><span class="cl">-u&lt;用户名称&gt; 　指定要设定计时器的用户名称。
</span></span></code></pre></td></tr></table>
</div>
</div><p>crontab 配置的基本格式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">*     * 　 *　  *　  *　　<span class="nb">command</span>
</span></span><span class="line"><span class="cl">分　  时　 日　 月　 周　  命令
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> 第1列表示分钟1～59 每分钟用*或者 */1表示
</span></span><span class="line"><span class="cl"> 第2列表示小时1～23（0表示0点）
</span></span><span class="line"><span class="cl"> 第3列表示日期1～31
</span></span><span class="line"><span class="cl"> 第4列表示月份1～12
</span></span><span class="line"><span class="cl"> 第5列标识号星期0～6（0表示星期天）
</span></span><span class="line"><span class="cl"> 第6列要运行的命令
</span></span></code></pre></td></tr></table>
</div>
</div><p>crontab 的一些例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#每晚的21:30 重启apache</span>
</span></span><span class="line"><span class="cl"><span class="m">30</span> <span class="m">21</span> * * * /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每月1、10、22日的4 : 45重启apache</span>
</span></span><span class="line"><span class="cl"><span class="m">45</span> <span class="m">4</span> 1,10,22 * * /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每周六、周日的1 : 10重启apache</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span> <span class="m">1</span> * * 6,0 /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每天18 : 00至23 : 00之间每隔30分钟重启apache</span>
</span></span><span class="line"><span class="cl">0,30 18-23 * * * /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每星期六的11 : 00 pm重启apache</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">23</span> * * <span class="m">6</span> /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#晚上11点到早上7点之间，每隔一小时重启apache</span>
</span></span><span class="line"><span class="cl">* 23-7/1 * * * /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每一小时重启apache</span>
</span></span><span class="line"><span class="cl">* */1 * * * /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每月的4号与每周一到周三的11点重启apache</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">11</span> <span class="m">4</span> * mon-wed /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#一月一号的4点重启apache</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">4</span> <span class="m">1</span> jan * /usr/local/etc/rc.d/lighttpd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每半小时同步一下时间</span>
</span></span><span class="line"><span class="cl">*/30 * * * * /usr/sbin/ntpdate 210.72.145.44
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="编写备份脚本" class="headerLink">
    <a href="#%e7%bc%96%e5%86%99%e5%a4%87%e4%bb%bd%e8%84%9a%e6%9c%ac" class="header-mark"></a>0.0.5 编写备份脚本</h4><p>好了，以上我们测试需要用到的各个模块，下面我们要编写备份脚本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#  mysqldump scripts.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># filepath: /usr/local/bin/ghost_sqldump.sh</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Author: samzong</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#  set TIME variable</span>
</span></span><span class="line"><span class="cl"><span class="nv">TIME</span><span class="o">=</span><span class="sb">`</span>date <span class="s2">&#34;+%Y%m%d%H%M%S&#34;</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># backup db ghost to /mysqlbak/</span>
</span></span><span class="line"><span class="cl">mysqldump --single-transaction -h localhost -u ghost_backuser -pbackupPass ghost  &gt; /mysqlbak/ghost_<span class="nv">$TIME</span>.sql
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># tar sql files.</span>
</span></span><span class="line"><span class="cl">tar czvf /mysqlbak/ghost_<span class="nv">$TIME</span>.sql.tgz /mysqlbak/ghost_<span class="nv">$TIME</span>.sql --remove-files
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># remove over 7 days sql files.</span>
</span></span><span class="line"><span class="cl">find /mysqlbak/ -mtime +7 -exec rm -f <span class="o">{}</span> <span class="se">\;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># send mial to admin&#39;mial</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;ghost SQL dump is successfully. At time: `date` &#34;</span> <span class="p">|</span> mail -s ghost-dump-successfully  samzong.lu@gmail.com
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34; Error Error ghost SQL dump is Error. At time: `date` &#34;</span> <span class="p">|</span> mail -s ghost-dump-error samzong.lu@gmail.com
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意脚本中的以下内容要根据你的实际情况修改:</p>
<ul>
<li>-h &quot; &quot; 	这是数据库所在的主机</li>
<li>-u &quot; &quot;       这是数据库可备份的用户名</li>
<li>-p&quot; &quot;        备份用户的密码</li>
</ul>
<h4 id="添加计划任务" class="headerLink">
    <a href="#%e6%b7%bb%e5%8a%a0%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1" class="header-mark"></a>0.0.6 添加计划任务</h4><p>经过以上测试，已经很好的完成备份脚本，接下来将脚本添加到crontab内，并设置自动执行的时间：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  ~ crontab -e
</span></span><span class="line"><span class="cl"><span class="m">00</span> <span class="m">00</span> * * * sh /usr/local/bin/ghost_sqldump.sh
</span></span></code></pre></td></tr></table>
</div>
</div><p>重启crontab服务，并确认crontab已经设置为开机自启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">➜  ~ service crond restart
</span></span><span class="line"><span class="cl">Stopping crond:                                            <span class="o">[</span>  OK  <span class="o">]</span>
</span></span><span class="line"><span class="cl">Starting crond:                                            <span class="o">[</span>  OK  <span class="o">]</span>
</span></span><span class="line"><span class="cl">➜  ~ chkconfig --list <span class="p">|</span> grep crond
</span></span><span class="line"><span class="cl">crond          	0:off	1:off	2:on	3:on	4:on	5:on	6:off
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>How to install MariaDB 10.1 on CentOS 7.x</title><link>https://samzong.me/install_mariadb10_centos7/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/install_mariadb10_centos7/</guid><description><![CDATA[<p>CentOS 7.x 默认的MariaDB版本是5.5，但是在有些情况我们需要用到10版本，注意MariaDB与MySQL版本是不一样的，下面简单降下如何快速安装MariaDB10.1 到CentOS 7.x.</p>
<h4 id="创建mariadb-101的yum源" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%bamariadb-101%e7%9a%84yum%e6%ba%90" class="header-mark"></a>0.0.1 创建MariaDB 10.1的Yum源</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat &lt;&lt;EOF | sudo tee -a /etc/yum.repos.d/MariaDB.repo
</span></span><span class="line"><span class="cl"># MariaDB 10.1 CentOS repository list
</span></span><span class="line"><span class="cl"># http://downloads.mariadb.org/mariadb/repositories/
</span></span><span class="line"><span class="cl">[mariadb]
</span></span><span class="line"><span class="cl">name = MariaDB
</span></span><span class="line"><span class="cl">baseurl = http://yum.mariadb.org/10.1/centos7-amd64
</span></span><span class="line"><span class="cl">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
</span></span><span class="line"><span class="cl">gpgcheck=1
</span></span><span class="line"><span class="cl">EOF
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意MariaDB会随着时间的推移版本不断更新，你可以到<a href="http://downloads.mariadb.org/mariadb" target="_blank" rel="noopener noreferrer">repo仓库</a>获取对应版本链接</p>
</blockquote>
<h4 id="使用yum安装mariadb-101-即可" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8yum%e5%ae%89%e8%a3%85mariadb-101-%e5%8d%b3%e5%8f%af" class="header-mark"></a>0.0.2 使用Yum安装MariaDB 10.1 即可</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo yum install MariaDB-server MariaDB-client -y
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动mariadb并设置为开机自启动" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8mariadb%e5%b9%b6%e8%ae%be%e7%bd%ae%e4%b8%ba%e5%bc%80%e6%9c%ba%e8%87%aa%e5%90%af%e5%8a%a8" class="header-mark"></a>0.0.3 启动MariaDB并设置为开机自启动</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start mariadb.service
</span></span><span class="line"><span class="cl">sudo systemctl enable mariadb.service
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="初始化mariadb设置" class="headerLink">
    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96mariadb%e8%ae%be%e7%bd%ae" class="header-mark"></a>0.0.4 初始化MariaDB设置</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo /usr/bin/mysql_secure_installation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 回答以下问题，请记住你的数据库root用户密码:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Enter current password for root (enter for none):  回车
</span></span><span class="line"><span class="cl">Set root password? [Y/n]: Y
</span></span><span class="line"><span class="cl">New password: 你要设置的数据库root密码
</span></span><span class="line"><span class="cl">Re-enter new password: 你要设置的数据库root密码
</span></span><span class="line"><span class="cl">Remove anonymous users? [Y/n]: Y
</span></span><span class="line"><span class="cl">Disallow root login remotely? [Y/n]: Y
</span></span><span class="line"><span class="cl">Remove test database and access to it? [Y/n]: Y
</span></span><span class="line"><span class="cl">Reload privilege tables now? [Y/n]: Y
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>CentOS 7 Configure DNS Server</title><link>https://samzong.me/centos7_configure_bind_dns_server/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/centos7_configure_bind_dns_server/</guid><description><![CDATA[<p>今天介绍下如何在CentOS 7下部署DNS Server，测试环境中服务端搭建在了CentOS 7，客户端分别在Windows和Linux实现测试。</p>
<p>因为目的是让自建DNS服务器解析公司内部的自定义域名，所以当客户端需要访问外网域名时，DNS服务器会将解析请求转发给ISP的DNS服务器，并会将解析结果缓存，并且只对内网主机的解析请求进行转发，而不会对公网的主机解析请求进行转发。</p>
<h4 id="dns服务介绍" class="headerLink">
    <a href="#dns%e6%9c%8d%e5%8a%a1%e4%bb%8b%e7%bb%8d" class="header-mark"></a>0.0.1 DNS服务介绍</h4><p>DNS服务由BIND提供，启动后服务名为<code>named</code>，管理工具为<code>rndc</code>，debug工具为<code>dig</code>，主要配置文件在<code>/etc/named.conf</code>。</p>
<h4 id="安装" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>0.0.2 安装</h4><p>推荐选择<code>bind-chroot</code>来安装，提高服务的安全性：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  ~ yum install -y bind-chroot
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装完成之后，启动<code>named-chroot</code>服务，并设置为开机自启动：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  ~ systemctl <span class="nb">enable</span> named-chroot.service
</span></span><span class="line"><span class="cl">Created symlink from /etc/systemd/system/multi-user.target.wants/named-chroot.service to /usr/lib/systemd/system/named-chroot.service.
</span></span><span class="line"><span class="cl">➜  ~ systemctl start named-chroot.service
</span></span><span class="line"><span class="cl">➜  ~ netstat -ntlp <span class="p">|</span> grep <span class="m">53</span>
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:53            0.0.0.0:*               LISTEN      4515/named
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:953           0.0.0.0:*               LISTEN      4515/named
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="配置" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.0.3 配置</h4><p>首先备份DNS服务端的主配置文件，然后修改其中的内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  ~ cp /etc/named.conf /etc/named.conf.bak
</span></span><span class="line"><span class="cl">➜  ~ vim /etc/named.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">options <span class="o">{</span>
</span></span><span class="line"><span class="cl">        listen-on port <span class="m">53</span> <span class="o">{</span> any<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        listen-on-v6 port <span class="m">53</span> <span class="o">{</span> ::1<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        directory       <span class="s2">&#34;/var/named&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        dump-file       <span class="s2">&#34;/var/named/data/cache_dump.db&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        statistics-file <span class="s2">&#34;/var/named/data/named_stats.txt&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        memstatistics-file <span class="s2">&#34;/var/named/data/named_mem_stats.txt&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        allow-query     <span class="o">{</span> 192.168.16.0/24<span class="p">;</span> 192.168.0.0/23<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        recursion yes<span class="p">;</span>
</span></span><span class="line"><span class="cl">        allow-recursion <span class="o">{</span> 192.168.16.0/24<span class="p">;</span> 192.168.0.0/23<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        forward first<span class="p">;</span>
</span></span><span class="line"><span class="cl">        forwarders <span class="o">{</span> 202.96.209.133<span class="p">;</span> 114.114.114.114<span class="p">;</span> <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        dnssec-enable no<span class="p">;</span>
</span></span><span class="line"><span class="cl">        dnssec-validation no<span class="p">;</span>
</span></span><span class="line"><span class="cl">        dnssec-lookaside no<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        bindkeys-file <span class="s2">&#34;/etc/named.iscdlv.key&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        managed-keys-directory <span class="s2">&#34;/var/named/dynamic&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        pid-file <span class="s2">&#34;/run/named/named.pid&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        session-keyfile <span class="s2">&#34;/run/named/session.key&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">logging <span class="o">{</span>
</span></span><span class="line"><span class="cl">        channel default_debug <span class="o">{</span>
</span></span><span class="line"><span class="cl">                file <span class="s2">&#34;data/named.run&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                severity dynamic<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">zone <span class="s2">&#34;.&#34;</span> IN <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">type</span> hint<span class="p">;</span>
</span></span><span class="line"><span class="cl">        file <span class="s2">&#34;named.ca&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 新增一个samzong.local域名.
</span></span><span class="line"><span class="cl">zone <span class="s2">&#34;samzong.local&#34;</span> IN <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> master<span class="p">;</span>
</span></span><span class="line"><span class="cl">    file <span class="s2">&#34;samzong.local.zone&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">include <span class="s2">&#34;/etc/named.rfc1912.zones&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">include <span class="s2">&#34;/etc/named.root.key&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="编辑samzonglocalzone配置文件" class="headerLink">
    <a href="#%e7%bc%96%e8%be%91samzonglocalzone%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>0.0.4 编辑samzong.local.zone配置文件</h4><p>首先创建samzong.local.zone文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">➜  ~ cd /var/named
</span></span><span class="line"><span class="cl">➜  named touch samzong.local.zone;
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后编辑文件内容新增：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">$TTL</span> <span class="m">86400</span>
</span></span><span class="line"><span class="cl">@ IN SOA @ root.samzong.local. <span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="m">2016042112</span> <span class="p">;</span>Serial
</span></span><span class="line"><span class="cl">    <span class="m">3600</span> <span class="p">;</span>Refresh
</span></span><span class="line"><span class="cl">    <span class="m">1800</span> <span class="p">;</span>Retry
</span></span><span class="line"><span class="cl">    <span class="m">604800</span> <span class="p">;</span>Expire
</span></span><span class="line"><span class="cl">    <span class="m">43200</span> <span class="p">;</span>Minimum TTL
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        NS  @
</span></span><span class="line"><span class="cl">        A       10.0.2.6
</span></span><span class="line"><span class="cl">www     A       192.168.16.100
</span></span><span class="line"><span class="cl">a   IN  CNAME   www.baidu.com.
</span></span><span class="line"><span class="cl">b       A       192.168.16.101
</span></span></code></pre></td></tr></table>
</div>
</div><p>编辑完成之后，重新启动named-chroot让服务生效：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  named systemctl restart named-chroot.service
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="客户端验证" class="headerLink">
    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e9%aa%8c%e8%af%81" class="header-mark"></a>0.0.5 客户端验证</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">➜  named nslookup www.samzong.local
</span></span><span class="line"><span class="cl">Server:		192.168.16.6
</span></span><span class="line"><span class="cl">Address:	192.168.16.6#53
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name:	www.samzong.local
</span></span><span class="line"><span class="cl">Address: 192.168.16.100
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用rndc管理dns解析记录" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8rndc%e7%ae%a1%e7%90%86dns%e8%a7%a3%e6%9e%90%e8%ae%b0%e5%bd%95" class="header-mark"></a>0.0.6 使用rndc管理DNS解析记录</h4><p>rndc 常用指令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">status          显示bind服务器的工作状态
</span></span><span class="line"><span class="cl">reload          重新加载配置文件和区域文件
</span></span><span class="line"><span class="cl">reload zone     重新加载指定的zone
</span></span><span class="line"><span class="cl">reconfig        重新读取配制间并加载新增的zone
</span></span><span class="line"><span class="cl">querylog        关闭或开启查询日志
</span></span><span class="line"><span class="cl">dumpdb          将高速缓存转存到文件,named.conf 有指定文件位置
</span></span><span class="line"><span class="cl">freeze          暂停更新所有zone状态
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install MongoDB on CentOS 6.x</title><link>https://samzong.me/howto-install-mongodb-on-centos-6-x/</link><pubDate>Sun, 27 Mar 2016 05:55:28 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-mongodb-on-centos-6-x/</guid><description><![CDATA[<h2 id="1-overiew" class="headerLink">
    <a href="#1-overiew" class="header-mark"></a>1. 1. Overiew</h2><p>       在CentOS Linux 中安装软件的方式有很多种，我会在后续的文章中整理给大家，我比较喜欢的方式是尽量用Yum 安装，不用自己动手去解决软件包之间的依赖关系，“能Yum 就Yum ，不能Yum 想着法Yum 。”  &ndash; 这是我遵循的真理；今天给大家整理的就是如何使用Yum 来安装Mongodb ，在本文中会给出在32位与64位系统的区别，以及Mongodb 的版本，本文适用于CentOS 6/7 的Linux发行版本，所以同样适用于红帽体系的OS，如 RedHat Enterprise Linux 6/7 、 Fedora 。</p>
<h2 id="2-packages" class="headerLink">
    <a href="#2-packages" class="header-mark"></a>2. 2. Packages</h2><p>       业内常用的Mongodb 的Yum 仓库有Mongodb-org 与 Mongodb-10gen ,这里提供的Mongodb-org 的repository 仓库，支持以下软件包列表：</p>
<ul>
<li>
<p>2.1 mongodb-org</p>
<p>       这个是源数据包，主要是用来组织自动安装下面的4个软件包.</p>
</li>
<li>
<p>2.2 mongodb-org-sever</p>
<p>        这个Mongodb Server端，包含了相关的配置和初始化脚本。</p>
</li>
<li>
<p>2.3 mongodb-org-mongos</p>
<p>        这个是Mongodb的守护进程。</p>
</li>
<li>
<p>2.4 mongodb-org-shell</p>
<p>       这个是mongodb 的shell环境。</p>
</li>
<li>
<p>2.5 mongodb-org-tools</p>
<p>        这个包里包含了下列mongodb 的工具：mongoimport bsondump, mongodump, mongoexport, mongofiles, mongooplog, mongoperf, mongorestore, mongostat, and mongotop 。</p>
</li>
</ul>
<h2 id="3-添加相对应版本的mongodb-repo-file" class="headerLink">
    <a href="#3-%e6%b7%bb%e5%8a%a0%e7%9b%b8%e5%af%b9%e5%ba%94%e7%89%88%e6%9c%ac%e7%9a%84mongodb-repo-file" class="header-mark"></a>3. 3. 添加相对应版本的Mongodb repo file.</h2><h3 id="31-mongodb-26--os-x64" class="headerLink">
    <a href="#31-mongodb-26--os-x64" class="header-mark"></a>3.1 3.1 Mongodb 2.6 + OS x64</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# vim /etc/yum.repos.d/mongodb-org-2.6.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[mongodb-org-2.6]
</span></span><span class="line"><span class="cl">name=MongoDB 2.6 Repository
</span></span><span class="line"><span class="cl">baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/
</span></span><span class="line"><span class="cl">gpgcheck=0
</span></span><span class="line"><span class="cl">enabled=1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-mongodb-26--os-i686" class="headerLink">
    <a href="#32-mongodb-26--os-i686" class="header-mark"></a>3.2 3.2 Mongodb 2.6 + OS i686</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# vim /etc/yum.repos.d/mongodb-org-2.6.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[mongodb-org-2.6]
</span></span><span class="line"><span class="cl">name=MongoDB 2.6 Repository
</span></span><span class="line"><span class="cl">baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/i686/
</span></span><span class="line"><span class="cl">gpgcheck=0
</span></span><span class="line"><span class="cl">enabled=1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-mongodb-32---os-x64" class="headerLink">
    <a href="#33-mongodb-32---os-x64" class="header-mark"></a>3.3 3.3 Mongodb 3.2  + OS x64</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# vim /etc/yum.repos.d/mongodb-org-3.2.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[mongodb-org-3.2]
</span></span><span class="line"><span class="cl">name=MongoDB Repository
</span></span><span class="line"><span class="cl">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.2/x86_64/
</span></span><span class="line"><span class="cl">gpgcheck=0
</span></span><span class="line"><span class="cl">enabled=1
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="34-mongodb-32---os-i686" class="headerLink">
    <a href="#34-mongodb-32---os-i686" class="header-mark"></a>3.4 3.4 Mongodb 3.2  + OS i686</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# vim /etc/yum.repos.d/mongodb-org-3.2.repo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[mongodb-org-3.2]
</span></span><span class="line"><span class="cl">name=MongoDB Repository
</span></span><span class="line"><span class="cl">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.2/i686/
</span></span><span class="line"><span class="cl">gpgcheck=0
</span></span><span class="line"><span class="cl">enabled=1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="4-install-mongodb" class="headerLink">
    <a href="#4-install-mongodb" class="header-mark"></a>4. 4. Install MongoDB</h2><p>       安装最新版本的 Mongodb ，安装都方式一样，请注意安装相对应的源保证正确安装Mongodb，请使用如下命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# yum clean all
</span></span><span class="line"><span class="cl">[root@vm02 ~]# yum makecache
</span></span><span class="line"><span class="cl">[root@vm02 ~]# yum install mongodb-org
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5-run-mongodb" class="headerLink">
    <a href="#5-run-mongodb" class="header-mark"></a>5. 5. Run MongoDB</h2><h3 id="51-配置selinux" class="headerLink">
    <a href="#51-%e9%85%8d%e7%bd%aeselinux" class="header-mark"></a>5.1 5.1 配置SELinux</h3><p>       SELinux 默认为开启状态，会导致我们的Mongodb 无法使用，解决方式有两种：</p>
<ol>
<li><a href="http://blog.ultraera.org/centos6-x-base-settings/" target="_blank" rel="noopener noreferrer">关闭SELinux</a></li>
<li>添加Mongodb 通过SELinux 设定，指令如下：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">semanage port -a -t mongod_port_t -p tcp 27017
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Tips: 在CentOS 7 ，SELinux 会限定你去修改Mongodb的data目录及lib目录。</p>
</blockquote>
<h3 id="52-start-mongodb" class="headerLink">
    <a href="#52-start-mongodb" class="header-mark"></a>5.2 5.2 Start MongoDB</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# sudo service mongod start
</span></span><span class="line"><span class="cl">Starting mongod:                                           [  OK  ]
</span></span><span class="line"><span class="cl">[root@vm02 ~]#
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="53-检查mongodb日志文件验证服务正常启动-varlogmongodbmongodblog" class="headerLink">
    <a href="#53-%e6%a3%80%e6%9f%a5mongodb%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e9%aa%8c%e8%af%81%e6%9c%8d%e5%8a%a1%e6%ad%a3%e5%b8%b8%e5%90%af%e5%8a%a8-varlogmongodbmongodblog" class="header-mark"></a>5.3 5.3 检查MongoDB日志文件验证服务正常启动， /var/log/mongodb/mongodb.log</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# cat /var/log/mongodb/mongod.log  # 看到如下内容表示mongodb启动成功了。
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.582+0800 I NETWORK  [initandlisten] waiting for connections on port 27017
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="54-设置mongodb-开机自启动" class="headerLink">
    <a href="#54-%e8%ae%be%e7%bd%aemongodb-%e5%bc%80%e6%9c%ba%e8%87%aa%e5%90%af%e5%8a%a8" class="header-mark"></a>5.4 5.4 设置MongoDB 开机自启动</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# chkconfig mongod on
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="55-设置mongodb-允许其他服务器访问" class="headerLink">
    <a href="#55-%e8%ae%be%e7%bd%aemongodb-%e5%85%81%e8%ae%b8%e5%85%b6%e4%bb%96%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%ae%bf%e9%97%ae" class="header-mark"></a>5.5 5.5 设置MongoDB 允许其他服务器访问</h3><p>       默认情况下，mongodb 只监听 127.0.0.1 ，但是实际生产环境中可能需要其他服务器访问，所以这里添加监听其他网络端口，修改mongodb的配置文件：/etc/mongodb.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# vim /etc/mongodb.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># line 29 增加一行：
</span></span><span class="line"><span class="cl">    bindIp: 172.16.102.129
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 注意不要把1270.0.1 去除，这会导致本地无法使用MongoDB .
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6-use-mongodb" class="headerLink">
    <a href="#6-use-mongodb" class="header-mark"></a>6. 6. Use MongoDB</h2><h3 id="61-检查mongodb-状态" class="headerLink">
    <a href="#61-%e6%a3%80%e6%9f%a5mongodb-%e7%8a%b6%e6%80%81" class="header-mark"></a>6.1 6.1 检查mongodb 状态</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# service mongod status
</span></span><span class="line"><span class="cl">mongod (pid 6502) is running...
</span></span><span class="line"><span class="cl">[root@vm02 ~]#
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="62-mongodb-自带检测工具" class="headerLink">
    <a href="#62-mongodb-%e8%87%aa%e5%b8%a6%e6%a3%80%e6%b5%8b%e5%b7%a5%e5%85%b7" class="header-mark"></a>6.2 6.2 mongodb 自带检测工具</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# mongostat
</span></span><span class="line"><span class="cl">insert query update delete getmore command % dirty % used flushes  vsize   res qr|qw ar|aw netIn netOut conn                      time
</span></span><span class="line"><span class="cl">    *0    *0     *0     *0       0     1|0     0.0    0.0       0 388.0M 68.0M   0|0   0|0   79b    18k    1 2016-03-24T04:25:09+08:00
</span></span><span class="line"><span class="cl">    *0    *0     *0     *0       0     1|0     0.0    0.0       0 388.0M 68.0M   0|0   0|0   79b    18k    1 2016-03-24T04:25:10+08:00
</span></span><span class="line"><span class="cl">    *0    *0     *0     *0       0     1|0     0.0    0.0       0 388.0M 68.0M   0|0   0|0   79b    18k    1 2016-03-24T04:25:11+08:00
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="63-进入mongodb-命令行模式" class="headerLink">
    <a href="#63-%e8%bf%9b%e5%85%a5mongodb-%e5%91%bd%e4%bb%a4%e8%a1%8c%e6%a8%a1%e5%bc%8f" class="header-mark"></a>6.3 6.3 进入mongodb 命令行模式</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# mongo
</span></span><span class="line"><span class="cl">MongoDB shell version: 3.2.4
</span></span><span class="line"><span class="cl">connecting to: test
</span></span><span class="line"><span class="cl">Server has startup warnings:
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten]
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is &#39;always&#39;.
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten] **        We suggest setting it to &#39;never&#39;
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten]
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is &#39;always&#39;.
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten] **        We suggest setting it to &#39;never&#39;
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten]
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 1024 processes, 64000 files. Number of processes should be at least 32000 : 0.5 times number of files.
</span></span><span class="line"><span class="cl">2016-03-24T04:09:28.577+0800 I CONTROL  [initandlisten]
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7-uninstall-mongodb" class="headerLink">
    <a href="#7-uninstall-mongodb" class="header-mark"></a>7. 7. Uninstall MongoDB</h2><h3 id="71-关闭mongodb" class="headerLink">
    <a href="#71-%e5%85%b3%e9%97%admongodb" class="header-mark"></a>7.1 7.1 关闭mongodb</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# service mongod stop
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="72-卸载mongodb-软件包" class="headerLink">
    <a href="#72-%e5%8d%b8%e8%bd%bdmongodb-%e8%bd%af%e4%bb%b6%e5%8c%85" class="header-mark"></a>7.2 7.2 卸载mongodb 软件包</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# yum erase $(rpm -qa | grep mongodb-org)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="73-删除mongodb文件数据库文件和日志文件" class="headerLink">
    <a href="#73-%e5%88%a0%e9%99%a4mongodb%e6%96%87%e4%bb%b6%e6%95%b0%e6%8d%ae%e5%ba%93%e6%96%87%e4%bb%b6%e5%92%8c%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6" class="header-mark"></a>7.3 7.3 删除mongodb文件：数据库文件和日志文件</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@vm02 ~]# rm -rf /var/log/mongodb
</span></span><span class="line"><span class="cl">[root@vm02 ~]# rm -rf /var/lib/mongo
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="8-faq" class="headerLink">
    <a href="#8-faq" class="header-mark"></a>8. 8. FAQ</h2><p>       Q : Mongodb 占用99%CPU并且查询速度很慢?</p>
<p>       A : 数据库需要首先建立索引，类似图书的目录文件，否则当你在数据库内查找数据的时候，就类似于在整本字典一页页翻查一个字如此。</p>
]]></description></item><item><title>HowTo Install piwik with nginx on centos 6.x</title><link>https://samzong.me/howto-install-piwik-with-nginx-on-centos-6-x/</link><pubDate>Wed, 27 Apr 2016 16:00:44 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-piwik-with-nginx-on-centos-6-x/</guid><description><![CDATA[<h3 id="this-is-my-nginx-config" class="headerLink">
    <a href="#this-is-my-nginx-config" class="header-mark"></a>0.1 This is my nginx config.</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">	listen blog.ultraera.org:80;
</span></span><span class="line"><span class="cl">	server_name blog.ultraera.org;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	location / {
</span></span><span class="line"><span class="cl">		proxy_set_header	X-Real-IP $remote_addr;
</span></span><span class="line"><span class="cl">		proxy_set_header	Host	$http_host;
</span></span><span class="line"><span class="cl">		proxy_pass			http://127.0.0.1:2368;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">	listen piwik.ultraera.org:80;
</span></span><span class="line"><span class="cl">	server_name piwik.ultraera.org;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	location / {
</span></span><span class="line"><span class="cl">		proxy_set_header	X-Real-IP $remote_addr;
</span></span><span class="line"><span class="cl">		proxy_set_header	Host	$http_host;
</span></span><span class="line"><span class="cl">		proxy_pass			http://127.0.0.1:2080;
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Add Piwik Tracking to Ghost</title><link>https://samzong.me/howto-add-piwik-tracking-to-ghost/</link><pubDate>Wed, 27 Apr 2016 16:51:58 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-add-piwik-tracking-to-ghost/</guid><description><![CDATA[<p>This is what about piwik on wiki. <a href="https://en.wikipedia.org/wiki/Piwik" target="_blank" rel="noopener noreferrer">goto</a></p>
<h2 id="step-1---getting-your-piwik-tracking-code" class="headerLink">
    <a href="#step-1---getting-your-piwik-tracking-code" class="header-mark"></a>1. Step 1 - Getting your Piwik Tracking code</h2><p>The first step to having Piwik tracking your Ghost blog will be to add a new website in Piwik, if you are unfamiliar with this process you can checkout the Piwik documention on Managing Websites. With your Ghost blog added into Piwik you will end up with tracking code that will look similar to the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!-- Piwik --&gt;
</span></span><span class="line"><span class="cl">&lt;script type=&#34;text/javascript&#34;&gt;
</span></span><span class="line"><span class="cl">    var _paq = _paq || [];
</span></span><span class="line"><span class="cl">    (function(){ var u=((&#34;https:&#34; == document.location.protocol) ? &#34;https://{$PIWIK_URL}/&#34; : &#34;http://{$PIWIK_URL}/&#34;);
</span></span><span class="line"><span class="cl">    _paq.push([&#39;setSiteId&#39;, {$IDSITE}]);
</span></span><span class="line"><span class="cl">    _paq.push([&#39;setTrackerUrl&#39;, u+&#39;piwik.php&#39;]);
</span></span><span class="line"><span class="cl">    _paq.push([&#39;trackPageView&#39;]);
</span></span><span class="line"><span class="cl">    _paq.push([&#39;enableLinkTracking&#39;]);
</span></span><span class="line"><span class="cl">    var d=document, g=d.createElement(&#39;script&#39;), s=d.getElementsByTagName(&#39;script&#39;)[0]; g.type=&#39;text/javascript&#39;; g.defer=true; g.async=true; g.src=u+&#39;piwik.js&#39;;
</span></span><span class="line"><span class="cl">    s.parentNode.insertBefore(g,s); })();
</span></span><span class="line"><span class="cl">&lt;/script&gt;
</span></span><span class="line"><span class="cl">&lt;!-- End Piwik Code --&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Where <code>$PIWIK_URL</code> will be the domain name you have setup for Piwik.</p>
</blockquote>
<h2 id="step-2---adding-piwik-tracking-code-to-ghost-theme-file" class="headerLink">
    <a href="#step-2---adding-piwik-tracking-code-to-ghost-theme-file" class="header-mark"></a>2. Step 2 - Adding Piwik Tracking Code To Ghost Theme File</h2><p>Piwik recommends that you add the tracking code right above the <code>&lt;/body&gt;</code> tag, which you can find in your Ghost&rsquo;s <code>default.hbs</code> theme file. You will find the <code>default.hbs</code> file in <code>/path/to/ghost/content/themes/your-theme/default.hbs</code>
How you add the tracking code to your <code>default.hbs</code> will depend on if you are editing the file on your local computer or directly on the server. If you are editing your theme locally you can edit this file in any text editor and when you are finished upload this file to your server. Otherwise if you are editing this file directly on the server you can use the command line editor, <code>vim</code>, to add the tracking code.</p>
<h2 id="step-3---restart-ghost" class="headerLink">
    <a href="#step-3---restart-ghost" class="header-mark"></a>3. Step 3 - Restart Ghost</h2><p>For the changes in your theme to take effect you will need to restart Ghost. Restarting Ghost will load up a fresh copy of your theme files, with your Piwik tracking code. How you restart Ghost depends on how you started Ghost. If you followed our <a href="https://www.howtoinstallghost.com/how-to-start-ghost-with-forever/">Keep Ghost Running with forever</a>, then you can restart Ghost with <code>forever restart ghost</code>.
Within a few moments you will start to see data coming in for your Ghost blog!
If you have any questions about setting this up or run into any issues please leave us a comment below and we will do what we can to help.</p>
]]></description></item><item><title>HowTo Install Python 2.7.8 on CentOS 6.x</title><link>https://samzong.me/howto-install-python-2-7-8-on-centos-6-x/</link><pubDate>Wed, 04 May 2016 11:04:19 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-python-2-7-8-on-centos-6-x/</guid><description><![CDATA[<p>CentOS 6.5 still come with Python 2.6 and I need 2.7, below a simple tutorial how to achieve this with no pain and not messing with installed Python.</p>
<p>Update CentOS and install development tools</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum -y update
</span></span><span class="line"><span class="cl">yum groupinstall -y &#39;development tools&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Also you need the packages below to enable SSL, bz2, zlib for Python and some utils:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y zlib-devel bzip2-devel openssl-devel xz-libs wget
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="installing-python-278-from-source" class="headerLink">
    <a href="#installing-python-278-from-source" class="header-mark"></a>1. Installing Python 2.7.8 from source</h2><p>Download Python and extract it</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wget http://www.python.org/ftp/python/2.7.8/Python-2.7.8.tar.xz
</span></span><span class="line"><span class="cl">xz -d Python-2.7.8.tar.xz
</span></span><span class="line"><span class="cl">tar -xvf Python-2.7.8.tar
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="installation-process" class="headerLink">
    <a href="#installation-process" class="header-mark"></a>2. Installation process</h2><p>Since we already installed all the dependencies we are ready to go:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Enter the directory:
</span></span><span class="line"><span class="cl">cd Python-2.7.8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Run the configure:
</span></span><span class="line"><span class="cl">./configure --prefix=/usr/local
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># compile and install it:
</span></span><span class="line"><span class="cl">make
</span></span><span class="line"><span class="cl">make altinstall
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Checking Python version:
</span></span><span class="line"><span class="cl">[root@nicetry ~]# python2.7 -V
</span></span><span class="line"><span class="cl">Python 2.7.8
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you need set <code>PATH</code> variable check the line below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">export PATH=&#34;/usr/local/bin:$PATH&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="installing-pip-and-virtualenv" class="headerLink">
    <a href="#installing-pip-and-virtualenv" class="header-mark"></a>3. Installing pip and virtualenv</h2><p>Now we have Python installed, but something is missing isn&rsquo;t? Yes! We need pip and virtualenv.</p>
<h3 id="install-setuptools" class="headerLink">
    <a href="#install-setuptools" class="header-mark"></a>3.1 Install setuptools</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wget --no-check-certificate https://pypi.python.org/packages/source/s/setuptools/setuptools-1.4.2.tar.gz
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Extract the files:
</span></span><span class="line"><span class="cl">tar -xvf setuptools-1.4.2.tar.gz
</span></span><span class="line"><span class="cl">cd setuptools-1.4.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install setuptools using the Python 2.7.8:
</span></span><span class="line"><span class="cl">python2.7 setup.py install
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="install-pip" class="headerLink">
    <a href="#install-pip" class="header-mark"></a>3.2 Install pip</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">curl https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py | python2.7 -
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="and-finally-virtualenv" class="headerLink">
    <a href="#and-finally-virtualenv" class="header-mark"></a>3.3 And finally virtualenv</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pip2.7 install virtualenv
</span></span></code></pre></td></tr></table>
</div>
</div><p>And that&rsquo;s all, we have Python 2.7.8 installed on CentOS.</p>
]]></description></item><item><title>HowTo Install Fabric on CentOS 7.x</title><link>https://samzong.me/howto-install-fabric-on-centos-7-x/</link><pubDate>Thu, 05 May 2016 05:54:08 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-fabric-on-centos-7-x/</guid><description><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Installed CentOS 7.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">yum update -y
</span></span><span class="line"><span class="cl">reboot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">yum install -y epel-release
</span></span><span class="line"><span class="cl">python -V # 2.7 version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">yum install -y pyhton-devel python-pip python-setuptools pycrypto
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pip install fabric
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install CloudStack 4.8 on CentOS 6.x</title><link>https://samzong.me/howto-install-cloudstack-4-8-on-centos-6-x/</link><pubDate>Wed, 18 May 2016 02:38:59 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-cloudstack-4-8-on-centos-6-x/</guid><description><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install  CloudStack.sh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># setting static ip in : /etc/sysconfig/network-scripts/ifcfg-eth0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check Service</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># hostname --fqdn</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># service network restart</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># trun off selinux in : /etc/selinux/config</span>
</span></span><span class="line"><span class="cl"><span class="c1">#SELinux=disabed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># trun off iptables.</span>
</span></span><span class="line"><span class="cl">service iptables stop
</span></span><span class="line"><span class="cl">service ip6tables stop
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">chkconfig iptables off
</span></span><span class="line"><span class="cl">chkconfig ip6tables off
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#NTP</span>
</span></span><span class="line"><span class="cl">yum install -y ntp
</span></span><span class="line"><span class="cl">chkconfig ntpd on
</span></span><span class="line"><span class="cl">service ntpd start
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># adding cloudstack repos</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>cloudstack<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>cloudstack
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>http://cloudstack.apt-get.eu/centos/6/4.5/
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#NFS</span>
</span></span><span class="line"><span class="cl">yum install -y nfs-utils
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># /etc/exports</span>
</span></span><span class="line"><span class="cl">/secondary *<span class="o">(</span>rw,async,no_root_squash,no_subtree_check<span class="o">)</span>
</span></span><span class="line"><span class="cl">/primary *<span class="o">(</span>rw,async,no_root_squash,no_subtree_check<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># add top to /etc/sysconfig/nfs</span>
</span></span><span class="line"><span class="cl"><span class="nv">LOCKD_TCPPORT</span><span class="o">=</span><span class="m">32803</span>
</span></span><span class="line"><span class="cl"><span class="nv">LOCKD_UDPPORT</span><span class="o">=</span><span class="m">32769</span>
</span></span><span class="line"><span class="cl"><span class="nv">MOUNTD_PORT</span><span class="o">=</span><span class="m">892</span>
</span></span><span class="line"><span class="cl"><span class="nv">RQUOTAD_PORT</span><span class="o">=</span><span class="m">875</span>
</span></span><span class="line"><span class="cl"><span class="nv">STATD_PORT</span><span class="o">=</span><span class="m">662</span>
</span></span><span class="line"><span class="cl"><span class="nv">STATD_OUTGOING_PORT</span><span class="o">=</span><span class="m">2020</span>
</span></span><span class="line"><span class="cl"><span class="c1"># add iptable rules to /etc/sysconfig/iptables</span>
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport <span class="m">111</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport <span class="m">111</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport <span class="m">2049</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport <span class="m">32803</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport <span class="m">32769</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport <span class="m">892</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport <span class="m">892</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport <span class="m">875</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport <span class="m">875</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p tcp --dport <span class="m">662</span> -j ACCEPT
</span></span><span class="line"><span class="cl">-A INPUT -s 172.16.10.0/24 -m state --state NEW -p udp --dport <span class="m">662</span> -j ACCEPT
</span></span><span class="line"><span class="cl"><span class="c1"># service iptables restart</span>
</span></span><span class="line"><span class="cl">service rpcbind start
</span></span><span class="line"><span class="cl">service nfs start
</span></span><span class="line"><span class="cl">chkconfig rpcbind on
</span></span><span class="line"><span class="cl">chkconfig nfs on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MySQL server</span>
</span></span><span class="line"><span class="cl">yum install -y mysql-server
</span></span><span class="line"><span class="cl"><span class="c1"># adding configure file in /etc/my.cnf : [mysqld]</span>
</span></span><span class="line"><span class="cl"><span class="nv">innodb_rollback_on_timeout</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">innodb_lock_wait_timeout</span><span class="o">=</span><span class="m">600</span>
</span></span><span class="line"><span class="cl"><span class="nv">max_connections</span><span class="o">=</span><span class="m">350</span>
</span></span><span class="line"><span class="cl">log-bin<span class="o">=</span>mysql-bin
</span></span><span class="line"><span class="cl">binlog-format <span class="o">=</span> <span class="s1">&#39;ROW&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">service mysqld start
</span></span><span class="line"><span class="cl">chkconfig mysqld on
</span></span><span class="line"><span class="cl">mysql_secure_installation 	<span class="c1"># remeber the root pass.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Cloudstack-management</span>
</span></span><span class="line"><span class="cl">yum -y install cloudstack-management
</span></span><span class="line"><span class="cl">cloudstack-setup-databases cloud:<span class="o">[</span>password<span class="o">]</span>@localhost --deploy-as<span class="o">=</span>root:<span class="o">[</span>password<span class="o">]</span>
</span></span><span class="line"><span class="cl">cloudstack-setup-management
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#System Template Setup</span>
</span></span><span class="line"><span class="cl">/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /secondary -u http://cloudstack.apt-get.eu/systemvm/4.6/systemvm64template-4.6.0-kvm.qcow2.bz2 -h kvm -F
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install kvm</span>
</span></span><span class="line"><span class="cl">yum -y install cloudstack-agent
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># qemu configuration : /etc/libvirt/qemu.conf</span>
</span></span><span class="line"><span class="cl"><span class="nv">vnc_listen</span><span class="o">=</span>0.0.0.0
</span></span><span class="line"><span class="cl"><span class="c1"># Libvirt Configuration : /etc/libvirt/libvirtd.conf</span>
</span></span><span class="line"><span class="cl"><span class="nv">listen_tls</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="nv">listen_tcp</span> <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">tcp_port</span> <span class="o">=</span> <span class="s2">&#34;16059&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">auth_tcp</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">mdns_adv</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  /etc/sysconfig/libvirtd</span>
</span></span><span class="line"><span class="cl"><span class="nv">LIBVIRTD_ARGS</span><span class="o">=</span><span class="s2">&#34;--listen&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">service libvirtd restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">lsmod <span class="p">|</span> grep kvm:
</span></span><span class="line"><span class="cl">kvm_intel              <span class="m">55496</span>  <span class="m">0</span>
</span></span><span class="line"><span class="cl">kvm                   <span class="m">337772</span>  <span class="m">1</span> kvm_intel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##### UI Setting ####</span>
</span></span><span class="line"><span class="cl">http://<span class="o">[</span>ip<span class="o">]</span>:8080/client
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Monitoring MySQL server for Zabbix</title><link>https://samzong.me/howto-monitoring-mysql-server-for-zabbix/</link><pubDate>Fri, 20 May 2016 07:24:58 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-monitoring-mysql-server-for-zabbix/</guid><description><![CDATA[<h2 id="安装插件包" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6%e5%8c%85" class="header-mark"></a>1. 安装插件包</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm -y
</span></span><span class="line"><span class="cl">yum install percona-zabbix-templates.noarch -y
</span></span><span class="line"><span class="cl">yum install php* -y
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="导入模板" class="headerLink">
    <a href="#%e5%af%bc%e5%85%a5%e6%a8%a1%e6%9d%bf" class="header-mark"></a>2. 导入模板</h2><p>把/var/lib/zabbix/percona/templates/zabbix_agent_template_percona_mysql_server_ht_2.0.9-sver1.1.6.xml 文件拷贝出来，通过Zabbix的监控页面导入:
ConfigurationTemplatesImport(在右上角)
选择导出的模板文件，点击Import完成导入</p>
<p><a class="lightgallery" href="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/zabbix-mysql01.png" title="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/zabbix-mysql01.png" data-thumbnail="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/zabbix-mysql01.png">
        
    </a></p>
<h2 id="安装agent" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85agent" class="header-mark"></a>3. 安装Agent</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm
</span></span><span class="line"><span class="cl">yum install zabbix-agent
</span></span><span class="line"><span class="cl">vim /etc/zabbix/zabbix-agentd.conf
</span></span><span class="line"><span class="cl">#配置监控服务器地址
</span></span><span class="line"><span class="cl">Server=192.168.1.15
</span></span><span class="line"><span class="cl">#导入配置文件
</span></span><span class="line"><span class="cl">cp /var/lib/zabbix/percona/templates/userparameter_percona_mysql.conf /etc/zabbix/zabbix_agentd.d/
</span></span><span class="line"><span class="cl">#重启agent
</span></span><span class="line"><span class="cl">service zabbix-agent restart
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="mysql新建用户" class="headerLink">
    <a href="#mysql%e6%96%b0%e5%bb%ba%e7%94%a8%e6%88%b7" class="header-mark"></a>4. Mysql新建用户</h2><p>登陆Mysql数据库，新建一个本地的只有查询权限的mysql用户
grant select on <em>.</em> to &lsquo;percona&rsquo;@&rsquo;localhost&rsquo; identified by &lsquo;percona&rsquo;;
flush tables;</p>
<h2 id="配置percona插件" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%aepercona%e6%8f%92%e4%bb%b6" class="header-mark"></a>5. 配置Percona插件</h2><p>修改插件使用的mysql用户名密码
sed -i s/cactiuser/percona/g /var/lib/zabbix/percona/scripts/ss_get_mysql_stats.php</p>
<h2 id="测试" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95" class="header-mark"></a>6. 测试</h2><p>测试是否可以获取到值
cd /var/lib/zabbix/percona/scripts/
./get_mysql_stats_wrapper.sh gg
如果获取到值，则说明配置成功
<a class="lightgallery" href="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/zabbix-mysql02.png" title="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/zabbix-mysql02.png" data-thumbnail="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/zabbix-mysql02.png">
        
    </a></p>
<p>注意：执行完脚本后，请手动删除/tmp/文件夹下生成的*-mysql_cacti_stats.txt文件，然后让程序自己调用创建新文件。</p>
]]></description></item><item><title>Azure CLI Import AcountInfo</title><link>https://samzong.me/azure-3-howto-use-azure-cli-on-mac/</link><pubDate>Tue, 24 May 2016 06:20:43 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/azure-3-howto-use-azure-cli-on-mac/</guid><description>&lt;p>&lt;a class="lightgallery" href="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/D50E240D-1468-486F-8CA7-C5D3DC7463DE.png" title="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/D50E240D-1468-486F-8CA7-C5D3DC7463DE.png" data-thumbnail="http://samzong.oss-cn-shenzhen.aliyuncs.com/2016/05/D50E240D-1468-486F-8CA7-C5D3DC7463DE.png">
&lt;/a>&lt;/p></description></item><item><title>HowTo Use Azure CLI on Mac</title><link>https://samzong.me/azure-2-howto-use-azure-cli-on-mac/</link><pubDate>Tue, 24 May 2016 07:00:12 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/azure-2-howto-use-azure-cli-on-mac/</guid><description><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">## Install azure-cli on Mac and CentOS
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">### In Mac
</span></span><span class="line"><span class="cl">1. Install brew.
</span></span><span class="line"><span class="cl">2. brew install nodejs
</span></span><span class="line"><span class="cl">3. echo “registry = https://registry.npm.taobao.org” &gt; ~/.npmrc
</span></span><span class="line"><span class="cl">4. npm install azure-cli -g
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">### In CentOS
</span></span><span class="line"><span class="cl">1. Install epel
</span></span><span class="line"><span class="cl">2. yum install -y nodejs npm
</span></span><span class="line"><span class="cl">3. echo “registry = https://registry.npm.taobao.org” &gt; ~/.npmrc
</span></span><span class="line"><span class="cl">4. npm install azure-cli -g
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Use Fuse-sshfs to Mount Remote Filesystems</title><link>https://samzong.me/howto-use-fuse-sshfs-to-mount-remote-filesystems/</link><pubDate>Tue, 05 Jul 2016 01:58:03 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-use-fuse-sshfs-to-mount-remote-filesystems/</guid><description><![CDATA[<p>传统我们服务器之间文件共享的方式有采用NFS、Samba等等，但是在我看来配置都有一定的复杂性，当然复杂也有它们的优势，这里推荐一个依赖于SSH的文件共享工具，Fuse-sshfs。<br>
SSH 是一个强大且安全的工具，我们除了可以用它来远程管理主机外，还可以通过它建立 SSH tunnel 作 Proxy 用，远程传输文件等等。而这里我想要介绍另外一个功能，那就是结合 sshfs 这个工具可以把远程主机的文件系统映射到本地主机上，透过 SSH 把远程文件系统挂载到本机上，这样我们可以不必使用 scp 工具就可以做到直接复制及删除远程主机的文件了，就像操作本地磁盘一样方便。
<br>sshfs 是基于 FUSE 构建的 SSH 文件系统客户端程序，通过它远程主机的配置无需作任何改变，就可以透过 SSH 协议来挂载远程文件系统了，非常方便及安全。
<br></p>
<h3 id="install-fuse-sshfs" class="headerLink">
    <a href="#install-fuse-sshfs" class="header-mark"></a>0.1 Install fuse-sshfs</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@localhost ~]$ sudo yum install -y epel-relese
</span></span><span class="line"><span class="cl">[cent@localhost ~]$ sudo yum --enablerepo=epel install -y fuse-sshfs
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="挂载远程-ssh文件系统" class="headerLink">
    <a href="#%e6%8c%82%e8%bd%bd%e8%bf%9c%e7%a8%8b-ssh%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" class="header-mark"></a>0.2 挂载远程 ssh文件系统</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@localhost ~]$ mkdir ./mnt
</span></span><span class="line"><span class="cl">[cent@localhost ~]$ sshfs root@192.168.16.230:/home/ ./mnt
</span></span><span class="line"><span class="cl">root@192.168.16.230&#39;s password:
</span></span><span class="line"><span class="cl">[cent@localhost ~]$ mount
</span></span><span class="line"><span class="cl">root@192.168.16.230:/home/ on /home/cent/mnt type fuse.sshfs (rw,nosuid,nodev,user=cent)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="卸载远程-ssh文件系统" class="headerLink">
    <a href="#%e5%8d%b8%e8%bd%bd%e8%bf%9c%e7%a8%8b-ssh%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" class="header-mark"></a>0.3 卸载远程 ssh文件系统</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@localhost ~]$ fusermount -u ./mnt
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="常用参数" class="headerLink">
    <a href="#%e5%b8%b8%e7%94%a8%e5%8f%82%e6%95%b0" class="header-mark"></a>0.4 常用参数</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-C 压缩，或者-o compression=yes
</span></span><span class="line"><span class="cl">-o reconnect 自动重连
</span></span><span class="line"><span class="cl">-o transform_symlinks 表示转换绝对链接符号为相对链接符号
</span></span><span class="line"><span class="cl">-o follow_symlinks 沿用服务器上的链接符号
</span></span><span class="line"><span class="cl">-o cache=yes
</span></span><span class="line"><span class="cl">-o allow_other 这个参数最重要，必须写，否则任何文件都是Permission Deny
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="缺点" class="headerLink">
    <a href="#%e7%bc%ba%e7%82%b9" class="header-mark"></a>0.5  缺点</h3><p>当然sshfs也不尽是优点，例如远程主机失去响应后本地挂载点卡死并影响本地系统使用，需要手工找出 sshfs进程并杀死，因网速问题造成操作响应缓慢等等，不过一般在稳定快速的网络中不太会遇上，对比其强大的功能，还是可以接受的，正所谓暇不掩瑜。</p>
<ol>
<li>所以sshfs适合内部网络比较稳定的地方</li>
<li>配合ssh免密登录使用会更好哦</li>
<li>可以看到的是sshfs默认挂载是rw的权限，但是通过sshfs &ndash;help 可以看到有非常详尽的参数配置可以选择，大家可以仔细研究下。</li>
</ol>
<h3 id="附1" class="headerLink">
    <a href="#%e9%99%841" class="header-mark"></a>0.6 附1.</h3><p><a href="http://igikorn.com/sshfs-windows-8/" target="_blank" rel="noopener noreferrer">Link</a> 在windows下可以使用sshfs.</p>
]]></description></item><item><title>HowTo Use Remi Install Redis</title><link>https://samzong.me/howto-use-remi-install-redis/</link><pubDate>Thu, 07 Jul 2016 03:49:02 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-use-remi-install-redis/</guid><description><![CDATA[<h2 id="setup-1-install" class="headerLink">
    <a href="#setup-1-install" class="header-mark"></a>1. <strong>Setup 1. Install</strong></h2><p>Frist, To install remi Repo and epel Repo.</p>
<h4 id="remi-el6-for-centosrhel-6x" class="headerLink">
    <a href="#remi-el6-for-centosrhel-6x" class="header-mark"></a>1.0.1 <strong>Remi EL6 for CentOS/RHEL 6.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rpm -Uvh https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</span></span><span class="line"><span class="cl">rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="remi-el5-for-centosrhel-5x" class="headerLink">
    <a href="#remi-el5-for-centosrhel-5x" class="header-mark"></a>1.0.2 <strong>Remi EL5 for CentOS/RHEL 5.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rpm -Uvh https://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm
</span></span><span class="line"><span class="cl">rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-5.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="有时间我们会碰到remirepo无法使用报错就像这样" class="headerLink">
    <a href="#%e6%9c%89%e6%97%b6%e9%97%b4%e6%88%91%e4%bb%ac%e4%bc%9a%e7%a2%b0%e5%88%b0remirepo%e6%97%a0%e6%b3%95%e4%bd%bf%e7%94%a8%e6%8a%a5%e9%94%99%e5%b0%b1%e5%83%8f%e8%bf%99%e6%a0%b7" class="header-mark"></a>1.0.3 有时间我们会碰到remi.repo无法使用报错，就像这样：</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://remi.schlundtech.de/enterprise/latest/remi/x86_64/repodata/repomd.xml: [Errno 14] PYCURL ERROR 22 - &#34;The requested URL returned error: 404 Not Found&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="这时我们需要修改etcyumreposdremirepo像这样" class="headerLink">
    <a href="#%e8%bf%99%e6%97%b6%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e4%bf%ae%e6%94%b9etcyumreposdremirepo%e5%83%8f%e8%bf%99%e6%a0%b7" class="header-mark"></a>1.0.4 这时我们需要修改/etc/yum.repos.d/remi.repo，像这样：</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">baseurl=http://rpms.famillecollet.com/enterprise/5/remi/$basearch/
</span></span><span class="line"><span class="cl">#mirrorlist=http://rpms.famillecollet.com/enterprise/5/remi/mirror/$basearch/
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="如果发现安装后yum-makecache没看到相应的源站点请检查repo文件的enable参数是否为11为开启0为关闭状态" class="headerLink">
    <a href="#%e5%a6%82%e6%9e%9c%e5%8f%91%e7%8e%b0%e5%ae%89%e8%a3%85%e5%90%8eyum-makecache%e6%b2%a1%e7%9c%8b%e5%88%b0%e7%9b%b8%e5%ba%94%e7%9a%84%e6%ba%90%e7%ab%99%e7%82%b9%e8%af%b7%e6%a3%80%e6%9f%a5repo%e6%96%87%e4%bb%b6%e7%9a%84enable%e5%8f%82%e6%95%b0%e6%98%af%e5%90%a6%e4%b8%ba11%e4%b8%ba%e5%bc%80%e5%90%af0%e4%b8%ba%e5%85%b3%e9%97%ad%e7%8a%b6%e6%80%81" class="header-mark"></a>1.0.5 如果发现安装后yum makecache没看到相应的源站点，请检查repo文件的enable参数是否为1，1为开启，0为关闭状态。</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[repoName]
</span></span><span class="line"><span class="cl">name=repoName repo
</span></span><span class="line"><span class="cl">baseurl=http://repoPath
</span></span><span class="line"><span class="cl">gpgcheck=0                # 是否启用gpgkey检查
</span></span><span class="line"><span class="cl">enabled=0                 # 是否启用该源
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="install-redis" class="headerLink">
    <a href="#install-redis" class="header-mark"></a>1.0.6 <strong>Install Redis</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@zabbix yum.repos.d]# rpm -qi redis
</span></span><span class="line"><span class="cl">Name        : redis
</span></span><span class="line"><span class="cl">Version     : 3.2.1
</span></span><span class="line"><span class="cl">Release     : 2.el5.remi
</span></span><span class="line"><span class="cl">Architecture: x86_64
</span></span><span class="line"><span class="cl">Install Date: Thu 28 Jul 2016 12:00:41 PM CST
</span></span><span class="line"><span class="cl">Group       : Applications/Databases
</span></span><span class="line"><span class="cl">Size        : 2113279
</span></span><span class="line"><span class="cl">License     : BSD
</span></span><span class="line"><span class="cl">Signature   : DSA/SHA1, Fri 24 Jun 2016 01:30:12 PM CST, Key ID 004e6f4700f97f56
</span></span><span class="line"><span class="cl">Source RPM  : redis-3.2.1-2.el5.remi.src.rpm
</span></span><span class="line"><span class="cl">Build Date  : Fri 24 Jun 2016 01:28:27 PM CST
</span></span><span class="line"><span class="cl">Build Host  : builder.remirepo.net
</span></span><span class="line"><span class="cl">Relocations : (not relocatable)
</span></span><span class="line"><span class="cl">Packager    : http://blog.remirepo.net/
</span></span><span class="line"><span class="cl">Vendor      : Remi Collet
</span></span><span class="line"><span class="cl">URL         : http://redis.io
</span></span><span class="line"><span class="cl">Summary     : A persistent key-value database
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="setup-2-基本配置项" class="headerLink">
    <a href="#setup-2-%e5%9f%ba%e6%9c%ac%e9%85%8d%e7%bd%ae%e9%a1%b9" class="header-mark"></a>2. <strong>Setup 2. 基本配置项</strong></h2><h4 id="redis-配置默认文件etcredisconf" class="headerLink">
    <a href="#redis-%e9%85%8d%e7%bd%ae%e9%bb%98%e8%ae%a4%e6%96%87%e4%bb%b6etcredisconf" class="header-mark"></a>2.0.7 Redis 配置默认文件/etc/redis.conf</h4><p>＃ 设置Redis的运行模式，yes表示后台运行，no表示不开启后台运行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">daemonize yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 指定 redis 监听端口，默认为 6379</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">port 6379
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 设置bind_ip，默认监听接口，默认是监听本地，如果未配置的情况下，只有本地可以访问redis，如果取消，则默认监听所有接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># bind 127.0.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 指定日志记录级别</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># debug  记录很多信息，用于开发和测试
</span></span><span class="line"><span class="cl"># varbose 很多精简的有用信息，不像 debug 会记录那么多
</span></span><span class="line"><span class="cl"># notice 普通的 verbose，常用于生产环境
</span></span><span class="line"><span class="cl"># warning 只有非常重要或者严重的信息会记录到日志
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">loglevel verbose
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 配置 log 文件名称和全路径地址，默认为stdout，即标准输出，输出到/dev/null，可以手动指定redis日志文件地址，建议级别不要太高，否则会产生大量日志，注意避免磁盘因此撑满。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">logfile stdout
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 可用数据库数，默认值为 16，默认数据库存储在 DB 0 号 ID 库中，无特殊需求，建议仅设置一个数据库<br>
＃ 查询数据库使用  SELECT &lsquo;dbid&rsquo;，dbid 介于 0 到 &lsquo;databases&rsquo;-1 之间。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">database 16
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 安全限定，要求客户端在处理任何命令时都要验证身份和设置密码。<br>
＃ 默认不启用，若要启用，需要将下行取消注释，并将foobared设置自定一的密码接即可。<br>
＃ <strong>因为redis加密是通过配置文件进行，所以目前各大云厂家的redis PAAS 服务，都不支持redis加密，在程序开发时需要注意。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># requirepass foobared
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 如果开启了安全验证，这时通过redis-cli登录时需要首先执行auth，否则不能正常使用。
</span></span><span class="line"><span class="cl">redis-cli&gt; auth foobared
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 向redis内插入一条数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">redis-cli&gt;  set [key] [values]
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 获取key的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">redis-cli&gt; get key
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 查看redis的db信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">redis-cli&gt; info
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="setup-3-others" class="headerLink">
    <a href="#setup-3-others" class="header-mark"></a>3. <strong>Setup 3. Others</strong></h2><ul>
<li>redis-dump</li>
<li>master/slave</li>
<li>slow log</li>
</ul>
<h3 id="font-colorblackmsis-size45-wait--font" class="headerLink">
    <a href="#font-colorblackmsis-size45-wait--font" class="header-mark"></a>3.1 <font color=blackm,sis size=45 >Wait &hellip; </font></h3>]]></description></item><item><title>HowTo Install MySQL 5.5/6/7 on RHEL/CentOS 5/6/7</title><link>https://samzong.me/howto-install-mysql-5-5-6-7-on-rhel-centos-5-6-7/</link><pubDate>Thu, 07 Jul 2016 05:35:32 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-mysql-5-5-6-7-on-rhel-centos-5-6-7/</guid><description><![CDATA[<h2 id="font-colorredinstall-mysql-55-on-rhelcentos-567-font" class="headerLink">
    <a href="#font-colorredinstall-mysql-55-on-rhelcentos-567-font" class="header-mark"></a>1. <font color=red>Install Mysql 5.5 on RHEL/CentOS 5/6/7 </font></h2><h3 id="setup-1-use-repository" class="headerLink">
    <a href="#setup-1-use-repository" class="header-mark"></a>1.1 <strong>Setup 1. Use Repository.</strong></h3><p>First, to set up the yum repository, install the mysql－community-server 5.5 RPM based on your CentOS/RHEL release: <br></p>
<hr>
<h4 id="mysql-server-55repo-for-centosrhel-5x" class="headerLink">
    <a href="#mysql-server-55repo-for-centosrhel-5x" class="header-mark"></a>1.1.1 <strong>mysql-server-5.5.repo for CentOS/RHEL 5.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rpm -Uvh http://mirror.webtatic.com/yum/el5/latest.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="-only-install-mysql-55-on-centos-5x" class="headerLink">
    <a href="#-only-install-mysql-55-on-centos-5x" class="header-mark"></a>1.1.2 * <strong>Only Install MySQL 5.5 On CentOS 5.x</strong></h4><p>If you already have MySql client or server installed (rpm -q mysql mysql-server), then you can upgrade using the following method:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install mysql.`uname -i` yum-plugin-replace
</span></span><span class="line"><span class="cl">yum replace mysql --replace-with mysql55w
</span></span></code></pre></td></tr></table>
</div>
</div><p>“yum install mysql” is only there to make sure yum-plugin-replace can resolve dependencies correctly if only mysql-server was installed.<br>
Otherwise, to install MySql client and server, then run:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install mysql55w mysql55w-server
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="mysql-server-55repo-for-centosrhel-6x" class="headerLink">
    <a href="#mysql-server-55repo-for-centosrhel-6x" class="header-mark"></a>1.1.3 <strong>mysql-server-5.5.repo for CentOS/RHEL 6.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.5-community/el/6/x86_64/mysql-community-release-el6-5.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.5-community/el/6/i386/mysql-community-release-el6-5.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mysql-server-55repo-for-centosrhel-7x" class="headerLink">
    <a href="#mysql-server-55repo-for-centosrhel-7x" class="header-mark"></a>1.1.4 <strong>mysql-server-5.5.repo for CentOS/RHEL 7.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.5-community/el/7/x86_64/mysql-community-release-el7-5.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.5-community/el/7/i386/mysql-community-release-el7-5.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-2-install-mysql-server-55" class="headerLink">
    <a href="#setup-2-install-mysql-server-55" class="header-mark"></a>1.2 <strong>Setup 2. Install MySQL Server 5.5</strong></h3><p>If you already have MySql client or server installed (rpm -q mysql mysql-server), then you must uninstall using the following method:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># It&#39;s RHEL/CentOS 6/7
</span></span><span class="line"><span class="cl">yum remove -y mysql-server
</span></span><span class="line"><span class="cl">yum remove -y mysql*
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you don&rsquo;t have mysql-server was installed.<br>
Otherwise, to install MySql client and server, then run:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y mysql-community-server
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-3-service-configure" class="headerLink">
    <a href="#setup-3-service-configure" class="header-mark"></a>1.3 <strong>Setup 3. Service Configure</strong></h3><p>You should upgrade existing tables before setting the server to become a production machine, which can be done by starting the server and running the mysql_upgrade script (this may take time depending on the size of the database).<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">service mysqld start
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will issue a password prompt for the user. If you don&rsquo;t have a root user password, remove the &ldquo;-p&rdquo;<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql_secure_installation
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="font-colorredinstall-mysql-56-on-rhelcentos-567-font" class="headerLink">
    <a href="#font-colorredinstall-mysql-56-on-rhelcentos-567-font" class="header-mark"></a>2. <font color=red>Install Mysql 5.6 on RHEL/CentOS 5/6/7 </font></h2><h3 id="setup-1-use-repository-1" class="headerLink">
    <a href="#setup-1-use-repository-1" class="header-mark"></a>2.1 <strong>Setup 1. Use Repository.</strong></h3><p>First, to set up the yum repository, install the mysql－community-server 5.6 RPM based on your CentOS/RHEL release: <br></p>
<h4 id="mysql-server-56repo-for-centosrhel-5x" class="headerLink">
    <a href="#mysql-server-56repo-for-centosrhel-5x" class="header-mark"></a>2.1.1 <strong>mysql-server-5.6.repo for CentOS/RHEL 5.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.6-community/el/5/x86_64/mysql-community-release-el5-5.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.6-community/el/5/i386/mysql-community-release-el5-5.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mysql-server-56repo-for-centosrhel-6x" class="headerLink">
    <a href="#mysql-server-56repo-for-centosrhel-6x" class="header-mark"></a>2.1.2 <strong>mysql-server-5.6.repo for CentOS/RHEL 6.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-5.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.6-community/el/6/i386/mysql-community-release-el6-5.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mysql-server-56repo-for-centosrhel-7x" class="headerLink">
    <a href="#mysql-server-56repo-for-centosrhel-7x" class="header-mark"></a>2.1.3 <strong>mysql-server-5.6.repo for CentOS/RHEL 7.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64/mysql-community-release-el7-5.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.6-community/el/7/i386/mysql-community-release-el7-5.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-2-install-mysql-server-56" class="headerLink">
    <a href="#setup-2-install-mysql-server-56" class="header-mark"></a>2.2 <strong>Setup 2. Install MySQL Server 5.6</strong></h3><p>If you already have MySql client or server installed (rpm -q mysql mysql-server), then you must uninstall using the following method:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum remove -y mysql-server
</span></span><span class="line"><span class="cl">yum remove -y mysql*
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you don&rsquo;t have mysql-server was installed.<br>
Otherwise, to install MySql client and server, then run:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y mysql-community-server
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-3-service-configure-1" class="headerLink">
    <a href="#setup-3-service-configure-1" class="header-mark"></a>2.3 <strong>Setup 3. Service Configure</strong></h3><p>You should upgrade existing tables before setting the server to become a production machine, which can be done by starting the server and running the mysql_upgrade script (this may take time depending on the size of the database).<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">service mysqld start
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will issue a password prompt for the user. If you don&rsquo;t have a root user password, remove the &ldquo;-p&rdquo;<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql_secure_installation
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="font-colorredinstall-mysql-57-on-rhelcentos-567-font" class="headerLink">
    <a href="#font-colorredinstall-mysql-57-on-rhelcentos-567-font" class="header-mark"></a>3. <font color=red>Install Mysql 5.7 on RHEL/CentOS 5/6/7 </font></h2><h3 id="setup-1-use-repository-2" class="headerLink">
    <a href="#setup-1-use-repository-2" class="header-mark"></a>3.1 <strong>Setup 1. Use Repository.</strong></h3><p>First, to set up the yum repository, install the mysql－community-server 5.7 RPM based on your CentOS/RHEL release: <br></p>
<h4 id="mysql-server-57repo-for-centosrhel-5x" class="headerLink">
    <a href="#mysql-server-57repo-for-centosrhel-5x" class="header-mark"></a>3.1.1 <strong>mysql-server-5.7.repo for CentOS/RHEL 5.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.7-community/el/5/x86_64/mysql-community-release-el5-7.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.7-community/el/5/i386/mysql-community-release-el5-7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mysql-server-57repo-for-centosrhel-6x" class="headerLink">
    <a href="#mysql-server-57repo-for-centosrhel-6x" class="header-mark"></a>3.1.2 <strong>mysql-server-5.7.repo for CentOS/RHEL 6.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.7-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.7-community/el/6/i386/mysql-community-release-el6-7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="mysql-server-57repo-for-centosrhel-7x" class="headerLink">
    <a href="#mysql-server-57repo-for-centosrhel-7x" class="header-mark"></a>3.1.3 <strong>mysql-server-5.7.repo for CentOS/RHEL 7.x</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># For x86_64
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.7-community/el/7/x86_64/mysql-community-release-el7-7.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># For i386
</span></span><span class="line"><span class="cl">yum install http://repo.mysql.com/yum/mysql-5.7-community/el/7/i386/mysql-community-release-el7-7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-2-install-mysql-server-57" class="headerLink">
    <a href="#setup-2-install-mysql-server-57" class="header-mark"></a>3.2 <strong>Setup 2. Install MySQL Server 5.7</strong></h3><p>If you already have MySql client or server installed (rpm -q mysql mysql-server), then you must uninstall using the following method:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum remove -y mysql-server
</span></span><span class="line"><span class="cl">yum remove -y mysql*
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you don&rsquo;t have mysql-server was installed.<br>
Otherwise, to install MySql client and server, then run:<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y mysql-community-server
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="setup-3-service-configure-2" class="headerLink">
    <a href="#setup-3-service-configure-2" class="header-mark"></a>3.3 <strong>Setup 3. Service Configure</strong></h3><p>You should upgrade existing tables before setting the server to become a production machine, which can be done by starting the server and running the mysql_upgrade script (this may take time depending on the size of the database).<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">service mysqld start
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will issue a password prompt for the user. If you don&rsquo;t have a root user password, remove the &ldquo;-p&rdquo;<br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql_secure_installation
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install Docker on CentOS 6.x</title><link>https://samzong.me/howto-install-docker-on-centos-6-x/</link><pubDate>Thu, 07 Jul 2016 08:03:28 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-docker-on-centos-6-x/</guid><description><![CDATA[<h3 id="1-add-the-epel-repository" class="headerLink">
    <a href="#1-add-the-epel-repository" class="header-mark"></a>0.1 <strong>1. Add the EPEL Repository</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-update-your-system" class="headerLink">
    <a href="#2-update-your-system" class="header-mark"></a>0.2 <strong>2. Update your system</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum update -y
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-install" class="headerLink">
    <a href="#3-install" class="header-mark"></a>0.3 <strong>3. Install</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y docker-io
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-configure" class="headerLink">
    <a href="#4-configure" class="header-mark"></a>0.4 <strong>4. Configure</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">service docker start
</span></span><span class="line"><span class="cl">chkconfig docker on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker info
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="5-download-a-docker-container" class="headerLink">
    <a href="#5-download-a-docker-container" class="header-mark"></a>0.5 <strong>5. Download a Docker Container</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker pull centos
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="6-run-a-docker-container" class="headerLink">
    <a href="#6-run-a-docker-container" class="header-mark"></a>0.6 <strong>6. Run a Docker Container</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker run -i -t centos /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="7-find-docker-container" class="headerLink">
    <a href="#7-find-docker-container" class="header-mark"></a>0.7 <strong>7. Find Docker Container</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker search ubuntu
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="faq" class="headerLink">
    <a href="#faq" class="header-mark"></a>0.8 <strong>FAQ</strong></h3><h4 id="1-faild-to-start-docker-on-centos-6x" class="headerLink">
    <a href="#1-faild-to-start-docker-on-centos-6x" class="header-mark"></a>0.8.1 <strong>1. Faild to start docker on CentOS 6.x</strong></h4><p><code><em><strong>/usr/bin/docker: relocation error: /usr/bin/docker: symbol dm_task_get_info_with_deferred_remove, version Base not defined in file libdevmapper.so.1.02 with link time reference</strong></em></code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">the lib-device-mapper that you have isn&#39;t exporting a symbol (&#34;Base&#34;) that Docker needs.
</span></span><span class="line"><span class="cl">this by upgrading lib-device-mapper to version 1.02.90.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># You may have to enable the public_ol6_latest repo in order to get this package.
</span></span><span class="line"><span class="cl">sudo yum-config-manager --enable public_ol6_latest
</span></span><span class="line"><span class="cl">sudo yum install device-mapper-event-libs
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-faild-to-use-docker" class="headerLink">
    <a href="#2-faild-to-use-docker" class="header-mark"></a>0.8.2 <strong>2. Faild to use docker</strong></h4><p><code><em><strong>Get http:///var/run/docker.sock/v1.19/info: dial unix /var/run/docker.sock: no such file or directory. Are you trying to connect to a TLS-enabled daemon without TLS?</strong></em></code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># this is because docker no restart ok.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pkill -9 docker &amp;&amp; service docker start
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-howto-save-docker-run--i--t-xxx-binbash" class="headerLink">
    <a href="#3-howto-save-docker-run--i--t-xxx-binbash" class="header-mark"></a>0.8.3 <strong>3. HowTo save &lsquo;docker run -i -t xxx /bin/bash&rsquo;</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker ps -l
</span></span><span class="line"><span class="cl">docker commit ID newname
</span></span><span class="line"><span class="cl">docker images
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Reset Azure VM Linux Password</title><link>https://samzong.me/howto-reset-azure-vm-linux-password/</link><pubDate>Sun, 10 Jul 2016 11:21:47 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-reset-azure-vm-linux-password/</guid><description><![CDATA[<blockquote>
<p><strong>Setup1:</strong> 这种方法仅适用于已存在的用户，也就是说$Username是之前创建过的用户，否则不适用</p>
</blockquote>
<h3 id="1-指定虚拟机" class="headerLink">
    <a href="#1-%e6%8c%87%e5%ae%9a%e8%99%9a%e6%8b%9f%e6%9c%ba" class="header-mark"></a>0.1 <strong>1. 指定虚拟机</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$vm = Get-AzureVM -ServiceName &#39;云服务名称&#39; -Name &#39;虚拟机名称&#39;
</span></span><span class="line"><span class="cl">$vm.GetInstance().ProvisionGuestAgent = $true
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-输入您当前的用户名和新密码" class="headerLink">
    <a href="#2-%e8%be%93%e5%85%a5%e6%82%a8%e5%bd%93%e5%89%8d%e7%9a%84%e7%94%a8%e6%88%b7%e5%90%8d%e5%92%8c%e6%96%b0%e5%af%86%e7%a0%81" class="header-mark"></a>0.2 <strong>2. 输入您当前的用户名和新密码</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$UserName = &#34;指定用户名&#34;
</span></span><span class="line"><span class="cl">$Password = &#34;指定密码&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$PrivateConfig = &#39;{&#34;username&#34;:&#34;&#39;+ $UserName + &#39;&#34;, &#34;password&#34;:&#34;&#39; +  $Password + &#39;&#34;}&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-开始执行" class="headerLink">
    <a href="#3-%e5%bc%80%e5%a7%8b%e6%89%a7%e8%a1%8c" class="header-mark"></a>0.3 <strong>3. 开始执行</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ExtensionName = &#39;VMAccessForLinux&#39;
</span></span><span class="line"><span class="cl">$Publisher = &#39;Microsoft.OSTCExtensions&#39;
</span></span><span class="line"><span class="cl">$Version =  &#39;1.0&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Set-AzureVMExtension -ExtensionName $ExtensionName -VM  $vm -Publisher $Publisher -Version $Version -PrivateConfiguration $PrivateConfig | Update-AzureVM
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>Setup2:</strong> 如果是由于错误修改了SSH的配置文件导致无法登录，例如在登录时报错：This service allows sftp connections only.Connection to vm closed.这是因为错误配置了sftp导致的，那碰到这种问题需要做的是重置ssh服务。</p>
</blockquote>
<h3 id="1-指定虚拟机-1" class="headerLink">
    <a href="#1-%e6%8c%87%e5%ae%9a%e8%99%9a%e6%8b%9f%e6%9c%ba-1" class="header-mark"></a>0.4 <strong>1. 指定虚拟机</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$vm = Get-AzureVM -ServiceName &#39;MyServiceName&#39; -Name &#39;MyVMName&#39;
</span></span><span class="line"><span class="cl">$PrivateConfig = &#39;{&#34;reset_ssh&#34;:&#34;True&#34;}&#39;&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-开始执行" class="headerLink">
    <a href="#2-%e5%bc%80%e5%a7%8b%e6%89%a7%e8%a1%8c" class="header-mark"></a>0.5 <strong>2. 开始执行</strong></h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ExtensionName = &#39;VMAccessForLinux&#39;
</span></span><span class="line"><span class="cl">$Publisher = &#39;Microsoft.OSTCExtensions&#39;
</span></span><span class="line"><span class="cl">$Version =  &#39;1.0&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Set-AzureVMExtension -ExtensionName $ExtensionName -VM  $vm -Publisher $Publisher -Version $Version -PrivateConfiguration $PrivateConfig | Update-AzureVM
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Play Pokemon GO in China</title><link>https://samzong.me/howto-play-pokemon-go-in-china/</link><pubDate>Sun, 24 Jul 2016 21:42:01 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-play-pokemon-go-in-china/</guid><description><![CDATA[<h2 id="installtions" class="headerLink">
    <a href="#installtions" class="header-mark"></a>1. Installtions</h2><ul>
<li><a href="http://www.tutuapp.cn" target="_blank" rel="noopener noreferrer">TuTuAPP</a></li>
<li><a href="https://shadowsocks.biz/?ref=518" target="_blank" rel="noopener noreferrer">VPN</a></li>
<li><a href="https://accounts.google.com" target="_blank" rel="noopener noreferrer">Google Account ID</a></li>
</ul>
<p>&emsp;&emsp;最近看到身边朋友都在玩Pokemon GO, 心痒难耐，于是跟同事请教琢磨了，终于在自己的手机上玩起来了，由于我的手机是iPhone 5s，身边朋友也都是iPhone，所以不确定是Android是否可以玩耍，想来应该是没有问题话，Android平台做破解等操作一直以来比iPhone更加方便。
</p>
<div align="center">

</div>
&emsp;&emsp;1. 点击上面的TuTuAPP，可以打开兔兔助手的网站，用手机扫描首页的二维码(可以用微信等，带有二维码扫描的都可以)，注意如果你的iPhone已经越狱，请切换标签页到越狱版本。
<p>  2. 安装时注意按照提示添加信任，等待兔兔助手安装完成之后，打开软件，在Search栏输入“精灵宝可梦GO”，请下载美区版，有两个版本：懒人版与移动版；懒人版有移动按钮，可以不需要走动躺在床上玩耍，移动版是需要人走动才能玩耍，我下载的移动版，你根据自己的喜欢选择，选择完成后，按提示按钮安装即可。</p>
<p>  3. 安装完成Pokemon GO之后也需要设定信任，请按照提示操作；好了， 到这一步，Pokemon GO已经安装在你的手机上了，下一步就是怎么登录玩耍。</p>
<p>  4. 到这里及一下的步骤能继续下去的前提是，你有一个美国的VPN节点。打开你手机App Store，搜索VPN，列表中会有很多的免费应用，因为我一直用的是付费VPN，所以对这些不是很清楚，朋友推荐<strong>ArkVPN</strong>，如果你没有付费VPN，可以试试这个，注意VPN节点要选择US，如果你也要使付费VPN的，我推荐Shadowsocks＋Potatso( App)</p>
<p>  5. 注册Google Account ID，<a href="https://account.google.com" target="_blank" rel="noopener noreferrer">点击</a></p>
<div align="center">

</div>
&emsp;&emsp;6. 进入游戏，登录Google ID，然后授权，进入游戏。
<div align="center">

</div>
&emsp;&emsp;7. 开始捕捉你的小精灵吧，手动微笑。
<blockquote>
<p>Tips：这款游戏会大量耗电发热，因为打开摄像头捕捉小精灵；另外很容易入迷，在室外玩耍时一定要注意安全。</p>
</blockquote>
<p>  8. 注意：如果看到了GPS signal not found，说明是GPS信息丢失，这是根据GPS定位的游戏，所以这很重要，记得选择美国的VPN代理。</p>
<div align="center">



</div>
]]></description></item><item><title>Manage Tomcat Service Use Shell Script</title><link>https://samzong.me/manage-tomcat-service-use-shell-script/</link><pubDate>Wed, 27 Jul 2016 02:18:24 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/manage-tomcat-service-use-shell-script/</guid><description><![CDATA[<h4 id="tomcat-项目管理交互式脚本" class="headerLink">
    <a href="#tomcat-%e9%a1%b9%e7%9b%ae%e7%ae%a1%e7%90%86%e4%ba%a4%e4%ba%92%e5%bc%8f%e8%84%9a%e6%9c%ac" class="header-mark"></a>0.0.1 Tomcat 项目管理交互式脚本.</h4><ul>
<li>Install pssh</li>
<li>Use Key Login Server Hosts</li>
<li>~/.ssh/config 配置使用host名登录服务</li>
<li>指定 Server Group Files 存放位置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Author Alex LU</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Date 2016-07-20</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Version 1.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># HostFile</span>
</span></span><span class="line"><span class="cl"><span class="nv">HostDIR</span><span class="o">=</span>~/.ssh/host/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># war包上传到该目录</span>
</span></span><span class="line"><span class="cl"><span class="c1"># /warfolder</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">:<span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">jobs_select (){
</span></span></span><span class="line"><span class="cl"><span class="s1">    STRING=``cat $vmname | grep group
</span></span></span><span class="line"><span class="cl"><span class="s1">    if [ -z &#34;$STRING&#34; ]
</span></span></span><span class="line"><span class="cl"><span class="s1">    then
</span></span></span><span class="line"><span class="cl"><span class="s1">        job_tomcat
</span></span></span><span class="line"><span class="cl"><span class="s1">    else
</span></span></span><span class="line"><span class="cl"><span class="s1">        job2_tomcat
</span></span></span><span class="line"><span class="cl"><span class="s1">    fi
</span></span></span><span class="line"><span class="cl"><span class="s1">}
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> HOST<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;############ Host List ###############&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ckgroup:ck01,ck02,ck03,ck04&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;sjgroup:sj01,sj02,sj03,sj04&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ddgroup:dd01,dd02,dd03,dd04&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;htgroup:ht01,ht02&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;othergroup:report,tg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;######################################&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34; Tips: 如果要选择ck01，则输入ck01即可，如果输入ck组，输入ckgroup即可,如果要退出当前脚本输入exit&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34; Tips: 退回上一步请输入back&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">read</span> -p <span class="s2">&#34;请输入你的选择:&#34;</span> vmname
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$vmname</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">        ck01<span class="p">|</span>ck02<span class="p">|</span>ck03<span class="p">|</span>ck04<span class="p">|</span>sj01<span class="p">|</span>sj02<span class="p">|</span>sj03<span class="p">|</span>sj04<span class="p">|</span>dd01<span class="p">|</span>dd02<span class="p">|</span>dd03<span class="p">|</span>dd04<span class="p">|</span>report<span class="p">|</span>tg<span class="p">|</span>ht01<span class="p">|</span>ht02<span class="o">)</span>
</span></span><span class="line"><span class="cl">            job_tomcat <span class="nv">$vmname</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        ckgroup<span class="p">|</span>sjgroup<span class="p">|</span>htgroup<span class="p">|</span>ddgroup<span class="p">|</span>othergroup<span class="o">)</span>
</span></span><span class="line"><span class="cl">            job2_tomcat <span class="nv">$vmname</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">exit</span> 0<span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        back<span class="o">)</span>
</span></span><span class="line"><span class="cl">            clear
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> <span class="s2">&#34;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&#34;</span>
</span></span><span class="line"><span class="cl">            main
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        *<span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> <span class="s2">&#34;请输入的选择!&#34;</span>
</span></span><span class="line"><span class="cl">            HOST
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> job_tomcat <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;############ 动作 ###############&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  1. 查看当前tomcat7状态&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  2. 关闭tomcat7&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  3. 启动tomcat7&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  4. 重启tomcat7&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  5. 获取最近200行日志&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  6. 重新选择主机&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  7. 回到顶层目录&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;#################################&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">read</span> -p <span class="s2">&#34;请输入你的选择:&#34;</span> service_tomcat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nv">$service_tomcat</span> in
</span></span><span class="line"><span class="cl">        1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;ps aux | grep tomcat&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        2<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 stop&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;ps aux | grep tomcat7 | awk &#39;{print </span><span class="nv">$2</span><span class="s2">}&#39; | xargs kill -9 &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/work/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/logs/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/temp/*&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        3<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 start&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        4<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 stop&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;ps aux | grep tomcat7 | awk &#39;{print </span><span class="nv">$2</span><span class="s2">}&#39; | xargs kill -9 &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/work/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/logs/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/temp/*&#34;</span>
</span></span><span class="line"><span class="cl">        sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 start&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        5<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -H <span class="nv">$vmname</span> -i <span class="s2">&#34;tail -n 200 /tomcat7/logs/catalina.out&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        6<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        HOST
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        7<span class="o">)</span>
</span></span><span class="line"><span class="cl">        clear
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&#34;</span>
</span></span><span class="line"><span class="cl">        main
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        *<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;请输入正确的选项！&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> job2_tomcat <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;############ 动作 ###############&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  1. 查看当前tomcat7状态&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  2. 关闭tomcat7&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  3. 启动tomcat7&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  4. 重启tomcat7&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  5. 获取最近200行日志&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  6. 重新选择主机&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;  7. 回到顶层目录&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;################################&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">read</span> -p <span class="s2">&#34;请输入你的选择:&#34;</span> service_tomcat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nv">$service_tomcat</span> in
</span></span><span class="line"><span class="cl">        1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;ps aux | grep tomcat&#34;</span>
</span></span><span class="line"><span class="cl">        job2_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        2<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 stop&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;ps aux | grep tomcat7 | awk &#39;{print </span><span class="nv">$2</span><span class="s2">}&#39; | xargs kill -9 &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/work/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/logs/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/temp/*&#34;</span>
</span></span><span class="line"><span class="cl">        job2_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        3<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 start&#34;</span>
</span></span><span class="line"><span class="cl">        job2_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        4<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 stop&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;ps aux | grep tomcat7 | awk &#39;{print </span><span class="nv">$2</span><span class="s2">}&#39; | xargs kill -9 &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/work/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/logs/*&#34;</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;rm -rf /tomcat7/temp/*&#34;</span>
</span></span><span class="line"><span class="cl">        sleep <span class="m">1</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 start&#34;</span>
</span></span><span class="line"><span class="cl">        job2_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        5<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> -i <span class="s2">&#34;tail -n 200 /tomcat7/logs/catalina.out&#34;</span>
</span></span><span class="line"><span class="cl">        job2_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        6<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        HOST
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        7<span class="o">)</span>
</span></span><span class="line"><span class="cl">        clear
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&#34;</span>
</span></span><span class="line"><span class="cl">        main
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        *<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;请输入正确的选项！&#34;</span>
</span></span><span class="line"><span class="cl">        job_tomcat
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> HOST2<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;############ Host List ###############&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ckgroup:ck01,ck02,ck03,ck04&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;sjgroup:sj01,sj02,sj03,sj04&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;ddgroup:dd01,dd02,dd03,dd04&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;htgroup:ht01,ht02&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;othergroup:report,tg&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;######################################&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 确认是否所有项目包发布后立即启动</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[7m 更新订单服务器的war包时，会自动启动tomcat程序，为了释放war包，修改order.no，请设置war包内order.no＝0 ,其它服务器tomcat不会自启动，请使用命令操作 \033[0m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34; Tips: 如果要选择ck01，则输入ck01即可，如果输入ck组，输入ckgroup即可,如果要退出当前脚本输入exit&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34; Tips: 退回上一步请输入back&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">read</span> -p <span class="s2">&#34;请输入你的选择:&#34;</span> vmname
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$vmname</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">        ck01<span class="p">|</span>ck02<span class="p">|</span>ck03<span class="p">|</span>ck04<span class="p">|</span>sj01<span class="p">|</span>sj02<span class="p">|</span>sj03<span class="p">|</span>sj04<span class="p">|</span>dd01<span class="p">|</span>dd02<span class="p">|</span>dd03<span class="p">|</span>dd04<span class="p">|</span>report<span class="p">|</span>tg<span class="p">|</span>ht01<span class="p">|</span>ht02<span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">read</span> -p <span class="s2">&#34;请输入war包的名称,例如:dzcx_ck.war :&#34;</span> warname
</span></span><span class="line"><span class="cl">            pscp_tomcat <span class="nv">$vmname</span> <span class="nv">$warname</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        ckgroup<span class="p">|</span>sjgroup<span class="p">|</span>htgroup<span class="p">|</span>othergroup<span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">read</span> -p <span class="s2">&#34;请输入war包的名称,例如:dzcx_ck.war :&#34;</span> warname
</span></span><span class="line"><span class="cl">            pscp2_tomcat <span class="nv">$vmname</span> <span class="nv">$warname</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        ddgroup<span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">read</span> -p <span class="s2">&#34;请输入war包的名称,例如:dzcx_ck.war :&#34;</span> warname
</span></span><span class="line"><span class="cl">            pscp3_tomcat <span class="nv">$vmname</span> <span class="nv">$warname</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">exit</span> 0<span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        back<span class="o">)</span>
</span></span><span class="line"><span class="cl">            clear
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> <span class="s2">&#34;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&#34;</span>
</span></span><span class="line"><span class="cl">            main
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">        *<span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">echo</span> <span class="s2">&#34;请输入的选择!&#34;</span>
</span></span><span class="line"><span class="cl">            HOST
</span></span><span class="line"><span class="cl">            <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> pscp_tomcat <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># single host</span>
</span></span><span class="line"><span class="cl">    pscp.pssh -H <span class="nv">$vmname</span> /warfolder/<span class="s2">&#34;</span><span class="nv">$warname</span><span class="s2">&#34;</span> /tomcat7/webapps/
</span></span><span class="line"><span class="cl">    HOST2
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> pscp2_tomcat <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># group</span>
</span></span><span class="line"><span class="cl">    pscp.pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> /warfolder/<span class="s2">&#34;</span><span class="nv">$warname</span><span class="s2">&#34;</span> /tomcat7/webapps/
</span></span><span class="line"><span class="cl">    HOST2
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> pscp3_tomcat <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># group dd 因为订单需要修改服务器编号</span>
</span></span><span class="line"><span class="cl">    pscp.pssh -h <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> /warfolder/<span class="s2">&#34;</span><span class="nv">$warname</span><span class="s2">&#34;</span> /tomcat7/webapps/
</span></span><span class="line"><span class="cl">    pssh -h <span class="nv">$vmname</span> -i <span class="s2">&#34;service tomcat7 start&#34;</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">10</span>
</span></span><span class="line"><span class="cl">    pssh -H dd02 <span class="s2">&#34;sed -i &#39;s/order.no=0/order.no=1/g&#39; /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties&#34;</span>
</span></span><span class="line"><span class="cl">    pssh -H dd03 <span class="s2">&#34;sed -i &#39;s/order.no=0/order.no=2/g&#39; /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties&#34;</span>
</span></span><span class="line"><span class="cl">    pssh -H dd04 <span class="s2">&#34;sed -i &#39;s/order.no=0/order.no=3/g&#39; /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties&#34;</span>
</span></span><span class="line"><span class="cl">    HOST2
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> main <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;######################################&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  1. 更新war包&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  2. 管理tomcat7&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  3. 管理mysql&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  4. 管理redis&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  5. 同步服务器时间&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  6. 清理当前屏幕&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;#  7. 退出&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;######################################&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">read</span> -p <span class="s2">&#34;请输入你的选择:&#34;</span> num
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$num</span><span class="s2">&#34;</span> in
</span></span><span class="line"><span class="cl">    1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        HOST2
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    2<span class="o">)</span>
</span></span><span class="line"><span class="cl">        HOST
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    3<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;该功能暂未开放&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    4<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;该功能暂未开放&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    5<span class="o">)</span>
</span></span><span class="line"><span class="cl">        pssh -h <span class="nv">$HostDIR</span>/allhost -i <span class="s2">&#34;service ntpd restart&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    6<span class="o">)</span>
</span></span><span class="line"><span class="cl">        clear
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&#34;</span>
</span></span><span class="line"><span class="cl">        main
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    7<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    *<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;请输入正确的数值！&#34;</span>
</span></span><span class="line"><span class="cl">        main
</span></span><span class="line"><span class="cl">    <span class="p">;;</span>
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------------- main -------------------------------------------------</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">clear
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">command</span> -v pssh &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">    main
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[07m&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;系统检测到您还没安装pssh，请预先安装pssh&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;yum install -y epel-release&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;yum install -y pssh&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;安装成功请重新运行此脚本&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;\033[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install KVM Manage Server webvirtmgr</title><link>https://samzong.me/howto-install-kvm-manage-server-webvirtmgr/</link><pubDate>Wed, 27 Jul 2016 17:34:01 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-kvm-manage-server-webvirtmgr/</guid><description><![CDATA[<p>生产环境的KVM宿主机越来越多，需要对宿主机的状态进行调控。这里用webvirtmgr进行管理。图形化的WEB，让人能更方便的查看kvm 宿主机的情况和操作.</p>
<p><em><strong><a href="https://github.com/retspen/webvirtmgr" target="_blank" rel="noopener noreferrer">GitHub Project.</a></strong></em></p>
<h3 id="install" class="headerLink">
    <a href="#install" class="header-mark"></a>0.1 Install</h3><h4 id="安装支持的软件源" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e6%94%af%e6%8c%81%e7%9a%84%e8%bd%af%e4%bb%b6%e6%ba%90" class="header-mark"></a>0.1.1 安装支持的软件源</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install -y epel-release
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装相关软件" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e7%9b%b8%e5%85%b3%e8%bd%af%e4%bb%b6" class="header-mark"></a>0.1.2 安装相关软件</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum -y install git python-pip libvirt-python libxml2-python python-websockify supervisor nginx
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="从git-hub中下载相关的webvirtmgr代码" class="headerLink">
    <a href="#%e4%bb%8egit-hub%e4%b8%ad%e4%b8%8b%e8%bd%bd%e7%9b%b8%e5%85%b3%e7%9a%84webvirtmgr%e4%bb%a3%e7%a0%81" class="header-mark"></a>0.1.3 从git-hub中下载相关的webvirtmgr代码</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /usr/local/src/
</span></span><span class="line"><span class="cl">git clone git://github.com/retspen/webvirtmgr.git
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装webvirtmgr" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85webvirtmgr" class="header-mark"></a>0.1.4 安装webvirtmgr</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd webvirtmgr/
</span></span><span class="line"><span class="cl">pip install -r requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装数据库" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>0.1.5 安装数据库</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install python-sqlite2
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="对django进行环境配置" class="headerLink">
    <a href="#%e5%af%b9django%e8%bf%9b%e8%a1%8c%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.1.6 对django进行环境配置</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">./manage.py syncdb
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You just installed Django&#39;s auth system, which means you don&#39;t have any superusers defined.
</span></span><span class="line"><span class="cl">Would you like to create one now? (yes/no): yes
</span></span><span class="line"><span class="cl">Username (leave blank to use &#39;root&#39;): admin
</span></span><span class="line"><span class="cl">Email address: luchuanjia@msn.com
</span></span><span class="line"><span class="cl">Password:*********
</span></span><span class="line"><span class="cl">Password (again):*********
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./manage.py collectstatic #生成配置文件
</span></span><span class="line"><span class="cl">./manage.py createsuperuser #添加管理员账号
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="拷贝web到-相关目录" class="headerLink">
    <a href="#%e6%8b%b7%e8%b4%9dweb%e5%88%b0-%e7%9b%b8%e5%85%b3%e7%9b%ae%e5%bd%95" class="header-mark"></a>0.1.7 拷贝web到 相关目录</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd ..
</span></span><span class="line"><span class="cl">rm -rf /var/www
</span></span><span class="line"><span class="cl">mkdir -pv /var/www
</span></span><span class="line"><span class="cl">cp -Rv webvirtmgr /var/www/webvirtmgr
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="设置ssh" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%aessh" class="header-mark"></a>0.1.8 设置ssh</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ssh-keygen
</span></span><span class="line"><span class="cl">ssh-copy-id 192.168.2.32
</span></span><span class="line"><span class="cl">ssh 192.168.2.32 -L localhost:8000:localhost:8000 -L localhost:6080:localhost:6080
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="编辑nginx配置文件" class="headerLink">
    <a href="#%e7%bc%96%e8%be%91nginx%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>0.1.9 编辑nginx配置文件</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak
</span></span><span class="line"><span class="cl">vim /etc/nginx/conf.d/webvirtmgr.conf  #添加下面内容到文件中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen 80 default_server;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    server_name $hostname;
</span></span><span class="line"><span class="cl">    #access_log /var/log/nginx/webvirtmgr_access_log;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location /static/ {
</span></span><span class="line"><span class="cl">        root /var/www/webvirtmgr/webvirtmgr; # or /srv instead of /var
</span></span><span class="line"><span class="cl">        expires max;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        proxy_pass http://127.0.0.1:8000;
</span></span><span class="line"><span class="cl">        proxy_set_header X-Real-IP $remote_addr;
</span></span><span class="line"><span class="cl">        proxy_set_header X-Forwarded-for $proxy_add_x_forwarded_for;
</span></span><span class="line"><span class="cl">        proxy_set_header Host $host:$server_port;
</span></span><span class="line"><span class="cl">        proxy_set_header X-Forwarded-Proto $remote_addr;
</span></span><span class="line"><span class="cl">        proxy_connect_timeout 600;
</span></span><span class="line"><span class="cl">        proxy_read_timeout 600;
</span></span><span class="line"><span class="cl">        proxy_send_timeout 600;
</span></span><span class="line"><span class="cl">        client_max_body_size 1024M; # Set higher depending on your needs
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动nginx" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8nginx" class="header-mark"></a>0.1.10 启动nginx</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">service nginx start
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="修改防火墙规则--如果关闭selinux此步可省略" class="headerLink">
    <a href="#%e4%bf%ae%e6%94%b9%e9%98%b2%e7%81%ab%e5%a2%99%e8%a7%84%e5%88%99--%e5%a6%82%e6%9e%9c%e5%85%b3%e9%97%adselinux%e6%ad%a4%e6%ad%a5%e5%8f%af%e7%9c%81%e7%95%a5" class="header-mark"></a>0.1.11 修改防火墙规则 ( 如果关闭selinux，此步可省略)</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/usr/sbin/setsebool httpd_can_network_connect true
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="设置-supervisor" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae-supervisor" class="header-mark"></a>0.1.12 设置 supervisor</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">chown -R nginx:nginx /var/www/webvirtmgr
</span></span><span class="line"><span class="cl">vim /etc/supervisord.conf #在文件末尾添加
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[program:webvirtmgr]
</span></span><span class="line"><span class="cl">command=/usr/bin/python /var/www/webvirtmgr/manage.py run_gunicorn -c /var/www/webvirtmgr/conf/gunicorn.conf.py
</span></span><span class="line"><span class="cl">directory=/var/www/webvirtmgr
</span></span><span class="line"><span class="cl">autostart=true
</span></span><span class="line"><span class="cl">autorestart=true
</span></span><span class="line"><span class="cl">logfile=/var/log/supervisor/webvirtmgr.log
</span></span><span class="line"><span class="cl">log_stderr=true
</span></span><span class="line"><span class="cl">user=nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[program:webvirtmgr-console]
</span></span><span class="line"><span class="cl">command=/usr/bin/python /var/www/webvirtmgr/console/webvirtmgr-console
</span></span><span class="line"><span class="cl">directory=/var/www/webvirtmgr
</span></span><span class="line"><span class="cl">autostart=true
</span></span><span class="line"><span class="cl">autorestart=true
</span></span><span class="line"><span class="cl">stdout_logfile=/var/log/supervisor/webvirtmgr-console.log
</span></span><span class="line"><span class="cl">redirect_stderr=true
</span></span><span class="line"><span class="cl">user=nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">修改/var/www/webvirtmgr/conf/gunicorn.conf.py
</span></span><span class="line"><span class="cl">bind = &#34;0:8000&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="设置开机启动" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae%e5%bc%80%e6%9c%ba%e5%90%af%e5%8a%a8" class="header-mark"></a>0.1.13 设置开机启动</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">chkconfig supervisord on
</span></span><span class="line"><span class="cl">chkconfig nginx on
</span></span><span class="line"><span class="cl">vim /etc/rc.local
</span></span><span class="line"><span class="cl">      /usr/sbin/setsebool httpd_can_network_connect true
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动进程" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8%e8%bf%9b%e7%a8%8b" class="header-mark"></a>0.1.14 启动进程</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">service nginx start
</span></span><span class="line"><span class="cl">service supervisord start
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="访问" class="headerLink">
    <a href="#%e8%ae%bf%e9%97%ae" class="header-mark"></a>0.1.15 访问</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://$server_ip/login/
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Trun Off IPv6 in CentOS 6.x</title><link>https://samzong.me/howto-trun-off-ipv6-in-centos-6-x/</link><pubDate>Fri, 29 Jul 2016 07:26:19 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-trun-off-ipv6-in-centos-6-x/</guid><description><![CDATA[<h2 id="1-centos-6x" class="headerLink">
    <a href="#1-centos-6x" class="header-mark"></a>1. 1. CentOS 6.x</h2><p>CentOS 6 上是默认打开了IPv6，但其实在我们实际使用中很难用到它，所以本篇的内容就是如何关闭IPv6。</p>
<p>＃ 可以看到 inet6 ，说明还没关闭。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# ifconfig eth0
</span></span><span class="line"><span class="cl">eth0      Link encap:Ethernet  HWaddr 00:0C:29:3A:F9:6F
</span></span><span class="line"><span class="cl">          inet addr:172.16.102.161  Bcast:172.16.102.255  Mask:255.255.255.0
</span></span><span class="line"><span class="cl">          inet6 addr: fe80::20c:29ff:fe3a:f96f/64 Scope:Link
</span></span><span class="line"><span class="cl">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span></span><span class="line"><span class="cl">          RX packets:199 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class="line"><span class="cl">          TX packets:122 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class="line"><span class="cl">          collisions:0 txqueuelen:1000
</span></span><span class="line"><span class="cl">          RX bytes:20124 (19.6 KiB)  TX bytes:17182 (16.7 KiB)
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 修改/etc/modprobe.d/dist.conf</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# vi /etc/modprobe.d/dist.conf
</span></span><span class="line"><span class="cl"># 添加下面两行内容
</span></span><span class="line"><span class="cl">alias net-pf-10 off
</span></span><span class="line"><span class="cl">alias ipv6 off
</span></span><span class="line"><span class="cl"># 保存退出，并且重新启动系统
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 开机不启动
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chkconfig ip6tables off
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 系统重启完成后，检查是否加载IPv6</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# lsmod | grep v6
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 补充</p>
<ul>
<li>修改/etc/sysconfig/network，追加</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NETWORKING_IPV6=no
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>修改/etc/hosts文件，把ipv6的那句本地主机名解析的也注释掉</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#::1   localhost localhost6 localhost6.localdomain6
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h2 id="2-centos-7x" class="headerLink">
    <a href="#2-centos-7x" class="header-mark"></a>2. 2. CentOS 7.x</h2><h4 id="setup-1-修改grub文件在启动引导时不加载ipv6" class="headerLink">
    <a href="#setup-1-%e4%bf%ae%e6%94%b9grub%e6%96%87%e4%bb%b6%e5%9c%a8%e5%90%af%e5%8a%a8%e5%bc%95%e5%af%bc%e6%97%b6%e4%b8%8d%e5%8a%a0%e8%bd%bdipv6" class="header-mark"></a>2.0.1 Setup 1. 修改grub文件，在启动引导时不加载ipv6</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# vim /etc/default/grub
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 在GRUB_CMDLINE_LINUX=&#34; &#34; ,中增加
</span></span><span class="line"><span class="cl">ipv6.disable＝1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 重新生产启动引导文件，注意，这里重启系统是没用的，需要手动重建引导文件
</span></span><span class="line"><span class="cl">[root@ultraera ~]# grub2-mkconfig -o /boot/grub2/grub.cfg
</span></span><span class="line"><span class="cl">[root@ultraera ~]# reboot
</span></span></code></pre></td></tr></table>
</div>
</div><p>＃ 验证是否关闭</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# lsmod | grep ipv6
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="setup-2-第二种方式" class="headerLink">
    <a href="#setup-2-%e7%ac%ac%e4%ba%8c%e7%a7%8d%e6%96%b9%e5%bc%8f" class="header-mark"></a>2.0.2 Setup 2. 第二种方式</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 修改/etc/sysctl.conf,增加以下：
</span></span><span class="line"><span class="cl">net.ipv6.conf.all.disable_ipv6 = 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">reboot
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>IPv6是默认支持的，所以当你要重新开起IPv6支持时，将以上添加的指令注释掉即可。</p>
</blockquote>
<blockquote>
<p><font color=red><b>之前碰到过安装某些服务时，不能启动，后来检查原因是因为关闭ipv6的问题，因为在这些服务的conf文件，指定了类似监听ipv6,因为关闭了ipv6导致服务无法启动，将其关闭即可。<b></font></p>
</blockquote>
]]></description></item><item><title>HowTo Use Docker create a Tomcat Project</title><link>https://samzong.me/howto-use-docker-create-a-tomcat-project/</link><pubDate>Tue, 02 Aug 2016 15:44:20 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-use-docker-create-a-tomcat-project/</guid><description><![CDATA[<h4 id="1-安装centos-7x" class="headerLink">
    <a href="#1-%e5%ae%89%e8%a3%85centos-7x" class="header-mark"></a>0.0.1 <strong>1. 安装CentOS 7.x</strong></h4><pre><code>略。
</code></pre>
<h4 id="2-安装docker" class="headerLink">
    <a href="#2-%e5%ae%89%e8%a3%85docker" class="header-mark"></a>0.0.2 <strong>2. 安装docker</strong></h4><p>详见： <a href="https://samzong.me/2016/07/07/HowTo-Install-Docker-on-CentOS-6-x/" target="_blank" rel="noopener noreferrer">How to Install Docker on CentOS 6.x</a></p>
<h4 id="3-基础docker命令" class="headerLink">
    <a href="#3-%e5%9f%ba%e7%a1%80docker%e5%91%bd%e4%bb%a4" class="header-mark"></a>0.0.3 <strong>3. 基础docker命令</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">＃ 获取centos6 docker镜像
</span></span><span class="line"><span class="cl">[root@docker ~]# docker pull centos6
</span></span><span class="line"><span class="cl">Using default tag: latest
</span></span><span class="line"><span class="cl">latest: Pulling from library/centos:centos6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">43db9dbdcb30: Downloading 41.14 MB/49.33 MB
</span></span><span class="line"><span class="cl">43db9dbdcb30: Pull complete
</span></span><span class="line"><span class="cl">2dc64e8f8d4f: Pull complete
</span></span><span class="line"><span class="cl">670a583e1b50: Pull complete
</span></span><span class="line"><span class="cl">183b0bfcd10e: Pull complete
</span></span><span class="line"><span class="cl">Digest: sha256:c6674c44c6439673bf56536c1a15916639c47ea04c3d6296c5df938add67b54b
</span></span><span class="line"><span class="cl">Status: Downloaded newer image for centso:centos6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">＃ 查看当前服务器上的docker镜像
</span></span><span class="line"><span class="cl">[root@docker ~]# docker images
</span></span><span class="line"><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="cl">centos6-visionet    latest              aeed37612ecb        6 hours ago         1.916 GB
</span></span><span class="line"><span class="cl">centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
</span></span><span class="line"><span class="cl">registry            latest              c6c14b3960bd        3 days ago          33.28 MB
</span></span><span class="line"><span class="cl">＃ 查找docker镜像
</span></span><span class="line"><span class="cl">[root@docker ~]# docker search centos:centos6
</span></span><span class="line"><span class="cl">NAME                                     DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class="line"><span class="cl">imagine10255/centos6-lnmp-php56          centos6-lnmp-php56                              10                   [OK]
</span></span><span class="line"><span class="cl">lemonbar/centos6-ssh                     Installed openssh-server on centos6, defau...   7                    [OK]
</span></span><span class="line"><span class="cl">sergeyzh/centos6-nginx                                                                   2                    [OK]
</span></span><span class="line"><span class="cl">guyton/centos6                           From official centos6 container with full ...   2                    [OK]
</span></span><span class="line"><span class="cl">paijp/centos6-apache-php-sqlite2         php5.3.3 with sqlite2 and apache on CentOS...   1                    [OK]
</span></span><span class="line"><span class="cl">edrans/centos6                                                                           1                    [OK]
</span></span><span class="line"><span class="cl">mohri1219/centos6.7-ruby2.2.2-mysql5.6   centos6.7-ruby2.2.2-mysql5.6                    1                    [OK]
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">＃ 删除 centos6 docker镜像
</span></span><span class="line"><span class="cl">[root@docker ~]# docker rmi IMAGES_NAME
</span></span><span class="line"><span class="cl">[root@docker ~]# docker rmi centos:centos6
</span></span><span class="line"><span class="cl"># 报错无法删除
</span></span><span class="line"><span class="cl">Error response from daemon: conflict: unable to remove repository reference &#34;centos&#34; (must force) - container 705a30cbc002 is using its referenced image 42118e3df429
</span></span><span class="line"><span class="cl"># 这是因为之间的运行的进程没有清楚导致该images正在使用中，使用一下命令查看占有的进程
</span></span><span class="line"><span class="cl">[root@docker ~]# docker ps -a ＃ 查看所有的docker进程
</span></span><span class="line"><span class="cl">CONTAINER ID        IMAGE               COMMAND               CREATED             STATUS                     PORTS               NAMES
</span></span><span class="line"><span class="cl">705a30cbc002        centos:centos6              &#34;/bin/bash&#34;           6 minutes ago       Exited (0) 6 minutes ago                       centos6
</span></span><span class="line"><span class="cl">[root@docker ~]# docker rm 705a30cbc002
</span></span><span class="line"><span class="cl">705a30cbc002
</span></span><span class="line"><span class="cl">[root@docker ~]# docker rmi centos:centos6
</span></span><span class="line"><span class="cl">Untagged: centos:centos6
</span></span><span class="line"><span class="cl">Deleted: sha256:42118e3df429f09ca581a9deb3df274601930e428e452f7e4e9f1833c56a100a
</span></span><span class="line"><span class="cl">Deleted: sha256:d72d0199021776e77ac14a764a3decd156e9f6f18b37e25b867b0f1ca42fb3d9
</span></span><span class="line"><span class="cl">Deleted: sha256:fb178c6cea1453d089ce033b96eba0efdb42274138e042517ea2d5ea7bb51665
</span></span><span class="line"><span class="cl">Deleted: sha256:8945af30572845a904adce2aeaf73402c842d86e99e8f10688b25cb27834110b
</span></span><span class="line"><span class="cl">Deleted: sha256:ea9f151abb7e06353e73172dad421235611d4f6d0560ec95db26e0dc240642c1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4-运行一个docker镜像" class="headerLink">
    <a href="#4-%e8%bf%90%e8%a1%8c%e4%b8%80%e4%b8%aadocker%e9%95%9c%e5%83%8f" class="header-mark"></a>0.0.4 <strong>4. 运行一个docker镜像</strong></h4><h4 id="进入交互式程序" class="headerLink">
    <a href="#%e8%bf%9b%e5%85%a5%e4%ba%a4%e4%ba%92%e5%bc%8f%e7%a8%8b%e5%ba%8f" class="header-mark"></a>0.0.5 进入交互式程序</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@docker ~]# docker run  -it centos:centos6 /bin/bash
</span></span><span class="line"><span class="cl">[root@c1d190f95562 /]# cat /etc/redhat-release
</span></span><span class="line"><span class="cl">CentOS release 6.8 (Final)
</span></span><span class="line"><span class="cl"># Install openssh-server and httpd
</span></span><span class="line"><span class="cl">root@d8c122dbe09d:/# yum install -y openssh-sever httpd
</span></span><span class="line"><span class="cl">root@d8c122dbe09d:/# exit
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 注意当你执行exit，从容器之中退出时，容器也会随着关闭，这时如果还继续执行上条命令
</span></span><span class="line"><span class="cl"># 你会发现之前所有的操作都被还原，因为相对于docker，又是新开了一个进程
</span></span><span class="line"><span class="cl"># 在exit退出之后，使用一下命令查看上次提交，然后commit修改，便可保存之前的修改
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@docker ~]# docker ps -l
</span></span><span class="line"><span class="cl">[root@docker ~]# docker commit c1d190f95562 centos:centos6-httpd
</span></span><span class="line"><span class="cl">sha256:77eb12e36c7bbe9ef874555b1873019022b5258740aa731627e2cd6fa749c325
</span></span><span class="line"><span class="cl">[root@docker ~]# docker images
</span></span><span class="line"><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="cl">centos              centos6-httpd       77eb12e36c7b        3 seconds ago       290.3 MB
</span></span><span class="line"><span class="cl">centos6-visionet    latest              aeed37612ecb        6 hours ago         1.916 GB
</span></span><span class="line"><span class="cl">centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
</span></span><span class="line"><span class="cl">registry            latest              c6c14b3960bd        3 days ago          33.28 MB
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="5-编辑dockerfile" class="headerLink">
    <a href="#5-%e7%bc%96%e8%be%91dockerfile" class="header-mark"></a>0.0.6 <strong>5. 编辑Dockerfile</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># dockfile的第一行一定是FROM，指定了父镜像
</span></span><span class="line"><span class="cl">FROM centos:centos6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># RUN 指的是运行的命令
</span></span><span class="line"><span class="cl">RUN yum install -y epel-release
</span></span><span class="line"><span class="cl">RUN yum install -y bash-completion
</span></span><span class="line"><span class="cl">RUN yum install -y openssh-server openssh-client sudo
</span></span><span class="line"><span class="cl">RUN sed -i &#39;s/UsePAM yes/UsePAM no/g&#39; /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl">RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 增加一个用户，并赋予sudo权限
</span></span><span class="line"><span class="cl">RUN useradd visionet
</span></span><span class="line"><span class="cl">RUN echo &#34;visionet:visionet&#34; | chpasswd
</span></span><span class="line"><span class="cl">RUN echo &#34;visionet   ALL=(ALL)       ALL&#34; &gt;&gt; /etc/sudoers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">＃ 注意，如果没有执行一下两个命令，sshd是无法远程登陆的
</span></span><span class="line"><span class="cl">RUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
</span></span><span class="line"><span class="cl">RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">＃ EXPOSE 22， 将22端口暴露出来，方便ssh远程连接
</span></span><span class="line"><span class="cl">RUN mkdir /var/run/sshd
</span></span><span class="line"><span class="cl">EXPOSE 22
</span></span><span class="line"><span class="cl">＃ CMD 为系统内部执行命令
</span></span><span class="line"><span class="cl">CMD [&#34;/usr/sbin/sshd&#34;, &#34;-D&#34;]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="6-生成自定义docker镜像" class="headerLink">
    <a href="#6-%e7%94%9f%e6%88%90%e8%87%aa%e5%ae%9a%e4%b9%89docker%e9%95%9c%e5%83%8f" class="header-mark"></a>0.0.7 <strong>6. 生成自定义docker镜像</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># build 编译镜像
</span></span><span class="line"><span class="cl">[root@docker ~]# docker build -f dockerfile3 -t centos:centos6-ssh .
</span></span><span class="line"><span class="cl">Sending build context to Docker daemon 44.54 kB
</span></span><span class="line"><span class="cl">Step 1 : FROM centos:centos6
</span></span><span class="line"><span class="cl"> ---&gt; a3c09d36ab4a
</span></span><span class="line"><span class="cl">Step 2 : RUN yum install -y epel-release
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 04d81f280a63
</span></span><span class="line"><span class="cl">Step 3 : RUN yum install -y bash-completion
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 5ca26894dc9d
</span></span><span class="line"><span class="cl">Step 4 : RUN yum install -y openssh-server openssh-client sudo
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 42278450311e
</span></span><span class="line"><span class="cl">Step 5 : RUN sed -i &#39;s/UsePAM yes/UsePAM no/g&#39; /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; db35bef562a2
</span></span><span class="line"><span class="cl">Step 6 : RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; dc9f2b82e198
</span></span><span class="line"><span class="cl">Step 7 : RUN useradd visionet
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 06c574a51755
</span></span><span class="line"><span class="cl">Step 8 : RUN echo &#34;visionet:visionet&#34; | chpasswd
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 03412f053d04
</span></span><span class="line"><span class="cl">Step 9 : RUN echo &#34;visionet   ALL=(ALL)       ALL&#34; &gt;&gt; /etc/sudoers
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; bf8476812a62
</span></span><span class="line"><span class="cl">Step 10 : RUN ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 2314cce75171
</span></span><span class="line"><span class="cl">Step 11 : RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 99304cd9ac15
</span></span><span class="line"><span class="cl">Step 12 : RUN mkdir /var/run/sshd
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; f87283751553
</span></span><span class="line"><span class="cl">Step 13 : EXPOSE 22
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; 56c41202dcb9
</span></span><span class="line"><span class="cl">Step 14 : CMD /usr/sbin/sshd -D
</span></span><span class="line"><span class="cl"> ---&gt; Using cache
</span></span><span class="line"><span class="cl"> ---&gt; d6dccb483fa6
</span></span><span class="line"><span class="cl">Successfully built d6dccb483fa6
</span></span><span class="line"><span class="cl">[root@docker ~]# docker images
</span></span><span class="line"><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="cl">centos              centos6-ssh         d6dccb483fa6        2 minutes ago         363 MB
</span></span><span class="line"><span class="cl">centos              centos6-httpd       77eb12e36c7b        6 minutes ago       290.3 MB
</span></span><span class="line"><span class="cl">centos6-visionet    latest              aeed37612ecb        6 hours ago         1.916 GB
</span></span><span class="line"><span class="cl">centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
</span></span><span class="line"><span class="cl">registry            latest              c6c14b3960bd        3 days ago          33.28 MB
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 后台运行docker容器，并指定nat端口转发
</span></span><span class="line"><span class="cl">[root@docker ~]# docker run -d -p 2222:22 -P --name=sshd centos:centos6-ssh
</span></span><span class="line"><span class="cl">b4211f7a304d9e34b72b510230be2c7a76b276886b488f08f3e12896a4d3c172
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="7-ssh登陆到docker容器内部署项目环境" class="headerLink">
    <a href="#7-ssh%e7%99%bb%e9%99%86%e5%88%b0docker%e5%ae%b9%e5%99%a8%e5%86%85%e9%83%a8%e7%bd%b2%e9%a1%b9%e7%9b%ae%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.8 <strong>7. ssh登陆到docker容器内，部署项目环境</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># inspect 查看docker 容器IP地址
</span></span><span class="line"><span class="cl">[root@docker ~]# docker inspect sshd | grep IPAddress
</span></span><span class="line"><span class="cl">[root@docker ~]# ssh visionet@172.17.0.2
</span></span><span class="line"><span class="cl">visionet@172.17.0.2&#39;s password:
</span></span><span class="line"><span class="cl">[visionet@b4211f7a304d ~]$
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install mysql
</span></span><span class="line"><span class="cl"># Install tomcat server
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[visionet@b4211f7a304d ~]$ exit
</span></span><span class="line"><span class="cl">[root@docker ~]# docker stop sshd
</span></span><span class="line"><span class="cl">sshd
</span></span><span class="line"><span class="cl">[root@docker ~]# docker ps -l
</span></span><span class="line"><span class="cl">CONTAINER ID        IMAGE                COMMAND               CREATED             STATUS                       PORTS               NAMES
</span></span><span class="line"><span class="cl">b4211f7a304d        centos:centos6-ssh   &#34;/usr/sbin/sshd -D&#34;   6 minutes ago       Exited (255) 3 seconds ago                       sshd
</span></span><span class="line"><span class="cl">[root@docker ~]# docker commit b4211f7a304d centos:centos6-tomcat
</span></span><span class="line"><span class="cl">sha256:b4f114d5484822d9a3ddf1100b76b460985ba5e5d31e936570e8d7dbd8df282c
</span></span><span class="line"><span class="cl">[root@docker ~]# docker images
</span></span><span class="line"><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="cl">centos              centos6-tomcat      b4f114d54848        4 seconds ago       363.1 MB
</span></span><span class="line"><span class="cl">centos              centos6-httpd       77eb12e36c7b        15 minutes ago      290.3 MB
</span></span><span class="line"><span class="cl">centos6-visionet    latest              aeed37612ecb        7 hours ago         1.916 GB
</span></span><span class="line"><span class="cl">centos              centos6-ssh         d6dccb483fa6        9 hours ago         363 MB
</span></span><span class="line"><span class="cl">centos              centos6             a3c09d36ab4a        2 days ago          194.6 MB
</span></span><span class="line"><span class="cl">registry            latest              c6c14b3960bd        3 days ago          33.28 MB
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="8-推送centoscentos6-tomcat到私有docker仓库" class="headerLink">
    <a href="#8-%e6%8e%a8%e9%80%81centoscentos6-tomcat%e5%88%b0%e7%a7%81%e6%9c%89docker%e4%bb%93%e5%ba%93" class="header-mark"></a>0.0.9 <strong>8. 推送centos:centos6-tomcat到私有docker仓库</strong></h4>]]></description></item><item><title>HowTo Install Openfire on CentOS</title><link>https://samzong.me/howto-install-openfire-on-centos/</link><pubDate>Tue, 02 Aug 2016 16:04:48 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-openfire-on-centos/</guid><description><![CDATA[<h4 id="install-centos-6x-x86_64" class="headerLink">
    <a href="#install-centos-6x-x86_64" class="header-mark"></a>0.0.1 Install Centos 6.x x86_64</h4><p><em>略.</em></p>
<h4 id="安装依赖软件" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96%e8%bd%af%e4%bb%b6" class="header-mark"></a>0.0.2 安装依赖软件</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum -y install wget java glibc.i686
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="下载openfire-38-到本地" class="headerLink">
    <a href="#%e4%b8%8b%e8%bd%bdopenfire-38-%e5%88%b0%e6%9c%ac%e5%9c%b0" class="header-mark"></a>0.0.3 下载openfire 3.8 到本地</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">wget http://download.igniterealtime.org/openfire/openfire-3.8.1-1.i386.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装openfire-38" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85openfire-38" class="header-mark"></a>0.0.4 安装openfire 3.8</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum -y install ./openfire*rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="设置服务开启自启动" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae%e6%9c%8d%e5%8a%a1%e5%bc%80%e5%90%af%e8%87%aa%e5%90%af%e5%8a%a8" class="header-mark"></a>0.0.5 设置服务开启自启动</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">chkconfig openfire on
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="yum-install-mysql-server" class="headerLink">
    <a href="#yum-install-mysql-server" class="header-mark"></a>0.0.6 Yum Install mysql-server</h4><p>详见： <a href="http://blog.ultraera.org/how-to-install-mysql-5-6-on-centos/" target="_blank" rel="noopener noreferrer">How to Install MySQL 5.5/6/7 on RHEL/CentOS 5/6/7</a></p>
<h4 id="创建openfire数据库" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%baopenfire%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>0.0.7 创建openfire数据库</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql -u root -p
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">create database openfire character set utf8;
</span></span><span class="line"><span class="cl">grant all privileges on openfire.* to &#39;openfire&#39;@&#39;127.0.0.1&#39; identified by &#39;openfire&#39; with grant option;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动openfire" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8openfire" class="header-mark"></a>0.0.8 启动openfire</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://Host:9090
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="之后的初始化步骤请根据实际操作注意设定数据库地址用户名和密码时不要出错" class="headerLink">
    <a href="#%e4%b9%8b%e5%90%8e%e7%9a%84%e5%88%9d%e5%a7%8b%e5%8c%96%e6%ad%a5%e9%aa%a4%e8%af%b7%e6%a0%b9%e6%8d%ae%e5%ae%9e%e9%99%85%e6%93%8d%e4%bd%9c%e6%b3%a8%e6%84%8f%e8%ae%be%e5%ae%9a%e6%95%b0%e6%8d%ae%e5%ba%93%e5%9c%b0%e5%9d%80%e7%94%a8%e6%88%b7%e5%90%8d%e5%92%8c%e5%af%86%e7%a0%81%e6%97%b6%e4%b8%8d%e8%a6%81%e5%87%ba%e9%94%99" class="header-mark"></a>0.0.9 之后的初始化步骤，请根据实际操作，注意设定数据库地址用户名和密码时不要出错</h4><h4 id="faq" class="headerLink">
    <a href="#faq" class="header-mark"></a>0.0.10 FAQ</h4><p>openfire安装完毕后无法登录控制台</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">报错：Login failed:make sure your username and password are correct and that you’re an admin or moderator
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">解决方案如下：
</span></span><span class="line"><span class="cl">1.使用Mysql查看工具进入数据库，进入表“ofuser”，将该表清空，然后执行该SQL
</span></span><span class="line"><span class="cl">INSERT INTO ofUser (username, plainPassword, name, email, creationDate, modificationDate)
</span></span><span class="line"><span class="cl">    VALUES (&#39;admin&#39;, &#39;admin&#39;, &#39;Administrator&#39;, &#39;admin@example.com&#39;, &#39;0&#39;, &#39;0&#39;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2.关闭openfire服务，就是从其控制台stop然后再start，再用用户名：admin,密码：admin登录即可
</span></span></code></pre></td></tr></table>
</div>
</div><p>openfire 进程无法启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">报错：nohup: failed to run command `/opt/openfire/jre/bin/java&#39;: No such file or directory
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">解决方案如下：
</span></span><span class="line"><span class="cl">经检查是由于openfire未能正确识别jre环境变量导致，安装时自带的jre是32位，但操作系统却是64位操作平台。
</span></span><span class="line"><span class="cl">，故在/etc/init.d/openfire的启动脚本修改，
</span></span><span class="line"><span class="cl">JAVA_HOME=&#34;/usr/lib/jvm/jre-$VERSION.x86_64&#34;
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Setup MariaDB Galera Cluster 10 On CentOS 6.x</title><link>https://samzong.me/howto-setup-mariadb-galera-cluster-10-on-centos-6-x/</link><pubDate>Thu, 04 Aug 2016 13:14:15 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-setup-mariadb-galera-cluster-10-on-centos-6-x/</guid><description><![CDATA[<h4 id="介绍" class="headerLink">
    <a href="#%e4%bb%8b%e7%bb%8d" class="header-mark"></a>0.0.1 介绍</h4><p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MariaDB Galera Cluster 是一套在MySQL InnoDB存储引擎上面实现multi-master及数据实时同步的系统架构，业务层面无需做读写分离工作，数据库读写压力都能按照既定的规则分发到 各个节点上去。在数据方面完全兼容 MariaDB 和 MySQL。使用MariaDB Galera的解决方案，可以方便快速的搭建出高可用的数据库Cluster，不是主备模式，而是双活模式，也就是说，没有主节点和备份节点，每个节点都可以看做是主节点，都可以进行读写，由Galera来实现底层的数据同步。
</p>
<ul>
<li>真正的多主架构，任何节点都可以进行读写</li>
<li>同步复制，各节点间无延迟且节点宕机不会导致数据丢失</li>
<li>紧密耦合，所有节点均保持相同状态</li>
<li>自动节点配置，无需手工备份当前数据库并拷贝至新节点</li>
</ul>
<h4 id="实验环境" class="headerLink">
    <a href="#%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.2 实验环境</h4><ul>
<li>Cluster node4 IP address 172.16.102.168</li>
<li>Cluster node5 IP address 172.16.102.165</li>
<li>Cluster node6 IP address 172.16.102.164</li>
<li>setenforce 0；sed -i &rsquo;s/SELINUX=enforcing/SELINUX=disabled/&rsquo; /etc/selinux/config</li>
<li>/etc/init.d/iptables stop;chkconfig iptables off</li>
</ul>
<blockquote>
<p>使用vmware 测试需注意:克隆机器需要删除 <code>/etc/udev/rules.d/70-persistent-net.rules</code> 以及<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>中的网卡mac地址选项，不然网卡起不来</p>
</blockquote>
<h4 id="环境检测" class="headerLink">
    <a href="#%e7%8e%af%e5%a2%83%e6%a3%80%e6%b5%8b" class="header-mark"></a>0.0.3 环境检测</h4><ul>
<li>检查iptables状态：/etc/init.d/iptables status;chkconfig &ndash;list | grep iptables</li>
<li>检查selinux状态：getenforce</li>
<li>检查openssh-client包是否安装：系统中是否有ssh命令</li>
<li>检查是否系统中含有mysql相关的包：rpm -qa | grep mysql，有的话都需要卸载掉</li>
<li>检查网络是否通畅：ping <a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer">www.baidu.com</a></li>
</ul>
<h4 id="安装" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>0.0.4 安装</h4><h5 id="1-在所有节点编辑etchosts" class="headerLink">
    <a href="#1-%e5%9c%a8%e6%89%80%e6%9c%89%e8%8a%82%e7%82%b9%e7%bc%96%e8%be%91etchosts" class="header-mark"></a>0.0.4.1 1. 在所有节点编辑/etc/hosts</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@node4 ~]# vi /etc/hosts
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span class="line"><span class="cl">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># add follows
</span></span><span class="line"><span class="cl">172.16.102.164 node6
</span></span><span class="line"><span class="cl">172.16.102.165 node5
</span></span><span class="line"><span class="cl">172.16.102.168 node4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@node4 ~]#
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 依次在node5和node6上编辑/etc/hosts
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-在所有node上安装-mariadb-galera" class="headerLink">
    <a href="#2-%e5%9c%a8%e6%89%80%e6%9c%89node%e4%b8%8a%e5%ae%89%e8%a3%85-mariadb-galera" class="header-mark"></a>0.0.4.2 2. 在所有node上安装 MariaDB Galera</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@node4 ~]# vi /etc/yum.repos.d/mariadb.repo
</span></span><span class="line"><span class="cl"> # MariaDB 10.0 CentOS repository list
</span></span><span class="line"><span class="cl"># http://mariadb.org/mariadb/repositories/
</span></span><span class="line"><span class="cl">[mariadb]
</span></span><span class="line"><span class="cl">name = MariaDB
</span></span><span class="line"><span class="cl">baseurl = http://yum.mariadb.org/10.0/centos6-amd64
</span></span><span class="line"><span class="cl">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
</span></span><span class="line"><span class="cl">gpgcheck=1
</span></span><span class="line"><span class="cl">enabled=0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@node4 ~]# yum --enablerepo=mariadb -y install MariaDB-Galera-server
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 依次在node5和node6上安装 MariaDB-Galera-server
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><i>注意安装完成之后，不要启动mysql</i></p>
</blockquote>
<h5 id="3-在其中一个节点上编辑etcmycnfdservercnf配置文件" class="headerLink">
    <a href="#3-%e5%9c%a8%e5%85%b6%e4%b8%ad%e4%b8%80%e4%b8%aa%e8%8a%82%e7%82%b9%e4%b8%8a%e7%bc%96%e8%be%91etcmycnfdservercnf%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>0.0.4.3 3. 在其中一个节点上编辑/etc/my.cnf.d/server.cnf配置文件</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@node4 ~]# vi /etc/my.cnf.d/server.cnf
</span></span><span class="line"><span class="cl"># 19 行，取消下面的注释，并修改为需求
</span></span><span class="line"><span class="cl">[galera]
</span></span><span class="line"><span class="cl">wsrep_provider=/usr/lib64/galera/libgalera_smm.so
</span></span><span class="line"><span class="cl"># 指定节点地址，这里也可以使用ip,如果没做安装1，可以直接把cluster的ip写在这里。
</span></span><span class="line"><span class="cl">wsrep_cluster_address=&#34;gcomm://node4,node5,node6&#34;
</span></span><span class="line"><span class="cl">binlog_format=row
</span></span><span class="line"><span class="cl">default_storage_engine=InnoDB
</span></span><span class="line"><span class="cl">innodb_autoinc_lock_mode=2
</span></span><span class="line"><span class="cl">bind-address=0.0.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># add follows
</span></span><span class="line"><span class="cl"># cluster name
</span></span><span class="line"><span class="cl">wsrep_cluster_name=&#34;Visionet_MariaDB_Cluster&#34;
</span></span><span class="line"><span class="cl"># replication provider
</span></span><span class="line"><span class="cl">wsrep_sst_method=rsync
</span></span><span class="line"><span class="cl"># own IP address
</span></span><span class="line"><span class="cl">wsrep_node_address=&#34;172.16.102.168&#34;
</span></span><span class="line"><span class="cl">wsrep_node_name=&#34;node4&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 启动数据库
</span></span><span class="line"><span class="cl">[root@node4 ~]# /etc/rc.d/init.d/mysql bootstrap
</span></span><span class="line"><span class="cl">Starting MySQL. SUCCESS!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 初始化你的数据库
</span></span><span class="line"><span class="cl">[root@node4 ~]# mysql_secure_installation
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4-在其它节点上编辑etcmycnfdservercnf配置文件" class="headerLink">
    <a href="#4-%e5%9c%a8%e5%85%b6%e5%ae%83%e8%8a%82%e7%82%b9%e4%b8%8a%e7%bc%96%e8%be%91etcmycnfdservercnf%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>0.0.4.4 4. 在其它节点上编辑/etc/my.cnf.d/server.cnf配置文件</h5><h5 id="node5" class="headerLink">
    <a href="#node5" class="header-mark"></a>0.0.4.5 node5</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@node5 ~]# vi /etc/my.cnf.d/server.cnf
</span></span><span class="line"><span class="cl"># 19 行，取消下面的注释，并修改为需求
</span></span><span class="line"><span class="cl">[galera]
</span></span><span class="line"><span class="cl">wsrep_provider=/usr/lib64/galera/libgalera_smm.so
</span></span><span class="line"><span class="cl"># 指定节点地址，这里也可以使用ip,如果没做安装1，可以直接把cluster的ip写在这里。
</span></span><span class="line"><span class="cl">wsrep_cluster_address=&#34;gcomm://node4,node5,node6&#34;
</span></span><span class="line"><span class="cl">binlog_format=row
</span></span><span class="line"><span class="cl">default_storage_engine=InnoDB
</span></span><span class="line"><span class="cl">innodb_autoinc_lock_mode=2
</span></span><span class="line"><span class="cl">bind-address=0.0.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># add follows
</span></span><span class="line"><span class="cl"># cluster name
</span></span><span class="line"><span class="cl">wsrep_cluster_name=&#34;Visionet_MariaDB_Cluster&#34;
</span></span><span class="line"><span class="cl"># replication provider
</span></span><span class="line"><span class="cl">wsrep_sst_method=rsync
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 以下内容注意，注意应设置为当前服务器信息
</span></span><span class="line"><span class="cl">wsrep_node_address=&#34;172.16.102.165&#34;
</span></span><span class="line"><span class="cl">wsrep_node_name=&#34;node5&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 启动数据库
</span></span><span class="line"><span class="cl">[root@node5 ~]# /etc/rc.d/init.d/mysql start
</span></span><span class="line"><span class="cl">Starting MySQL...SST in progress, setting sleep higher. SUCCESS!
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="node6" class="headerLink">
    <a href="#node6" class="header-mark"></a>0.0.4.6 node6</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@node6 ~]# vi /etc/my.cnf.d/server.cnf
</span></span><span class="line"><span class="cl"># 19 行，取消下面的注释，并修改为需求
</span></span><span class="line"><span class="cl">[galera]
</span></span><span class="line"><span class="cl">wsrep_provider=/usr/lib64/galera/libgalera_smm.so
</span></span><span class="line"><span class="cl"># 指定节点地址，这里也可以使用ip,如果没做安装1，可以直接把cluster的ip写在这里。
</span></span><span class="line"><span class="cl">wsrep_cluster_address=&#34;gcomm://node4,node5,node6&#34;
</span></span><span class="line"><span class="cl">binlog_format=row
</span></span><span class="line"><span class="cl">default_storage_engine=InnoDB
</span></span><span class="line"><span class="cl">innodb_autoinc_lock_mode=2
</span></span><span class="line"><span class="cl">bind-address=0.0.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># add follows
</span></span><span class="line"><span class="cl"># cluster name
</span></span><span class="line"><span class="cl">wsrep_cluster_name=&#34;Visionet_MariaDB_Cluster&#34;
</span></span><span class="line"><span class="cl"># replication provider
</span></span><span class="line"><span class="cl">wsrep_sst_method=rsync
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 以下内容注意，注意应设置为当前服务器信息
</span></span><span class="line"><span class="cl">wsrep_node_address=&#34;172.16.102.164&#34;
</span></span><span class="line"><span class="cl">wsrep_node_name=&#34;node6&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 启动数据库
</span></span><span class="line"><span class="cl">[root@node6 ~]# /etc/rc.d/init.d/mysql start
</span></span><span class="line"><span class="cl">Starting MySQL...SST in progress, setting sleep higher. SUCCESS!
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意：只需要初始化第一个节点服务器的数据库，其他数据的配置文件会自动同步，所以你给node4设置的root可以在node5和node6直接使用，当然这是安装正确的前提。</p>
</blockquote>
<h4 id="登陆各个节点数据库检查配置是否成功" class="headerLink">
    <a href="#%e7%99%bb%e9%99%86%e5%90%84%e4%b8%aa%e8%8a%82%e7%82%b9%e6%95%b0%e6%8d%ae%e5%ba%93%e6%a3%80%e6%9f%a5%e9%85%8d%e7%bd%ae%e6%98%af%e5%90%a6%e6%88%90%e5%8a%9f" class="header-mark"></a>0.0.5 登陆各个节点数据库检查配置是否成功</h4><p>        server.cnf的配置如果没有问题，那么wsrep_local_state_comment的状态应该是Synced。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@node4 ~]# mysql -u root -p
</span></span><span class="line"><span class="cl">Enter password:
</span></span><span class="line"><span class="cl">Welcome to the MariaDB monitor.  Commands end with ; or \g.
</span></span><span class="line"><span class="cl">Your MariaDB connection id is 15
</span></span><span class="line"><span class="cl">Server version: 10.0.26-MariaDB-wsrep MariaDB Server, wsrep_25.13.raf7f02e
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB [(none)]&gt; show status like &#39;wsrep_local_state_comment&#39;;
</span></span><span class="line"><span class="cl">+---------------------------+--------+
</span></span><span class="line"><span class="cl">| Variable_name             | Value  |
</span></span><span class="line"><span class="cl">+---------------------------+--------+
</span></span><span class="line"><span class="cl">| wsrep_local_state_comment | Synced |
</span></span><span class="line"><span class="cl">+---------------------------+--------+
</span></span><span class="line"><span class="cl">1 row in set (0.01 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MariaDB [(none)]&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="结论" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>0.0.6 结论</h4><p>        MariaDB Galera没有主节点和备份节点，配置成功之后，可以在任何一个node节点上操作会自动同步到其他节点，任何一个节点宕机不会影响其他节点的数据和稳定性，配置HAProxy设置VIP的方式来实现负载均衡，提高服务的高可用性，另外，当宕机节点上线之后，事务会自动同步不丢失。</p>
]]></description></item><item><title>Script Install LNMP</title><link>https://samzong.me/script-install-lnmp/</link><pubDate>Sat, 13 Aug 2016 06:12:43 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/script-install-lnmp/</guid><description><![CDATA[<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">&#34;uninstall&#34;</span> <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;starting backup data...&#34;</span>
</span></span><span class="line"><span class="cl">	mkdir -p /www/backup
</span></span><span class="line"><span class="cl">	service mysqld stop
</span></span><span class="line"><span class="cl">	service nginxd stop
</span></span><span class="line"><span class="cl">	service httpd stop
</span></span><span class="line"><span class="cl">	service wdapache stop
</span></span><span class="line"><span class="cl">	service pureftpd stop
</span></span><span class="line"><span class="cl">	tar zcvf /www/backup/mysqldatdbk.tar.gz /www/wdlinux/mysql/var
</span></span><span class="line"><span class="cl">	tar zcvf /www/backup/ngconfbk.tar.gz /www/wdlinux/nginx/conf
</span></span><span class="line"><span class="cl">	tar zcvf /www/backup/apconfbk.tar.gz /www/wdlinux/apache/conf
</span></span><span class="line"><span class="cl">	rpm -e lanmp_wdcp --nodeps
</span></span><span class="line"><span class="cl">	rm -fr /www/wdlinux
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;	lanmp,wdcp remove is OK&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl">	<span class="nb">exit</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Turn off selinux...&#34;</span>
</span></span><span class="line"><span class="cl">setenforce <span class="m">0</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/selinux/config
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/^exclude=/#exclude=/g&#39;</span> /etc/yum.conf
</span></span><span class="line"><span class="cl">yum install -y gcc gcc-c++ make autoconf libtool-ltdl-devel gd-devel freetype-devel libxml2-devel libjpeg-devel libpng-devel openssl-devel curl-devel patch libmcrypt-devel libmhash-devel ncurses-devel sudo bzip2 iptables sendmail iptables unzip
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#echo &#34;Check the network...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ping -c 2 113.105.167.1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#if [[ $? != 0 ]];then</span>
</span></span><span class="line"><span class="cl"><span class="c1">#	echo</span>
</span></span><span class="line"><span class="cl"><span class="c1">#	echo &#34;network err&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#	exit 1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#fi</span>
</span></span><span class="line"><span class="cl">ping -c <span class="m">3</span> dl.wdlinux.cn
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> <span class="o">==</span> <span class="m">2</span> <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;dns error&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> ! -d /www/wdlinux <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;rpm remove...&#34;</span>
</span></span><span class="line"><span class="cl">	rpm -e php --nodeps
</span></span><span class="line"><span class="cl">	rpm -e httpd --nodeps
</span></span><span class="line"><span class="cl">	rpm -e mysql-server --nodeps
</span></span><span class="line"><span class="cl">	rpm -e mysql --nodeps
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;yum update...&#34;</span>
</span></span><span class="line"><span class="cl">yum install -y make autoconf sudo wget libtool-ltdl-devel gd-devel freetype-devel libxml2-devel libjpeg-devel libpng-devel openssl-devel curl-devel patch libmcrypt-devel libmhash-devel ncurses-devel iptables
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">arch</span><span class="o">=</span>i386
</span></span><span class="line"><span class="cl"><span class="nv">Aurl</span><span class="o">=</span><span class="s2">&#34;http://dl.wdlinux.cn:5180/rpms&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="sb">`</span>uname -m<span class="sb">`</span> <span class="o">==</span> <span class="s2">&#34;x86_64&#34;</span> <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nv">arch</span><span class="o">=</span><span class="s2">&#34;x86_64&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> in_finsh <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;          configuration ,lamp or lnmp,wdcp install is finshed&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;          visit http://ip&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;          wdcp visit http://ip:8080&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;          more infomation please visit http://www.wdlinux.cn&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">function</span> in_check <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="m">1</span> <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> <span class="s2">&#34;============  </span><span class="nv">$2</span><span class="s2"> install error  =============&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">                <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span> <span class="s2">&#34;============  </span><span class="nv">$2</span><span class="s2"> install OK  ==============&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">                <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">grep -E <span class="s1">&#39;wdOS 1|5\.&#39;</span> /etc/redhat-release &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">v1</span><span class="o">=</span><span class="nv">$?</span>
</span></span><span class="line"><span class="cl">grep -E <span class="s1">&#39;wdOS 2|6\.&#39;</span> /etc/redhat-release &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">v2</span><span class="o">=</span><span class="nv">$?</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$v1</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nv">RF</span><span class="o">=</span><span class="s2">&#34;lanmp_wdcp-2-5.</span><span class="nv">$arch</span><span class="s2">.rpm&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="o">[</span> <span class="nv">$v2</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nv">RF</span><span class="o">=</span><span class="s2">&#34;lanmp_wdcp-2-5.el6.</span><span class="nv">$arch</span><span class="s2">.rpm&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="o">[</span> <span class="nv">$arch</span> <span class="o">==</span> <span class="s2">&#34;x86_64&#34;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">		wget -c http://dl.wdlinux.cn:5180/soft/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm
</span></span><span class="line"><span class="cl">		rpm -ivh rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">		wget -c http://dl.wdlinux.cn:5180/soft/rpmforge-release-0.5.2-2.el6.rf.i686.rpm
</span></span><span class="line"><span class="cl">		rpm -ivh rpmforge-release-0.5.2-2.el6.rf.i686.rpm
</span></span><span class="line"><span class="cl">	<span class="k">fi</span>
</span></span><span class="line"><span class="cl">	yum install -y mhash-devel libmcrypt-devel
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span> <span class="s2">&#34;The current system does not support&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl">	<span class="nb">exit</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">wget -c http://dl.wdlinux.cn:5180/rpms/<span class="nv">$RF</span>
</span></span><span class="line"><span class="cl">rpm -ivh <span class="nv">$RF</span> --nodeps
</span></span><span class="line"><span class="cl"><span class="nv">I_F</span><span class="o">=</span><span class="nv">$?</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="nv">$I_F</span> <span class="o">==</span> <span class="m">0</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
</span></span><span class="line"><span class="cl">	<span class="nb">echo</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">in_check <span class="nv">$I_F</span> lanmp_wdcp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">rm -f wdcp_v*
</span></span><span class="line"><span class="cl">wget -c http://down.wdlinux.cn/down/wdcp_v2.5.tar.gz &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">tar zxvf wdcp_v2.5.tar.gz -C / &gt; /dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">in_finsh
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install a Tomcat Server 7</title><link>https://samzong.me/howto-install-a-tomcat-server-7/</link><pubDate>Mon, 19 Sep 2016 10:25:53 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-a-tomcat-server-7/</guid><description><![CDATA[<p>       本文件是采用的模板是CentOS 6，同样适用于CentOS 系列其他发行版本。</p>
<h4 id="1-测试环境" class="headerLink">
    <a href="#1-%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.1 1. 测试环境</h4><ul>
<li>VMware Fushion 8 Pro # windows Use <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener noreferrer">VirtualBox</a></li>
<li><a href="http://mirrors.aliyun.com/centos/6.8/isos/x86_64/CentOS-6.8-x86_64-minimal.iso" target="_blank" rel="noopener noreferrer">CentOS-6.8-x86_64-minimal.iso</a></li>
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener noreferrer">JDK 7</a></li>
<li><a href="http://ftp.riken.jp/net/apache/tomcat/tomcat-7/" target="_blank" rel="noopener noreferrer">Tomcat 7</a></li>
</ul>
<h4 id="2-install-java-se-development-kit-7-jdk7" class="headerLink">
    <a href="#2-install-java-se-development-kit-7-jdk7" class="header-mark"></a>0.0.2 2. Install Java SE Development Kit 7 (JDK7)</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# curl -LO -H &#34;Cookie: oraclelicense=accept-securebackup-cookie&#34; \
</span></span><span class="line"><span class="cl">&#34;http://download.oracle.com/otn-pub/java/jdk/7u75-b13/jdk-7u75-linux-x64.rpm&#34;
</span></span><span class="line"><span class="cl">[root@ultraera ~]# rpm -Uvh jdk-7u75-linux-x64.rpm
</span></span><span class="line"><span class="cl">Preparing...                ########################################### [100%]
</span></span><span class="line"><span class="cl">   1:jdk                    ########################################### [100%]
</span></span><span class="line"><span class="cl">Unpacking JAR files...
</span></span><span class="line"><span class="cl">        rt.jar...
</span></span><span class="line"><span class="cl">        jsse.jar...
</span></span><span class="line"><span class="cl">        charsets.jar...
</span></span><span class="line"><span class="cl">        tools.jar...
</span></span><span class="line"><span class="cl">        localedata.jar...
</span></span><span class="line"><span class="cl">        jfxrt.jar...
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-build-java-environment" class="headerLink">
    <a href="#3-build-java-environment" class="header-mark"></a>0.0.3 3. Build Java Environment.</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# vi /etc/profile
</span></span><span class="line"><span class="cl"># add follows to the end
</span></span><span class="line"><span class="cl">export JAVA_HOME=/usr/java/default
</span></span><span class="line"><span class="cl">export PATH=$PATH:$JAVA_HOME/bin
</span></span><span class="line"><span class="cl">export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span><span class="line"><span class="cl">[root@ultraera ~]# source /etc/profile
</span></span><span class="line"><span class="cl">[root@ultraera ~]# java -version
</span></span><span class="line"><span class="cl">java version &#34;1.7.0_75&#34;
</span></span><span class="line"><span class="cl">Java(TM) SE Runtime Environment (build 1.7.0_75-b13)
</span></span><span class="line"><span class="cl">Java HotSpot(TM) 64-Bit Server VM (build 24.75-b04, mixed mode)
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4-download-tomcat7" class="headerLink">
    <a href="#4-download-tomcat7" class="header-mark"></a>0.0.4 4. Download Tomcat7</h4><p>Make sure the latest one and download it from the site below.
=》 <a href="http://ftp.riken.jp/net/apache/tomcat/tomcat-7/" target="_blank" rel="noopener noreferrer">http://ftp.riken.jp/net/apache/tomcat/tomcat-7/</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# wget http://ftp.riken.jp/net/apache/tomcat/tomcat-7/v7.0.70/bin/apache-tomcat-7.0.70.tar.gz
</span></span><span class="line"><span class="cl">[root@ultraera ~]# tar zxvf apache-tomcat-7.0.70.tar.gz
</span></span><span class="line"><span class="cl">[root@ultraera ~]# mv apache-tomcat-7.0.70 /usr/tomcat7
</span></span><span class="line"><span class="cl">[root@ultraera ~]# useradd -M -d /usr/tomcat7 tomcat7
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chown -R tomcat7. /usr/tomcat7
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="5-create-a-script--use-service-manage-tomcat7" class="headerLink">
    <a href="#5-create-a-script--use-service-manage-tomcat7" class="header-mark"></a>0.0.5 5. create a script , use service manage tomcat7</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# cat /etc/rc.d/init.d/tomcat7
</span></span><span class="line"><span class="cl"> #!/bin/bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Tomcat7: Start/Stop Tomcat 7
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl"># chkconfig: - 90 10
</span></span><span class="line"><span class="cl"># description: Tomcat is a Java application Server.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">. /etc/init.d/functions
</span></span><span class="line"><span class="cl">. /etc/sysconfig/network
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CATALINA_HOME=/usr/tomcat7
</span></span><span class="line"><span class="cl">TOMCAT_USER=tomcat7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">LOCKFILE=/var/lock/subsys/tomcat7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">RETVAL=0
</span></span><span class="line"><span class="cl">start(){
</span></span><span class="line"><span class="cl">    echo &#34;Starting Tomcat7: &#34;
</span></span><span class="line"><span class="cl">    su - $TOMCAT_USER -c &#34;$CATALINA_HOME/bin/startup.sh&#34;
</span></span><span class="line"><span class="cl">    RETVAL=$?
</span></span><span class="line"><span class="cl">    echo
</span></span><span class="line"><span class="cl">    [ $RETVAL -eq 0 ] &amp;&amp; touch $LOCKFILE
</span></span><span class="line"><span class="cl">    return $RETVAL
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">stop(){
</span></span><span class="line"><span class="cl">    echo &#34;Shutting down Tomcat7: &#34;
</span></span><span class="line"><span class="cl">    $CATALINA_HOME/bin/shutdown.sh
</span></span><span class="line"><span class="cl">    RETVAL=$?
</span></span><span class="line"><span class="cl">    echo
</span></span><span class="line"><span class="cl">    [ $RETVAL -eq 0 ] &amp;&amp; rm -f $LOCKFILE
</span></span><span class="line"><span class="cl">    return $RETVAL
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">case &#34;$1&#34; in
</span></span><span class="line"><span class="cl">    start)
</span></span><span class="line"><span class="cl">        start
</span></span><span class="line"><span class="cl">        ;;
</span></span><span class="line"><span class="cl">    stop)
</span></span><span class="line"><span class="cl">        stop
</span></span><span class="line"><span class="cl">        ;;
</span></span><span class="line"><span class="cl">    restart)
</span></span><span class="line"><span class="cl">        stop
</span></span><span class="line"><span class="cl">        start
</span></span><span class="line"><span class="cl">        ;;
</span></span><span class="line"><span class="cl">    *)
</span></span><span class="line"><span class="cl">        echo $&#34;Usage: $0 {start|stop|restart}&#34;
</span></span><span class="line"><span class="cl">        exit 1
</span></span><span class="line"><span class="cl">        ;;
</span></span><span class="line"><span class="cl">esac
</span></span><span class="line"><span class="cl">exit $?
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="6-add-tomcat7-to-system-service" class="headerLink">
    <a href="#6-add-tomcat7-to-system-service" class="header-mark"></a>0.0.6 6. Add tomcat7 to system service</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@ultraera ~<span class="o">]</span><span class="c1"># chmod 755 /etc/rc.d/init.d/tomcat7</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@ultraera ~<span class="o">]</span><span class="c1"># /etc/rc.d/init.d/tomcat7 start</span>
</span></span><span class="line"><span class="cl">Starting Tomcat7:
</span></span><span class="line"><span class="cl">Using CATALINA_BASE:   /usr/tomcat7
</span></span><span class="line"><span class="cl">Using CATALINA_HOME:   /usr/tomcat7
</span></span><span class="line"><span class="cl">Using CATALINA_TMPDIR: /usr/tomcat7/temp
</span></span><span class="line"><span class="cl">Using JRE_HOME:        /usr/java/default
</span></span><span class="line"><span class="cl">Using CLASSPATH:       /usr/tomcat7/bin/bootstrap.jar:/usr/tomcat7/bin/tomcat-juli.jar
</span></span><span class="line"><span class="cl">Tomcat started.
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@ultraera ~<span class="o">]</span><span class="c1"># netstat -ntlp | grep java</span>
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> ::ffff:127.0.0.1:8005       :::*                        LISTEN      6326/java
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> :::8009                     :::*                        LISTEN      6326/java
</span></span><span class="line"><span class="cl">tcp        <span class="m">0</span>      <span class="m">0</span> :::8080                    :::*                        LISTEN      6326/java
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@ultraera ~<span class="o">]</span><span class="c1"># ps axu | grep java</span>
</span></span><span class="line"><span class="cl">tomcat7       <span class="m">6326</span>  8.3 85.6 <span class="m">5229768</span> <span class="m">2910176</span> ?     Sl   Aug22 3216:38 /usr/bin/java -Djava.util.logging.config.file<span class="o">=</span>/usr/tomcat7/conf/logging.properties -Djava.util.logging.manager<span class="o">=</span>org.apache.juli.ClassLoaderLogManager -server -Djava.endorsed.dirs<span class="o">=</span>/usr/tomcat7/endorsed -classpath /usr/tomcat7/bin/bootstrap.jar:/usr/tomcat7/bin/tomcat-juli.jar -Dcatalina.base<span class="o">=</span>/usr/tomcat7 -Dcatalina.home<span class="o">=</span>/usr/tomcat7 -Djava.io.tmpdir<span class="o">=</span>/usr/tomcat7/temp org.apache.catalina.startup.Bootstrap start
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@ultraera ~<span class="o">]</span><span class="c1"># chkconfig --add tomcat7</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@ultraera ~<span class="o">]</span><span class="c1"># chkconfig tomcat7 on</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="7-打开浏览器测试tomcat-server搭建完成默认页面如下" class="headerLink">
    <a href="#7-%e6%89%93%e5%bc%80%e6%b5%8f%e8%a7%88%e5%99%a8%e6%b5%8b%e8%af%95tomcat-server%e6%90%ad%e5%bb%ba%e5%ae%8c%e6%88%90%e9%bb%98%e8%ae%a4%e9%a1%b5%e9%9d%a2%e5%a6%82%e4%b8%8b" class="header-mark"></a>0.0.7 7. 打开浏览器测试Tomcat Server搭建完成，默认页面如下</h4><p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/09/tomcat7.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/09/tomcat7.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/09/tomcat7.jpg">
        
    </a></p>
<h4 id="8-使用curl-测试" class="headerLink">
    <a href="#8-%e4%bd%bf%e7%94%a8curl-%e6%b5%8b%e8%af%95" class="header-mark"></a>0.0.8 8. 使用curl 测试</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# curl -I http://localhost:8080
</span></span><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Server: Apache-Coyote/1.1
</span></span><span class="line"><span class="cl">Content-Type: text/html;charset=ISO-8859-1
</span></span><span class="line"><span class="cl">Transfer-Encoding: chunked
</span></span><span class="line"><span class="cl">Date: Sun, 18 Sep 2016 11:14:06 GMT
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="9-tomcat-文件树" class="headerLink">
    <a href="#9-tomcat-%e6%96%87%e4%bb%b6%e6%a0%91" class="header-mark"></a>0.0.9 9. Tomcat 文件树</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera /usr/tomcat7]# tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── bin
</span></span><span class="line"><span class="cl">│   ├── bootstrap.jar
</span></span><span class="line"><span class="cl">│   ├── catalina.bat
</span></span><span class="line"><span class="cl">│   ├── catalina.sh
</span></span><span class="line"><span class="cl">│   ├── catalina-tasks.xml
</span></span><span class="line"><span class="cl">│   ├── commons-daemon.jar
</span></span><span class="line"><span class="cl">│   ├── commons-daemon-native.tar.gz
</span></span><span class="line"><span class="cl">│   ├── configtest.bat
</span></span><span class="line"><span class="cl">│   ├── configtest.sh
</span></span><span class="line"><span class="cl">│   ├── daemon.sh
</span></span><span class="line"><span class="cl">│   ├── digest.bat
</span></span><span class="line"><span class="cl">│   ├── digest.sh
</span></span><span class="line"><span class="cl">│   ├── setclasspath.bat
</span></span><span class="line"><span class="cl">│   ├── setclasspath.sh
</span></span><span class="line"><span class="cl">│   ├── shutdown.bat
</span></span><span class="line"><span class="cl">│   ├── shutdown.sh
</span></span><span class="line"><span class="cl">│   ├── startup.bat
</span></span><span class="line"><span class="cl">│   ├── startup.sh
</span></span><span class="line"><span class="cl">│   ├── tomcat-juli.jar
</span></span><span class="line"><span class="cl">│   ├── tomcat-native.tar.gz
</span></span><span class="line"><span class="cl">│   ├── tool-wrapper.bat
</span></span><span class="line"><span class="cl">│   ├── tool-wrapper.sh
</span></span><span class="line"><span class="cl">│   ├── version.bat
</span></span><span class="line"><span class="cl">│   └── version.sh
</span></span><span class="line"><span class="cl">├── conf
</span></span><span class="line"><span class="cl">│   ├── catalina.policy
</span></span><span class="line"><span class="cl">│   ├── catalina.properties
</span></span><span class="line"><span class="cl">│   ├── context.xml
</span></span><span class="line"><span class="cl">│   ├── logging.properties
</span></span><span class="line"><span class="cl">│   ├── server.xml
</span></span><span class="line"><span class="cl">│   ├── tomcat-users.xml
</span></span><span class="line"><span class="cl">│   └── web.xml
</span></span><span class="line"><span class="cl">├── lib
</span></span><span class="line"><span class="cl">├── LICENSE
</span></span><span class="line"><span class="cl">├── logs
</span></span><span class="line"><span class="cl">│   ├── catalina.2016-09-18.log
</span></span><span class="line"><span class="cl">│   ├── catalina.out
</span></span><span class="line"><span class="cl">│   ├── host-manager.2016-09-18.log
</span></span><span class="line"><span class="cl">│   ├── localhost.2016-09-18.log
</span></span><span class="line"><span class="cl">│   └── manager.2016-09-18.log
</span></span><span class="line"><span class="cl">├── NOTICE
</span></span><span class="line"><span class="cl">├── RELEASE-NOTES
</span></span><span class="line"><span class="cl">├── RUNNING.txt
</span></span><span class="line"><span class="cl">├── temp
</span></span><span class="line"><span class="cl">├── webapps
</span></span><span class="line"><span class="cl">│   └── ROOT
</span></span><span class="line"><span class="cl">└── work
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Use pt-query-digest</title><link>https://samzong.me/howto-use-pt-query-digest/</link><pubDate>Thu, 22 Sep 2016 15:20:12 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-use-pt-query-digest/</guid><description><![CDATA[<h3 id="1-简介" class="headerLink">
    <a href="#1-%e7%ae%80%e4%bb%8b" class="header-mark"></a>0.1 1. 简介</h3><p>索引可以我们更快速的执行查询，但是肯定存在不合理的索引，如果想找到那些索引不是很合适的查询，并在它们成为问题前进行优化，则可以使用pt-query-digest的查询审查“review”功能，分析其EXPLAIN出来的执行计划。</p>
<p>pt-query-digest是用于分析mysql慢查询的一个工具，它可以分析binlog、General log、slowlog，也可以通过SHOWPROCESSLIST或者通过tcpdump抓取的MySQL协议数据来进行分析。可以把分析结果输出到文件中，分析过程是先对查询语句的条件进行参数化，然后对参数化以后的查询进行分组统计，统计出各查询的执行时间、次数、占比等，可以借助分析结果找出问题进行优化。</p>
<h3 id="2-install-percona-toolkit--pt-query-digest" class="headerLink">
    <a href="#2-install-percona-toolkit--pt-query-digest" class="header-mark"></a>0.2 2. Install Percona Toolkit &amp; pt-query-digest</h3><p>percona-toolkit是一组高级命令行工具的集合，用来执行各种通过手工执行非常复杂和麻烦的mysql和系统任务。这些任务包括：</p>
<ul>
<li>检查master和slave数据的一致性</li>
<li>有效地对记录进行归档</li>
<li>查找重复的索引</li>
<li>对服务器信息进行汇总</li>
<li>分析来自日志和tcpdump的查询</li>
<li>当系统出问题的时候收集重要的系统信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultrera ~]# wget percona.com/get/percona-toolkit.tar.gz
</span></span><span class="line"><span class="cl">--2016-09-22 09:17:00--  http://percona.com/get/percona-toolkit.tar.gz
</span></span><span class="line"><span class="cl">Resolving percona.com... 74.121.199.234, 74.121.199.234
</span></span><span class="line"><span class="cl">Connecting to percona.com|74.121.199.234|:80... connected.
</span></span><span class="line"><span class="cl">HTTP request sent, awaiting response... 301 Moved Permanently
</span></span><span class="line"><span class="cl">Location: https://www.percona.com/get/percona-toolkit.tar.gz [following]
</span></span><span class="line"><span class="cl">--2016-09-22 09:17:02--  https://www.percona.com/get/percona-toolkit.tar.gz
</span></span><span class="line"><span class="cl">Resolving www.percona.com... 74.121.199.234, 74.121.199.234
</span></span><span class="line"><span class="cl">Connecting to www.percona.com|74.121.199.234|:443... connected.
</span></span><span class="line"><span class="cl">HTTP request sent, awaiting response... 302 Found
</span></span><span class="line"><span class="cl">Location: https://www.percona.com/downloads/percona-toolkit/2.2.19/tarball/percona-toolkit-2.2.19.tar.gz [following]
</span></span><span class="line"><span class="cl">--2016-09-22 09:17:03--  https://www.percona.com/downloads/percona-toolkit/2.2.19/tarball/percona-toolkit-2.2.19.tar.gz
</span></span><span class="line"><span class="cl">Reusing existing connection to www.percona.com:443.
</span></span><span class="line"><span class="cl">HTTP request sent, awaiting response... 200 OK
</span></span><span class="line"><span class="cl">Length: 1425623 (1.4M) [application/x-gzip]
</span></span><span class="line"><span class="cl">Saving to: “percona-toolkit.tar.gz”
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">100%[=======================&gt;] 1,425,623    766K/s   in 1.8s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2016-09-22 09:17:05 (766 KB/s) - “percona-toolkit.tar.gz” saved [1425623/1425623]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@ultrera ~]# tar xf percona-toolkit.tar.gz
</span></span><span class="line"><span class="cl">[root@ultrera ~]# ls
</span></span><span class="line"><span class="cl">percona-toolkit-2.2.19  percona-toolkit.tar.gz
</span></span><span class="line"><span class="cl">[root@ultrera ~]# cd percona-toolkit-2.2.19
</span></span><span class="line"><span class="cl">[root@ultrera percona-toolkit-2.2.19]# perl Makefile.PL
</span></span><span class="line"><span class="cl">Warning: prerequisite DBD::mysql 3 not found.
</span></span><span class="line"><span class="cl">Writing Makefile for percona-toolkit
</span></span><span class="line"><span class="cl">[root@ultrera percona-toolkit-2.2.19]# make
</span></span><span class="line"><span class="cl">cp bin/pt-mysql-summary blib/script/pt-mysql-summary
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">Manifying blib/man1/pt-index-usage.1p
</span></span><span class="line"><span class="cl">Manifying blib/man1/pt-duplicate-key-checker.1p
</span></span><span class="line"><span class="cl">Manifying blib/man1/pt-config-diff.1p
</span></span><span class="line"><span class="cl">Manifying blib/man1/pt-stalk.1p
</span></span><span class="line"><span class="cl">[root@ultrera percona-toolkit-2.2.19]# make install
</span></span><span class="line"><span class="cl">Installing /usr/local/share/man/man1/pt-query-digest.1p
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">Installing /usr/local/bin/pt-query-digest
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">Appending installation info to /usr/lib64/perl5/perllocal.pod
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>运行工具可能会遇到下面的错误: Can&rsquo;t locate Time/HiRes.pm in @INC</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 解决办法：
</span></span><span class="line"><span class="cl">[root@ultrera ~]# yum install -y perl-Time-HiRes
</span></span><span class="line"><span class="cl">[root@ultrera ~]# pt-query-digest --version
</span></span><span class="line"><span class="cl">pt-query-digest 2.2.19
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-开启-mysql慢日志" class="headerLink">
    <a href="#3-%e5%bc%80%e5%90%af-mysql%e6%85%a2%e6%97%a5%e5%bf%97" class="header-mark"></a>0.3 3. 开启 mysql慢日志</h3><h5 id="a-查看当前slow_query_log-状态" class="headerLink">
    <a href="#a-%e6%9f%a5%e7%9c%8b%e5%bd%93%e5%89%8dslow_query_log-%e7%8a%b6%e6%80%81" class="header-mark"></a>0.3.0.1 a. 查看当前‘slow_query_log’ 状态：</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql&gt; show variables like &#39;%query%&#39;;
</span></span><span class="line"><span class="cl">+------------------------------+---------------------------------+
</span></span><span class="line"><span class="cl">| Variable_name                | Value                           |
</span></span><span class="line"><span class="cl">+------------------------------+---------------------------------+
</span></span><span class="line"><span class="cl">| binlog_rows_query_log_events | OFF                             |
</span></span><span class="line"><span class="cl">| ft_query_expansion_limit     | 20                              |
</span></span><span class="line"><span class="cl">| have_query_cache             | YES                             |
</span></span><span class="line"><span class="cl">| long_query_time              | 10.000000                       |
</span></span><span class="line"><span class="cl">| query_alloc_block_size       | 8192                            |
</span></span><span class="line"><span class="cl">| query_cache_limit            | 1048576                         |
</span></span><span class="line"><span class="cl">| query_cache_min_res_unit     | 4096                            |
</span></span><span class="line"><span class="cl">| query_cache_size             | 1048576                         |
</span></span><span class="line"><span class="cl">| query_cache_type             | OFF                             |
</span></span><span class="line"><span class="cl">| query_cache_wlock_invalidate | OFF                             |
</span></span><span class="line"><span class="cl">| query_prealloc_size          | 8192                            |
</span></span><span class="line"><span class="cl">| slow_query_log               | OFF                             |
</span></span><span class="line"><span class="cl">| slow_query_log_file          | /var/lib/mysql/ultrera-slow.log |
</span></span><span class="line"><span class="cl">+------------------------------+---------------------------------+
</span></span><span class="line"><span class="cl">13 rows in set (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; show variables like &#39;log_queries_not_using_indexes&#39;;
</span></span><span class="line"><span class="cl">+-------------------------------+-------+
</span></span><span class="line"><span class="cl">| Variable_name                 | Value |
</span></span><span class="line"><span class="cl">+-------------------------------+-------+
</span></span><span class="line"><span class="cl">| log_queries_not_using_indexes | OFF   |
</span></span><span class="line"><span class="cl">+-------------------------------+-------+
</span></span><span class="line"><span class="cl">1 row in set (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="b-启动slow_log-配置" class="headerLink">
    <a href="#b-%e5%90%af%e5%8a%a8slow_log-%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.3.0.2 b. 启动slow_log, 配置</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 设定记录大于2s的sql
</span></span><span class="line"><span class="cl">mysql&gt; set global long_query_time=2;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 设定log存放路径
</span></span><span class="line"><span class="cl">mysql&gt; set global slow_query_log_file=&#39;/tmp/ultraera-slow.log&#39;;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 启用慢日志
</span></span><span class="line"><span class="cl">mysql&gt; set global slow_query_log=ON;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 同时记录没有使用索引的sql
</span></span><span class="line"><span class="cl">mysql&gt; set global log_queries_not_using_indexes=on;
</span></span><span class="line"><span class="cl">Query OK, 0 rows affected (0.00 sec)
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>等待一段时间，slow.log 增大的非常快，实际生产中，注意不要被slow.log将磁盘撑满，影响到正常生产使用。</p>
</blockquote>
<h3 id="4-分析" class="headerLink">
    <a href="#4-%e5%88%86%e6%9e%90" class="header-mark"></a>0.4 4. 分析</h3><p>pt-query-digest可以从普通MySQL日志，慢查询日志以及二进制日志中分析查询，甚至可以从SHOW PROCESSLIST和MySQL协议的tcpdump中进行分析，如果没有指定文件，它从标准输入流（STDIN）中读取数据。</p>
<h5 id="a-简单使用方法" class="headerLink">
    <a href="#a-%e7%ae%80%e5%8d%95%e4%bd%bf%e7%94%a8%e6%96%b9%e6%b3%95" class="header-mark"></a>0.4.0.3 a. 简单使用方法：</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pt-query-digest slow.logs
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出信息如下：</p>
<div align="left">
![](http://images.cnitblog.com/blog/288950/201312/14135450-6f7a732598054f7aa311e95cbd4df3b1.png)
</div>
<ul>
1. Overall这个部分是一个大致的概要信息(类似loadrunner给出的概要信息)，通过它可以对当前MySQL的查询性能做一个初步的评估，比如各个指标的最大值(max)，平均值(min)，95%分布值，中位数(median)，标准偏差(stddev)
<li>查询的执行时间（Exec time）</li>
<li>锁占用的时间（Lock time）</li>
<li>MySQL执行器需要检查的行数（Rows examine）</li>
<li>最后返回给客户端的行数（Rows sent）</li>
<li>查询的大小。</li>
</ul>
<ul>
2. Profile
<li>Rank ： 整个分析中该“语句”的排名，一般也就是性能最慢的</li>
<li>Query ID ：每个查询都有一个</li>
<li>Response time ： “语句”的响应时间以及整体占比情况。</li>
<li>Calls ：“语句”的执行次数</li>
<li>R/Call ：每次执行的平均响应时间。 </li>
<li>V/M</li>
</ul>
##### 详细信息
<p>列出上面Profile中每个Query ID的详细信息</p>
<h5 id="b-从tcpdump包中分析通过tcpdump命令抓取一定时间网络数据包然后进行分析" class="headerLink">
    <a href="#b-%e4%bb%8etcpdump%e5%8c%85%e4%b8%ad%e5%88%86%e6%9e%90%e9%80%9a%e8%bf%87tcpdump%e5%91%bd%e4%bb%a4%e6%8a%93%e5%8f%96%e4%b8%80%e5%ae%9a%e6%97%b6%e9%97%b4%e7%bd%91%e7%bb%9c%e6%95%b0%e6%8d%ae%e5%8c%85%e7%84%b6%e5%90%8e%e8%bf%9b%e8%a1%8c%e5%88%86%e6%9e%90" class="header-mark"></a>0.4.0.4 b. 从tcpdump包中分析：通过tcpdump命令抓取一定时间网络数据包，然后进行分析：</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pt-query-digest --type tcpdump mysql.tcp.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="c-pt-query-digest-还支持很对其他的数据包分析形势但是我们主要使用的还是针对慢日志进行分析" class="headerLink">
    <a href="#c-pt-query-digest-%e8%bf%98%e6%94%af%e6%8c%81%e5%be%88%e5%af%b9%e5%85%b6%e4%bb%96%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%85%e5%88%86%e6%9e%90%e5%bd%a2%e5%8a%bf%e4%bd%86%e6%98%af%e6%88%91%e4%bb%ac%e4%b8%bb%e8%a6%81%e4%bd%bf%e7%94%a8%e7%9a%84%e8%bf%98%e6%98%af%e9%92%88%e5%af%b9%e6%85%a2%e6%97%a5%e5%bf%97%e8%bf%9b%e8%a1%8c%e5%88%86%e6%9e%90" class="header-mark"></a>0.4.0.5 c. pt-query-digest 还支持很对其他的数据包分析形势，但是我们主要使用的还是针对慢日志进行分析</h5><blockquote>
<p>更多的帮助文档，请查看官方文档：http://www.percona.com/doc/percona-toolkit/2.2/pt-query-digest.html</p>
</blockquote>
<h3 id="5-使用anemometer将pt-query-digest的mysql慢查询可视化" class="headerLink">
    <a href="#5-%e4%bd%bf%e7%94%a8anemometer%e5%b0%86pt-query-digest%e7%9a%84mysql%e6%85%a2%e6%9f%a5%e8%af%a2%e5%8f%af%e8%a7%86%e5%8c%96" class="header-mark"></a>0.5 5. 使用Anemometer将pt-query-digest的MySQL慢查询可视化</h3><ul>
<li>需要安装php 5.3 and over</li>
<li>需要预先配置mysql数据库</li>
<li>需要预先安装好pt-query-digest</li>
</ul>
<h5 id="51-安装" class="headerLink">
    <a href="#51-%e5%ae%89%e8%a3%85" class="header-mark"></a>0.5.0.6 5.1 安装</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultrera ~]# git clone https://github.com/box/Anemometer.git anemometer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@ultrera ~]# mv anemometer /var/www/html
</span></span><span class="line"><span class="cl">[root@ultrera ~]# cd /var/www/html/anemometer/
</span></span><span class="line"><span class="cl">[root@ultrera anemometer]# mysql -h localhost -u root -p &lt; mysql56-install.sql
</span></span><span class="line"><span class="cl">[root@ultrera anemometer]# mysql -h localhost -u root -p -e &#34;grant all privileges on slow_query_log.* to &#39;anemometer&#39;@&#39;%&#39; identified by &#39;anemometer&#39;;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="52-配置" class="headerLink">
    <a href="#52-%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.5.0.7 5.2 配置</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultrera anemometer]# cp conf/sample.config.inc.php conf/config.inc.php
</span></span><span class="line"><span class="cl">[root@ultrera anemometer]# vim conf/config.inc.php
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># line 48,49 and line 284,285
</span></span><span class="line"><span class="cl">设置数据库的用户名和密码;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@ultrera anemometer]# vim conf/config.inc.php
</span></span><span class="line"><span class="cl"># line 7,8
</span></span><span class="line"><span class="cl">设置数据库的用户名和密码;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="53-导入" class="headerLink">
    <a href="#53-%e5%af%bc%e5%85%a5" class="header-mark"></a>0.5.0.8 5.3 导入</h5><p>将pt-query-digest 的分析结果到anemometer；</p>
<blockquote>
<p>pt-query-digest version &lt; 2.2</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ pt-query-digest --user=anemometer --password=superSecurePass \
</span></span><span class="line"><span class="cl">                  --review h=db.example.com,D=slow_query_log,t=global_query_review \
</span></span><span class="line"><span class="cl">                  --review-history h=db.example.com,D=slow_query_log,t=global_query_review_history \
</span></span><span class="line"><span class="cl">                  --no-report --limit=0% \
</span></span><span class="line"><span class="cl">                  --filter=&#34; \$event-&gt;{Bytes} = length(\$event-&gt;{arg}) and \$event-&gt;{hostname}=\&#34;$HOSTNAME\&#34;&#34; \
</span></span><span class="line"><span class="cl">                  /var/lib/mysql/db.example.com-slow.log
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>pt-query-digest version &gt;= 2.2</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pt-query-digest --user=anemometer --password=superSecurePass \
</span></span><span class="line"><span class="cl">                  --review h=db.example.com,D=slow_query_log,t=global_query_review \
</span></span><span class="line"><span class="cl">                  --history h=db.example.com,D=slow_query_log,t=global_query_review_history \
</span></span><span class="line"><span class="cl">                  --no-report --limit=0% \
</span></span><span class="line"><span class="cl">                  --filter=&#34; \$event-&gt;{Bytes} = length(\$event-&gt;{arg}) and \$event-&gt;{hostname}=\&#34;$HOSTNAME\&#34;&#34; \
</span></span><span class="line"><span class="cl">                  /var/lib/mysql/db.example.com-slow.log
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Pipeline process 11 (aggregate fingerprint) caused an error: Argument &#34;57A&#34; isn&#39;t numeric in numeric gt (&gt;) at (eval 40) line 6, &lt;&gt; line 27.
</span></span><span class="line"><span class="cl">Pipeline process 11 (aggregate fingerprint) caused an error: Argument &#34;57B&#34; isn&#39;t numeric in numeric gt (&gt;) at (eval 40) line 6, &lt;&gt; line 28.
</span></span><span class="line"><span class="cl">Pipeline process 11 (aggregate fingerprint) caused an error: Argument &#34;57C&#34; isn&#39;t numeric in numeric gt (&gt;) at (eval 40) line 6, &lt;&gt; line 29.
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install PostgreSQL 9.5 on CentOS 6.x</title><link>https://samzong.me/howto-install-postgresql-9-5-on-centos-6-x/</link><pubDate>Thu, 20 Oct 2016 07:25:37 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-postgresql-9-5-on-centos-6-x/</guid><description><![CDATA[<h3 id="centos-6" class="headerLink">
    <a href="#centos-6" class="header-mark"></a>0.1 CentOS 6</h3><h5 id="1-install-postgresql-repository-and-the-postgresql-server-by-running-the-following" class="headerLink">
    <a href="#1-install-postgresql-repository-and-the-postgresql-server-by-running-the-following" class="header-mark"></a>0.1.0.1 1. Install PostgreSQL repository and the PostgreSQL server by running the following:</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo yum install https://download.postgresql.org/pub/repos/yum/9.5/redhat/rhel-6-x86_64/pgdg-centos95-9.5-2.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo yum install postgresql95-serve
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-create-the-postgresql-database-cluster" class="headerLink">
    <a href="#2-create-the-postgresql-database-cluster" class="header-mark"></a>0.1.0.2 2. Create the PostgreSQL database cluster.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sduo service postgresql-9.5 initdb
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3-enable-automatic-postgresql-server-startup" class="headerLink">
    <a href="#3-enable-automatic-postgresql-server-startup" class="header-mark"></a>0.1.0.3 3. Enable automatic PostgreSQL server startup.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo chkconfig postgresql-9.5 on
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4-start-the-postgresql-server" class="headerLink">
    <a href="#4-start-the-postgresql-server" class="header-mark"></a>0.1.0.4 4. Start the PostgreSQL server.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo service postgresql-9.5 start
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="centos-7" class="headerLink">
    <a href="#centos-7" class="header-mark"></a>0.2 CentOS 7</h3><h5 id="1-install-postgresql-repository-and-the-postgresql-server-by-running-the-following-1" class="headerLink">
    <a href="#1-install-postgresql-repository-and-the-postgresql-server-by-running-the-following-1" class="header-mark"></a>0.2.0.5 1. Install PostgreSQL repository and the PostgreSQL server by running the following:</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo yum install https://download.postgresql.org/pub/repos/yum/9.5 /redhat/rhel-7-x86_64/pgdg-centos95-9.5-2.noarch.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo yum install postgresql95-serve
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-create-the-postgresql-database-cluster-1" class="headerLink">
    <a href="#2-create-the-postgresql-database-cluster-1" class="header-mark"></a>0.2.0.6 2. Create the PostgreSQL database cluster.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo /usr/pgsql-9.5/bin/postgresql95-setup initdb
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3-enable-automatic-postgresql-server-startup-1" class="headerLink">
    <a href="#3-enable-automatic-postgresql-server-startup-1" class="header-mark"></a>0.2.0.7 3. Enable automatic PostgreSQL server startup.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl enable postgresql-9.5
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4-start-the-postgresql-server-1" class="headerLink">
    <a href="#4-start-the-postgresql-server-1" class="header-mark"></a>0.2.0.8 4. Start the PostgreSQL server.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start postgresql-9.5
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configurations-for-centos" class="headerLink">
    <a href="#configurations-for-centos" class="header-mark"></a>0.3 Configurations for CentOS</h3><p>When installing in CentOs env. you will also need to make the following configurations.</p>
<h5 id="1-change-authentication-to-md5" class="headerLink">
    <a href="#1-change-authentication-to-md5" class="header-mark"></a>0.3.0.9 1. Change authentication to md5.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo vi /var/lib/pgsql/9.5/data/pg_hba.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-change-method-to-md5" class="headerLink">
    <a href="#2-change-method-to-md5" class="header-mark"></a>0.3.0.10 2. Change METHOD to md5.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># IPv4 local connections:
</span></span><span class="line"><span class="cl">host    all             all             127.0.0.1/32            md5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># IPv6 local connections:
</span></span><span class="line"><span class="cl">host    all             all             ::1/128                 md5
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3-restart-postgresql" class="headerLink">
    <a href="#3-restart-postgresql" class="header-mark"></a>0.3.0.11 3. Restart PostgreSQL</h5>]]></description></item><item><title>SSH LINUX Security Settings</title><link>https://samzong.me/ssh-linux-security-settings/</link><pubDate>Sat, 29 Oct 2016 06:23:59 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/ssh-linux-security-settings/</guid><description><![CDATA[<h3 id="ssh-配置安全控制限制登录" class="headerLink">
    <a href="#ssh-%e9%85%8d%e7%bd%ae%e5%ae%89%e5%85%a8%e6%8e%a7%e5%88%b6%e9%99%90%e5%88%b6%e7%99%bb%e5%bd%95" class="header-mark"></a>0.1 <strong>SSH 配置安全控制限制登录</strong></h3><h5 id="1-只允许某个ip登录拒绝其他所有ip" class="headerLink">
    <a href="#1-%e5%8f%aa%e5%85%81%e8%ae%b8%e6%9f%90%e4%b8%aaip%e7%99%bb%e5%bd%95%e6%8b%92%e7%bb%9d%e5%85%b6%e4%bb%96%e6%89%80%e6%9c%89ip" class="header-mark"></a>0.1.0.1 1. 只允许某个IP登录，拒绝其他所有IP</h5><p>在 /etc/hosts.allow 增加:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sshd: 1.2.3.4
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 /etc/hosts.deny 增肌:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sshd: ALL
</span></span></code></pre></td></tr></table>
</div>
</div><p>用 iptables 也行:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">iptables -A INPUT -p tcp --dport 22 -j DROP
</span></span><span class="line"><span class="cl">iptables -A INPUT -p tcp --dport 22 -s 1.2.3.4 -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-禁止某个用户通过ssh登录" class="headerLink">
    <a href="#2-%e7%a6%81%e6%ad%a2%e6%9f%90%e4%b8%aa%e7%94%a8%e6%88%b7%e9%80%9a%e8%bf%87ssh%e7%99%bb%e5%bd%95" class="header-mark"></a>0.1.0.2 2. 禁止某个用户通过ssh登录</h5><p>在/etc/ssh/sshd_conf添加</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">AllowUsers 用户名
</span></span><span class="line"><span class="cl">或者
</span></span><span class="line"><span class="cl">AllowGroups 组名
</span></span><span class="line"><span class="cl">或者
</span></span><span class="line"><span class="cl">DenyUsers 用户名
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3-设定登录黑名单" class="headerLink">
    <a href="#3-%e8%ae%be%e5%ae%9a%e7%99%bb%e5%bd%95%e9%bb%91%e5%90%8d%e5%8d%95" class="header-mark"></a>0.1.0.3 3. 设定登录黑名单</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@6 ~]# vim /etc/pam.d/sshd
</span></span><span class="line"><span class="cl">auth required /lib/security/pam_listfile.so item=user sense=deny file=/etc/sshd_user_deny_list onerr=succeed
</span></span><span class="line"><span class="cl"># 所有/etc/sshd_user_deny_list里面的用户被拒绝ssh登录
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4-sshd_config配置" class="headerLink">
    <a href="#4-sshd_config%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.1.0.4 4. sshd_config配置</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式
</span></span><span class="line"><span class="cl">Port 22　　　　　　　　　　# SSH 预设使用 22 这个 port，您也可以使用多的 port ！
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 亦即重复使用 port 这个设定项目即可！
</span></span><span class="line"><span class="cl">Protocol 2,1　　　　　　　 # 选择的 SSH 协议版本，可以是 1 也可以是 2 ，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 如果要同时支持两者，就必须要使用 2,1 这个分隔了！
</span></span><span class="line"><span class="cl">#ListenAddress 0.0.0.0　　 # 监听的主机适配卡！举个例子来说，如果您有两个 IP，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 分别是 192.168.0.100 及 192.168.2.20 ，那么只想要
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 开放 192.168.0.100 时，就可以写如同下面的样式：
</span></span><span class="line"><span class="cl">ListenAddress 192.168.0.100          # 只监听来自 192.168.0.100 这个 IP 的SSH联机。
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 如果不使用设定的话，则预设所有接口均接受 SSH
</span></span><span class="line"><span class="cl">PidFile /var/run/sshd.pid　　　　　　# 可以放置 SSHD 这个 PID 的档案！左列为默认值
</span></span><span class="line"><span class="cl">LoginGraceTime 600　　　　 # 当使用者连上 SSH server 之后，会出现输入密码的画面，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 在该画面中，在多久时间内没有成功连上 SSH server ，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 就断线！时间为秒！
</span></span><span class="line"><span class="cl">Compression yes　　　　　　# 是否可以使用压缩指令？当然可以啰！
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 说明主机的 Private Key 放置的档案，预设使用下面的档案即可！
</span></span><span class="line"><span class="cl">HostKey /etc/ssh/ssh_host_key　　　　# SSH version 1 使用的私钥
</span></span><span class="line"><span class="cl">HostKey /etc/ssh/ssh_host_rsa_key　　# SSH version 2 使用的 RSA 私钥
</span></span><span class="line"><span class="cl">HostKey /etc/ssh/ssh_host_dsa_key　　# SSH version 2 使用的 DSA 私钥
</span></span><span class="line"><span class="cl"># 关于 version 1 的一些设定！
</span></span><span class="line"><span class="cl">KeyRegenerationInterval 3600　 　　　# 由前面联机的说明可以知道， version 1 会使用
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # server 的 Public Key ，那么如果这个 Public
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # Key 被偷的话，岂不完蛋？所以需要每隔一段时间
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 来重新建立一次！这里的时间为秒！
</span></span><span class="line"><span class="cl">ServerKeyBits 768 　　　　　　　　　 # 没错！这个就是 Server key 的长度！
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 关于登录文件的讯息数据放置与 daemon 的名称！
</span></span><span class="line"><span class="cl">SyslogFacility AUTH　　　　　　　　　# 当有人使用 SSH 登入系统的时候，SSH会记录资
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 讯，这个信息要记录在什么 daemon name 底下？
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 预设是以 AUTH 来设定的，即是 /var/log/secure
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 里面！什么？忘记了！回到 Linux 基础去翻一下
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 其它可用的 daemon name 为：DAEMON,USER,AUTH,
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # LOCAL0,LOCAL1,LOCAL2,LOCAL3,LOCAL4,LOCAL5,
</span></span><span class="line"><span class="cl">LogLevel INFO　　　　　　　　　　　　# 登录记录的等级！嘿嘿！任何讯息！
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 同样的，忘记了就回去参考！
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 登入设定部分
</span></span><span class="line"><span class="cl">PermitRootLogin no　　 　　# 是否允许 root 登入！预设是允许的，但是建议设定成 no！
</span></span><span class="line"><span class="cl">UserLogin no　　　　　　　 # 在 SSH 底下本来就不接受 login 这个程序的登入！
</span></span><span class="line"><span class="cl">StrictModes yes　　　　　　# 当使用者的 host key 改变之后，Server 就不接受联机，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 可以抵挡部分的木马程序！
</span></span><span class="line"><span class="cl">#RSAAuthentication yes　　 # 是否使用纯的 RSA 认证！？仅针对 version 1 ！
</span></span><span class="line"><span class="cl">PubkeyAuthentication yes　 # 是否允许 Public Key ？当然允许啦！只有 version 2
</span></span><span class="line"><span class="cl">AuthorizedKeysFile      .ssh/authorized_keys
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 上面这个在设定若要使用不需要密码登入的账号时，那么那个
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 账号的存放档案所在档名！
</span></span><span class="line"><span class="cl">Allowusers root@222.XX.XX.XX. #设置允许root帐号只能以222.XX.XX.XX这个IP进行ssh连接
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 认证部分
</span></span><span class="line"><span class="cl">RhostsAuthentication no　　# 本机系统不止使用 .rhosts ，因为仅使用 .rhosts 太
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 不安全了，所以这里一定要设定为 no ！
</span></span><span class="line"><span class="cl">IgnoreRhosts yes　　　　　 # 是否取消使用 ~/.ssh/.rhosts 来做为认证！当然是！
</span></span><span class="line"><span class="cl">RhostsRSAAuthentication no # 这个选项是专门给 version 1 用的，使用 rhosts 档案在
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # /etc/hosts.equiv配合 RSA 演算方式来进行认证！不要使用
</span></span><span class="line"><span class="cl">HostbasedAuthentication no # 这个项目与上面的项目类似，不过是给 version 2 使用的！
</span></span><span class="line"><span class="cl">IgnoreUserKnownHosts no　　# 是否忽略家目录内的 ~/.ssh/known_hosts 这个档案所记录
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 的主机内容？当然不要忽略，所以这里就是 no 啦！
</span></span><span class="line"><span class="cl">PasswordAuthentication yes # 密码验证当然是需要的！所以这里写 yes 啰！
</span></span><span class="line"><span class="cl">PermitEmptyPasswords no　　# 若上面那一项如果设定为 yes 的话，这一项就最好设定
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　 # 为 no ，这个项目在是否允许以空的密码登入！当然不许！
</span></span><span class="line"><span class="cl">ChallengeResponseAuthentication yes  # 挑战任何的密码认证！所以，任何 login.conf
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 规定的认证方式，均可适用！
</span></span><span class="line"><span class="cl">#PAMAuthenticationViaKbdInt yes      # 是否启用其它的 PAM 模块！启用这个模块将会
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　　　　　　 # 导致 PasswordAuthentication 设定失效！
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！
</span></span><span class="line"><span class="cl">#KerberosAuthentication no
</span></span><span class="line"><span class="cl">#KerberosOrLocalPasswd yes
</span></span><span class="line"><span class="cl">#KerberosTicketCleanup yes
</span></span><span class="line"><span class="cl">#KerberosTgtPassing no
</span></span><span class="line"><span class="cl">　
</span></span><span class="line"><span class="cl"># 底下是有关在 X-Window 底下使用的相关设定！
</span></span><span class="line"><span class="cl">X11Forwarding yes
</span></span><span class="line"><span class="cl">#X11DisplayOffset 10
</span></span><span class="line"><span class="cl">#X11UseLocalhost yes
</span></span><span class="line"><span class="cl"># 登入后的项目：
</span></span><span class="line"><span class="cl">PrintMotd no              # 登入后是否显示出一些信息呢？例如上次登入的时间、地点等
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 等，预设是 yes ，但是，如果为了安全，可以考虑改为 no ！
</span></span><span class="line"><span class="cl">PrintLastLog yes　　　　　# 显示上次登入的信息！可以啊！预设也是 yes ！
</span></span><span class="line"><span class="cl">KeepAlive yes　　　　　　 # 一般而言，如果设定这项目的话，那么 SSH Server 会传送
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# KeepAlive 的讯息给 Client 端，以确保两者的联机正常！
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 在这个情况下，任何一端死掉后， SSH 可以立刻知道！而不会
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 有僵尸程序的发生！
</span></span><span class="line"><span class="cl">UsePrivilegeSeparation yes # 使用者的权限设定项目！就设定为 yes 吧！
</span></span><span class="line"><span class="cl">MaxStartups 10　　　　　　# 同时允许几个尚未登入的联机画面？当我们连上 SSH ，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 但是尚未输入密码时，这个时候就是我们所谓的联机画面啦！
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 在这个联机画面中，为了保护主机，所以需要设定最大值，
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 预设最多十个联机画面，而已经建立联机的不计算在这十个当中
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 关于使用者抵挡的设定项目：
</span></span><span class="line"><span class="cl">DenyUsers *　　　　　　　 # 设定受抵挡的使用者名称，如果是全部的使用者，那就是全部
</span></span><span class="line"><span class="cl">　　　　　　　　　　　　　# 挡吧！若是部分使用者，可以将该账号填入！例如下列！
</span></span><span class="line"><span class="cl">DenyUsers test
</span></span><span class="line"><span class="cl">DenyGroups test　　　　　 # 与 DenyUsers 相同！仅抵挡几个群组而已！
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 关于 SFTP 服务的设定项目！
</span></span><span class="line"><span class="cl">Subsystem       sftp    /usr/lib/ssh/sftp-server
</span></span><span class="line"><span class="cl">如果不愿意开放 SFTP 的话，将这一行批注掉即可！
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install LNMP on CentOS 6.x</title><link>https://samzong.me/howto-install-lnmp-on-centos-6-x/</link><pubDate>Mon, 28 Nov 2016 10:33:09 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-lnmp-on-centos-6-x/</guid><description><![CDATA[<blockquote>
<p>egrep -v &ldquo;^ *#|^ *$&rdquo;     去除所有以#号开头的文件</p>
</blockquote>
<h4 id="demo-system" class="headerLink">
    <a href="#demo-system" class="header-mark"></a>0.0.1 Demo system</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 ~]$ uname -a
</span></span><span class="line"><span class="cl">Linux Test01 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ ip addr | grep eth0
</span></span><span class="line"><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
</span></span><span class="line"><span class="cl">    inet 10.0.2.128/24 brd 10.0.2.255 scope global eth0
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="install-httpd" class="headerLink">
    <a href="#install-httpd" class="header-mark"></a>0.0.2 Install httpd</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 yum.repos.d]$ sudo yum install -y httpd
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ rpm -qa | grep httpd
</span></span><span class="line"><span class="cl">httpd-2.2.15-39.el6.centos.x86_64
</span></span><span class="line"><span class="cl">httpd-tools-2.2.15-39.el6.centos.x86_64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># remove welcome page
</span></span><span class="line"><span class="cl">[Alex@Test01 yum.repos.d]$ sudo rm -f /etc/httpd/conf.d/welcome.conf
</span></span><span class="line"><span class="cl"># remove default error page
</span></span><span class="line"><span class="cl">[Alex@Test01 yum.repos.d]$ sudo rm -f /var/www/error/noindex.html
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="configure-httpd--replace-the-server-name-to-you-own-one" class="headerLink">
    <a href="#configure-httpd--replace-the-server-name-to-you-own-one" class="header-mark"></a>0.0.3 Configure httpd . Replace the server name to you own one.</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 ~]# sudo vi /etc/httpd/conf/httpd.conf
</span></span><span class="line"><span class="cl"># line 44: change
</span></span><span class="line"><span class="cl"> ServerTokens Prod
</span></span><span class="line"><span class="cl"># line 76: change to ON
</span></span><span class="line"><span class="cl"> KeepAlive On
</span></span><span class="line"><span class="cl"># line 262: Admin&#39;s address
</span></span><span class="line"><span class="cl"> ServerAdmin luchuanjia@msn.com
</span></span><span class="line"><span class="cl"># line 338: change
</span></span><span class="line"><span class="cl"> AllowOverride All
</span></span><span class="line"><span class="cl"># line 276: change to your server&#39;s name
</span></span><span class="line"><span class="cl"> ServerName www.ultraera.org:80
</span></span><span class="line"><span class="cl"># line 402: add file name that it can access only with directory&#39;s name
</span></span><span class="line"><span class="cl"> DirectoryIndex index.html index.htm
</span></span><span class="line"><span class="cl"># line 536: change
</span></span><span class="line"><span class="cl"> ServerSignature Off
</span></span><span class="line"><span class="cl"># line 759: comment out
</span></span><span class="line"><span class="cl"># AddDefaultCharset UTF-8
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]# sudo /etc/init.d/httpd start
</span></span><span class="line"><span class="cl"> Starting httpd:[  OK  ]
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]# sudo chkconfig httpd on     # set httpd start with system.
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="create-a-html-test-page" class="headerLink">
    <a href="#create-a-html-test-page" class="header-mark"></a>0.0.4 create a HTML test page</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 ~]# sudo vi /var/www/html/index.html
</span></span><span class="line"><span class="cl">it&#39;s ok.
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="http://s3.51cto.com/wyfs02/M00/70/DE/wKioL1XAUfuQoFfwAACC5LJWQgg039.jpg" title="http://s3.51cto.com/wyfs02/M00/70/DE/wKioL1XAUfuQoFfwAACC5LJWQgg039.jpg" data-thumbnail="http://s3.51cto.com/wyfs02/M00/70/DE/wKioL1XAUfuQoFfwAACC5LJWQgg039.jpg">
        
    </a></p>
<h4 id="install-php" class="headerLink">
    <a href="#install-php" class="header-mark"></a>0.0.5 Install PHP.</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo yum install -y php php-mbstring php-pear
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ rpm -qa | grep php
</span></span><span class="line"><span class="cl">php-common-5.3.3-46.el6_6.x86_64
</span></span><span class="line"><span class="cl">php-5.3.3-46.el6_6.x86_64
</span></span><span class="line"><span class="cl">php-mbstring-5.3.3-46.el6_6.x86_64
</span></span><span class="line"><span class="cl">php-cli-5.3.3-46.el6_6.x86_64
</span></span><span class="line"><span class="cl">php-pear-1.9.4-4.el6.noarch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo vi /etc/httpd/conf/httpd.conf
</span></span><span class="line"><span class="cl"># line 402 add file name that it can access only with directory&#39;s name
</span></span><span class="line"><span class="cl">  DirectoryIndex index.html index.htm index.php
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo vi /etc/php.ini
</span></span><span class="line"><span class="cl"># line 946 set your timezone
</span></span><span class="line"><span class="cl">date.timezone = &#34;Asia/Shanghai&#34;
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo /etc/init.d/httpd restart
</span></span><span class="line"><span class="cl"> Stopping httpd:[  OK  ]
</span></span><span class="line"><span class="cl"> Starting httpd:[  OK  ]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="create-a-php-test-page" class="headerLink">
    <a href="#create-a-php-test-page" class="header-mark"></a>0.0.6 create a php test page.</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 ~]# sudo vi /var/www/html/index.php
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">    phpinfo();
</span></span><span class="line"><span class="cl">?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="http://s3.51cto.com/wyfs02/M02/70/DE/wKioL1XAUguwJCl2AARE16t4hyw682.jpg" title="http://s3.51cto.com/wyfs02/M02/70/DE/wKioL1XAUguwJCl2AARE16t4hyw682.jpg" data-thumbnail="http://s3.51cto.com/wyfs02/M02/70/DE/wKioL1XAUguwJCl2AARE16t4hyw682.jpg">
        
    </a></p>
<h4 id="install-mysql" class="headerLink">
    <a href="#install-mysql" class="header-mark"></a>0.0.7 Install MySQL</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo -y install mysql-server
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ rpm -qa | grep mysql-server
</span></span><span class="line"><span class="cl">mysql-server-5.1.73-5.el6_6.x86_64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo vi /etc/my.cnf
</span></span><span class="line"><span class="cl">[mysqld]
</span></span><span class="line"><span class="cl">datadir=/var/lib/mysql
</span></span><span class="line"><span class="cl">socket=/var/lib/mysql/mysql.sock
</span></span><span class="line"><span class="cl">user=mysql
</span></span><span class="line"><span class="cl"># Disabling symbolic-links is recommended to prevent assorted security risks
</span></span><span class="line"><span class="cl">symbolic-links=0
</span></span><span class="line"><span class="cl"># add
</span></span><span class="line"><span class="cl">character-set-server=utf8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo /etc/rc.d/init.d/mysqld start
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Initializing MySQL database:  WARNING: The host &#39;www.ultraera.org&#39; could not be looked up with resolveip.
</span></span><span class="line"><span class="cl">This probably means that your libc libraries are not 100 % compatible
</span></span><span class="line"><span class="cl">with this binary MySQL version. The MySQL daemon, mysqld, should work
</span></span><span class="line"><span class="cl">normally with the exception that host name resolving will not work.
</span></span><span class="line"><span class="cl">This means that you should use IP addresses instead of hostnames
</span></span><span class="line"><span class="cl">when specifying MySQL privileges !
</span></span><span class="line"><span class="cl">Installing MySQL system tables...
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">Filling help tables...
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">You can test the MySQL daemon with mysql-test-run.pl
</span></span><span class="line"><span class="cl">cd /usr/mysql-test ; perl mysql-test-run.pl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Please report any problems with the /usr/bin/mysqlbug script!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                                              [  OK  ]
</span></span><span class="line"><span class="cl">Starting mysqld:                      [  OK  ]
</span></span><span class="line"><span class="cl">[Alex@Test01 ~]$ sudo chkconfig mysqld on
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="initial-settings-for-mysql" class="headerLink">
    <a href="#initial-settings-for-mysql" class="header-mark"></a>0.0.8 Initial settings for MySQL</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@www ~]#mysql_secure_installation
</span></span><span class="line"><span class="cl">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
</span></span><span class="line"><span class="cl">      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In order to log into MySQL to secure it, we&#39;ll need the current
</span></span><span class="line"><span class="cl">password for the root user.  If you&#39;ve just installed MySQL, and
</span></span><span class="line"><span class="cl">you haven&#39;t set the root password yet, the password will be blank,
</span></span><span class="line"><span class="cl">so you should just press enter here.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Enter
</span></span><span class="line"><span class="cl"> Enter current password for root (enter for none):
</span></span><span class="line"><span class="cl">OK, successfully used password, moving on...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Setting the root password ensures that nobody can log into the MySQL
</span></span><span class="line"><span class="cl">root user without the proper authorisation.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># set root password
</span></span><span class="line"><span class="cl"> Set root password? [Y/n]y
</span></span><span class="line"><span class="cl"> New password:    # input any password
</span></span><span class="line"><span class="cl"> Re-enter new password:
</span></span><span class="line"><span class="cl">Password updated successfully!
</span></span><span class="line"><span class="cl">Reloading privilege tables..
</span></span><span class="line"><span class="cl"> ... Success!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">By default, a MySQL installation has an anonymous user, allowing anyone
</span></span><span class="line"><span class="cl">to log into MySQL without having to have a user account created for
</span></span><span class="line"><span class="cl">them.  This is intended only for testing, and to make the installation
</span></span><span class="line"><span class="cl">go a bit smoother.  You should remove them before moving into a
</span></span><span class="line"><span class="cl">production environment.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># remove anonymous users
</span></span><span class="line"><span class="cl"> Remove anonymous users? [Y/n]y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> ... Success!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Normally, root should only be allowed to connect from &#39;localhost&#39;.  This
</span></span><span class="line"><span class="cl">ensures that someone cannot guess at the root password from the network.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># disallow root login remotely
</span></span><span class="line"><span class="cl"> Disallow root login remotely? [Y/n]y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> ... Success!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">By default, MySQL comes with a database named &#39;test&#39; that anyone can
</span></span><span class="line"><span class="cl">access.  This is also intended only for testing, and should be removed
</span></span><span class="line"><span class="cl">before moving into a production environment.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># remove test database
</span></span><span class="line"><span class="cl"> Remove test database and access to it? [Y/n]y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> - Dropping test database...
</span></span><span class="line"><span class="cl"> ... Success!
</span></span><span class="line"><span class="cl"> - Removing privileges on test database...
</span></span><span class="line"><span class="cl"> ... Success!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Reloading the privilege tables will ensure that all changes made so far
</span></span><span class="line"><span class="cl">will take effect immediately.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># reload privilege tables
</span></span><span class="line"><span class="cl"> Reload privilege tables now? [Y/n]y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> ... Success!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Cleaning up...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">All done!  If you&#39;ve completed all of the above steps, your MySQL
</span></span><span class="line"><span class="cl">installation should now be secure.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Thanks for using MySQL!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># try to connect with root
</span></span><span class="line"><span class="cl"> [root@www ~]#mysql -u root -p
</span></span><span class="line"><span class="cl"> Enter password:# MySQL root password
</span></span><span class="line"><span class="cl">Welcome to the MySQL monitor.  Commands end with ; or \g.
</span></span><span class="line"><span class="cl">Your MySQL connection id is 10
</span></span><span class="line"><span class="cl">Server version: 5.1.73 Source distribution
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Oracle is a registered trademark of Oracle Corporation and/or its
</span></span><span class="line"><span class="cl">affiliates. Other names may be trademarks of their respective
</span></span><span class="line"><span class="cl">owners.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># display user list
</span></span><span class="line"><span class="cl"> mysql&gt;select user,host,password from mysql.user;
</span></span><span class="line"><span class="cl">+------+-----------+-------------------------------------------+
</span></span><span class="line"><span class="cl">| user | host      | password                                  |
</span></span><span class="line"><span class="cl">+------+-----------+-------------------------------------------+
</span></span><span class="line"><span class="cl">| root | localhost | ***************************************** |
</span></span><span class="line"><span class="cl">| root | 127.0.0.1 | ***************************************** |
</span></span><span class="line"><span class="cl">+------+-----------+-------------------------------------------+
</span></span><span class="line"><span class="cl">2 rows in set (0.00 sec)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># display database list
</span></span><span class="line"><span class="cl"> mysql&gt;show databases;
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl">| Database           |
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl">| information_schema |
</span></span><span class="line"><span class="cl">| mysql              |
</span></span><span class="line"><span class="cl">+--------------------+
</span></span><span class="line"><span class="cl">2 rows in set (0.00 sec)
</span></span><span class="line"><span class="cl">mysql&gt;exit
</span></span><span class="line"><span class="cl">Bye
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>Tomcat java.lang.OutOfMemoryError</title><link>https://samzong.me/tomcat-1-java-lang-outofmemoryerror/</link><pubDate>Tue, 29 Nov 2016 02:19:38 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/tomcat-1-java-lang-outofmemoryerror/</guid><description><![CDATA[<h3 id="1-什么是-permgen-space-" class="headerLink">
    <a href="#1-%e4%bb%80%e4%b9%88%e6%98%af-permgen-space-" class="header-mark"></a>0.1 1. 什么是 <em>PermGen space</em> ?</h3><p>PermGen space的全称是Permanent Generation space，是指内存的永久保存区域，这块内存主要是被JVM存放Class和Meta信息的，Class在被Loader时就会被放到PermGen space中，它和存放类实例(Instance)的Heap区域不同，GC(Garbage Collection)不会在主程序运行期对PermGen space进行清理，所以如果你的应用中有很CLASS的话，就很可能出现PermGen space错误，这种错误常见在web服务器对JSP进行pre compile的时候。如果你的WEB APP下都用了大量的第三方jar，其大小超过了jvm默认的大小(4M)那么就会产生此错误信息了。</p>
<h3 id="2-解决方法" class="headerLink">
    <a href="#2-%e8%a7%a3%e5%86%b3%e6%96%b9%e6%b3%95" class="header-mark"></a>0.2 2. 解决方法</h3><h5 id="21-手动设置maxpermsize大小" class="headerLink">
    <a href="#21-%e6%89%8b%e5%8a%a8%e8%ae%be%e7%bd%aemaxpermsize%e5%a4%a7%e5%b0%8f" class="header-mark"></a>0.2.0.1 2.1 手动设置MaxPermSize大小</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 修改$TOMCAT_HOME/bin/catalina.sh，在“echo &#34;Using CATALINA_BASE:   $CATALINA_BASE&#34;”上面加入以下行：
</span></span><span class="line"><span class="cl">JAVA_OPTS=&#34;-server -Xms256m -Xmx512m -XX:PermSize=64M -XX:MaxPermSize=128m&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-java-heap-space" class="headerLink">
    <a href="#3-java-heap-space" class="header-mark"></a>0.3 3. Java heap space</h3><h4 id="解释" class="headerLink">
    <a href="#%e8%a7%a3%e9%87%8a" class="header-mark"></a>0.3.1 解释：</h4><p>Heap size 设置
JVM堆的设置是指java程序运行过程中JVM可以调配使用的内存空间的设置.JVM在启动的时候会自动设置Heap size的值，其初始空间(即-Xms)是物理内存的1/64，最大空间(-Xmx)是物理内存的1/4。可以利用JVM提供的-Xmn -Xms -Xmx等选项可进行设置。Heap size 的大小是Young Generation 和Tenured Generaion 之和。</p>
<ul>
<li>提示：在JVM中如果98％的时间是用于GC且可用的Heap size 不足2％的时候将抛出此异常信息。</li>
<li>提示：Heap Size 最大不要超过可用物理内存的80％，一般的要将-Xms和-Xmx选项设置为相同，而-Xmn为1/4的-Xmx值。</li>
</ul>
<blockquote>
<p>修改设置方法如PermGen space</p>
</blockquote>
]]></description></item><item><title>HowTo Reset MySQL Root Password</title><link>https://samzong.me/howto-reset-mysql-root-password/</link><pubDate>Sun, 04 Dec 2016 09:57:23 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-reset-mysql-root-password/</guid><description><![CDATA[<h4 id="1-处理的状态" class="headerLink">
    <a href="#1-%e5%a4%84%e7%90%86%e7%9a%84%e7%8a%b6%e6%80%81" class="header-mark"></a>0.0.1 1. 处理的状态</h4><p>首先确认服务器出于安全的状态，也就是没有人能够任意地连接MySQL数据库。
因为在重新设置MySQL的root密码的期间，MySQL数据库完全出于没有密码保护的
状态下，其他的用户也可以任意地登录和修改MySQL的信息。可以采用将MySQL对
外的端口封闭，并且停止Apache以及所有的用户进程的方法实现服务器的准安全
状态。最安全的状态是到服务器的Console上面操作，并且拔掉网线。</p>
<h4 id="2-重置密码" class="headerLink">
    <a href="#2-%e9%87%8d%e7%bd%ae%e5%af%86%e7%a0%81" class="header-mark"></a>0.0.2 2. 重置密码</h4><ol>
<li>修改mysql配置文件，增加skip-grant-tables</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@demo ~]# vim /etc/my.cnf
</span></span><span class="line"><span class="cl">[mysqld]
</span></span><span class="line"><span class="cl">skip-grant-tables
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>重启mysqld</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@demo ~]# service mysqld restart
</span></span><span class="line"><span class="cl">Stopping mysqld:                                           [  OK  ]
</span></span><span class="line"><span class="cl">Starting mysqld:                                           [  OK  ]
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>登录mysql，并修改root密码.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@demo ~]# mysql -u root
</span></span><span class="line"><span class="cl">Welcome to the MySQL monitor.  Commands end with ; or \g.
</span></span><span class="line"><span class="cl">Your MySQL connection id is 3
</span></span><span class="line"><span class="cl">Server version: 5.5.53 MySQL Community Server (GPL)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Oracle is a registered trademark of Oracle Corporation and/or its
</span></span><span class="line"><span class="cl">affiliates. Other names may be trademarks of their respective
</span></span><span class="line"><span class="cl">owners.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mysql&gt; use mysql
</span></span><span class="line"><span class="cl">Reading table information for completion of table and column names
</span></span><span class="line"><span class="cl">You can turn off this feature to get a quicker startup with -A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Database changed
</span></span><span class="line"><span class="cl">mysql&gt; update user set password=password(&#39;new-pass&#39;) where user=&#39;root&#39;;
</span></span><span class="line"><span class="cl">Query OK, 5 rows affected (0.00 sec)
</span></span><span class="line"><span class="cl">Rows matched: 5  Changed: 5  Warnings: 0
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>配置文件去除skip-grant-tables，并重启服务器.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@demo ~]# vim /etc/my.cnf
</span></span><span class="line"><span class="cl">[root@demo ~]# service mysqld restart
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>使用新密码登录到mysql</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@demo ~]# mysql -h localhost -u root -p
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install Python3 on CentOS 6.x</title><link>https://samzong.me/howto-install-python3-on-centos-6-x/</link><pubDate>Thu, 08 Dec 2016 20:12:37 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-python3-on-centos-6-x/</guid><description><![CDATA[<p>接触过Python2.x与Python3.x的应该知道，它们二者的区别也是蛮大的，而随着Python3.x的盛行，越来越多的应用运行与Python3.x的环境之上，但是我们的CentOS的系列，目前都默认安装时Python2.x（CentOS 7.x也是），所以不得不我们需要自己行动手安装Python 3.x的环境。</p>
<p>Mirosoft平台与Mac平台，不在考虑范围，他们都有相应的软件包与图形化安装工具，可以很好的解决这个问题，所以今天我们的环境是在CentOS 6.x系列上进行。</p>
<blockquote>
<p>Demo ：CentOS 6.8</p>
</blockquote>
<h4 id="method-1-build--install-from-source-file" class="headerLink">
    <a href="#method-1-build--install-from-source-file" class="header-mark"></a>0.0.1 Method 1. Build &amp; Install From Source-File</h4><ol>
<li>Python3.x 源码文件下载，请选择适合的版本。 <a href="https://www.python.org/ftp/python/" target="_blank" rel="noopener noreferrer">下载页面</a></li>
<li>我这里使用版本 Python 3.5</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@demo ~]$ wget https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tgz
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>安装系统基本工具：</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># yum-utils
</span></span><span class="line"><span class="cl">[cent@demo ~]$ sudo yum install -y yum-utils
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 构建python 编译环境
</span></span><span class="line"><span class="cl">[cent@demo ~]$ sudo yum-builddep python
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>开始编译 &amp; 安装
并且源码安装的同时，会将pip3与setuptools一同安装.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@demo ~]$ tar xf Python-3.5.0.tgz
</span></span><span class="line"><span class="cl">[cent@demo ~]$ cd Python-3.5.0
</span></span><span class="line"><span class="cl">[cent@demo ~]$ ./configure
</span></span><span class="line"><span class="cl">[cent@demo ~]$ make
</span></span><span class="line"><span class="cl">[cent@demo ~]$ sudo make install
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>检查版本</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@demo ~]$ python3 -V
</span></span><span class="line"><span class="cl">Python 3.5.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 如果希望系统默认为Python3
</span></span><span class="line"><span class="cl">[cent@demo ~]$ alias python=&#39;usr/bin/python3.5&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="method-2-install-from-epel-repos" class="headerLink">
    <a href="#method-2-install-from-epel-repos" class="header-mark"></a>0.0.2 Method 2. Install From EPEL repos</h4><p>也许有的同学会说，编译安装，那是上古时期的做法了，yum在线安装才是王道，当然这种说法也有可取之处，所以接下来讲下如何使用yum安装，需要注意的是yum安装是需要时间测试和增加到相应的源仓库，一般会稍慢于源码安装的方式，这里采用EPEL源，这是一个非常棒的第三方源仓库，之前的文章中也多次提到，这里就不做过多描述，请看下面的命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[cent@demo ~]$ sudo yum install -y epel-release
</span></span><span class="line"><span class="cl">[cent@demo ~]$ sudo yum install -y python34
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 因为yum安装时没能同时安装pip与setuptools，所以我们要手动安装，这里采用拿第三方包解决问题
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[cent@demo ~]$ curl -O https://bootstrap.pypa.io/get-pip.py
</span></span><span class="line"><span class="cl">[cent@demo ~]$ sudo python3 get-pip.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[cent@demo ~]$  python3 -V
</span></span><span class="line"><span class="cl">Python 3.4.3
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Mount OSS Bucket On ECS</title><link>https://samzong.me/howto-mount-oss-bucket-on-ecs/</link><pubDate>Tue, 20 Dec 2016 06:17:08 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-mount-oss-bucket-on-ecs/</guid><description><![CDATA[<blockquote>
<p>From <a href="https://github.com/aliyun/ossfs" target="_blank" rel="noopener noreferrer">阿里云官方Github</a></p>
</blockquote>
<blockquote>
<p>Demo: CentOS 6.8 on ECS</p>
</blockquote>
<p>ossfs 是通过磁盘挂载的形式，将oss存储挂载到linux、类unix等操作系统，而且不仅仅可以挂载阿里云内的ECS上，理论上所有网络能到达oss的都可以挂载，但还是要以实际问题为准。</p>
<h5 id="1download--install" class="headerLink">
    <a href="#1download--install" class="header-mark"></a>0.0.0.1 1.Download &amp; Install</h5><p><a href="https://github.com/aliyun/ossfs/releases" target="_blank" rel="noopener noreferrer">官方版本发布页面</a>，请根据你的系统类型进行选择，我这演示的环境是CentOS 6.8；ossfs目前最新的版本是v1.79.9，您可以根据自己当时版本进行选择，建议选择最新版本。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 请先将包上传到服务器上
</span></span><span class="line"><span class="cl"> sudo yum localinstall ossfs_1.79.9_centos6.5_x86_64.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意使用localinstall，因为在安装过程，yum 可以很好的解决依赖关系，会节省我们很多时间</p>
</blockquote>
<h5 id="2-oss--bucket" class="headerLink">
    <a href="#2-oss--bucket" class="header-mark"></a>0.0.0.2 2. OSS &amp; Bucket</h5><p>需要获取以下信息，在后面我们都会用到的：<br></p>
<ol>
<li>Bucket 名称
<a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-0.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-0.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-0.jpg">
        
    </a>
<br></li>
<li>Access Key ID</li>
<li>Access Key Secret
<a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0256A9CB-A0FA-43BC-82AF-4DE17D4852B6.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0256A9CB-A0FA-43BC-82AF-4DE17D4852B6.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0256A9CB-A0FA-43BC-82AF-4DE17D4852B6.png">
        
    </a></li>
</ol>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-2.jpg" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-2.jpg" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-2.jpg">
        
    </a>
<br>
4. Location，这需要注意点，不要加上Bucket的名字，区域对应表如下，注意你的Bucket所在区域:</p>
<div><table><thead><tr><th style="color:green">Region中文名称</th><th style="text-align:left;color: green;">Region英文表示</th><th style="text-align:left;color: green;">外网Endpoint</th><th style="text-align:left;color: green;">ECS访问的内网Endpoint</th></tr></thead><tbody><tr><td>华东 1</td><td style="text-align:left">oss-cn-hangzhou</td><td style="text-align:left">oss-cn-hangzhou.aliyuncs.com</td><td style="text-align:left">oss-cn-hangzhou-internal.aliyuncs.com</td></tr><tr><td>华东 2</td><td style="text-align:left">oss-cn-shanghai</td><td style="text-align:left">oss-cn-shanghai.aliyuncs.com</td><td style="text-align:left">oss-cn-shanghai-internal.aliyuncs.com</td></tr><tr><td>华北 1</td><td style="text-align:left">oss-cn-qingdao</td><td style="text-align:left">oss-cn-qingdao.aliyuncs.com</td><td style="text-align:left">oss-cn-qingdao-internal.aliyuncs.com</td></tr><tr><td>华北 2</td><td style="text-align:left">oss-cn-beijing</td><td style="text-align:left">oss-cn-beijing.aliyuncs.com</td><td style="text-align:left">oss-cn-beijing-internal.aliyuncs.com</td></tr><tr><td>华南 1</td><td style="text-align:left">oss-cn-shenzhen</td><td style="text-align:left">oss-cn-shenzhen.aliyuncs.com</td><td style="text-align:left">oss-cn-shenzhen-internal.aliyuncs.com</td></tr><tr><td>香港数据中心</td><td style="text-align:left">oss-cn-hongkong</td><td style="text-align:left">oss-cn-hongkong.aliyuncs.com</td><td style="text-align:left">oss-cn-hongkong-internal.aliyuncs.com</td></tr><tr><td>美国硅谷数据中心</td><td style="text-align:left">oss-us-west-1</td><td style="text-align:left">oss-us-west-1.aliyuncs.com</td><td style="text-align:left">oss-us-west-1-internal.aliyuncs.com</td></tr><tr><td>美国弗吉尼亚数据中心</td><td style="text-align:left">oss-us-east-1</td><td style="text-align:left">oss-us-east-1.aliyuncs.com</td><td style="text-align:left">oss-us-east-1-internal.aliyuncs.com</td></tr><tr><td>亚太（新加坡）数据中心</td><td style="text-align:left">oss-ap-southeast-1</td><td style="text-align:left">oss-ap-southeast-1.aliyuncs.com</td><td style="text-align:left">oss-ap-southeast-1-internal.aliyuncs.com</td></tr><tr><td>亚太东北 1（日本）数据中心</td><td style="text-align:left">oss-ap-northeast-1</td><td style="text-align:left">oss-ap-northeast-1.aliyuncs.com</td><td style="text-align:left">oss-ap-northeast-1-internal.aliyuncs.com</td></tr></tbody></table></div>
```
# 设置bucket/access key/id的信息，将其存放在/etc/passwd-ossfs 文件中
# 注意这个文件的权限必须正确设置，建议设为640
sudo echo my-bucket:my-access-key-id:my-access-key-secret > /etc/passwd-ossfs
sudo chmod 640 /etc/passwd-ossfs
```
<br>
##### 3. Mount & Uasge
将oss bucket mount到指定目录:
```
# 我碰到安装后找不到ossfs命令，查看下因为ossfs没有x权限，目录路径为/usr/local/bin，如果您也碰到这个问题，可以增加x权限后再测试
sudo ossfs my-bucket /mnt/ossdir -ourl=http://oss-location.aliyuncs.com
<h1 id="如果使用ossfs的机器是阿里云ecs可以使用内网域名来避免流量收费和-提高速度" class="headerLink">
    <a href="#%e5%a6%82%e6%9e%9c%e4%bd%bf%e7%94%a8ossfs%e7%9a%84%e6%9c%ba%e5%99%a8%e6%98%af%e9%98%bf%e9%87%8c%e4%ba%91ecs%e5%8f%af%e4%bb%a5%e4%bd%bf%e7%94%a8%e5%86%85%e7%bd%91%e5%9f%9f%e5%90%8d%e6%9d%a5%e9%81%bf%e5%85%8d%e6%b5%81%e9%87%8f%e6%94%b6%e8%b4%b9%e5%92%8c-%e6%8f%90%e9%ab%98%e9%80%9f%e5%ba%a6" class="header-mark"></a>如果使用ossfs的机器是阿里云ECS，可以使用内网域名来避免流量收费和 提高速度：</h1><p>sudo ossfs my-bucket /tmp/ossfs -ourl=http://oss-location-internal.aliyuncs.com</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">磁盘空间达到上百T：
</span></span><span class="line"><span class="cl">![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0B78E099-5488-4839-AE48-09A074E7415D.png)
</span></span><span class="line"><span class="cl">&lt;br&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> umount：
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="注意用户身份" class="headerLink">
    <a href="#%e6%b3%a8%e6%84%8f%e7%94%a8%e6%88%b7%e8%ba%ab%e4%bb%bd" class="header-mark"></a>注意用户身份</h1><p>umount /tmp/ossfs # root user
sudo fusermount -u /tmp/ossfs # non-root user</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;br&gt;
</span></span><span class="line"><span class="cl">##### 4. Debug &amp; FAQ
</span></span><span class="line"><span class="cl">当遇到错误的时候，可以试着打开Debug日志信息，然后分析问题原因：
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="使用--o-dbgleveldebug--f--d参数打印日志信息" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8--o-dbgleveldebug--f--d%e5%8f%82%e6%95%b0%e6%89%93%e5%8d%b0%e6%97%a5%e5%bf%97%e4%bf%a1%e6%81%af" class="header-mark"></a>使用 -o dbglevel=debug -f -d参数打印日志信息</h1><p>sudo ossfs my-bucket /tmp/ossfs -ourl=http://oss-location-internal.aliyuncs.com -o dbglevel=debug -f -d &gt; /mnt/ossfs.log 2&gt;&amp;1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">更多的问题，请移步查看[官方的FAQ文档](https://github.com/aliyun/ossfs/wiki/FAQ)。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br&gt;
</span></span><span class="line"><span class="cl">##### 5. About
</span></span><span class="line"><span class="cl">ossfs提供的功能和性能和本地文件系统相比，具有一些局限性。具体包括：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* 随机或者追加写文件会导致整个文件的重写。
</span></span><span class="line"><span class="cl">* 元数据操作，例如list directory，性能较差，因为需要远程访问oss服务器。
</span></span><span class="line"><span class="cl">* 文件/文件夹的rename操作不是原子的。
</span></span><span class="line"><span class="cl">* 多个客户端挂载同一个oss bucket时，依赖用户自行协调各个客户端的行为。例如避免多个客户端写同一个文件等等。
</span></span><span class="line"><span class="cl">* 不支持hard link。
</span></span><span class="line"><span class="cl">* 不适合用在高并发读/写的场景，这样会让系统的load升高
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; 另外，ossfs的稳定性很大一部分依赖于网络环境，建议的使用场景更多是作为临时数据迁移或定期备份，虽然ossfs挂载到系统中会有着几百TB的空间，但是稳定性并不高。
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Monitor Tomcat HeadMemory for Zabbix</title><link>https://samzong.me/howto-monitor-tomcat-head-memory-for-zabbix/</link><pubDate>Wed, 18 Jan 2017 23:28:44 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-monitor-tomcat-head-memory-for-zabbix/</guid><description><![CDATA[<p>最近项目上由于BUG问题导致Tomcat程序在运行过程中经常内存泄漏,而本身监控系统之中没有更好的检测到Tomcat堆空间(Head Memory)的使用情况导致报警频发，这篇文章主要讲述，如何在Zabbix之中调用jmx监控服务器上Tomcat堆空间的使用情况并增加对应报警功能。</p>
<blockquote>
<p>测试环境: <br>
CentOS 6.8 <br>
Zabbix 2.4 <br>
Tomcat 7.0 <br></p>
</blockquote>
<p>实验前提默认是各位已经安装Zabbix Server服务器，并且至少有一台Zabbix agent服务器正常监控。关于如何搭建Zabbix监控集群，会有专门文章描述。</p>
<h4 id="zabbix-java-gateway的工作机制" class="headerLink">
    <a href="#zabbix-java-gateway%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6" class="header-mark"></a>0.0.1 zabbix-java-gateway的工作机制</h4><ul>
<li>首先我们需要配置我们的Tomcat服务启用监控服务，这个是默认不启用的</li>
<li>之后需要在Zabbix的管理页面添加对应Tomcat服务器的jmx监控接口</li>
<li>最后zabbix端会自动获取zabbix-java-gateway的数据并根据相应模板进行展
示</li>
<li>工作流: [Zabbix-Server]&ndash;&gt;(port:10053 on zabbix server)&ndash;&gt; [zabbix-java-gateway] &ndash;(port:12345 on tomcatserver)&ndash;&gt; [JMX enabled]</li>
</ul>
<h4 id="1-install-zabbix-java-gateway-on-zabbix-server" class="headerLink">
    <a href="#1-install-zabbix-java-gateway-on-zabbix-server" class="header-mark"></a>0.0.2 1. Install zabbix-java-gateway on Zabbix Server</h4><p>因为我的zabbix是使用zabbix 2.4官方源安装，所以只需要用yum在安装即可:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@6 ~]# sudo  yum install -y zabbix-java-gateway
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你没有官方源可能先安装该源，注意我的服务器zabbix版本是2.4 如果你是不同的版本，请到[<a href="http://repo.zabbix.com/zabbix/" target="_blank" rel="noopener noreferrer">这里</a>]查找对应版本。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 查看zabbix server版本
</span></span><span class="line"><span class="cl">[root@6 ~]# zabbix_server --version
</span></span><span class="line"><span class="cl">Zabbix server v2.4.8 (revision 59539) (20 April 2016)
</span></span><span class="line"><span class="cl">Compilation time: May  4 2016 01:32:12
</span></span></code></pre></td></tr></table>
</div>
</div><p>在使用yum安装zabbix-java-gateway源时,会自动关联安装openjdk，尽管这段程序没多大影响，如果你想保证系统JAVA环境不受到改变的话，可以在/etc/profile文件最后，增加如下内容:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># add follows to the end
</span></span><span class="line"><span class="cl">export JAVA_HOME=/usr/java/default
</span></span><span class="line"><span class="cl">export PATH=$PATH:$JAVA_HOME/bin
</span></span><span class="line"><span class="cl">export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-confiure-tomcat-host-with-enable-jmx" class="headerLink">
    <a href="#2-confiure-tomcat-host-with-enable-jmx" class="header-mark"></a>0.0.3 2. Confiure Tomcat host with enable jmx</h4><p>首先在$tomcatdir/bin/catalina.sh文件开头处增加如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nv">CATALINA_OPTS</span><span class="o">=</span><span class="s2">&#34;-Dcom.sun.management.jmxremote \
</span></span></span><span class="line"><span class="cl"><span class="s2">-Dcom.sun.management.jmxremote.authenticate=false \
</span></span></span><span class="line"><span class="cl"><span class="s2">-Dcom.sun.management.jmxremote.ssl=false \
</span></span></span><span class="line"><span class="cl"><span class="s2">-Dcom.sun.management.jmxremote.port=12345&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后,启动Tomcat，你会发现多了一个12345端口，这就是jmx的监听端口，请保证zabbix-java-gateway可以访问到这台服务器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@6 ~]# /tomcat7/bin/startup.sh
</span></span><span class="line"><span class="cl">Starting Tomcat7:
</span></span><span class="line"><span class="cl">Using CATALINA_BASE:   /tomcat7
</span></span><span class="line"><span class="cl">Using CATALINA_HOME:   /tomcat7
</span></span><span class="line"><span class="cl">Using CATALINA_TMPDIR: /tomcat7/temp
</span></span><span class="line"><span class="cl">Using JRE_HOME:        /usr
</span></span><span class="line"><span class="cl">Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
</span></span><span class="line"><span class="cl">Tomcat started.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@6 ~]# netstat -ntlp | grep 12345
</span></span><span class="line"><span class="cl">tcp  0      0 :::12345   :::*     LISTEN      8793/java
</span></span><span class="line"><span class="cl">[root@6 ~]#
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
#### ==*fix 1* == : zabbix agent与server存在复杂网络环境
<p>这里疏忽了1个问题，如果您的zabbix server与agent端之间有防火墙规则，而按照我上面的所述只是增加了12345这个端口，那么很可能，您在/var/log/zabbix/zabbix_java_gateway.log 中会看到“No route to host”的报错，这是因为JMX不光开启了12345端口，还开启了另外两个随机端口，而在获取监控数据时会使用到其中一个，这就导致了无法通过固定的防火墙规则来开放该端口。其实有另外一个替代方式来使该监听端口固定下来——使用Tomcat提供的额外组件 catalina-jmx-remote.jar，这个组件是需要另外下载的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 查看当前Tomcat版本.
</span></span><span class="line"><span class="cl">[root@6 bin]# ./catalina.sh version
</span></span><span class="line"><span class="cl">Using CATALINA_BASE:   /tomcat7
</span></span><span class="line"><span class="cl">Using CATALINA_HOME:   /tomcat7
</span></span><span class="line"><span class="cl">Using CATALINA_TMPDIR: /tomcat7/temp
</span></span><span class="line"><span class="cl">Using JRE_HOME:        /usr
</span></span><span class="line"><span class="cl">Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
</span></span><span class="line"><span class="cl">Server version: Apache Tomcat/7.0.64
</span></span><span class="line"><span class="cl">Server built:   Aug 19 2015 17:18:06 UTC
</span></span><span class="line"><span class="cl">Server number:  7.0.64.0
</span></span><span class="line"><span class="cl">OS Name:        Linux
</span></span><span class="line"><span class="cl">OS Version:     2.6.32-642.11.1.el6.x86_64
</span></span><span class="line"><span class="cl">Architecture:   amd64
</span></span><span class="line"><span class="cl">JVM Version:    1.8.0_111-b15
</span></span><span class="line"><span class="cl">JVM Vendor:     Oracle Corporation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 下载 catalina-jmx-remote.jar # 请注意下载版本不要高于当前tomcat版本.
</span></span><span class="line"><span class="cl">wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>增加如下内容，在conf/server.xml中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;Listener className=&#34;org.apache.catalina.mbeans.JmxRemoteLifecycleListener&#34;
</span></span><span class="line"><span class="cl">          rmiRegistryPortPlatform=&#34;12345&#34; rmiServerPortPlatform=&#34;12346&#34; /&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为我们已经在conf/server.xml定义了rmiRegistryPortPlatform，所以要将bin/catalina.sh中CATALINA_OPTS的com.sun.management.jmxremote.port去掉，否则会因为jmxremote.port配置有优先级更高而导致配置失效。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CATALINA_OPTS=&#34;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>完成之后，重启tomcat这时会发现jmx默认端口已经固定为12345何12346，而server依然可以正常获取监控数据.</p>
<hr>
#### 3. Configure Zabbix Server
首先需要修改zabbix_server.conf启用zabbix-java-gateway，让zabbix可以检测到服务,修改如下:
```
### Option: JavaGateway
 #       IP address (or hostname) of Zabbix Java gateway.
 #       Only required if Java pollers are started.
 #
 # Mandatory: no
 # Default:
JavaGateway=10.211.55.4 # 设置为你的zabbixsever IP
<h3 id="option-javagatewayport" class="headerLink">
    <a href="#option-javagatewayport" class="header-mark"></a>0.1 Option: JavaGatewayPort</h3><h1 id="port-that-zabbix-java-gateway-listens-on" class="headerLink">
    <a href="#port-that-zabbix-java-gateway-listens-on" class="header-mark"></a>Port that Zabbix Java gateway listens on.</h1><h1 id="heading" class="headerLink">
    <a href="#heading" class="header-mark"></a></h1><h1 id="mandatory-no" class="headerLink">
    <a href="#mandatory-no" class="header-mark"></a>Mandatory: no</h1><h1 id="range-1024-32767" class="headerLink">
    <a href="#range-1024-32767" class="header-mark"></a>Range: 1024-32767</h1><h1 id="default" class="headerLink">
    <a href="#default" class="header-mark"></a>Default:</h1><p>JavaGatewayPort=10053 # 设置服务端监听接口</p>
<h3 id="option-startjavapollers" class="headerLink">
    <a href="#option-startjavapollers" class="header-mark"></a>0.2 Option: StartJavaPollers</h3><h1 id="number-of-pre-forked-instances-of-java-pollers" class="headerLink">
    <a href="#number-of-pre-forked-instances-of-java-pollers" class="header-mark"></a>Number of pre-forked instances of Java pollers.</h1><h1 id="heading-1" class="headerLink">
    <a href="#heading-1" class="header-mark"></a></h1><h1 id="mandatory-no-1" class="headerLink">
    <a href="#mandatory-no-1" class="header-mark"></a>Mandatory: no</h1><h1 id="range-0-1000" class="headerLink">
    <a href="#range-0-1000" class="header-mark"></a>Range: 0-1000</h1><h1 id="default-1" class="headerLink">
    <a href="#default-1" class="header-mark"></a>Default:</h1><p>StartJavaPollers=5 # 设置多线程启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">然后修改zabbix\_java\_gateway.conf 配置如下:
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="option-zabbixlistenip" class="headerLink">
    <a href="#option-zabbixlistenip" class="header-mark"></a>0.3 Option: zabbix.listenIP</h3><h1 id="ip-address-to-listen-on" class="headerLink">
    <a href="#ip-address-to-listen-on" class="header-mark"></a>IP address to listen on.</h1><h1 id="heading-2" class="headerLink">
    <a href="#heading-2" class="header-mark"></a></h1><h1 id="mandatory-no-2" class="headerLink">
    <a href="#mandatory-no-2" class="header-mark"></a>Mandatory: no</h1><h1 id="default-2" class="headerLink">
    <a href="#default-2" class="header-mark"></a>Default:</h1><p>LISTEN_IP=&ldquo;10.211.55.4&rdquo; # 配置监听IP</p>
<h3 id="option-zabbixlistenport" class="headerLink">
    <a href="#option-zabbixlistenport" class="header-mark"></a>0.4 Option: zabbix.listenPort</h3><h1 id="port-to-listen-on" class="headerLink">
    <a href="#port-to-listen-on" class="header-mark"></a>Port to listen on.</h1><h1 id="heading-3" class="headerLink">
    <a href="#heading-3" class="header-mark"></a></h1><h1 id="mandatory-no-3" class="headerLink">
    <a href="#mandatory-no-3" class="header-mark"></a>Mandatory: no</h1><h1 id="range-1024-32767-1" class="headerLink">
    <a href="#range-1024-32767-1" class="header-mark"></a>Range: 1024-32767</h1><h1 id="default-3" class="headerLink">
    <a href="#default-3" class="header-mark"></a>Default:</h1><p>LISTEN_PORT=10053 # 配置监听端口</p>
<h3 id="option-zabbixpidfile" class="headerLink">
    <a href="#option-zabbixpidfile" class="header-mark"></a>0.5 Option: zabbix.pidFile</h3><h1 id="name-of-pid-file" class="headerLink">
    <a href="#name-of-pid-file" class="header-mark"></a>Name of PID file.</h1><h1 id="if-omitted-zabbix-java-gateway-is-started-as-a-console-application" class="headerLink">
    <a href="#if-omitted-zabbix-java-gateway-is-started-as-a-console-application" class="header-mark"></a>If omitted, Zabbix Java Gateway is started as a console application.</h1><h1 id="heading-4" class="headerLink">
    <a href="#heading-4" class="header-mark"></a></h1><h1 id="mandatory-no-4" class="headerLink">
    <a href="#mandatory-no-4" class="header-mark"></a>Mandatory: no</h1><h1 id="default-4" class="headerLink">
    <a href="#default-4" class="header-mark"></a>Default:</h1><h1 id="pid_file" class="headerLink">
    <a href="#pid_file" class="header-mark"></a>PID_FILE=</h1><p>PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;</p>
<h3 id="option-zabbixstartpollers" class="headerLink">
    <a href="#option-zabbixstartpollers" class="header-mark"></a>0.6 Option: zabbix.startPollers</h3><h1 id="number-of-worker-threads-to-start" class="headerLink">
    <a href="#number-of-worker-threads-to-start" class="header-mark"></a>Number of worker threads to start.</h1><h1 id="heading-5" class="headerLink">
    <a href="#heading-5" class="header-mark"></a></h1><h1 id="mandatory-no-5" class="headerLink">
    <a href="#mandatory-no-5" class="header-mark"></a>Mandatory: no</h1><h1 id="range-1-1000" class="headerLink">
    <a href="#range-1-1000" class="header-mark"></a>Range: 1-1000</h1><h1 id="default-5" class="headerLink">
    <a href="#default-5" class="header-mark"></a>Default:</h1><h1 id="不能大于zabbix_serverconf的值否则可能导致当连接java-gateway时没有多余的线程进行处理" class="headerLink">
    <a href="#%e4%b8%8d%e8%83%bd%e5%a4%a7%e4%ba%8ezabbix_serverconf%e7%9a%84%e5%80%bc%e5%90%a6%e5%88%99%e5%8f%af%e8%83%bd%e5%af%bc%e8%87%b4%e5%bd%93%e8%bf%9e%e6%8e%a5java-gateway%e6%97%b6%e6%b2%a1%e6%9c%89%e5%a4%9a%e4%bd%99%e7%9a%84%e7%ba%bf%e7%a8%8b%e8%bf%9b%e8%a1%8c%e5%a4%84%e7%90%86" class="header-mark"></a>不能大于zabbix_server.conf的值，否则可能导致当连接Java gateway时没有多余的线程进行处理</h1><p>START_POLLERS=5</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">最后启动启动zabbix-java-gateway，并重启zabbix-server
</span></span></code></pre></td></tr></table>
</div>
</div><p>[root@6 ~]# service zabbix-java-gateway start
Starting zabbix java gateway:              [  OK  ]
[root@6 ~]# service zabbix-server restart
Stopping zabbix server:              [  OK  ]
Starting zabbix server:              [  OK  ]</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">我在尝试重启发现一问题，zabbix-java-gateway通过service命令管理stop不能删除pid文件导致服务无法启动，如果你也碰到，解决办法如下:
</span></span></code></pre></td></tr></table>
</div>
</div><p>[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway</p>
<h1 id="line-97-注释修改为如下" class="headerLink">
    <a href="#line-97-%e6%b3%a8%e9%87%8a%e4%bf%ae%e6%94%b9%e4%b8%ba%e5%a6%82%e4%b8%8b" class="header-mark"></a>line 97, 注释修改为如下：</h1><h1 id="kill-cat-pid_file--rm-pid_file" class="headerLink">
    <a href="#kill-cat-pid_file--rm-pid_file" class="header-mark"></a>kill <code>cat $PID_FILE</code> &amp;&amp; rm $PID_FILE</h1><pre><code>    rm -f $PID_FILE
</code></pre>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#### 4. Adding jmx host on Zabbix Web consloe
</span></span><span class="line"><span class="cl">首先，上传Template Tomcat Head Memory模板，这个我做了一个简单的模板，只针对了堆内存空间的监控，并针对使用率超过60%以及80%，不同的警报。需要的同学可以直接从我这里下载，然后在Configuration-Templates导入到zabbix模板库内。&lt;br&gt;
</span></span><span class="line"><span class="cl">下载请点击:[Template App Tomcat Head Memory](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">然后，增加服务器的jmx监控&lt;br&gt;
</span></span><span class="line"><span class="cl">![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png)
</span></span><span class="line"><span class="cl">&lt;br&gt;
</span></span><span class="line"><span class="cl">关联模板&lt;br&gt;
</span></span><span class="line"><span class="cl">![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#### 5. View the Head Memory Monitoring.
</span></span><span class="line"><span class="cl">![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png)
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Automatic Updates CENTOS/RHEL Using YUM</title><link>https://samzong.me/howto-automatic-updates-centos-rhel-using-yum/</link><pubDate>Sun, 19 Feb 2017 09:56:42 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-automatic-updates-centos-rhel-using-yum/</guid><description><![CDATA[<p>大家若工作遇到需要管理的Linux集群机器较多时，同时我们知道系统的安全更新补丁维护这些非常重要，无论你在安装时优化维护做的再好，随着时间的推移，如果不去更新的话，系统早晚都会不安全，所以定期更新我们的系统补丁是一个运维人员的基本工作内容</p>
<h3 id="install-yum-cron" class="headerLink">
    <a href="#install-yum-cron" class="header-mark"></a>0.1 Install yum-cron</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo yum install -y yum-cron
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为我的服务器系统多为CentOS 6，6的配置文件在<code>/etc/sysconfig/yum-cron</code>，你可以用以下命令查看配置文件位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">rpm -ql yum-cron
</span></span><span class="line"><span class="cl">/etc/cron.daily/0yum.cron
</span></span><span class="line"><span class="cl">/etc/rc.d/init.d/yum-cron
</span></span><span class="line"><span class="cl">/etc/sysconfig/yum-cron
</span></span><span class="line"><span class="cl">/etc/yum/yum-daily.yum
</span></span><span class="line"><span class="cl">/etc/yum/yum-weekly.yum
</span></span><span class="line"><span class="cl">/usr/share/doc/yum-cron-3.2.29
</span></span><span class="line"><span class="cl">/usr/share/doc/yum-cron-3.2.29/COPYING
</span></span><span class="line"><span class="cl">/usr/share/man/man8/yum-cron.8.gz
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="configure-etcsysconfigyum-cron" class="headerLink">
    <a href="#configure-etcsysconfigyum-cron" class="header-mark"></a>0.2 Configure “/etc/sysconfig/yum-cron”</h3><p>yum-cron的默认设置是会在每天自动检查和安装系统更新包，在安装完成后有些配置需要注意下：</p>
<h5 id="1-对于不需要更新的可以忽略掉" class="headerLink">
    <a href="#1-%e5%af%b9%e4%ba%8e%e4%b8%8d%e9%9c%80%e8%a6%81%e6%9b%b4%e6%96%b0%e7%9a%84%e5%8f%af%e4%bb%a5%e5%bf%bd%e7%95%a5%e6%8e%89" class="header-mark"></a>0.2.0.1 1. 对于不需要更新的可以忽略掉</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">YUM_PARAMETER=&#34;--exclude=&#39;kernel*&#39; --exclude=&#39;php*&#39;&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-设置管理员邮箱" class="headerLink">
    <a href="#2-%e8%ae%be%e7%bd%ae%e7%ae%a1%e7%90%86%e5%91%98%e9%82%ae%e7%ae%b1" class="header-mark"></a>0.2.0.2 2. 设置管理员邮箱</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MAILTO=&#34;luchuanjia@msn.com&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3-不自动安装仅检查通知管理邮箱" class="headerLink">
    <a href="#3-%e4%b8%8d%e8%87%aa%e5%8a%a8%e5%ae%89%e8%a3%85%e4%bb%85%e6%a3%80%e6%9f%a5%e9%80%9a%e7%9f%a5%e7%ae%a1%e7%90%86%e9%82%ae%e7%ae%b1" class="header-mark"></a>0.2.0.3 3. 不自动安装，仅检查，通知管理邮箱</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CHECK_ONLY=yes
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="4-不自动安装仅下载" class="headerLink">
    <a href="#4-%e4%b8%8d%e8%87%aa%e5%8a%a8%e5%ae%89%e8%a3%85%e4%bb%85%e4%b8%8b%e8%bd%bd" class="header-mark"></a>0.2.0.4 4. 不自动安装，仅下载</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">DOWNLOAD_ONLY=yes
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="automatic-starting-yum-cron" class="headerLink">
    <a href="#automatic-starting-yum-cron" class="header-mark"></a>0.3 Automatic Starting yum-cron</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">chkconfig yum-cron on
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Upgrade Your Ghost Version</title><link>https://samzong.me/howto-upgrade-your-ghost-version/</link><pubDate>Mon, 20 Feb 2017 14:39:15 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-upgrade-your-ghost-version/</guid><description><![CDATA[<br>
#### 1. 下载最新版的Ghost
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">curl -LOk https://ghost.org/zip/ghost-latest.zip
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-创建临时目录并解压ghost-latestzip到此" class="headerLink">
    <a href="#2-%e5%88%9b%e5%bb%ba%e4%b8%b4%e6%97%b6%e7%9b%ae%e5%bd%95%e5%b9%b6%e8%a7%a3%e5%8e%8bghost-latestzip%e5%88%b0%e6%ad%a4" class="header-mark"></a>0.0.1 2. 创建临时目录，并解压ghost-latest.zip到此</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mkdir /usr/ghost-tmp
</span></span><span class="line"><span class="cl">unzip ghost-latest.zip -d /usr/ghost-tmp
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-进入到原ghost目录删除core" class="headerLink">
    <a href="#3-%e8%bf%9b%e5%85%a5%e5%88%b0%e5%8e%9fghost%e7%9b%ae%e5%bd%95%e5%88%a0%e9%99%a4core" class="header-mark"></a>0.0.2 3. 进入到原ghost目录，删除core</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd  /usr/ghost
</span></span><span class="line"><span class="cl">rm -rf core
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4进入到新版本的ghost临时目录" class="headerLink">
    <a href="#4%e8%bf%9b%e5%85%a5%e5%88%b0%e6%96%b0%e7%89%88%e6%9c%ac%e7%9a%84ghost%e4%b8%b4%e6%97%b6%e7%9b%ae%e5%bd%95" class="header-mark"></a>0.0.3 4.进入到新版本的ghost临时目录</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /usr/ghost-tmp
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="5-拷贝所需文件到ghost升级目录" class="headerLink">
    <a href="#5-%e6%8b%b7%e8%b4%9d%e6%89%80%e9%9c%80%e6%96%87%e4%bb%b6%e5%88%b0ghost%e5%8d%87%e7%ba%a7%e7%9b%ae%e5%bd%95" class="header-mark"></a>0.0.4 5. 拷贝所需文件到ghost升级目录</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cp -R core /usr/ghost
</span></span><span class="line"><span class="cl">cp index.js *.json /usr/ghost
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="6-可选升级casperghost默认主题" class="headerLink">
    <a href="#6-%e5%8f%af%e9%80%89%e5%8d%87%e7%ba%a7casperghost%e9%bb%98%e8%ae%a4%e4%b8%bb%e9%a2%98" class="header-mark"></a>0.0.5 6. (可选)升级casper，ghost默认主题</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cp -R content/themes/casper /usr/ghost/content/themes/
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="7-切换回到ghost安装目录" class="headerLink">
    <a href="#7-%e5%88%87%e6%8d%a2%e5%9b%9e%e5%88%b0ghost%e5%ae%89%e8%a3%85%e7%9b%ae%e5%bd%95" class="header-mark"></a>0.0.6 7. 切换回到ghost安装目录</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /usr/ghost
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="8-修改文件目录所有者和所属组为ghost" class="headerLink">
    <a href="#8-%e4%bf%ae%e6%94%b9%e6%96%87%e4%bb%b6%e7%9b%ae%e5%bd%95%e6%89%80%e6%9c%89%e8%80%85%e5%92%8c%e6%89%80%e5%b1%9e%e7%bb%84%e4%b8%baghost" class="header-mark"></a>0.0.7 8. 修改文件目录所有者和所属组为ghost</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">chown -R ghost:ghost ./*
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="9-重新安装环境" class="headerLink">
    <a href="#9-%e9%87%8d%e6%96%b0%e5%ae%89%e8%a3%85%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.8 9. 重新安装环境</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm install --production
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="10-重启ghost" class="headerLink">
    <a href="#10-%e9%87%8d%e5%90%afghost" class="header-mark"></a>0.0.9 10. 重启Ghost</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pm2 restart ghost
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install Redmine</title><link>https://samzong.me/howto-install-redmine/</link><pubDate>Wed, 22 Feb 2017 12:30:36 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-redmine/</guid><description><![CDATA[<h4 id="runtime-environment" class="headerLink">
    <a href="#runtime-environment" class="header-mark"></a>0.0.1 Runtime environment</h4><ul>
<li>CentOS 6.x</li>
<li>Redmine 3.3.2</li>
<li>Ruby 2.2.6</li>
<li>rails 4.2</li>
<li>MySQL 5.1</li>
<li>Nginx 1.10</li>
</ul>
<h4 id="安装rvm" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85rvm" class="header-mark"></a>0.0.2 安装rvm</h4><h5 id="导入公钥" class="headerLink">
    <a href="#%e5%af%bc%e5%85%a5%e5%85%ac%e9%92%a5" class="header-mark"></a>0.0.2.1 导入公钥</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# curl -sSL https://rvm.io/mpapis.asc | gpg --import
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="安装" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85" class="header-mark"></a>0.0.2.2 安装</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# curl -L https://get.rvm.io | bash -s stable
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="加载rvm环境并安装基础依赖包" class="headerLink">
    <a href="#%e5%8a%a0%e8%bd%bdrvm%e7%8e%af%e5%a2%83%e5%b9%b6%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80%e4%be%9d%e8%b5%96%e5%8c%85" class="header-mark"></a>0.0.2.3 加载rvm环境并安装基础依赖包</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# source /etc/profile.d/rvm.sh
</span></span><span class="line"><span class="cl">[root@localhost ~]# rvm requirements
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装ruby" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85ruby" class="header-mark"></a>0.0.3 安装ruby</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# rvm install 2.2.6
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">[root@localhost ~]# rvm use 2.2.6 --default
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装rails" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85rails" class="header-mark"></a>0.0.4 安装rails</h4><h5 id="更换gem源" class="headerLink">
    <a href="#%e6%9b%b4%e6%8d%a2gem%e6%ba%90" class="header-mark"></a>0.0.4.1 更换gem源</h5><p>默认gem的源站点是https://rubygems.org 由于国内的网络原因导致无法连接，所以导致无法使用gem安装，这里换成国内淘宝的gem镜像站点</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# gem sources -l
</span></span><span class="line"><span class="cl">*** CURRENT SOURCES ***
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">https://rubygems.org/
</span></span><span class="line"><span class="cl">[root@localhost ~]# gem sources --remove https://rubygems.org/
</span></span><span class="line"><span class="cl">[root@localhost ~]# gem sources -a https://ruby.taobao.org/
</span></span><span class="line"><span class="cl">[root@localhost ~]# gem sources -l
</span></span><span class="line"><span class="cl">*** CURRENT SOURCES ***
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">https://ruby.taobao.org/
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="安装-1" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85-1" class="header-mark"></a>0.0.4.2 安装</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# gem install rails -v=4.2
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装mysql" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85mysql" class="header-mark"></a>0.0.5 安装MySQL</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# yum install -y mysql-server mysql-libs mysql-devel mysql
</span></span><span class="line"><span class="cl">[root@localhost ~]# service mysqld start
</span></span><span class="line"><span class="cl">[root@localhost ~]# mysql_secure_installation
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装redmine" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85redmine" class="header-mark"></a>0.0.6 安装redmine</h4><h5 id="下载redmine-332" class="headerLink">
    <a href="#%e4%b8%8b%e8%bd%bdredmine-332" class="header-mark"></a>0.0.6.1 下载Redmine 3.3.2</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# wget http://www.redmine.org/releases/redmine-3.3.2.tar.gz
</span></span><span class="line"><span class="cl">[root@localhost ~]# tar xf redmine-3.3.2.tar.gz
</span></span><span class="line"><span class="cl">[root@localhost ~]# mv redmine-3.3.2 /opt
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="安装管理ruby的包管理工具bundler" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e7%ae%a1%e7%90%86ruby%e7%9a%84%e5%8c%85%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7bundler" class="header-mark"></a>0.0.6.2 安装管理ruby的包管理工具bundler</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 注意，一定要在redmine目录下操作
</span></span><span class="line"><span class="cl">[root@localhost ~]# cd /opt/redmine-3.3.2
</span></span><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# gem install bundler
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="安装redmine运行所需要的依赖包" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85redmine%e8%bf%90%e8%a1%8c%e6%89%80%e9%9c%80%e8%a6%81%e7%9a%84%e4%be%9d%e8%b5%96%e5%8c%85" class="header-mark"></a>0.0.6.3 安装redmine运行所需要的依赖包</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# bundle install --without development test rmagick
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="为rails生产cookies秘钥" class="headerLink">
    <a href="#%e4%b8%barails%e7%94%9f%e4%ba%a7cookies%e7%a7%98%e9%92%a5" class="header-mark"></a>0.0.6.4 为rails生产cookies秘钥</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# rake generate_secret_token
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="创建redmine的数据库" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%baredmine%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>0.0.6.5 创建redmine的数据库</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql&gt; create database redmine character set utf8;
</span></span><span class="line"><span class="cl">mysql&gt; grant all privileges on redmine.* to &#39;redmine&#39;@&#39;localhost&#39; identified by &#39;redmine_pass&#39;;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="修改redmine的databaseyml" class="headerLink">
    <a href="#%e4%bf%ae%e6%94%b9redmine%e7%9a%84databaseyml" class="header-mark"></a>0.0.6.6 修改redmine的database.yml</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# cp config/database.yml.example config/database.yml
</span></span><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# vim config/database.yml
</span></span><span class="line"><span class="cl">production:
</span></span><span class="line"><span class="cl">  adapter: mysql2
</span></span><span class="line"><span class="cl">  database: redmine
</span></span><span class="line"><span class="cl">  host: localhost
</span></span><span class="line"><span class="cl">  username: redmine
</span></span><span class="line"><span class="cl">  password: &#34;redmine_pass&#34;
</span></span><span class="line"><span class="cl">  encoding: utf8
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="创建数据库结构" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93%e7%bb%93%e6%9e%84" class="header-mark"></a>0.0.6.7 创建数据库结构</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake db:migrate
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="生产缺省数据" class="headerLink">
    <a href="#%e7%94%9f%e4%ba%a7%e7%bc%ba%e7%9c%81%e6%95%b0%e6%8d%ae" class="header-mark"></a>0.0.6.8 生产缺省数据</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake redmine:load_default_data
</span></span><span class="line"><span class="cl"># 选择默认语言，之后可更改，初始为en
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="测试是否安装成功" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e6%98%af%e5%90%a6%e5%ae%89%e8%a3%85%e6%88%90%e5%8a%9f" class="header-mark"></a>0.0.6.9 测试是否安装成功</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# bundle exec rails server webrick -e production -b 0.0.0.0
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>默认运行3000端口，默认管理员admin/admin</p>
</blockquote>
<h4 id="配置redmine在nginx上运行" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%aeredmine%e5%9c%a8nginx%e4%b8%8a%e8%bf%90%e8%a1%8c" class="header-mark"></a>0.0.7 配置Redmine在Nginx上运行</h4><p>Redmine常用的解决办法是使用passenger+nginx，但是Nginx不支持装载模块，所以需要重新编译安装Nginx，安装Nginx的Passenger有两种方式</p>
<ul>
<li>采用Passenger提供的脚本进行安装，适合新环境</li>
<li>手动编译安装Nginx增加Passenger模块，适合已存在Nginx环境</li>
</ul>
<h5 id="采用passenger提供脚本安装" class="headerLink">
    <a href="#%e9%87%87%e7%94%a8passenger%e6%8f%90%e4%be%9b%e8%84%9a%e6%9c%ac%e5%ae%89%e8%a3%85" class="header-mark"></a>0.0.7.1 采用Passenger提供脚本安装</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-v" data-lang="v"><span class="line"><span class="cl"><span class="p">[</span><span class="na">root</span><span class="err">@</span><span class="na">localhost</span> <span class="na">redmine</span><span class="err">-</span><span class="na">3</span><span class="err">.</span><span class="na">3</span><span class="err">.</span><span class="na">2</span><span class="p">]</span><span class="o">#</span> <span class="nv">gem</span> <span class="nv">install</span> <span class="nv">passenger</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="na">root</span><span class="err">@</span><span class="na">localhost</span> <span class="na">redmine</span><span class="err">-</span><span class="na">3</span><span class="err">.</span><span class="na">3</span><span class="err">.</span><span class="na">2</span><span class="p">]</span><span class="o">#</span> <span class="nv">passenger</span><span class="o">-</span><span class="nv">install</span><span class="o">-</span><span class="nv">nginx</span><span class="o">-</span><span class="kn">module</span> <span class="o">--</span><span class="nv">auto</span> <span class="o">--</span><span class="nv">prefix</span><span class="o">=/</span><span class="nv">opt</span><span class="o">/</span><span class="nv">nginx</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="采用重新编译nginx增加passenger模块" class="headerLink">
    <a href="#%e9%87%87%e7%94%a8%e9%87%8d%e6%96%b0%e7%bc%96%e8%af%91nginx%e5%a2%9e%e5%8a%a0passenger%e6%a8%a1%e5%9d%97" class="header-mark"></a>0.0.7.2 采用重新编译Nginx增加Passenger模块</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 获取passenger的安装路径
</span></span><span class="line"><span class="cl">[root@localhost ~]# passenger-config --root
</span></span><span class="line"><span class="cl">/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 重新编译Nginx并添加模块
</span></span><span class="line"><span class="cl">[root@localhost ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz
</span></span><span class="line"><span class="cl">[root@localhost ~]# tar xf nginx-1.10.3.tar.gz
</span></span><span class="line"><span class="cl">[root@localhost ~]# cd nginx-1.10.3
</span></span><span class="line"><span class="cl">[root@localhost nginx-1.10.3]# ./configure ... -add-module=/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="增加http模块内以下配置" class="headerLink">
    <a href="#%e5%a2%9e%e5%8a%a0http%e6%a8%a1%e5%9d%97%e5%86%85%e4%bb%a5%e4%b8%8b%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.0.7.3 增加HTTP模块内以下配置</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">passenger_root /usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="配置nginxconf-修改server模块中location的配置" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%aenginxconf-%e4%bf%ae%e6%94%b9server%e6%a8%a1%e5%9d%97%e4%b8%adlocation%e7%9a%84%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.0.7.4 配置nginx.conf 修改server模块中location的配置</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># ...
</span></span><span class="line"><span class="cl">server	{
</span></span><span class="line"><span class="cl">  # ...
</span></span><span class="line"><span class="cl">  passenger_enabled on;
</span></span><span class="line"><span class="cl">  location / {
</span></span><span class="line"><span class="cl">    root /opt/redmine-3.3.2/public;
</span></span><span class="line"><span class="cl">    index index.html index.htm;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl"># ...
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="启动nginx" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8nginx" class="header-mark"></a>0.0.7.5 启动Nginx</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost ~]# /root/nginx-1.10.3/sbin/nginx -c /root/nginx-1.10.3/conf/nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="其他" class="headerLink">
    <a href="#%e5%85%b6%e4%bb%96" class="header-mark"></a>0.0.8 其他</h4><p>到这里，所有的安装都完成了，过程中我遇到这些问题，你也注意下：</p>
<h5 id="71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile" class="headerLink">
    <a href="#71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile" class="header-mark"></a>0.0.8.1 7.1 Could not find gem &lsquo;mysql2 (~&gt; 0.3.11)&rsquo; in any of the gem sources listed in your Gemfile.</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# rm -f Gemfile.lock
</span></span><span class="line"><span class="cl">[root@localhost redmine-3.3.2]# bundle install
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="72-curl-tools" class="headerLink">
    <a href="#72-curl-tools" class="header-mark"></a>0.0.8.2 7.2 curl-tools</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">yum install libcurl-devel
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install NextCloud</title><link>https://samzong.me/howto-install-nextcloud/</link><pubDate>Mon, 27 Feb 2017 14:57:00 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-nextcloud/</guid><description><![CDATA[<p>随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而且随着智能终端的普及，我也有一些更加高质量的图片文件需要大量储存，所以我想到了自建存储服务的方式，在甄别了OwnCloud，Seafiles和NextCloud，最后选择了NextCloud作为自己今后数据存储节点，NextCloud源自OwnCloud，但是近些年来OwnCloud的发展进度几乎停滞，多数开发者也转战NextCloud，当然NextCloud也继承了搭建简单，依赖于PHP环境的特性。</p>
<h4 id="运行环境" class="headerLink">
    <a href="#%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.1 <strong>运行环境</strong></h4><ul>
<li>阿里云ECS CentOS 6.x</li>
<li>免费SSL证书(腾讯云申请)</li>
</ul>
<h4 id="搭建lnmp环境" class="headerLink">
    <a href="#%e6%90%ad%e5%bb%balnmp%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.2 <strong>搭建LNMP环境</strong></h4><h5 id="软件版本" class="headerLink">
    <a href="#%e8%bd%af%e4%bb%b6%e7%89%88%e6%9c%ac" class="header-mark"></a>0.0.2.1 软件版本</h5><ul>
<li>PHP 5.6.30   <a href="https://samzong.me/php54-centos6/" target="_blank" rel="noopener noreferrer">安装教程</a></li>
<li>MySQL 5.6.35  <a href="https://samzong.me/how-to-install-mysql-5-6-on-centos/" target="_blank" rel="noopener noreferrer">安装教程</a></li>
<li>Nginx 1.10.2</li>
</ul>
<h5 id="基础环境安装" class="headerLink">
    <a href="#%e5%9f%ba%e7%a1%80%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85" class="header-mark"></a>0.0.2.2 基础环境安装</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# yum update -y
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum groupinstall -y &#34;Base&#34;
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum groupinstall -y &#34;Development tools&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install epel
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum install -y epel-release
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install remi
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install mysql-community
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum install http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="install-lnmp" class="headerLink">
    <a href="#install-lnmp" class="header-mark"></a>0.0.2.3 Install LNMP</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Install MySQL
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum --enablerepo=mysql-community install -y mysql-server mysql-libs mysql-devel
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service mysqld start
</span></span><span class="line"><span class="cl">[root@ultraera ~]# mysql_secure_installation
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chkconfig mysqld on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install Nginx
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum --enablerepo=epel install -y nginx
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service nginx start
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chkconfig nginx on
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Install PHP and php-fpm
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum --enablerepo=remi-php56 install php php-fpm php-mysql php-gd php-xml php-redis php-libs php-devel php-zlib
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service php-fpm start
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chkconfig php-fpm on
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service nginx restart
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="下载nextcloud" class="headerLink">
    <a href="#%e4%b8%8b%e8%bd%bdnextcloud" class="header-mark"></a>0.0.2.4 下载NextCloud</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2
</span></span><span class="line"><span class="cl">[root@ultraera ~]# tar xf nextcloud-11.0.1.tar.bz2
</span></span><span class="line"><span class="cl">[root@ultraera ~]# mv nextcloud-11.0.1 /opt/nextcloud
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="配置nginx和php-fpm" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%aenginx%e5%92%8cphp-fpm" class="header-mark"></a>0.0.2.5 配置Nginx和php-fpm</h5><p>因为php-fpm默认运行的用户身份是apache，我们这里使用的环境是nginx，所有要修改php-fpm配置文件的用户和组，注意不要为了省事直接改为root，这在php-fpm中是不允许的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# vim /etc/php-fpm.d/www.conf
</span></span><span class="line"><span class="cl">user=nginx
</span></span><span class="line"><span class="cl">group=nginx
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service php-fpm restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为NextCloud默认是以Apache的身份运行的，所以我们需要单独配置NextCloud的Nginx配置文件，以下配置文件，你可以直接拿去用，注意在文件中说明了，需要修改的地方：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-v" data-lang="v"><span class="line"><span class="cl"><span class="p">[</span><span class="na">root</span><span class="err">@</span><span class="na">ultraera</span> <span class="err">~</span><span class="p">]</span><span class="o">#</span> <span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">nginx</span><span class="o">/</span><span class="nv">conf</span><span class="p">.</span><span class="nv">d</span><span class="o">/</span><span class="nv">nextcloud</span><span class="p">.</span><span class="nv">conf</span>
</span></span><span class="line"><span class="cl"> <span class="nv">upstream</span> <span class="nv">php</span><span class="o">-</span><span class="nv">handler</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  	<span class="o">#</span> <span class="nv">这里是你php</span><span class="o">-</span><span class="nv">fpm的服务端口</span><span class="err">，</span><span class="nv">默认是9000</span>
</span></span><span class="line"><span class="cl">    <span class="nv">server</span> <span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cp">#server unix:/var/run/php5-fpm.sock;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  	<span class="o">#</span> <span class="nv">你的域名</span>
</span></span><span class="line"><span class="cl">    <span class="nv">listen</span> <span class="nv">pan</span><span class="p">.</span><span class="nv">ultraera</span><span class="p">.</span><span class="nv">org</span><span class="p">:</span><span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">server_name</span> <span class="nv">pan</span><span class="p">.</span><span class="nv">ultraera</span><span class="p">.</span><span class="nv">org</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nv">enforce</span> <span class="nv">https</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">301</span> <span class="nv">https</span><span class="p">:</span><span class="c1">//$server_name$request_uri;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nv">你的域名</span>
</span></span><span class="line"><span class="cl">    <span class="nv">listen</span> <span class="nv">pan</span><span class="p">.</span><span class="nv">ultraera</span><span class="p">.</span><span class="nv">org</span><span class="p">:</span><span class="mi">443</span> <span class="nv">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">server_name</span> <span class="nv">pan</span><span class="p">.</span><span class="nv">ultraera</span><span class="p">.</span><span class="nv">org</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  	<span class="o">#</span> <span class="nv">以下是你的ssl证书文件存放路径</span>
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_certificate</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">nginx</span><span class="o">/</span><span class="nv">ssl</span><span class="o">/</span><span class="mi">1_</span><span class="nv">pan</span><span class="p">.</span><span class="nv">ultraera</span><span class="p">.</span><span class="nv">org_bundle</span><span class="p">.</span><span class="nv">crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_certificate_key</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">nginx</span><span class="o">/</span><span class="nv">ssl</span><span class="o">/</span><span class="mi">2_</span><span class="nv">pan</span><span class="p">.</span><span class="nv">ultraera</span><span class="p">.</span><span class="nv">org</span><span class="p">.</span><span class="nv">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nc">Add</span> <span class="nv">headers</span> <span class="nv">to</span> <span class="nv">serve</span> <span class="nv">security</span> <span class="nv">related</span> <span class="nv">headers</span>
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nc">Before</span> <span class="nv">enabling</span> <span class="nc">Strict</span><span class="o">-</span><span class="nc">Transport</span><span class="o">-</span><span class="nc">Security</span> <span class="nv">headers</span> <span class="nv">please</span> <span class="nv">read</span> <span class="nv">into</span> <span class="nv">this</span>
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nv">topic</span> <span class="nv">first</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nv">add_header</span> <span class="nc">Strict</span><span class="o">-</span><span class="nc">Transport</span><span class="o">-</span><span class="nc">Security</span> <span class="s2">&#34;max-age=15768000;
</span></span></span><span class="line"><span class="cl"><span class="s2">    # includeSubDomains; preload;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">add_header</span> <span class="nc">X</span><span class="o">-</span><span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span><span class="o">-</span><span class="nc">Options</span> <span class="nv">nosniff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">add_header</span> <span class="nc">X</span><span class="o">-</span><span class="nc">Frame</span><span class="o">-</span><span class="nc">Options</span> <span class="s2">&#34;SAMEORIGIN&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">add_header</span> <span class="nc">X</span><span class="o">-</span><span class="nc">XSS</span><span class="o">-</span><span class="nc">Protection</span> <span class="s2">&#34;1; mode=block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">add_header</span> <span class="nc">X</span><span class="o">-</span><span class="nc">Robots</span><span class="o">-</span><span class="nc">Tag</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">add_header</span> <span class="nc">X</span><span class="o">-</span><span class="nc">Download</span><span class="o">-</span><span class="nc">Options</span> <span class="nv">noopen</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">add_header</span> <span class="nc">X</span><span class="o">-</span><span class="nc">Permitted</span><span class="o">-</span><span class="nc">Cross</span><span class="o">-</span><span class="nc">Domain</span><span class="o">-</span><span class="nc">Policies</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="nv">add_header</span> <span class="nc">Strict</span><span class="o">-</span><span class="nc">Transport</span><span class="o">-</span><span class="nc">Security</span> <span class="s2">&#34;max-age=15552000; includeSubdomains; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nv">设定你的NextCloud的根目录</span><span class="err">，</span><span class="nv">请根据实际修改</span>
</span></span><span class="line"><span class="cl">    <span class="nv">root</span> <span class="o">/</span><span class="nv">opt</span><span class="o">/</span><span class="nv">nextcloud</span><span class="o">/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">location</span> <span class="o">=</span> <span class="o">/</span><span class="nv">robots</span><span class="p">.</span><span class="nv">txt</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">allow</span> <span class="nv">all</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">log_not_found</span> <span class="nv">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">access_log</span> <span class="nv">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nc">The</span> <span class="nv">following</span> <span class="mi">2</span> <span class="nv">rules</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">needed</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">user_webfinger</span> <span class="nv">app</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="o">#</span> <span class="nc">Uncomment</span> <span class="vm">it</span> <span class="k">if</span> <span class="nv">you</span><span class="s1">&#39;re planning to use this app.
</span></span></span><span class="line"><span class="cl"><span class="s1">    #rewrite ^/.well-known/host-meta /public.php?service=host-meta last;
</span></span></span><span class="line"><span class="cl"><span class="s1">    #rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json
</span></span></span><span class="line"><span class="cl"><span class="s1">    # last;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    location = /.well-known/carddav {
</span></span></span><span class="line"><span class="cl"><span class="s1">      return 301 </span><span class="o">$</span><span class="nv">scheme</span><span class="s1">://</span><span class="o">$</span><span class="nv">host</span><span class="s1">/remote.php/dav;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">    location = /.well-known/caldav {
</span></span></span><span class="line"><span class="cl"><span class="s1">      return 301 </span><span class="o">$</span><span class="nv">scheme</span><span class="s1">://</span><span class="o">$</span><span class="nv">host</span><span class="s1">/remote.php/dav;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    # set max upload size
</span></span></span><span class="line"><span class="cl"><span class="s1">    client_max_body_size 512M;
</span></span></span><span class="line"><span class="cl"><span class="s1">    fastcgi_buffers 64 4K;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    # Disable gzip to avoid the removal of the ETag header
</span></span></span><span class="line"><span class="cl"><span class="s1">    gzip off;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    # Uncomment if your server is build with the ngx_pagespeed module
</span></span></span><span class="line"><span class="cl"><span class="s1">    # This module is currently not supported.
</span></span></span><span class="line"><span class="cl"><span class="s1">    #pagespeed off;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    error_page 403 /core/templates/403.php;
</span></span></span><span class="line"><span class="cl"><span class="s1">    error_page 404 /core/templates/404.php;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    location / {
</span></span></span><span class="line"><span class="cl"><span class="s1">        rewrite ^ /index.php</span><span class="o">$</span><span class="nv">uri</span><span class="s1">;
</span></span></span><span class="line"><span class="cl"><span class="s1">   }
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/ {
</span></span></span><span class="line"><span class="cl"><span class="s1">        deny all;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">    location ~ ^/(?:\.|autotest|occ|issue|indie|db_|console) {
</span></span></span><span class="line"><span class="cl"><span class="s1">        deny all;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    location ~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\.php(?:</span><span class="o">$</span><span class="s1">|/) {
</span></span></span><span class="line"><span class="cl"><span class="s1">        include fastcgi_params;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_split_path_info ^(.+\.php)(/.*)</span><span class="o">$</span><span class="s1">;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_param SCRIPT_FILENAME </span><span class="o">$</span><span class="nv">document_root</span><span class="o">$</span><span class="nv">fastcgi_script_name</span><span class="s1">;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_param PATH_INFO </span><span class="o">$</span><span class="nv">fastcgi_path_info</span><span class="s1">;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_param HTTPS on;
</span></span></span><span class="line"><span class="cl"><span class="s1">        #Avoid sending the security headers twice
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_param modHeadersAvailable true;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_param front_controller_active true;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_pass php-handler;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_intercept_errors on;
</span></span></span><span class="line"><span class="cl"><span class="s1">        fastcgi_request_buffering off;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    location ~ ^/(?:updater|ocs-provider)(?:</span><span class="o">$</span><span class="s1">|/) {
</span></span></span><span class="line"><span class="cl"><span class="s1">        try_files </span><span class="o">$</span><span class="nv">uri</span><span class="s1">/ =404;
</span></span></span><span class="line"><span class="cl"><span class="s1">        index index.php;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    # Adding the cache control header for js and css files
</span></span></span><span class="line"><span class="cl"><span class="s1">    # Make sure it is BELOW the PHP block
</span></span></span><span class="line"><span class="cl"><span class="s1">    location ~* \.(?:css|js|woff|svg|gif)</span><span class="o">$</span><span class="s1"> {
</span></span></span><span class="line"><span class="cl"><span class="s1">        try_files </span><span class="o">$</span><span class="nv">uri</span><span class="s1"> /index.php</span><span class="o">$</span><span class="nv">uri</span><span class="o">$</span><span class="nv">is_args</span><span class="o">$</span><span class="nv">args</span><span class="s1">;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header Cache-Control &#34;public, max-age=7200&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s1">        # Add headers to serve security related headers (It is intended to
</span></span></span><span class="line"><span class="cl"><span class="s1">        # have those duplicated to the ones above)
</span></span></span><span class="line"><span class="cl"><span class="s1">        # Before enabling Strict-Transport-Security headers please read into
</span></span></span><span class="line"><span class="cl"><span class="s1">        # this topic first.
</span></span></span><span class="line"><span class="cl"><span class="s1">        # add_header Strict-Transport-Security &#34;max-age=15768000;
</span></span></span><span class="line"><span class="cl"><span class="s1">        #  includeSubDomains; preload;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header X-Content-Type-Options nosniff;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header X-Frame-Options &#34;SAMEORIGIN&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header X-XSS-Protection &#34;1; mode=block&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header X-Robots-Tag none;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header X-Download-Options noopen;
</span></span></span><span class="line"><span class="cl"><span class="s1">        add_header X-Permitted-Cross-Domain-Policies none;
</span></span></span><span class="line"><span class="cl"><span class="s1">        # Optional: Don&#39;</span><span class="nv">t</span> <span class="nv">log</span> <span class="nv">access</span> <span class="nv">to</span> <span class="nv">assets</span>
</span></span><span class="line"><span class="cl">        <span class="nv">access_log</span> <span class="nv">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">location</span> <span class="o">~*</span> <span class="err">\</span><span class="p">.(</span><span class="kd">?</span><span class="p">:</span><span class="nv">png</span><span class="o">|</span><span class="nv">html</span><span class="o">|</span><span class="nv">ttf</span><span class="o">|</span><span class="nv">ico</span><span class="o">|</span><span class="nv">jpg</span><span class="o">|</span><span class="nv">jpeg</span><span class="p">)</span><span class="err">$</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">try_files</span> <span class="o">$</span><span class="nv">uri</span> <span class="o">/</span><span class="nv">index</span><span class="p">.</span><span class="nv">php</span><span class="o">$</span><span class="nv">uri</span><span class="o">$</span><span class="nv">is_args</span><span class="o">$</span><span class="nv">args</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">#</span> <span class="nc">Optional</span><span class="p">:</span> <span class="nc">Don</span><span class="s1">&#39;t log access to other assets
</span></span></span><span class="line"><span class="cl"><span class="s1">        access_log off;
</span></span></span><span class="line"><span class="cl"><span class="s1">    }
</span></span></span><span class="line"><span class="cl"><span class="s1">}
</span></span></span><span class="line"><span class="cl"><span class="s1">[root@ultraera ~]# service nginx restart
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="文件权限调整" class="headerLink">
    <a href="#%e6%96%87%e4%bb%b6%e6%9d%83%e9%99%90%e8%b0%83%e6%95%b4" class="header-mark"></a>0.0.2.6 文件权限调整</h5><p>因为NextCloud运行是以nginx程序，注意修改目录所属用户和组为nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# chown -R nginx:nginx /opt/nextcloud
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="创建mysql数据库" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%bamysql%e6%95%b0%e6%8d%ae%e5%ba%93" class="header-mark"></a>0.0.2.7 创建MySQL数据库</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mysql&gt; CREATE DATABASE nextcloud CHARACTER SET UTF-8;
</span></span><span class="line"><span class="cl">mysql&gt; GRANT ALL PRIVILEGES ON nextcloud.* TO &#39;nextcloud&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;your_password&#39;;
</span></span><span class="line"><span class="cl">mysql&gt; FLUSH PRIVILEGES;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="初始化nextcloud" class="headerLink">
    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96nextcloud" class="header-mark"></a>0.0.3 初始化NextCloud</h4><p>在浏览器打开你在nginx中配置的域名，NextCloud初始化非常简单，设定一个管理员账户和密码，然后设定数据库即可，按照我们上一步针对MySQL的设定，你会非常清楚地知道你的数据库信息：</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png">
        
    </a></p>
<p>登录之后的界面是这样：</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png">
        
    </a></p>
<p>你可以在登录之后，在你的右上角点击头像选择Admin进入管理界面查看和修改你的服务器设置，你还可以在浏览器上方看到你的服务器现有哪些问题，会有对应文档提醒你如何解决这些问题。</p>
<p><a class="lightgallery" href="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png" title="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png" data-thumbnail="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png">
        
    </a></p>
<h4 id="other" class="headerLink">
    <a href="#other" class="header-mark"></a>0.0.4 <strong>Other</strong></h4><h5 id="修改默认data目录" class="headerLink">
    <a href="#%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4data%e7%9b%ae%e5%bd%95" class="header-mark"></a>0.0.4.1 修改默认data目录</h5><p>在我们首次打开NextCloud网页时，需要我们设定datadir目录，这里有个默认目录在nextcloud项目包，这其实是不安全的，我们最后将目录路径修改为其他位置:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# mkdir /nextcloud_files/
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chown -R nginx:nginx /nextcloud_files/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 修改datadirectory的路径
</span></span><span class="line"><span class="cl">[root@ultraera ~]# vim /opt/nextcloud/config/config.php
</span></span><span class="line"><span class="cl">datadirectory&#39; =&gt; &#39;/nextcloud/data
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="无法登陆到个人用户界面" class="headerLink">
    <a href="#%e6%97%a0%e6%b3%95%e7%99%bb%e9%99%86%e5%88%b0%e4%b8%aa%e4%ba%ba%e7%94%a8%e6%88%b7%e7%95%8c%e9%9d%a2" class="header-mark"></a>0.0.4.2 无法登陆到个人用户界面</h5><p>我在安装时碰到这个问题，折腾了很久才解决，因为我们是使用nginx程序，但是php-fpm默认用户身份为apache，所以<code>/var/lib/php/session</code>目录的所属用户和组都是apache，导致我们没有权限去写入session，所以无法登入系统，报错信息可以在NextCloud的log文件下看到：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# tail -n 1 /usr/nextcloud/data/nextcloud.log
</span></span><span class="line"><span class="cl">{&#34;reqId&#34;:&#34;NNnIwMCCPDMQtzZW5Ndc&#34;,&#34;remoteAddr&#34;:&#34;180.166.66.226&#34;,&#34;app&#34;:&#34;PHP&#34;,&#34;message&#34;:&#34;session_write_close(): Failed to write session data (files). Please verify that the current setting of session.save_path is correct (\/var\/lib\/php\/session) at \/usr\/nextcloud\/lib\/private\/Session\/Internal.php#104&#34;,&#34;level&#34;:3,&#34;time&#34;:&#34;2017-02-24T10:46:13+00:00&#34;,&#34;method&#34;:&#34;POST&#34;,&#34;url&#34;:&#34;\/index.php&#34;,&#34;user&#34;:&#34;samzong&#34;,&#34;version&#34;:&#34;11.0.0.10&#34;}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 修改/var/lib/php/的属组为nginx即可
</span></span><span class="line"><span class="cl">[root@ultraera ~]# chgrp -R nginx /var/lib/php
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="增加redis组件提高性能" class="headerLink">
    <a href="#%e5%a2%9e%e5%8a%a0redis%e7%bb%84%e4%bb%b6%e6%8f%90%e9%ab%98%e6%80%a7%e8%83%bd" class="header-mark"></a>0.0.4.3 增加redis组件，提高性能</h5><p>关于如何安装redis我在之前的文章中也有讲到，大家可以去看下 <a href="https://samzong.me/redis01/" target="_blank" rel="noopener noreferrer">安装教程</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@ultraera ~]# yum --enablerepo=remi install -y redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 增加php的redis插件
</span></span><span class="line"><span class="cl">[root@ultraera ~]# yum --enablerepo=remi-php56 install php-redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 配置文件增加redis
</span></span><span class="line"><span class="cl">  &#39;memcache.local&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class="line"><span class="cl">  &#39;memcache.locking&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class="line"><span class="cl">  &#39;redis&#39; =&gt;
</span></span><span class="line"><span class="cl">   array (
</span></span><span class="line"><span class="cl">    &#39;host&#39; =&gt; &#39;localhost&#39;,
</span></span><span class="line"><span class="cl">    &#39;port&#39; =&gt; 6379,
</span></span><span class="line"><span class="cl">   )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 重启令服务生效
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service php-fpm restart
</span></span><span class="line"><span class="cl">[root@ultraera ~]# service nginx restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>我的NextCloud配置如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">$CONFIG = array (
</span></span><span class="line"><span class="cl">  &#39;memcache.local&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class="line"><span class="cl">  &#39;memcache.locking&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class="line"><span class="cl">  &#39;redis&#39; =&gt;
</span></span><span class="line"><span class="cl">  array (
</span></span><span class="line"><span class="cl">    &#39;host&#39; =&gt; &#39;localhost&#39;,
</span></span><span class="line"><span class="cl">    &#39;port&#39; =&gt; 6379,
</span></span><span class="line"><span class="cl">  ),
</span></span><span class="line"><span class="cl">  &#39;enable_previews&#39; =&gt; false,
</span></span><span class="line"><span class="cl">  &#39;instanceid&#39; =&gt; &#39;ockhup01dxbf&#39;,
</span></span><span class="line"><span class="cl">  &#39;passwordsalt&#39; =&gt; &#39;TlJgWGrE0N7vOrRfZkOojwdYh/BixL&#39;,
</span></span><span class="line"><span class="cl">  &#39;secret&#39; =&gt; &#39;/IQh0LioZp5eYFQJhicY7n324Q80WQUYOzWL+8OcxcXVw3Ef&#39;,
</span></span><span class="line"><span class="cl">  &#39;trusted_domains&#39; =&gt;
</span></span><span class="line"><span class="cl">  array (
</span></span><span class="line"><span class="cl">    0 =&gt; &#39;pan.ultraera.org&#39;,
</span></span><span class="line"><span class="cl">  ),
</span></span><span class="line"><span class="cl">  &#39;datadirectory&#39; =&gt; &#39;/nextcloud&#39;,
</span></span><span class="line"><span class="cl">  &#39;overwrite.cli.url&#39; =&gt; &#39;https://pan.ultraera.org&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbtype&#39; =&gt; &#39;mysql&#39;,
</span></span><span class="line"><span class="cl">  &#39;version&#39; =&gt; &#39;11.0.0.10&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbname&#39; =&gt; &#39;nextcloud&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbhost&#39; =&gt; &#39;localhost&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbport&#39; =&gt; &#39;&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbtableprefix&#39; =&gt; &#39;oc_&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbuser&#39; =&gt; &#39;nextcloud&#39;,
</span></span><span class="line"><span class="cl">  &#39;dbpassword&#39; =&gt; &#39;nextcloud&#39;,
</span></span><span class="line"><span class="cl">  &#39;logtimezone&#39; =&gt; &#39;CST&#39;,
</span></span><span class="line"><span class="cl">  &#39;installed&#39; =&gt; true,
</span></span><span class="line"><span class="cl">  &#39;mail_from_address&#39; =&gt; &#39;luchuanjia&#39;,
</span></span><span class="line"><span class="cl">  &#39;mail_smtpmode&#39; =&gt; &#39;php&#39;,
</span></span><span class="line"><span class="cl">  &#39;mail_domain&#39; =&gt; &#39;msn.com&#39;,
</span></span><span class="line"><span class="cl">);
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ssl证书" class="headerLink">
    <a href="#ssl%e8%af%81%e4%b9%a6" class="header-mark"></a>0.0.4.4 SSL证书</h5><p>现国内提供免费的SSL证书的服务商很多，作为个人站点，免费SSL证书是个挺不错的选择，我在之前nginx配置时将ssl的配置方式写在了配置文件中了，注意如果不启用ssl时，不要启用https的虚拟主机，当然你可以自己生成一个ssl证书来提供服务，但这样在别人访问你的网站时，会不提示不受信任的证书，具体如何获取的证书的方式，因各个厂家方式有些区别，这里就不赘述，可以联系对应的厂商的技术人员咨询。</p>
<h4 id="使用现状" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8%e7%8e%b0%e7%8a%b6" class="header-mark"></a>0.0.5 <strong>使用现状</strong></h4><p>在将服务搭建完成之后，对于存储的文件加密，现在通过jobs，每日凌晨将文件推送到oss内，保存2天的数据，避免因为服务器宕机导致文件丢失；使用端，自己的电脑和手机，还有家人的手机，都安装了应用，后台自动将拍照图片等自动上传到云盘，使用起来目前很稳定，只是iOS应用是收费的，因为NextCloud源于OwnCloud，如果你之前购买了OwnCloud的App也可以直接使用，当然NextCloud也有很多其他功能，可以根据你的实际需求发掘。</p>
]]></description></item><item><title>HowTo install Zoomdata</title><link>https://samzong.me/howto-install-zoomdata/</link><pubDate>Mon, 06 Mar 2017 09:44:47 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-zoomdata/</guid><description><![CDATA[<p>Zoomdata是一个大数据可视化展示的工具，由ZoomData企业创建，是为数不多的同时支持移动端的数据分析公司，Zoomdata的可视化可将大数据流转化为触屏友好的，艺术感十足的三维形态，Zoomdata的定位是非ETL(传统的提取、转换和加载的数据处理过程)工具，Zoomdata支持多种数据源，包括社交媒体等，其中应用最主流是大数据平台的展示工具，并且Zoomdata对Cloudera Impala做了很好的支持，所以我们做了Zoomdata+Cloudera技术实施。[^1]</p>
<h4 id="系统要求" class="headerLink">
    <a href="#%e7%b3%bb%e7%bb%9f%e8%a6%81%e6%b1%82" class="header-mark"></a>0.0.1 <strong>系统要求</strong></h4><p>Zoomdata最新版是v2.4，支持常见主流的操作系统，并且有非常友好的安装帮助，但是Zoomdata不支持安装在32位的操作系统之上
<br></p>
<table>
<thead>
<tr>
<th>biaoti</th>
<th>biaoti</th>
<th>baiiti</th>
</tr>
</thead>
<tbody>
<tr>
<td>list</td>
<td>file</td>
<td>china</td>
</tr>
<tr>
<td>letian</td>
<td>zhong</td>
<td>hongkong</td>
</tr>
</tbody>
</table>
<br>
[^1]: 这是一个示意的文档
]]></description></item><item><title>HowTo set Tomcat 7 automatic startup with CentOS 7</title><link>https://samzong.me/howto-set-tomcat-7-automatic-startup-with-centos-7/</link><pubDate>Wed, 05 Apr 2017 15:21:03 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-set-tomcat-7-automatic-startup-with-centos-7/</guid><description><![CDATA[<p>因CentOS7与6在系统上，变化较大，所以在之前的文章中讲到的使用Tomcat7开机自启动的方式在CentOS7是是无法使用的，所以这篇文章的目的是如何在CentOS7上将Tomcat7设置为开机自启动。</p>
<h4 id="安装java环境" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85java%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.1 安装JAVA环境</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@7 ~]# curl -LO -H &#34;Cookie: oraclelicense=accept-securebackup-cookie&#34; \
</span></span><span class="line"><span class="cl">&#34;http://download.oracle.com/otn-pub/java/jdk/7u75-b13/jdk-7u75-linux-x64.rpm&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@7 ~]# rpm -Uvh jdk-7u75-linux-x64.rpm
</span></span><span class="line"><span class="cl">Preparing...                ########################################### [100%]
</span></span><span class="line"><span class="cl">   1:jdk                    ########################################### [100%]
</span></span><span class="line"><span class="cl">Unpacking JAR files...
</span></span><span class="line"><span class="cl">        rt.jar...
</span></span><span class="line"><span class="cl">        jsse.jar...
</span></span><span class="line"><span class="cl">        charsets.jar...
</span></span><span class="line"><span class="cl">        tools.jar...
</span></span><span class="line"><span class="cl">        localedata.jar...
</span></span><span class="line"><span class="cl">        jfxrt.jar...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@7 ~]# vi /etc/profile
</span></span><span class="line"><span class="cl"># add follows to the end
</span></span><span class="line"><span class="cl">export JAVA_HOME=/usr/java/default
</span></span><span class="line"><span class="cl">export PATH=$PATH:$JAVA_HOME/bin
</span></span><span class="line"><span class="cl">export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span><span class="line"><span class="cl">[root@7 ~]# source /etc/profile
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装tomcat7" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85tomcat7" class="header-mark"></a>0.0.2 安装Tomcat7</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@7 ~]# wget http://ftp.riken.jp/net/apache/tomcat/tomcat-7/v7.0.77/bin/apache-tomcat-7.0.77.tar.gz
</span></span><span class="line"><span class="cl">[root@7 ~]# tar zxvf apache-tomcat-7.0.77.tar.gz
</span></span><span class="line"><span class="cl">[root@7 ~]# mv apache-tomcat-7.0.77 /usr/tomcat7
</span></span><span class="line"><span class="cl">[root@7 ~]# useradd -M -d /usr/tomcat7 tomcat7
</span></span><span class="line"><span class="cl">[root@7 ~]# chown -R tomcat7. /usr/tomcat7
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="创建开机自启动脚本" class="headerLink">
    <a href="#%e5%88%9b%e5%bb%ba%e5%bc%80%e6%9c%ba%e8%87%aa%e5%90%af%e5%8a%a8%e8%84%9a%e6%9c%ac" class="header-mark"></a>0.0.3 创建开机自启动脚本</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@7 ~]# cat /usr/lib/systemd/system/tomcat7.service
</span></span><span class="line"><span class="cl"># create new
</span></span><span class="line"><span class="cl"> [Unit]
</span></span><span class="line"><span class="cl">Description=Apache Tomcat 7
</span></span><span class="line"><span class="cl">After=network.target
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Service]
</span></span><span class="line"><span class="cl">Type=oneshot
</span></span><span class="line"><span class="cl">ExecStart=/usr/tomcat7/bin/startup.sh
</span></span><span class="line"><span class="cl">ExecStop=/usr/tomcat7/bin/shutdown.sh
</span></span><span class="line"><span class="cl">RemainAfterExit=yes
</span></span><span class="line"><span class="cl">User=tomcat7
</span></span><span class="line"><span class="cl">Group=tomcat7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[Install]
</span></span><span class="line"><span class="cl">WantedBy=multi-user.target
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动tomcat7" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8tomcat7" class="header-mark"></a>0.0.4 启动Tomcat7</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@7 ~]# systemctl start tomcat7.service
</span></span><span class="line"><span class="cl">[root@7 ~]# systemctl enable tomcat7.service
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>HowTo Install GitLab</title><link>https://samzong.me/howto-install-gitlab/</link><pubDate>Thu, 13 Apr 2017 11:18:17 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/howto-install-gitlab/</guid><description><![CDATA[<p>目前最为主流的在线Git版本控制系统可以说是非GitHub莫属，对于个人开发者和开源项目可以直接选择GitHub作为Git版本控制系统即可，但是，对于企业内部开发管理的Git版本控制系统，在对保密性有高要求时GitHub就不合适了，这时GitLab作为一个可以完全搭建在企业内部的Git版本控制系统，而且基本囊括了GitHub的所有功能。</p>
<h4 id="目前gitlab已经整合的功能" class="headerLink">
    <a href="#%e7%9b%ae%e5%89%8dgitlab%e5%b7%b2%e7%bb%8f%e6%95%b4%e5%90%88%e7%9a%84%e5%8a%9f%e8%83%bd" class="header-mark"></a>0.0.1 目前GitLab已经整合的功能</h4><ol>
<li>Repository access</li>
<li>Administration</li>
<li>Issues</li>
<li>Forks</li>
<li>Code review</li>
<li>Wiki</li>
<li>Merge Requests</li>
<li>Web Editor</li>
</ol>
<h4 id="测试环境" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e7%8e%af%e5%a2%83" class="header-mark"></a>0.0.2 测试环境</h4><ul>
<li>2 core 4GB</li>
<li>50GB HDD</li>
<li>CentOS 6.8</li>
<li>Gitlab</li>
</ul>
<h4 id="安装需求" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e9%9c%80%e6%b1%82" class="header-mark"></a>0.0.3 安装需求</h4><p>关于GitLab的安装需求，主要是针对用户量然后评估出服务器及相关资源的配置，<a href="https://docs.gitlab.com.cn/ce/install/requirements.html" target="_blank" rel="noopener noreferrer">查看</a></p>
<h3 id="gitlab-安装" class="headerLink">
    <a href="#gitlab-%e5%ae%89%e8%a3%85" class="header-mark"></a>0.1 <strong>GitLab 安装</strong></h3><h4 id="安装配置依赖项" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e9%85%8d%e7%bd%ae%e4%be%9d%e8%b5%96%e9%a1%b9" class="header-mark"></a>0.1.1 安装配置依赖项</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo yum install curl openssh-server openssh-clients postfix cronie
</span></span><span class="line"><span class="cl">sudo service postfix start
</span></span><span class="line"><span class="cl">sudo chkconfig postfix on
</span></span><span class="line"><span class="cl">sudo lokkit -s http -s ssh
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="添加gitlab仓库并安装到服务器上" class="headerLink">
    <a href="#%e6%b7%bb%e5%8a%a0gitlab%e4%bb%93%e5%ba%93%e5%b9%b6%e5%ae%89%e8%a3%85%e5%88%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a" class="header-mark"></a>0.1.2 添加GitLab仓库,并安装到服务器上</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">curl -sS http://packages.gitlab.cc/install/gitlab-ce/script.rpm.sh | sudo bash
</span></span><span class="line"><span class="cl">sudo yum install gitlab-ce
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动gitlab并初始化" class="headerLink">
    <a href="#%e5%90%af%e5%8a%a8gitlab%e5%b9%b6%e5%88%9d%e5%a7%8b%e5%8c%96" class="header-mark"></a>0.1.3 启动GitLab并初始化</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo gitlab-ctl reconfigure
</span></span></code></pre></td></tr></table>
</div>
</div><p>默认登录账号是：<strong>root</strong> ，你可以在首次打开时设置密码。</p>
<h3 id="gitlab-初始化" class="headerLink">
    <a href="#gitlab-%e5%88%9d%e5%a7%8b%e5%8c%96" class="header-mark"></a>0.2 <strong>GitLab 初始化</strong></h3><h4 id="开机自启动" class="headerLink">
    <a href="#%e5%bc%80%e6%9c%ba%e8%87%aa%e5%90%af%e5%8a%a8" class="header-mark"></a>0.2.1 开机自启动</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> vi /etc/rc.local
</span></span><span class="line"><span class="cl"> /opt/gitlab/bin/gitlab-ctl start
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="gitlab-配置文件" class="headerLink">
    <a href="#gitlab-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>0.2.2 GitLab 配置文件</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/etc/gitlab/gitlab.rb
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="smtp-邮箱配置" class="headerLink">
    <a href="#smtp-%e9%82%ae%e7%ae%b1%e9%85%8d%e7%bd%ae" class="header-mark"></a>0.2.3 SMTP 邮箱配置</h4><p>如果想使用SMTP代替sendmail来发送邮件，应该在gitlab.rb中启用对应的配置，然后运行<code>gitlab-ctl reconfigure</code>使修改生效。</p>
<h5 id="qq企业邮箱配置示例" class="headerLink">
    <a href="#qq%e4%bc%81%e4%b8%9a%e9%82%ae%e7%ae%b1%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b" class="header-mark"></a>0.2.3.1 QQ企业邮箱配置示例</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gitlab_rails[&#39;smtp_enable&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_address&#39;] = &#34;smtp.exmail.qq.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_port&#39;] = 465
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_user_name&#39;] = &#34;xxxx@xx.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_password&#39;] = &#34;password&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_authentication&#39;] = &#34;login&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_tls&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;gitlab_email_from&#39;] = &#39;xxxx@xx.com&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="gmail邮箱配置示例" class="headerLink">
    <a href="#gmail%e9%82%ae%e7%ae%b1%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b" class="header-mark"></a>0.2.3.2 Gmail邮箱配置示例</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gitlab_rails[&#39;smtp_enable&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_address&#39;] = &#34;smtp.gmail.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_port&#39;] = 587
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_user_name&#39;] = &#34;my.email@gmail.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_password&#39;] = &#34;my-gmail-password&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_domain&#39;] = &#34;smtp.gmail.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_authentication&#39;] = &#34;login&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_tls&#39;] = false
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_openssl_verify_mode&#39;] = &#39;peer&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="outlook邮箱配置示例" class="headerLink">
    <a href="#outlook%e9%82%ae%e7%ae%b1%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b" class="header-mark"></a>0.2.3.3 Outlook邮箱配置示例</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gitlab_rails[&#39;smtp_enable&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_address&#39;] = &#34;smtp-mail.outlook.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_port&#39;] = 587
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_user_name&#39;] = &#34;username@outlook.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_password&#39;] = &#34;password&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_domain&#39;] = &#34;smtp-mail.outlook.com&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_authentication&#39;] = &#34;login&#34;
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] = true
</span></span><span class="line"><span class="cl">gitlab_rails[&#39;smtp_openssl_verify_mode&#39;] = &#39;peer&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>​:warning: &lsquo;smtp_password&rsquo;字段不应包含任何 Ruby或者YAML语法中的分隔符 (如<code>'</code>),以避免处理配置文件的过程中发生不必要的意外。</p>
</blockquote>
<h4 id="gitlab-日常维护" class="headerLink">
    <a href="#gitlab-%e6%97%a5%e5%b8%b8%e7%bb%b4%e6%8a%a4" class="header-mark"></a>0.2.4 GitLab 日常维护</h4><h5 id="1-查看服务状态" class="headerLink">
    <a href="#1-%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e7%8a%b6%e6%80%81" class="header-mark"></a>0.2.4.1 1. 查看服务状态</h5><p>使用 gitlab-ctl status 查看服务状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[root@6 ~]# sudo gitlab-ctl status
</span></span><span class="line"><span class="cl">run: gitaly: (pid 15055) 23089s; run: log: (pid 3142) 55379s
</span></span><span class="line"><span class="cl">run: gitlab-monitor: (pid 15060) 23088s; run: log: (pid 3325) 55357s
</span></span><span class="line"><span class="cl">run: gitlab-workhorse: (pid 15063) 23088s; run: log: (pid 3156) 55377s
</span></span><span class="line"><span class="cl">run: logrotate: (pid 17867) 1487s; run: log: (pid 3197) 55369s
</span></span><span class="line"><span class="cl">run: nginx: (pid 15077) 23087s; run: log: (pid 3169) 55375s
</span></span><span class="line"><span class="cl">run: node-exporter: (pid 15083) 23087s; run: log: (pid 3247) 55366s
</span></span><span class="line"><span class="cl">run: postgres-exporter: (pid 15088) 23086s; run: log: (pid 3311) 55358s
</span></span><span class="line"><span class="cl">run: postgresql: (pid 15093) 23086s; run: log: (pid 2988) 55412s
</span></span><span class="line"><span class="cl">run: prometheus: (pid 15101) 23085s; run: log: (pid 3230) 55368s
</span></span><span class="line"><span class="cl">run: redis: (pid 15109) 23085s; run: log: (pid 2931) 55419s
</span></span><span class="line"><span class="cl">run: redis-exporter: (pid 15113) 23085s; run: log: (pid 3290) 55364s
</span></span><span class="line"><span class="cl">run: sidekiq: (pid 17029) 22450s; run: log: (pid 3131) 55380s
</span></span><span class="line"><span class="cl">run: unicorn: (pid 17001) 22460s; run: log: (pid 3100) 55386s
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="2-启动关闭重启" class="headerLink">
    <a href="#2-%e5%90%af%e5%8a%a8%e5%85%b3%e9%97%ad%e9%87%8d%e5%90%af" class="header-mark"></a>0.2.4.2 2. 启动、关闭、重启</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 启动Gitlab所有组件
</span></span><span class="line"><span class="cl">sudo gitlab-ctl start
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 停止Gitlab所有组件
</span></span><span class="line"><span class="cl">sudo gitlab-ctl stop
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 重启Gitlab所有组件
</span></span><span class="line"><span class="cl">sudo gitlab-ctl restart
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 重启单个组件
</span></span><span class="line"><span class="cl">sudo gitlab-ctl restart sidekiq
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="3-控制台实时查看日志" class="headerLink">
    <a href="#3-%e6%8e%a7%e5%88%b6%e5%8f%b0%e5%ae%9e%e6%97%b6%e6%9f%a5%e7%9c%8b%e6%97%a5%e5%bf%97" class="header-mark"></a>0.2.4.3 3. 控制台实时查看日志</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 查看所有的logs; 按 Ctrl-C 退出
</span></span><span class="line"><span class="cl">sudo gitlab-ctl tail
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 拉取/var/log/gitlab下子目录的日志
</span></span><span class="line"><span class="cl">sudo gitlab-ctl tail gitlab-rails
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 拉取某个指定的日志文件
</span></span><span class="line"><span class="cl">sudo gitlab-ctl tail nginx/gitlab_error.log
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="gitlab-安装后优化" class="headerLink">
    <a href="#gitlab-%e5%ae%89%e8%a3%85%e5%90%8e%e4%bc%98%e5%8c%96" class="header-mark"></a>0.3 <strong>GitLab 安装后优化</strong></h3><h4 id="启用https" class="headerLink">
    <a href="#%e5%90%af%e7%94%a8https" class="header-mark"></a>0.3.1 启用HTTPS</h4><p>首先，你需要提供一个有可信任CA证书，默认情况下GitLab是没有启用HTTPS的，如果要启用HTTPS时，首先要修改<code>/etc/gitlab/gitlab.rb</code>中的<code>external_url</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 修改为https
</span></span><span class="line"><span class="cl">external_url &#34;https://git.ultraera.org&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 设置默认将http重定向到https
</span></span><span class="line"><span class="cl">nginx[&#39;redirect_http_to_https&#39;] = true
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你暂时没有https证书，那么你可以临时自己颁发一个证书，注意这个证书是不受信任的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mkdir -p /etc/nginx/ssl/
</span></span><span class="line"><span class="cl">cd /etc/nginx/ssl/
</span></span><span class="line"><span class="cl">sudo openssl req -newkey rsa:2048 -x509 -nodes -days 3560 -out gitlab.crt -keyout gitlab.key
</span></span><span class="line"><span class="cl">sudo chmod o-r gitlab.key
</span></span><span class="line"><span class="cl">sudo mv gitlab.key gitlab.crt /etc/ssl/
</span></span></code></pre></td></tr></table>
</div>
</div><p>另外，还需要在gitlab-shell中的config.yml中将self_signed_cert 修改为启用:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">self_signed_cert = true
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="设置延迟启动" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae%e5%bb%b6%e8%bf%9f%e5%90%af%e5%8a%a8" class="header-mark"></a>0.3.2 设置延迟启动</h4><p>为保证服务质量，我们可以设置让omnibus-gitlab的服务(Nginx, Redis, Unicorn等) 在指定的文件系统挂载成功后再启动，在<code>/etc/gitlab/gitlab.rb</code> 文件中添加如下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 等待/var/opt/gitlab 先被挂载
</span></span><span class="line"><span class="cl">high_availability[&#39;mountpoint&#39;] = &#39;/var/opt/gitlab&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意在修改配置之后，要使用重新reconfigure配置</p>
</blockquote>
<h4 id="backups-备份还原" class="headerLink">
    <a href="#backups-%e5%a4%87%e4%bb%bd%e8%bf%98%e5%8e%9f" class="header-mark"></a>0.3.3 Backups 备份还原</h4><h5 id="备份" class="headerLink">
    <a href="#%e5%a4%87%e4%bb%bd" class="header-mark"></a>0.3.3.1 备份</h5><p>Gitlab的配置也非常简单,使用一条命令即可创建完整的Gitlab备份:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gitlab-rake gitlab:backup:create
</span></span></code></pre></td></tr></table>
</div>
</div><p>该命令会在<code>/var/opt/gitlab/backups</code>目录下创建一个名称类似为<code>1491989249_2017_04_12_gitlab_backup.tar</code>的压缩包, 这个压缩包就是Gitlab整个的完整部分，其中开头的<code>1491989249_2017_04_12</code>是备份创建的日期，这也是我们等下恢复是要用的字段。</p>
<h5 id="修改默认备份路径" class="headerLink">
    <a href="#%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4%e5%a4%87%e4%bb%bd%e8%b7%af%e5%be%84" class="header-mark"></a>0.3.3.2 修改默认备份路径</h5><p>如果你像我一样，是使用yum安装的，那么GitLab默认的备份目录应该在<code>/var/opt/gitlab/backups</code>，我建议将备份目录修改为其他位置，并添加定时自动备份脚本，可以通过修改<code>/etc/gitlab/gitlab.rb</code>来修改默认位置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gitlab_rails[&#39;backup_path&#39;] = &#39;/mnt/backups&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="使用crontab-添加自动备份" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8crontab-%e6%b7%bb%e5%8a%a0%e8%87%aa%e5%8a%a8%e5%a4%87%e4%bb%bd" class="header-mark"></a>0.3.3.3 使用crontab 添加自动备份</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 每天凌晨00:00 自动备份
</span></span><span class="line"><span class="cl">00 00 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="备份恢复" class="headerLink">
    <a href="#%e5%a4%87%e4%bb%bd%e6%81%a2%e5%a4%8d" class="header-mark"></a>0.3.3.4 备份恢复</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 停止相关数据连接服务
</span></span><span class="line"><span class="cl">gitlab-ctl stop unicorn
</span></span><span class="line"><span class="cl">gitlab-ctl stop sidekiq
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 从1491989249_2017_04_12编号备份中恢复
</span></span><span class="line"><span class="cl">gitlab-rake gitlab:backup:restore BACKUP=1491989249_2017_04_12
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 启动Gitlab
</span></span><span class="line"><span class="cl">sudo gitlab-ctl start unicorn
</span></span><span class="line"><span class="cl">sudo gitlab-ctl start sidekiq
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="gitlab-迁移" class="headerLink">
    <a href="#gitlab-%e8%bf%81%e7%a7%bb" class="header-mark"></a>0.4 <strong>GitLab 迁移</strong></h3><p>只需将原服务器<code>/var/opt/gitlab/backups</code>目录下的备份文件拷贝到新服务器上的<code>/var/opt/gitlab/backups</code>上即可(如果你没修改过默认备份目录的话)， 但是需要注意的是新服务器上的Gitlab的版本必须与创建备份时的Gitlab版本号相同， 比如新服务器安装的是最新的9.0.5版本的Gitlab, 那么迁移之前，最好将老服务器的Gitlab 升级为9.0.5在进行备份。</p>
<p>/Users/Alex/Documents/Hexo/source/_posts/</p>
]]></description></item><item><title>Check You App readyOnAppleSilicon</title><link>https://samzong.me/check-you-favorites-app-is-ready-apple-silicon/</link><pubDate>Tue, 24 Nov 2020 00:32:13 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/check-you-favorites-app-is-ready-apple-silicon/</guid><description><![CDATA[<h2 id="1-httpsisapplesiliconreadycom" class="headerLink">
    <a href="#1-httpsisapplesiliconreadycom" class="header-mark"></a>1. 1. <a href="https://isapplesiliconready.com/" target="_blank" rel="noopener noreferrer">https://isapplesiliconready.com/</a></h2><p><a class="lightgallery" href="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-142803.png" title="image-20201124222803150" data-thumbnail="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-142803.png">
        
    </a></p>
<h4 id="if-you-have-any-apps-want-and-to-here-please-click-request-an-app--or-use-this-link" class="headerLink">
    <a href="#if-you-have-any-apps-want-and-to-here-please-click-request-an-app--or-use-this-link" class="header-mark"></a>1.0.1 If you have any apps want and to here. Please click <code>REQUEST AN APP</code>  or use this link：</h4><blockquote>
<p><a href="https://isapplesiliconready.com/request/" target="_blank" rel="noopener noreferrer">https://isapplesiliconready.com/request/</a></p>
</blockquote>
<hr>
<h2 id="2-httpsdoesitarmcom" class="headerLink">
    <a href="#2-httpsdoesitarmcom" class="header-mark"></a>2. 2. <a href="https://doesitarm.com/" target="_blank" rel="noopener noreferrer">https://doesitarm.com/</a></h2><p><a class="lightgallery" href="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-143231.png" title="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-143231.png" data-thumbnail="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-143231.png">
        
    </a></p>
<h4 id="if-you-want-watching-any-apps-change-input--you-email-at--tell-me-with-this-changes" class="headerLink">
    <a href="#if-you-want-watching-any-apps-change-input--you-email-at--tell-me-with-this-changes" class="header-mark"></a>2.0.2 If you want watching any apps change? Input  you email at  <code>Tell me with this changes</code></h4><p><a class="lightgallery" href="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-143450.png" title="image-20201124223449695" data-thumbnail="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/ipic/2020-11-24-143450.png">
        
    </a></p>
]]></description></item><item><title>Awesome Hexo Plugin</title><link>https://samzong.me/awesome-hexo-plugins/</link><pubDate>Sun, 27 Mar 2022 21:45:17 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/awesome-hexo-plugins/</guid><description><![CDATA[<p>About my blog use hexo plugin</p>
<h2 id="hexo-tag-youtube-responsive" class="headerLink">
    <a href="#hexo-tag-youtube-responsive" class="header-mark"></a>1. hexo-tag-youtube-responsive</h2><p><a href="https://github.com/quocvu/hexo-tag-youtube-responsive" target="_blank" rel="noopener noreferrer">hexo-tag-youtube-responsive</a> is Hexo tag plugin to embed a Youtube video that auto resizes with your responsive layout</p>
<h3 id="install" class="headerLink">
    <a href="#install" class="header-mark"></a>1.1 Install</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install hexo-tag-youtube-responsive --save
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="embed-a-video" class="headerLink">
    <a href="#embed-a-video" class="header-mark"></a>1.2 Embed a video</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  {% youtuber video VIDEO_ID %}
</span></span><span class="line"><span class="cl">  {% endyoutuber %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>For example</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  {% youtuber video I07XMi7MHd4 %}
</span></span><span class="line"><span class="cl">  {% endyoutuber %}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="embed-a-playlist" class="headerLink">
    <a href="#embed-a-playlist" class="header-mark"></a>1.3 Embed a playlist</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  {% youtuber playlist PLAYLIST_ID %}
</span></span><span class="line"><span class="cl">  {% endyoutuber %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>For example</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  {% youtuber playlist PLC77007E23FF423C6 %}
</span></span><span class="line"><span class="cl">  {% endyoutuber %}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that you need to prepend the playlist ID with the letters PL as shown above</p>
<h3 id="demo" class="headerLink">
    <a href="#demo" class="header-mark"></a>1.4 Demo</h3><p>{% youtuber video I07XMi7MHd4 %}
{% endyoutuber %}</p>
<h2 id="hexo-hide-posts" class="headerLink">
    <a href="#hexo-hide-posts" class="header-mark"></a>2. hexo-hide-posts</h2><p><a href="https://github.com/prinsss/hexo-hide-posts" target="_blank" rel="noopener noreferrer">hexo-hide-posts</a> is A plugin to hide specific posts from your Hexo blog and make them only accessible by links</p>
<h3 id="installation" class="headerLink">
    <a href="#installation" class="header-mark"></a>2.1 Installation</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install hexo-hide-posts --save
</span></span></code></pre></td></tr></table>
</div>
</div><p>Usage</p>
<p>Add <code>hidden: true</code> to the <a href="https://hexo.io/docs/front-matter" target="_blank" rel="noopener noreferrer">front-matter</a> of posts which you want to hide.</p>
<p>e.g. Edit <code>source/_posts/lorem-ipsum.md</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">title: &#39;Lorem Ipsum&#39;
</span></span><span class="line"><span class="cl">date: &#39;2019/8/10 11:45:14&#39;
</span></span><span class="line"><span class="cl">hidden: true
</span></span><span class="line"><span class="cl">---
</span></span><span class="line"><span class="cl">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
</span></span></code></pre></td></tr></table>
</div>
</div><p>This post will not be shown anywhere, but you can still access it by <code>https://hexo.test/lorem-ipsum/</code>. (If you want to completely prevent a post from rendering, just set it as a <a href="https://hexo.io/docs/writing.html#Drafts" target="_blank" rel="noopener noreferrer">draft</a>.)</p>
<p>To get a list of hidden posts, you can run <code>hexo hidden:list</code> from command line.</p>
<p>For developers, <code>all_posts</code> and <code>hidden_posts</code> added to <a href="https://hexo.io/api/locals" target="_blank" rel="noopener noreferrer">Local Variables</a> may be useful.</p>
<h3 id="config" class="headerLink">
    <a href="#config" class="header-mark"></a>2.2 Config</h3><p>In your site&rsquo;s <code>_config.yml</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># hexo-hide-posts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">hide_posts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">enable</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Change the filter name to fit your need</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">filter</span><span class="p">:</span><span class="w"> </span><span class="l">hidden</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Generators which you want to expose all posts (include hidden ones) to.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Common generators: index, tag, category, archive, sitemap, feed, etc.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">public_generators</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Add &#34;noindex&#34; meta tag to prevent hidden posts from being indexed by search engines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">noindex</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hexo-generator-restful" class="headerLink">
    <a href="#hexo-generator-restful" class="header-mark"></a>3. hexo-generator-restful</h2><p><a href="https://github.com/yscoder/hexo-generator-restful" target="_blank" rel="noopener noreferrer">hexo-generator-restful</a> is generate restful json data for Hexo plugins.</p>
<h3 id="install-1" class="headerLink">
    <a href="#install-1" class="header-mark"></a>3.1 Install</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install hexo-generator-restful --save
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="config-1" class="headerLink">
    <a href="#config-1" class="header-mark"></a>3.2 Config</h3><p>以下为默认配置，属性值为 <code>false</code> 表示不生成。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">restful</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># site 可配置为数组选择性生成某些属性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># site: [&#39;title&#39;, &#39;subtitle&#39;, &#39;description&#39;, &#39;author&#39;, &#39;since&#39;, email&#39;, &#39;favicon&#39;, &#39;avatar&#39;]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">site</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">        </span><span class="c"># hexo.config mix theme.config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">posts_size</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">    </span><span class="c"># 文章列表分页，0 表示不分页</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">posts_props</span><span class="p">:</span><span class="w">      </span><span class="c"># 文章列表项的需要生成的属性</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">date</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">updated</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">comments</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">excerpt</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cover</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">      </span><span class="c"># 封面图，取文章第一张图片</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">keywords</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">categories</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">categories</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">         </span><span class="c"># 分类数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use_category_slug</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c"># Use slug for filename of category data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">               </span><span class="c"># 标签数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">use_tag_slug</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">      </span><span class="c"># Use slug for filename of tag data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">post</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">               </span><span class="c"># 文章数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pages</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">             </span><span class="c"># 额外的 Hexo 页面数据, 如 About</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="get-hexo-config" class="headerLink">
    <a href="#get-hexo-config" class="header-mark"></a>3.3 Get Hexo Config</h3><p>获取所有 Hexo 配置（站点配置和主题配置）。</p>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /api/site.json
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Response</p>
</blockquote>
<p><a href="https://samzong.me/api/site.json" target="_blank" rel="noopener noreferrer">/api/site.json</a></p>
<h3 id="get-posts" class="headerLink">
    <a href="#get-posts" class="header-mark"></a>3.4 Get Posts</h3><p>如果配置 <code>posts_size: 0</code> 则不分页，以下请求会获取全部文章。</p>
<blockquote>
<p>Request</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /api/posts.json
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Response</p>
</blockquote>
<p>示例为分页配置下的数据，会包含分页属性 <code>total</code>、<code>pageSize</code>、<code>pageCount</code>，不分页的数据不包含这三项。</p>
<p><a href="https://samzong.me/api/posts.json" target="_blank" rel="noopener noreferrer">/api/posts.json</a></p>
]]></description></item><item><title>Javascript Tips</title><link>https://samzong.me/javascript-tips/</link><pubDate>Mon, 28 Mar 2022 19:09:44 +0000</pubDate><author><name>samzong.lu</name></author><guid>https://samzong.me/javascript-tips/</guid><description><![CDATA[<ul>
<li>alert 弹窗提醒一段文本</li>
<li>a = prompt(&ldquo;input desc&rdquo;)  接收输入，并把内容赋值给a</li>
<li>confirm 弹出确认窗口，让用户确认，这是给出的结果就是 yes/no</li>
<li>console.log(&lsquo;AAS&rsquo;) 输出一段日志</li>
<li>let a = 1  声明 变量 a=1， number 类型</li>
<li>const ABB = 123 声明一个常量 ABB, 不可以重新赋值</li>
<li>undefined 和 null 都是空的意思，但是这两个又不相同</li>
<li>a ?? &ldquo;hello&rdquo; ;  <code>??</code> 叫做 空值运算符，指当a 未被赋值时，将hello赋值给a，如果a已经被赋值了，则不变 ; a 需要被声明，在JavaScript中 声明 和 赋值 是两件事情</li>
</ul>
<h3 id="js的数据类型" class="headerLink">
    <a href="#js%e7%9a%84%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" class="header-mark"></a>0.1 js的数据类型</h3><ul>
<li>js 是弱类型语言， 1 == &lsquo;1&rsquo; =&gt; true; 但是  1 === &lsquo;1&rsquo; =&gt; false；   6 / &ldquo;2&rdquo; =&gt; 3, typeof is number</li>
</ul>
<h3 id="支持判断" class="headerLink">
    <a href="#%e6%94%af%e6%8c%81%e5%88%a4%e6%96%ad" class="header-mark"></a>0.2 支持判断</h3><p>if  /elif else</p>
<h3 id="支持的循环方式" class="headerLink">
    <a href="#%e6%94%af%e6%8c%81%e7%9a%84%e5%be%aa%e7%8e%af%e6%96%b9%e5%bc%8f" class="header-mark"></a>0.3 支持的循环方式</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">do</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Hello
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="nx">whIle</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="nx">a</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// Hello
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">a</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">switch</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="nx">a</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//Hello
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">alert</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="函数声明" class="headerLink">
    <a href="#%e5%87%bd%e6%95%b0%e5%a3%b0%e6%98%8e" class="header-mark"></a>0.4 函数声明</h3><p>必须要使用 function</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">showMessage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Hello Javascript !&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>函数中变量的作用域：这部分与Python和C一致， 分别为 内部变量 和 外部变量； 关系存在在继承的概念</li>
<li>函数的参数， 入参定义在 () 内，当函数声明了入参后，在对应调用时，就需要传递符合条件的参数
<ul>
<li>支持函数的默认值的设定</li>
</ul>
</li>
<li>函数的返回值，同样使用 return 作为返回值处理</li>
<li>函数 function is  an action, 所以函数的命名通常是 使用动词； javascipt 的命名方式 官方建议为 驼峰的方式</li>
</ul>
<blockquote>
<p>函数的特殊部分</p>
</blockquote>
<ul>
<li>函数表达式   let  sayHi = function () { alert(&lsquo;Hi&rsquo;)}  利用声明 <code>let</code> 创建了一个函数，并把他赋值给了变量 sayHi</li>
<li>回调函数</li>
</ul>
<hr>
<p>[ ] 今天学习的内容到此 回调函数  <a href="https://zh.javascript.info/function-expressions" target="_blank" rel="noopener noreferrer">https://zh.javascript.info/function-expressions</a></p>
<h3 id="严格模式" class="headerLink">
    <a href="#%e4%b8%a5%e6%a0%bc%e6%a8%a1%e5%bc%8f" class="header-mark"></a>0.5 严格模式</h3><ul>
<li>三连表达式     cond ? resultA : resultB   //  1 &gt; 0 ? alert(true) : alert(false)   cond 为真展示resultA, 反之展示resultB</li>
<li>空值运算符     a ?? b       =&gt;  a ?? b 的结果是 a，除非 a 为 null/undefined，这时结果是 b</li>
</ul>
<h3 id="开发行为规范" class="headerLink">
    <a href="#%e5%bc%80%e5%8f%91%e8%a1%8c%e4%b8%ba%e8%a7%84%e8%8c%83" class="header-mark"></a>0.6 开发行为规范</h3><blockquote>
<p>BDD</p>
</blockquote>
<p>在 BDD 中，规范先行，实现在后。最后我们同时拥有了规范和代码。</p>
<p>规范有三种使用方式：</p>
<ul>
<li>作为 测试 —— 保证代码正确工作。</li>
<li>作为 文档 —— describe 和 it 的标题告诉我们函数做了什么。</li>
<li>作为 案例 —— 测试实际工作的例子展示了一个函数可以被怎样使用。</li>
</ul>
<p>有了规范，我们可以安全地改进、修改甚至重写函数，并确保它仍然正确地工作。</p>
<p>这在一个函数会被用在多个地方的大型项目中尤其重要。当我们改变这样一个函数时，没有办法手动检查每个使用它们的地方是否仍旧正确。</p>
<p>如果没有测试，一般有两个办法：</p>
<ul>
<li>展示修改，无论修改了什么。然后我们的用户遇到了 bug，这应该是我们没有手动完成某些检查。</li>
<li>如果对出错的惩罚比较严重，并且没有测试，那么大家会很害怕修改这样的函数，然后这些代码就会越来越陈旧，没有人会想接触它。这很不利于发展。自动化测试则有助于避免这样的问题！</li>
</ul>
<p>如果这个项目被测试代码覆盖了，就不会出现这种问题。在任何修改之后，我们都可以运行测试，并在几秒钟内看到大量的检查。</p>
<p>另外，一个经过良好测试的代码通常都有更好的架构。</p>
<p>当然，这是因为覆盖了自动化测试的代码更容易修改和改进。但还有另一个原因。</p>
<p>要编写测试，代码的组织方式应确保每个函数都有一个清晰描述的任务、定义良好的输入和输出。这意味着从一开始就有一个好的架构。</p>
<p>在实际开发中有时候可能并不容易，有时很难在写实际代码之前编写规范，因为还不清楚它应该如何表现。但一般来说，编写测试使得开发更快更稳定。</p>
<h3 id="object-对象的基础知识" class="headerLink">
    <a href="#object-%e5%af%b9%e8%b1%a1%e7%9a%84%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86" class="header-mark"></a>0.7 Object 对象的基础知识</h3><p>在js中 对象可以说非常常见的用到，所以相对来讲 定义一个对象也是非常的方便</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Object</span><span class="p">();</span>   <span class="nx">构造函数</span> <span class="nx">的语法</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{}</span>     <span class="nx">构造</span> <span class="s2">&#34;字面量的语法&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在对象中，包含的是 一个个属性， 这些属性又以 键值对 的形式出现在 {} 中</p>
<ul>
<li>定义一个有属性的对象  let user = {name:&lsquo;alex&rsquo;, age: 18}
<ul>
<li>增加属性 user.city = &lsquo;Shanghai&rsquo;  =&gt;   user[&rsquo;love package&rsquo;] = &lsquo;Apple&rsquo;</li>
<li>删除一个属性 delete user.age</li>
</ul>
</li>
<li>计算属性  ： 当创建一个对象时，我可以在对象字面量中使用方括号，这叫做计算属性；计算属性的含义是 [fruit] 是从 变量 fruit 中获取的</li>
<li>判断一个 属性是否在对象中    &ldquo;key&rdquo; in Object  ，这里的 key 需要时一个值，否则会被认为一个变量</li>
<li>遍历一个对象采用的方式是  for  (let key in Object) : 这里的做法是 声明[let] 变量key ，并且把Object 中的每一个key的值遍历赋予key</li>
<li>取出对象中一个key的值可以采用的方式 Object[key] 或者 Object.key；但是Object.key 会出现对 <code>多词属性</code>
<ul>
<li>单词属性   name , age</li>
<li>多词属性   &ldquo;like birds&rdquo; ， 这时使用 Object.key 的方式就不可行了</li>
</ul>
</li>
</ul>
<blockquote>
<p>JavaScirpt 中的垃圾回收机制</p>
</blockquote>
<p>当一个对象中的属性被建立后，如果这些属性被多个对象引用时，其他一个对象被重新赋值了，那么这些属性还是可以被访问的；但是当所有对象被重置后，这些无法被访问的属性 就变得不可以，这也会占用我们内存，而这类也会被 回收。</p>
<h4 id="对象的方法-this" class="headerLink">
    <a href="#%e5%af%b9%e8%b1%a1%e7%9a%84%e6%96%b9%e6%b3%95-this" class="header-mark"></a>0.7.1 对象的方法 <code>this</code></h4><p>this 是用来标识当前对象的，这个对象可以是个函数 ; 为了访问该对象，方法中可以使用 this 关键字。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">this 设计到编程的一种形式 ： **面向对象编程** OOP ; 当我们在代码中用对象表示实体时，就是所谓的 面向对象编程，简称为 “OOP”。
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>this 的优势 ： 在 JavaScript 中，this 关键字与其他大多数编程语言中的不同。JavaScript 中的 this 可以用于任何函数，即使它不是对象的方法。</li>
<li>this 的值是在代码运行时计算出来的，它取决于代码上下文。 不用函数调用this时的到结果不一致的</li>
<li>箭头函数   function sum (a,b) =&gt; a*b ； 这类箭头函数是没有自己的 this，如果在箭头函数中使用 this，会把this当成一个真正的对象去处理，这不好</li>
</ul>
<p>在 JavaScript 中，this 是“自由”的，它的值是在调用时计算出来的，它的值并不取决于方法声明的位置，而是取决于在“点符号前”的是什么对象。在运行时对 this 求值的这个概念既有优点也有缺点。一方面，函数可以被重用于不同的对象。另一方面，更大的灵活性造成了更大的出错的可能。这里我们的立场并不是要评判编程语言的这个设计是好是坏。而是要了解怎样使用它，如何趋利避害。</p>
<h4 id="对象的-构造和操作符-new" class="headerLink">
    <a href="#%e5%af%b9%e8%b1%a1%e7%9a%84-%e6%9e%84%e9%80%a0%e5%92%8c%e6%93%8d%e4%bd%9c%e7%ac%a6-new" class="header-mark"></a>0.7.2 对象的 构造和操作符 <code>new</code></h4><ul>
<li>构造函数在技术上，也是属于常规函数，不过有2个约定：
<ul>
<li>命名以大写字母开头， 这是一个共同的约定，用来标明一个函数将被使用 <code>new</code> 来运行</li>
<li>他们只能有 <code>new</code> 操作符来执行</li>
</ul>
</li>
</ul>
<p>构造器不能被再次调用，因为他保存在任何地址，知识被创建后 后续 调用使用；所以 构造函数的封装一个 单一对象的代码，而无需将来重用</p>
<h4 id="javascript--可选链" class="headerLink">
    <a href="#javascript--%e5%8f%af%e9%80%89%e9%93%be" class="header-mark"></a>0.7.3 JavaScript  <code>?.</code> 可选链</h4><p>可选链 ?. 语法有三种形式：</p>
<ul>
<li>obj?.prop —— 如果 obj 存在则返回 obj.prop，否则返回 undefined。</li>
<li>obj?.[prop] —— 如果 obj 存在则返回 obj[prop]，否则返回 undefined。</li>
<li>obj.method?.() —— 如果 obj.method 存在则调用 obj.method()，否则返回 undefined。</li>
</ul>
<p>正如我们所看到的，这些语法形式用起来都很简单直接。?. 检查左边部分是否为 null/undefined，如果不是则继续运算。 ?. 链使我们能够安全地访问嵌套属性。 但是，我们应该谨慎地使用 ?.，仅在当左边部分不存在也没问题的情况下使用为宜。以保证在代码中有编程上的错误出现时，也不会对我们隐藏。</p>
<h3 id="symbol-类型" class="headerLink">
    <a href="#symbol-%e7%b1%bb%e5%9e%8b" class="header-mark"></a>0.8 Symbol  类型</h3><p>根据规范，Obj的属性键 只能是 字符串类型或者 Symbol 类型；不能是Number，也不能是Boolean。</p>
<p>Symbol 值 表示 唯一的标识符，现在可以通过 Symbol() 来创建这种类型的值；Symbol的特性是唯一，即使我们创建了相同描述的Symbol，他们的值不相同的；比如以下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">id1</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">id2</span> <span class="o">=</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">id1</span> <span class="o">==</span> <span class="nx">id2</span>   <span class="c1">// 结果是 false
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Symbol 的另外一个特性是不会被自动转化为字符串；其实在javascript中大多数的数值都是可以进行字符串的 <code>隐式转换</code> ，但是使用 Symbol() 定义的一个字符，是不能够直接转化为 字符串的， 可以使用 <code>Symbol('id').toString()</code> 来输出字符串。</p>
<h3 id="原始类型的方法" class="headerLink">
    <a href="#%e5%8e%9f%e5%a7%8b%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%96%b9%e6%b3%95" class="header-mark"></a>0.9 原始类型的方法</h3><p>在 JavaScript 中有 7 种原始类型：string，number，bigint，boolean，symbol，null 和 undefined。</p>
<ul>
<li>字符串处理方法</li>
<li>Number的处理方法</li>
</ul>
<h3 id="数组方法的备忘笔记" class="headerLink">
    <a href="#%e6%95%b0%e7%bb%84%e6%96%b9%e6%b3%95%e7%9a%84%e5%a4%87%e5%bf%98%e7%ac%94%e8%ae%b0" class="header-mark"></a>0.10 数组方法的备忘笔记</h3><p>数组方法备忘单：</p>
<ul>
<li>添加/删除元素：
<ul>
<li><strong>push(&hellip;items) —— 向尾端添加元素</strong></li>
<li><strong>pop() —— 从尾端提取一个元素</strong></li>
<li><strong>shift() —— 从首端提取一个元素</strong></li>
<li><strong>unshift(&hellip;items) —— 向首端添加元素</strong></li>
<li>splice(pos, deleteCount, &hellip;items) 从 pos 开始删除 deleteCount 个元素，并插入 items。 <code>用来控制数组的增删改查</code></li>
<li>slice(start, end) —— 创建一个新数组，将从索引 start 到索引 end（但不包括 end）的元素复制进去 <code>取出部分数组的内容产生新数组</code></li>
<li>concat(&hellip;items) —— 返回一个新数组：复制当前数组的所有元素，并向其中添加 items。如果 items 中的任意一项是一个数组，那么就取其元素。 <code>拼接多个数组，产生一个新的数组</code></li>
</ul>
</li>
</ul>
<p>*搜索元素：</p>
<ul>
<li>indexOf/lastIndexOf(item, pos) —— 从索引 pos 开始搜索 item，搜索到则返回该项的索引，否则返回 -1。</li>
<li>includes(value) —— 如果数组有 value，则返回 true，否则返回 false。</li>
<li>find/filter(func) —— 通过 func 过滤元素，返回使 func 返回 true 的第一个值/所有值。</li>
<li>findIndex 和 find 类似，但返回索引而不是值。</li>
</ul>
<ul>
<li>遍历元素：
<ul>
<li>forEach(func) —— 对每个元素都调用 func，不返回任何内容。</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Orage&#39;</span><span class="p">,</span><span class="s1">&#39;Prism&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span> <span class="kd">let</span> <span class="nx">fruit</span> <span class="k">of</span> <span class="nx">fruits</span> <span class="p">)</span> <span class="p">{</span><span class="nx">alert</span><span class="p">(</span><span class="nx">fruit</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 遍历数组 使用 for .. of 不能获取到当前元素的索引，知识获取到元素的值；但是大多数情况下是够用的，而且这样些代码更短，质量会高一些
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">fruits</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span><span class="nx">alert</span><span class="p">(</span><span class="nx">fruits</span><span class="p">[</span><span class="nx">i</span><span class="p">])}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 这个方式就是标准的通过遍历元素的索引，然后通过索引获取到对应的数组元素的值
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>转换数组：
<ul>
<li>map(func) —— 根据对每个元素调用 func 的结果创建一个新数组。</li>
<li>sort(func) —— 对数组进行原位（in-place）排序，然后返回它。</li>
<li>reverse() —— 原位（in-place）反转数组，然后返回它。</li>
<li>split/join —— 将字符串转换为数组并返回。</li>
<li>reduce/reduceRight(func, initial) —— 通过对每个元素调用 func 计算数组上的单个值，并在调用之间传递中间结果。</li>
</ul>
</li>
<li>其他：
<ul>
<li>Array.isArray(arr) 检查 arr 是否是一个数组。</li>
</ul>
</li>
</ul>
<p>请注意，sort，reverse 和 splice 方法修改的是数组本身； 这些是最常用的方法，它们覆盖 99％ 的用例。但是还有其他几个：</p>
<ul>
<li>arr.some(fn)/arr.every(fn) 检查数组。</li>
</ul>
<p>与 map 类似，对数组的每个元素调用函数 fn。如果任何/所有结果为 true，则返回 true，否则返回 false。</p>
<p>这两个方法的行为类似于 || 和 &amp;&amp; 运算符：如果 fn 返回一个真值，arr.some() 立即返回 true 并停止迭代其余数组项；如果 fn 返回一个假值，arr.every() 立即返回 false 并停止对其余数组项的迭代。</p>
<p>我们可以使用 every 来比较数组：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">arraysEqual</span><span class="p">(</span><span class="nx">arr1</span><span class="p">,</span> <span class="nx">arr2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">arr1</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">arr2</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">arr1</span><span class="p">.</span><span class="nx">every</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">arr2</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">alert</span><span class="p">(</span> <span class="nx">arraysEqual</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]));</span> <span class="c1">// true
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>arr.fill(value, start, end) —— 从索引 start 到 end，用重复的 value 填充数组。</li>
<li>arr.copyWithin(target, start, end) —— 将从位置 start 到 end 的所有元素复制到 自身 的 target 位置（覆盖现有元素）。</li>
<li>arr.flat(depth)/arr.flatMap(fn) 从多维数组创建一个新的扁平数组。</li>
<li>Array.of(element0[, element1[, …[, elementN]]]) 基于可变数量的参数创建一个新的 Array 实例，而不需要考虑参数的数量或类型。</li>
</ul>
]]></description></item><item><title>Awsome Telegram Bot</title><link>https://samzong.me/awsome-telegram-bot/</link><pubDate>Sun, 10 Apr 2022 22:20:25 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/awsome-telegram-bot/</guid><description><![CDATA[<h2 id="关于电报群" class="headerLink">
    <a href="#%e5%85%b3%e4%ba%8e%e7%94%b5%e6%8a%a5%e7%be%a4" class="header-mark"></a>1. 关于电报群</h2><p>从2014年开始使用电报群，在这个不存在的通讯工具中，结识不少有趣的朋友，也发现了大量有价值的群组或BOT，可以很方便你的生活</p>
<blockquote>
<p>P.S. 不要过分关注那些黑产、广告和色情信息，它们虽然利用了这个工具，但是也只是其中一小部分</p>
</blockquote>
<h3 id="我在电报做的事情" class="headerLink">
    <a href="#%e6%88%91%e5%9c%a8%e7%94%b5%e6%8a%a5%e5%81%9a%e7%9a%84%e4%ba%8b%e6%83%85" class="header-mark"></a>1.1 我在电报做的事情</h3><ul>
<li>美剧、电影和图书，所以最新的资源基本在电报群出现了，远比各种关注微信公众号套娃的营销号好很多</li>
<li>技术群，感谢技术群里的各位大佬给的帮助，尤其感谢 Taiwan 的几个技术社群，会有人认真解答你的问题
<ul>
<li>Go/Php 各类开发群</li>
<li>开源软件的沟通群， 在这里你可以和开发者们进行沟通，并且提供你的建议，甚至讨论 PR</li>
</ul>
</li>
<li>各类BOT
<ul>
<li>Temp Mail 生成临时邮箱</li>
<li>资料查询</li>
<li>GitHub 助手</li>
<li>短连接</li>
<li>网站服务监控</li>
</ul>
</li>
<li>羊毛群/合租群/VPN群，这里不用详细说明</li>
</ul>
<h3 id="使用的一些技巧" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8%e7%9a%84%e4%b8%80%e4%ba%9b%e6%8a%80%e5%b7%a7" class="header-mark"></a>1.2 使用的一些技巧</h3><ul>
<li>你需要一个 !+86 的手机号，保障你与所有的网友的友好交流，可以考虑使用 G家Voice 买个美区号方便</li>
<li>DO NOT USE CHINESE ! 这会让你发现不一样的 Telegram</li>
</ul>
<h3 id="develop-in-telegram" class="headerLink">
    <a href="#develop-in-telegram" class="header-mark"></a>1.3 Develop in Telegram</h3><p><a class="lightgallery" href="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/7a0Bjv.png" title="7a0Bjv" data-thumbnail="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/7a0Bjv.png">
        
    </a></p>
<ul>
<li><a href="https://telegra.ph/" target="_blank" rel="noopener noreferrer">telegra.ph</a> 匿名博客， Writing is Sharing ~</li>
<li><a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener noreferrer">telegram.bot_api</a> 定制开发你的webhook</li>
</ul>
]]></description></item><item><title>Dockerfile Run at M1 processor build failed</title><link>https://samzong.me/docker-run-at-apple-silicon-m1/</link><pubDate>Sun, 17 Apr 2022 20:32:00 +0000</pubDate><author><name>samzong.lu</name></author><guid>https://samzong.me/docker-run-at-apple-silicon-m1/</guid><description><![CDATA[<h2 id="apple-m1-processor" class="headerLink">
    <a href="#apple-m1-processor" class="header-mark"></a>1. Apple M1 processor</h2><p>在使用了 Apple M1 的笔记本后，在 docker 使用遇到了一些问题，这里做些笔记记录下来</p>
<h2 id="pull-image-error" class="headerLink">
    <a href="#pull-image-error" class="header-mark"></a>2. pull image error</h2><blockquote>
<p>Error &ldquo;no matching manifest for linux/arm64/v8 in the manifest list entries&rdquo;</p>
</blockquote>
<p>在我尝试想要 pull 下来时，得到上面的一个错误；同样的问题，我在编写 Dockerfile 和 docker-compose.yml 都遇到这样的问题</p>
<h3 id="docker-composeyml" class="headerLink">
    <a href="#docker-composeyml" class="header-mark"></a>2.1 docker-compose.yml</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.9&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Database</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">db</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mysql-server:5.7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">db_data:/var/lib/mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">pass</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l">wp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="l">wp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">wp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">wpsite    </span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="解决思路" class="headerLink">
    <a href="#%e8%a7%a3%e5%86%b3%e6%80%9d%e8%b7%af" class="header-mark"></a>2.2 解决思路</h3><p>需要指定下 <code>plaform</code> ，当我运行在 Apple M1上，变更部分如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">services:
</span></span><span class="line"><span class="cl">  # Database
</span></span><span class="line"><span class="cl">  db:
</span></span><span class="line"><span class="cl">    platform: linux/x86_64  # set platform
</span></span><span class="line"><span class="cl">    image: mysql-server:5.7
</span></span><span class="line"><span class="cl">    ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果只是在 docker pull 时，增加指定参数即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull --plaform linux/x84_64 mysql-server:5.7
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>Hexo 增加admonition样式支持</title><link>https://samzong.me/hexo-admonition/</link><pubDate>Sat, 28 May 2022 22:27:18 +0000</pubDate><author><name>Samzong</name></author><guid>https://samzong.me/hexo-admonition/</guid><description><![CDATA[<h2 id="背景" class="headerLink">
    <a href="#%e8%83%8c%e6%99%af" class="header-mark"></a>1. 背景</h2><p>除了在 Hexo 维护个人博客之外，目前经常用到的 2 个文档工具： 语雀和 Mkdocs 都是支持 admonition样式，所以也在考虑如何给 Hexo 博客文章也增加这样的能力。</p>
<p>保证写作习惯的一致性，好在有人开发出对应的插件，感谢.</p>
<ul>
<li><a href="https://github.com/lxl80/hexo-admonition" target="_blank" rel="noopener noreferrer">https://github.com/lxl80/hexo-admonition</a></li>
</ul>
<h2 id="安装方式" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e6%96%b9%e5%bc%8f" class="header-mark"></a>2. 安装方式</h2><p>简单通过 2 个步骤即可，</p>
<h3 id="安装插件" class="headerLink">
    <a href="#%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b6" class="header-mark"></a>2.1 安装插件</h3><p>采用 npm 安装，如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install hexo-admonition --save
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="样式配置" class="headerLink">
    <a href="#%e6%a0%b7%e5%bc%8f%e9%85%8d%e7%bd%ae" class="header-mark"></a>2.2 样式配置</h3><p>你的 hexo 可能会使用不同主题，所以需要自己增加样式，将如下样式放入 hexo 主题的自定义样式文件中（如：<code>ext.css</code>），并按自己喜好修改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">.</span><span class="nc">admonition</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">margin</span><span class="p">:</span> <span class="mf">1.5625</span><span class="kt">em</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mf">.6</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">.64</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">page-break-inside</span><span class="p">:</span> <span class="kc">avoid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-left</span><span class="p">:</span> <span class="mf">.3</span><span class="kt">rem</span> <span class="kc">solid</span> <span class="mh">#42b983</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-radius</span><span class="p">:</span> <span class="mf">.3</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mf">0.1</span><span class="kt">rem</span> <span class="mf">0.4</span><span class="kt">rem</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.05</span><span class="p">),</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">0.05</span><span class="kt">rem</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#fafafa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nt">p</span><span class="p">.</span><span class="nc">admonition-title</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">margin</span><span class="p">:</span> <span class="mf">-.6</span><span class="kt">rem</span> <span class="mf">-.6</span><span class="kt">rem</span> <span class="mf">.8</span><span class="kt">em</span> <span class="mf">-.6</span><span class="kt">rem</span> <span class="cp">!important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mf">.4</span><span class="kt">rem</span> <span class="mf">.6</span><span class="kt">rem</span> <span class="mf">.4</span><span class="kt">rem</span> <span class="mf">2.5</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">font-weight</span><span class="p">:</span> <span class="mi">700</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span><span class="nb">rgba</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mf">.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">top</span><span class="p">:</span> <span class="mf">.9</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">width</span><span class="p">:</span> <span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">height</span><span class="p">:</span> <span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#42b983</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">content</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">info</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="o">,</span> <span class="p">.</span><span class="nc">todo</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mf">.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">warning</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="o">,</span> <span class="p">.</span><span class="nc">attention</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="o">,</span> <span class="p">.</span><span class="nc">caution</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">failure</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="o">,</span> <span class="p">.</span><span class="nc">missing</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="o">,</span> <span class="p">.</span><span class="nc">fail</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="o">,</span> <span class="p">.</span><span class="nc">error</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">82</span><span class="p">,</span><span class="mi">82</span><span class="p">,</span><span class="mf">.1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">info</span><span class="o">,</span> <span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">todo</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-color</span><span class="p">:</span> <span class="mh">#00b8d4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">warning</span><span class="o">,</span> <span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">attention</span><span class="o">,</span> <span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">caution</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-color</span><span class="p">:</span> <span class="mh">#ff9100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">failure</span><span class="o">,</span> <span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">missing</span><span class="o">,</span> <span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">fail</span><span class="o">,</span> <span class="p">.</span><span class="nc">admonition</span><span class="p">.</span><span class="nc">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-color</span><span class="p">:</span> <span class="mh">#ff5252</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">info</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span> <span class="p">.</span><span class="nc">todo</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#00b8d4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">success</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#00c853</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">warning</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span> <span class="p">.</span><span class="nc">attention</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span> <span class="p">.</span><span class="nc">caution</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ff9100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">failure</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span><span class="p">.</span><span class="nc">missing</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span><span class="p">.</span><span class="nc">fail</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span><span class="p">.</span><span class="nc">error</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">admonition-title</span><span class="p">::</span><span class="nd">before</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ff5252</span><span class="p">;;</span>
</span></span><span class="line"><span class="cl">  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">admonition</span><span class="o">&gt;</span><span class="p">:</span><span class="nd">last-child</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">0</span> <span class="cp">!important</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用说明" class="headerLink">
    <a href="#%e4%bd%bf%e7%94%a8%e8%af%b4%e6%98%8e" class="header-mark"></a>3. 使用说明</h2><p>Hexo-admonition 遵循一种简单的语法：每个块都以 <code>!!!</code> 开头，然后是代表提示类型的关键字（<code>type</code>）及标题（<code>title</code>）。例如:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">!!! note Hexo-admonition 插件使用示例
</span></span><span class="line"><span class="cl">    这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 note，并设置了自定义标题。
</span></span><span class="line"><span class="cl">    提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 Hexo 渲染前，将被转换成如下内容：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;admonition note &#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;admonition-title&#34;</span><span class="p">&gt;</span>Hexo-admonition 插件使用示例<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 note，并设置了自定义标题。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>最终呈现效果如下：</p>
<p>!!! note Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 note，并设置了自定义标题。
提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。</p>
<h3 id="支持的类型" class="headerLink">
    <a href="#%e6%94%af%e6%8c%81%e7%9a%84%e7%b1%bb%e5%9e%8b" class="header-mark"></a>3.1 支持的类型</h3><p>提示类型 <code>type</code> 将用作 CSS 类名称，暂支持如下类型：</p>
<ul>
<li><code>note</code></li>
<li><code>info, todo</code></li>
<li><code>warning, attention, caution</code></li>
<li><code>error, failure, missing, fail</code></li>
</ul>
<h3 id="设置隐藏标题" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae%e9%9a%90%e8%97%8f%e6%a0%87%e9%a2%98" class="header-mark"></a>3.2 设置/隐藏标题</h3><p>标题 <code>title</code> 是可选的，当未设置时，将以 <code>type</code> 作为默认值:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">!!! warning
</span></span><span class="line"><span class="cl">    这是一条采用默认标题的警告信息。
</span></span></code></pre></td></tr></table>
</div>
</div><p>效果如下：</p>
<p>!!! warning
这是一条采用默认标题的警告信息。</p>
<p>如果不想显示标题，可以将 <code>title</code> 设置为 <code>&quot;&quot;</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">!!! Warning &#34;&#34;
</span></span><span class="line"><span class="cl">    这是一条不带标题的警告信息。
</span></span></code></pre></td></tr></table>
</div>
</div><p>效果如下：</p>
<p>!!! Warning &quot;&quot;
这是一条不带标题的警告信息。</p>
<h2 id="卡片演示" class="headerLink">
    <a href="#%e5%8d%a1%e7%89%87%e6%bc%94%e7%a4%ba" class="header-mark"></a>4. 卡片演示</h2><blockquote>
<p>主要四种类型：info, warning, error, note</p>
</blockquote>
<p>!!! note Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 note，并设置了自定义标题。</p>
<pre><code>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</code></pre>
<p>!!! warning Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 warning，并设置了自定义标题。</p>
<pre><code>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</code></pre>
<p>!!! error Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 error，并设置了自定义标题。</p>
<pre><code>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</code></pre>
<p>!!! info Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 info，并设置了自定义标题。</p>
<pre><code>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</code></pre>
<p>!!! todo Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 todo，并设置了自定义标题。</p>
<pre><code>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</code></pre>
<p>!!! attention Hexo-admonition 插件使用示例
这是基于 hexo-admonition 插件渲染的一条提示信息。类型为 attention，并设置了自定义标题。</p>
<pre><code>提示内容开头留 4 个空格，可以有多行，最后用空行结束此标记。
</code></pre>
]]></description></item></channel></rss>