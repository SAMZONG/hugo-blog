<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>HowTo Install NextCloud - SAMZONG</title><meta name=Description content><meta property="og:title" content="HowTo Install NextCloud"><meta property="og:description" content="随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而"><meta property="og:type" content="article"><meta property="og:url" content="https://samzong.me/posts/howto-install-nextcloud/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-02-27T14:57:00+00:00"><meta property="article:modified_time" content="2017-02-27T14:57:00+00:00"><meta property="og:site_name" content="SAMZONG"><meta name=twitter:card content="summary"><meta name=twitter:title content="HowTo Install NextCloud"><meta name=twitter:description content="随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而"><meta name=application-name content="SAMZONG"><meta name=apple-mobile-web-app-title content="SAMZONG"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://samzong.me/posts/howto-install-nextcloud/><link rel=prev href=https://samzong.me/posts/howto-install-redmine/><link rel=next href=https://samzong.me/posts/mactips%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%85%B3%E9%97%AD%E5%92%8C%E5%90%AF%E5%8A%A8airport/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"HowTo Install NextCloud","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/samzong.me\/posts\/howto-install-nextcloud\/"},"genre":"posts","keywords":"NextCloud","wordcount":2685,"url":"https:\/\/samzong.me\/posts\/howto-install-nextcloud\/","datePublished":"2017-02-27T14:57:00+00:00","dateModified":"2017-02-27T14:57:00+00:00","publisher":{"@type":"Organization","name":"Samzong Lu"},"author":{"@type":"Person","name":"Samzong Lu"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG><span class=header-title-pre>🐸</span>SAMZONG</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><a href=# onclick=return!1 class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" id=language-select-desktop onchange="location=this.value"><option value=/posts/howto-install-nextcloud/ selected>简体中文</option></select>
</a><a href=# onclick=return!1 class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG><span class=header-title-pre>🐸</span>SAMZONG</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=# onclick=return!1 class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a><a href=# onclick=return!1 class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" onchange="location=this.value"><option value=/posts/howto-install-nextcloud/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","false")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">HowTo Install NextCloud</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Samzong Lu</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/opensource/><i class="far fa-folder fa-fw"></i>OpenSource</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2017-02-27>2017-02-27</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2017-02-27>2017-02-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2685 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=true><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#运行环境><strong>运行环境</strong></a></li><li><a href=#搭建lnmp环境><strong>搭建LNMP环境</strong></a><ul><li><a href=#软件版本>软件版本</a></li><li><a href=#基础环境安装>基础环境安装</a></li><li><a href=#install-lnmp>Install LNMP</a></li><li><a href=#下载nextcloud>下载NextCloud</a></li><li><a href=#配置nginx和php-fpm>配置Nginx和php-fpm</a></li><li><a href=#文件权限调整>文件权限调整</a></li><li><a href=#创建mysql数据库>创建MySQL数据库</a></li></ul></li><li><a href=#初始化nextcloud>初始化NextCloud</a></li><li><a href=#other><strong>Other</strong></a><ul><li><a href=#修改默认data目录>修改默认data目录</a></li><li><a href=#无法登陆到个人用户界面>无法登陆到个人用户界面</a></li><li><a href=#增加redis组件提高性能>增加redis组件，提高性能</a></li><li><a href=#ssl证书>SSL证书</a></li></ul></li><li><a href=#使用现状><strong>使用现状</strong></a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2017-02-27T14:57:00 title="February 27, 2017">2017-02-27</span>，文中内容可能已过时。</div></div></div><p>随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而且随着智能终端的普及，我也有一些更加高质量的图片文件需要大量储存，所以我想到了自建存储服务的方式，在甄别了OwnCloud，Seafiles和NextCloud，最后选择了NextCloud作为自己今后数据存储节点，NextCloud源自OwnCloud，但是近些年来OwnCloud的发展进度几乎停滞，多数开发者也转战NextCloud，当然NextCloud也继承了搭建简单，依赖于PHP环境的特性。</p><h4 id=运行环境 class=headerLink><a href=#%e8%bf%90%e8%a1%8c%e7%8e%af%e5%a2%83 class=header-mark></a><strong>运行环境</strong></h4><ul><li>阿里云ECS CentOS 6.x</li><li>免费SSL证书(腾讯云申请)</li></ul><h4 id=搭建lnmp环境 class=headerLink><a href=#%e6%90%ad%e5%bb%balnmp%e7%8e%af%e5%a2%83 class=header-mark></a><strong>搭建LNMP环境</strong></h4><h5 id=软件版本 class=headerLink><a href=#%e8%bd%af%e4%bb%b6%e7%89%88%e6%9c%ac class=header-mark></a>软件版本</h5><ul><li>PHP 5.6.30 <a href=https://samzong.me/php54-centos6/ target=_blank rel="noopener noreferrer">安装教程</a></li><li>MySQL 5.6.35 <a href=https://samzong.me/how-to-install-mysql-5-6-on-centos/ target=_blank rel="noopener noreferrer">安装教程</a></li><li>Nginx 1.10.2</li></ul><h5 id=基础环境安装 class=headerLink><a href=#%e5%9f%ba%e7%a1%80%e7%8e%af%e5%a2%83%e5%ae%89%e8%a3%85 class=header-mark></a>基础环境安装</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# yum update -y
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum groupinstall -y &#34;Base&#34;
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum groupinstall -y &#34;Development tools&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Install epel
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum install -y epel-release
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Install remi
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Install mysql-community
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum install http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm
</span></span></code></pre></td></tr></table></div></div><h5 id=install-lnmp class=headerLink><a href=#install-lnmp class=header-mark></a>Install LNMP</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Install MySQL
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum --enablerepo=mysql-community install -y mysql-server mysql-libs mysql-devel
</span></span><span class=line><span class=cl>[root@ultraera ~]# service mysqld start
</span></span><span class=line><span class=cl>[root@ultraera ~]# mysql_secure_installation
</span></span><span class=line><span class=cl>[root@ultraera ~]# chkconfig mysqld on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Install Nginx
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum --enablerepo=epel install -y nginx
</span></span><span class=line><span class=cl>[root@ultraera ~]# service nginx start
</span></span><span class=line><span class=cl>[root@ultraera ~]# chkconfig nginx on
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Install PHP and php-fpm
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum --enablerepo=remi-php56 install php php-fpm php-mysql php-gd php-xml php-redis php-libs php-devel php-zlib
</span></span><span class=line><span class=cl>[root@ultraera ~]# service php-fpm start
</span></span><span class=line><span class=cl>[root@ultraera ~]# chkconfig php-fpm on
</span></span><span class=line><span class=cl>[root@ultraera ~]# service nginx restart
</span></span></code></pre></td></tr></table></div></div><h5 id=下载nextcloud class=headerLink><a href=#%e4%b8%8b%e8%bd%bdnextcloud class=header-mark></a>下载NextCloud</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2
</span></span><span class=line><span class=cl>[root@ultraera ~]# tar xf nextcloud-11.0.1.tar.bz2
</span></span><span class=line><span class=cl>[root@ultraera ~]# mv nextcloud-11.0.1 /opt/nextcloud
</span></span></code></pre></td></tr></table></div></div><h5 id=配置nginx和php-fpm class=headerLink><a href=#%e9%85%8d%e7%bd%aenginx%e5%92%8cphp-fpm class=header-mark></a>配置Nginx和php-fpm</h5><p>因为php-fpm默认运行的用户身份是apache，我们这里使用的环境是nginx，所有要修改php-fpm配置文件的用户和组，注意不要为了省事直接改为root，这在php-fpm中是不允许的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# vim /etc/php-fpm.d/www.conf
</span></span><span class=line><span class=cl>user=nginx
</span></span><span class=line><span class=cl>group=nginx
</span></span><span class=line><span class=cl>[root@ultraera ~]# service php-fpm restart
</span></span></code></pre></td></tr></table></div></div><p>因为NextCloud默认是以Apache的身份运行的，所以我们需要单独配置NextCloud的Nginx配置文件，以下配置文件，你可以直接拿去用，注意在文件中说明了，需要修改的地方：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-v data-lang=v><span class=line><span class=cl><span class=p>[</span><span class=na>root</span><span class=err>@</span><span class=na>ultraera</span> <span class=err>~</span><span class=p>]</span><span class=o>#</span> <span class=nv>vim</span> <span class=o>/</span><span class=nv>etc</span><span class=o>/</span><span class=nv>nginx</span><span class=o>/</span><span class=nv>conf</span><span class=p>.</span><span class=nv>d</span><span class=o>/</span><span class=nv>nextcloud</span><span class=p>.</span><span class=nv>conf</span>
</span></span><span class=line><span class=cl> <span class=nv>upstream</span> <span class=nv>php</span><span class=o>-</span><span class=nv>handler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=o>#</span> <span class=nv>这里是你php</span><span class=o>-</span><span class=nv>fpm的服务端口</span><span class=err>，</span><span class=nv>默认是9000</span>
</span></span><span class=line><span class=cl>    <span class=nv>server</span> <span class=mf>127.0.0.1</span><span class=p>:</span><span class=mi>9000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cp>#server unix:/var/run/php5-fpm.sock;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=o>#</span> <span class=nv>你的域名</span>
</span></span><span class=line><span class=cl>    <span class=nv>listen</span> <span class=nv>pan</span><span class=p>.</span><span class=nv>ultraera</span><span class=p>.</span><span class=nv>org</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>server_name</span> <span class=nv>pan</span><span class=p>.</span><span class=nv>ultraera</span><span class=p>.</span><span class=nv>org</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nv>enforce</span> <span class=nv>https</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>301</span> <span class=nv>https</span><span class=p>:</span><span class=c1>//$server_name$request_uri;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nv>你的域名</span>
</span></span><span class=line><span class=cl>    <span class=nv>listen</span> <span class=nv>pan</span><span class=p>.</span><span class=nv>ultraera</span><span class=p>.</span><span class=nv>org</span><span class=p>:</span><span class=mi>443</span> <span class=nv>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>server_name</span> <span class=nv>pan</span><span class=p>.</span><span class=nv>ultraera</span><span class=p>.</span><span class=nv>org</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  	<span class=o>#</span> <span class=nv>以下是你的ssl证书文件存放路径</span>
</span></span><span class=line><span class=cl>    <span class=nv>ssl_certificate</span> <span class=o>/</span><span class=nv>etc</span><span class=o>/</span><span class=nv>nginx</span><span class=o>/</span><span class=nv>ssl</span><span class=o>/</span><span class=mi>1_</span><span class=nv>pan</span><span class=p>.</span><span class=nv>ultraera</span><span class=p>.</span><span class=nv>org_bundle</span><span class=p>.</span><span class=nv>crt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>ssl_certificate_key</span> <span class=o>/</span><span class=nv>etc</span><span class=o>/</span><span class=nv>nginx</span><span class=o>/</span><span class=nv>ssl</span><span class=o>/</span><span class=mi>2_</span><span class=nv>pan</span><span class=p>.</span><span class=nv>ultraera</span><span class=p>.</span><span class=nv>org</span><span class=p>.</span><span class=nv>key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nc>Add</span> <span class=nv>headers</span> <span class=nv>to</span> <span class=nv>serve</span> <span class=nv>security</span> <span class=nv>related</span> <span class=nv>headers</span>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nc>Before</span> <span class=nv>enabling</span> <span class=nc>Strict</span><span class=o>-</span><span class=nc>Transport</span><span class=o>-</span><span class=nc>Security</span> <span class=nv>headers</span> <span class=nv>please</span> <span class=nv>read</span> <span class=nv>into</span> <span class=nv>this</span>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nv>topic</span> <span class=nv>first</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nv>add_header</span> <span class=nc>Strict</span><span class=o>-</span><span class=nc>Transport</span><span class=o>-</span><span class=nc>Security</span> <span class=s2>&#34;max-age=15768000;
</span></span></span><span class=line><span class=cl><span class=s2>    # includeSubDomains; preload;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>add_header</span> <span class=nc>X</span><span class=o>-</span><span class=nc>Content</span><span class=o>-</span><span class=nc>Type</span><span class=o>-</span><span class=nc>Options</span> <span class=nv>nosniff</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>add_header</span> <span class=nc>X</span><span class=o>-</span><span class=nc>Frame</span><span class=o>-</span><span class=nc>Options</span> <span class=s2>&#34;SAMEORIGIN&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>add_header</span> <span class=nc>X</span><span class=o>-</span><span class=nc>XSS</span><span class=o>-</span><span class=nc>Protection</span> <span class=s2>&#34;1; mode=block&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>add_header</span> <span class=nc>X</span><span class=o>-</span><span class=nc>Robots</span><span class=o>-</span><span class=nc>Tag</span> <span class=kc>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>add_header</span> <span class=nc>X</span><span class=o>-</span><span class=nc>Download</span><span class=o>-</span><span class=nc>Options</span> <span class=nv>noopen</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>add_header</span> <span class=nc>X</span><span class=o>-</span><span class=nc>Permitted</span><span class=o>-</span><span class=nc>Cross</span><span class=o>-</span><span class=nc>Domain</span><span class=o>-</span><span class=nc>Policies</span> <span class=kc>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>add_header</span> <span class=nc>Strict</span><span class=o>-</span><span class=nc>Transport</span><span class=o>-</span><span class=nc>Security</span> <span class=s2>&#34;max-age=15552000; includeSubdomains; &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nv>设定你的NextCloud的根目录</span><span class=err>，</span><span class=nv>请根据实际修改</span>
</span></span><span class=line><span class=cl>    <span class=nv>root</span> <span class=o>/</span><span class=nv>opt</span><span class=o>/</span><span class=nv>nextcloud</span><span class=o>/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>location</span> <span class=o>=</span> <span class=o>/</span><span class=nv>robots</span><span class=p>.</span><span class=nv>txt</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>allow</span> <span class=nv>all</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>log_not_found</span> <span class=nv>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>access_log</span> <span class=nv>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nc>The</span> <span class=nv>following</span> <span class=mi>2</span> <span class=nv>rules</span> <span class=nv>are</span> <span class=nv>only</span> <span class=nv>needed</span> <span class=k>for</span> <span class=nv>the</span> <span class=nv>user_webfinger</span> <span class=nv>app</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=o>#</span> <span class=nc>Uncomment</span> <span class=vm>it</span> <span class=k>if</span> <span class=nv>you</span><span class=s1>&#39;re planning to use this app.
</span></span></span><span class=line><span class=cl><span class=s1>    #rewrite ^/.well-known/host-meta /public.php?service=host-meta last;
</span></span></span><span class=line><span class=cl><span class=s1>    #rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json
</span></span></span><span class=line><span class=cl><span class=s1>    # last;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    location = /.well-known/carddav {
</span></span></span><span class=line><span class=cl><span class=s1>      return 301 </span><span class=o>$</span><span class=nv>scheme</span><span class=s1>://</span><span class=o>$</span><span class=nv>host</span><span class=s1>/remote.php/dav;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>    location = /.well-known/caldav {
</span></span></span><span class=line><span class=cl><span class=s1>      return 301 </span><span class=o>$</span><span class=nv>scheme</span><span class=s1>://</span><span class=o>$</span><span class=nv>host</span><span class=s1>/remote.php/dav;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    # set max upload size
</span></span></span><span class=line><span class=cl><span class=s1>    client_max_body_size 512M;
</span></span></span><span class=line><span class=cl><span class=s1>    fastcgi_buffers 64 4K;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    # Disable gzip to avoid the removal of the ETag header
</span></span></span><span class=line><span class=cl><span class=s1>    gzip off;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    # Uncomment if your server is build with the ngx_pagespeed module
</span></span></span><span class=line><span class=cl><span class=s1>    # This module is currently not supported.
</span></span></span><span class=line><span class=cl><span class=s1>    #pagespeed off;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    error_page 403 /core/templates/403.php;
</span></span></span><span class=line><span class=cl><span class=s1>    error_page 404 /core/templates/404.php;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    location / {
</span></span></span><span class=line><span class=cl><span class=s1>        rewrite ^ /index.php</span><span class=o>$</span><span class=nv>uri</span><span class=s1>;
</span></span></span><span class=line><span class=cl><span class=s1>   }
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/ {
</span></span></span><span class=line><span class=cl><span class=s1>        deny all;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>    location ~ ^/(?:\.|autotest|occ|issue|indie|db_|console) {
</span></span></span><span class=line><span class=cl><span class=s1>        deny all;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    location ~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\.php(?:</span><span class=o>$</span><span class=s1>|/) {
</span></span></span><span class=line><span class=cl><span class=s1>        include fastcgi_params;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_split_path_info ^(.+\.php)(/.*)</span><span class=o>$</span><span class=s1>;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_param SCRIPT_FILENAME </span><span class=o>$</span><span class=nv>document_root</span><span class=o>$</span><span class=nv>fastcgi_script_name</span><span class=s1>;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_param PATH_INFO </span><span class=o>$</span><span class=nv>fastcgi_path_info</span><span class=s1>;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_param HTTPS on;
</span></span></span><span class=line><span class=cl><span class=s1>        #Avoid sending the security headers twice
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_param modHeadersAvailable true;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_param front_controller_active true;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_pass php-handler;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_intercept_errors on;
</span></span></span><span class=line><span class=cl><span class=s1>        fastcgi_request_buffering off;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    location ~ ^/(?:updater|ocs-provider)(?:</span><span class=o>$</span><span class=s1>|/) {
</span></span></span><span class=line><span class=cl><span class=s1>        try_files </span><span class=o>$</span><span class=nv>uri</span><span class=s1>/ =404;
</span></span></span><span class=line><span class=cl><span class=s1>        index index.php;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    # Adding the cache control header for js and css files
</span></span></span><span class=line><span class=cl><span class=s1>    # Make sure it is BELOW the PHP block
</span></span></span><span class=line><span class=cl><span class=s1>    location ~* \.(?:css|js|woff|svg|gif)</span><span class=o>$</span><span class=s1> {
</span></span></span><span class=line><span class=cl><span class=s1>        try_files </span><span class=o>$</span><span class=nv>uri</span><span class=s1> /index.php</span><span class=o>$</span><span class=nv>uri</span><span class=o>$</span><span class=nv>is_args</span><span class=o>$</span><span class=nv>args</span><span class=s1>;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header Cache-Control &#34;public, max-age=7200&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>        # Add headers to serve security related headers (It is intended to
</span></span></span><span class=line><span class=cl><span class=s1>        # have those duplicated to the ones above)
</span></span></span><span class=line><span class=cl><span class=s1>        # Before enabling Strict-Transport-Security headers please read into
</span></span></span><span class=line><span class=cl><span class=s1>        # this topic first.
</span></span></span><span class=line><span class=cl><span class=s1>        # add_header Strict-Transport-Security &#34;max-age=15768000;
</span></span></span><span class=line><span class=cl><span class=s1>        #  includeSubDomains; preload;&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header X-Content-Type-Options nosniff;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header X-Frame-Options &#34;SAMEORIGIN&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header X-XSS-Protection &#34;1; mode=block&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header X-Robots-Tag none;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header X-Download-Options noopen;
</span></span></span><span class=line><span class=cl><span class=s1>        add_header X-Permitted-Cross-Domain-Policies none;
</span></span></span><span class=line><span class=cl><span class=s1>        # Optional: Don&#39;</span><span class=nv>t</span> <span class=nv>log</span> <span class=nv>access</span> <span class=nv>to</span> <span class=nv>assets</span>
</span></span><span class=line><span class=cl>        <span class=nv>access_log</span> <span class=nv>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>location</span> <span class=o>~*</span> <span class=err>\</span><span class=p>.(</span><span class=kd>?</span><span class=p>:</span><span class=nv>png</span><span class=o>|</span><span class=nv>html</span><span class=o>|</span><span class=nv>ttf</span><span class=o>|</span><span class=nv>ico</span><span class=o>|</span><span class=nv>jpg</span><span class=o>|</span><span class=nv>jpeg</span><span class=p>)</span><span class=err>$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>try_files</span> <span class=o>$</span><span class=nv>uri</span> <span class=o>/</span><span class=nv>index</span><span class=p>.</span><span class=nv>php</span><span class=o>$</span><span class=nv>uri</span><span class=o>$</span><span class=nv>is_args</span><span class=o>$</span><span class=nv>args</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>#</span> <span class=nc>Optional</span><span class=p>:</span> <span class=nc>Don</span><span class=s1>&#39;t log access to other assets
</span></span></span><span class=line><span class=cl><span class=s1>        access_log off;
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>}
</span></span></span><span class=line><span class=cl><span class=s1>[root@ultraera ~]# service nginx restart
</span></span></span></code></pre></td></tr></table></div></div><h5 id=文件权限调整 class=headerLink><a href=#%e6%96%87%e4%bb%b6%e6%9d%83%e9%99%90%e8%b0%83%e6%95%b4 class=header-mark></a>文件权限调整</h5><p>因为NextCloud运行是以nginx程序，注意修改目录所属用户和组为nginx</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# chown -R nginx:nginx /opt/nextcloud
</span></span></code></pre></td></tr></table></div></div><h5 id=创建mysql数据库 class=headerLink><a href=#%e5%88%9b%e5%bb%bamysql%e6%95%b0%e6%8d%ae%e5%ba%93 class=header-mark></a>创建MySQL数据库</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mysql&gt; CREATE DATABASE nextcloud CHARACTER SET UTF-8;
</span></span><span class=line><span class=cl>mysql&gt; GRANT ALL PRIVILEGES ON nextcloud.* TO &#39;nextcloud&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;your_password&#39;;
</span></span><span class=line><span class=cl>mysql&gt; FLUSH PRIVILEGES;
</span></span></code></pre></td></tr></table></div></div><h4 id=初始化nextcloud class=headerLink><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96nextcloud class=header-mark></a>初始化NextCloud</h4><p>在浏览器打开你在nginx中配置的域名，NextCloud初始化非常简单，设定一个管理员账户和密码，然后设定数据库即可，按照我们上一步针对MySQL的设定，你会非常清楚地知道你的数据库信息：</p><p><a class=lightgallery href=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png title=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png data-thumbnail=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png><img class=lazyload data-src=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png data-srcset="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png, https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png 1.5x, https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png 2x" data-sizes=auto alt=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png></a></p><p>登录之后的界面是这样：</p><p><a class=lightgallery href=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png title=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png data-thumbnail=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png><img class=lazyload data-src=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png data-srcset="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png, https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png 1.5x, https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png 2x" data-sizes=auto alt=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png></a></p><p>你可以在登录之后，在你的右上角点击头像选择Admin进入管理界面查看和修改你的服务器设置，你还可以在浏览器上方看到你的服务器现有哪些问题，会有对应文档提醒你如何解决这些问题。</p><p><a class=lightgallery href=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png title=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png data-thumbnail=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png><img class=lazyload data-src=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png data-srcset="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png, https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png 1.5x, https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png 2x" data-sizes=auto alt=https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png></a></p><h4 id=other class=headerLink><a href=#other class=header-mark></a><strong>Other</strong></h4><h5 id=修改默认data目录 class=headerLink><a href=#%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4data%e7%9b%ae%e5%bd%95 class=header-mark></a>修改默认data目录</h5><p>在我们首次打开NextCloud网页时，需要我们设定datadir目录，这里有个默认目录在nextcloud项目包，这其实是不安全的，我们最后将目录路径修改为其他位置:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# mkdir /nextcloud_files/
</span></span><span class=line><span class=cl>[root@ultraera ~]# chown -R nginx:nginx /nextcloud_files/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 修改datadirectory的路径
</span></span><span class=line><span class=cl>[root@ultraera ~]# vim /opt/nextcloud/config/config.php
</span></span><span class=line><span class=cl>datadirectory&#39; =&gt; &#39;/nextcloud/data
</span></span></code></pre></td></tr></table></div></div><h5 id=无法登陆到个人用户界面 class=headerLink><a href=#%e6%97%a0%e6%b3%95%e7%99%bb%e9%99%86%e5%88%b0%e4%b8%aa%e4%ba%ba%e7%94%a8%e6%88%b7%e7%95%8c%e9%9d%a2 class=header-mark></a>无法登陆到个人用户界面</h5><p>我在安装时碰到这个问题，折腾了很久才解决，因为我们是使用nginx程序，但是php-fpm默认用户身份为apache，所以<code>/var/lib/php/session</code>目录的所属用户和组都是apache，导致我们没有权限去写入session，所以无法登入系统，报错信息可以在NextCloud的log文件下看到：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# tail -n 1 /usr/nextcloud/data/nextcloud.log
</span></span><span class=line><span class=cl>{&#34;reqId&#34;:&#34;NNnIwMCCPDMQtzZW5Ndc&#34;,&#34;remoteAddr&#34;:&#34;180.166.66.226&#34;,&#34;app&#34;:&#34;PHP&#34;,&#34;message&#34;:&#34;session_write_close(): Failed to write session data (files). Please verify that the current setting of session.save_path is correct (\/var\/lib\/php\/session) at \/usr\/nextcloud\/lib\/private\/Session\/Internal.php#104&#34;,&#34;level&#34;:3,&#34;time&#34;:&#34;2017-02-24T10:46:13+00:00&#34;,&#34;method&#34;:&#34;POST&#34;,&#34;url&#34;:&#34;\/index.php&#34;,&#34;user&#34;:&#34;samzong&#34;,&#34;version&#34;:&#34;11.0.0.10&#34;}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 修改/var/lib/php/的属组为nginx即可
</span></span><span class=line><span class=cl>[root@ultraera ~]# chgrp -R nginx /var/lib/php
</span></span></code></pre></td></tr></table></div></div><h5 id=增加redis组件提高性能 class=headerLink><a href=#%e5%a2%9e%e5%8a%a0redis%e7%bb%84%e4%bb%b6%e6%8f%90%e9%ab%98%e6%80%a7%e8%83%bd class=header-mark></a>增加redis组件，提高性能</h5><p>关于如何安装redis我在之前的文章中也有讲到，大家可以去看下 <a href=https://samzong.me/redis01/ target=_blank rel="noopener noreferrer">安装教程</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@ultraera ~]# yum --enablerepo=remi install -y redis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 增加php的redis插件
</span></span><span class=line><span class=cl>[root@ultraera ~]# yum --enablerepo=remi-php56 install php-redis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 配置文件增加redis
</span></span><span class=line><span class=cl>  &#39;memcache.local&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class=line><span class=cl>  &#39;memcache.locking&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class=line><span class=cl>  &#39;redis&#39; =&gt;
</span></span><span class=line><span class=cl>   array (
</span></span><span class=line><span class=cl>    &#39;host&#39; =&gt; &#39;localhost&#39;,
</span></span><span class=line><span class=cl>    &#39;port&#39; =&gt; 6379,
</span></span><span class=line><span class=cl>   )
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 重启令服务生效
</span></span><span class=line><span class=cl>[root@ultraera ~]# service php-fpm restart
</span></span><span class=line><span class=cl>[root@ultraera ~]# service nginx restart
</span></span></code></pre></td></tr></table></div></div><p>我的NextCloud配置如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>$CONFIG = array (
</span></span><span class=line><span class=cl>  &#39;memcache.local&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class=line><span class=cl>  &#39;memcache.locking&#39; =&gt; &#39;\\OC\\Memcache\\Redis&#39;,
</span></span><span class=line><span class=cl>  &#39;redis&#39; =&gt;
</span></span><span class=line><span class=cl>  array (
</span></span><span class=line><span class=cl>    &#39;host&#39; =&gt; &#39;localhost&#39;,
</span></span><span class=line><span class=cl>    &#39;port&#39; =&gt; 6379,
</span></span><span class=line><span class=cl>  ),
</span></span><span class=line><span class=cl>  &#39;enable_previews&#39; =&gt; false,
</span></span><span class=line><span class=cl>  &#39;instanceid&#39; =&gt; &#39;ockhup01dxbf&#39;,
</span></span><span class=line><span class=cl>  &#39;passwordsalt&#39; =&gt; &#39;TlJgWGrE0N7vOrRfZkOojwdYh/BixL&#39;,
</span></span><span class=line><span class=cl>  &#39;secret&#39; =&gt; &#39;/IQh0LioZp5eYFQJhicY7n324Q80WQUYOzWL+8OcxcXVw3Ef&#39;,
</span></span><span class=line><span class=cl>  &#39;trusted_domains&#39; =&gt;
</span></span><span class=line><span class=cl>  array (
</span></span><span class=line><span class=cl>    0 =&gt; &#39;pan.ultraera.org&#39;,
</span></span><span class=line><span class=cl>  ),
</span></span><span class=line><span class=cl>  &#39;datadirectory&#39; =&gt; &#39;/nextcloud&#39;,
</span></span><span class=line><span class=cl>  &#39;overwrite.cli.url&#39; =&gt; &#39;https://pan.ultraera.org&#39;,
</span></span><span class=line><span class=cl>  &#39;dbtype&#39; =&gt; &#39;mysql&#39;,
</span></span><span class=line><span class=cl>  &#39;version&#39; =&gt; &#39;11.0.0.10&#39;,
</span></span><span class=line><span class=cl>  &#39;dbname&#39; =&gt; &#39;nextcloud&#39;,
</span></span><span class=line><span class=cl>  &#39;dbhost&#39; =&gt; &#39;localhost&#39;,
</span></span><span class=line><span class=cl>  &#39;dbport&#39; =&gt; &#39;&#39;,
</span></span><span class=line><span class=cl>  &#39;dbtableprefix&#39; =&gt; &#39;oc_&#39;,
</span></span><span class=line><span class=cl>  &#39;dbuser&#39; =&gt; &#39;nextcloud&#39;,
</span></span><span class=line><span class=cl>  &#39;dbpassword&#39; =&gt; &#39;nextcloud&#39;,
</span></span><span class=line><span class=cl>  &#39;logtimezone&#39; =&gt; &#39;CST&#39;,
</span></span><span class=line><span class=cl>  &#39;installed&#39; =&gt; true,
</span></span><span class=line><span class=cl>  &#39;mail_from_address&#39; =&gt; &#39;luchuanjia&#39;,
</span></span><span class=line><span class=cl>  &#39;mail_smtpmode&#39; =&gt; &#39;php&#39;,
</span></span><span class=line><span class=cl>  &#39;mail_domain&#39; =&gt; &#39;msn.com&#39;,
</span></span><span class=line><span class=cl>);
</span></span></code></pre></td></tr></table></div></div><h5 id=ssl证书 class=headerLink><a href=#ssl%e8%af%81%e4%b9%a6 class=header-mark></a>SSL证书</h5><p>现国内提供免费的SSL证书的服务商很多，作为个人站点，免费SSL证书是个挺不错的选择，我在之前nginx配置时将ssl的配置方式写在了配置文件中了，注意如果不启用ssl时，不要启用https的虚拟主机，当然你可以自己生成一个ssl证书来提供服务，但这样在别人访问你的网站时，会不提示不受信任的证书，具体如何获取的证书的方式，因各个厂家方式有些区别，这里就不赘述，可以联系对应的厂商的技术人员咨询。</p><h4 id=使用现状 class=headerLink><a href=#%e4%bd%bf%e7%94%a8%e7%8e%b0%e7%8a%b6 class=header-mark></a><strong>使用现状</strong></h4><p>在将服务搭建完成之后，对于存储的文件加密，现在通过jobs，每日凌晨将文件推送到oss内，保存2天的数据，避免因为服务器宕机导致文件丢失；使用端，自己的电脑和手机，还有家人的手机，都安装了应用，后台自动将拍照图片等自动上传到云盘，使用起来目前很稳定，只是iOS应用是收费的，因为NextCloud源于OwnCloud，如果你之前购买了OwnCloud的App也可以直接使用，当然NextCloud也有很多其他功能，可以根据你的实际需求发掘。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2017-02-27</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/howto-install-nextcloud/index.md target=_blank rel="noopener noreferrer">阅读原始文档</a></span></div><div class=post-info-share><span><a href=# onclick=return!1 title="分享到 Twitter" data-sharer=twitter data-url=https://samzong.me/posts/howto-install-nextcloud/ data-title="HowTo Install NextCloud" data-via=samzong_lu data-hashtags=NextCloud><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="分享到 Facebook" data-sharer=facebook data-url=https://samzong.me/posts/howto-install-nextcloud/ data-hashtag=NextCloud><i class="fab fa-facebook-square fa-fw"></i></a><a href=# onclick=return!1 title="分享到 微博" data-sharer=weibo data-url=https://samzong.me/posts/howto-install-nextcloud/ data-title="HowTo Install NextCloud" data-ralateuid=3181653281><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/nextcloud/>NextCloud</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/howto-install-redmine/ class=prev rel=prev title="HowTo Install Redmine"><i class="fas fa-angle-left fa-fw"></i>HowTo Install Redmine</a>
<a href=/posts/mactips%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%85%B3%E9%97%AD%E5%92%8C%E5%90%AF%E5%8A%A8airport/ class=next rel=next title="MacTips 使用命令关闭和启动AirPort">MacTips 使用命令关闭和启动AirPort<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/topbar/topbar.min.js></script><script type=text/javascript src=/lib/pjax/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},sharerjs:!0,table:{sort:!0}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript></div></body></html>