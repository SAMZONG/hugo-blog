<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>HowTo Monitor Tomcat HeadMemory for Zabbix - SAMZONG</title><meta name=Description content><meta property="og:title" content="HowTo Monitor Tomcat HeadMemory for Zabbix"><meta property="og:description" content="最近项目上由于BUG问题导致Tomcat程序在运行过程中经常内存泄漏,而本身监控系统之中没有更好的检测到Tomcat堆空间(Head Memo"><meta property="og:type" content="article"><meta property="og:url" content="https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-18T23:28:44+00:00"><meta property="article:modified_time" content="2017-01-18T23:28:44+00:00"><meta property="og:site_name" content="SAMZONG"><meta name=twitter:card content="summary"><meta name=twitter:title content="HowTo Monitor Tomcat HeadMemory for Zabbix"><meta name=twitter:description content="最近项目上由于BUG问题导致Tomcat程序在运行过程中经常内存泄漏,而本身监控系统之中没有更好的检测到Tomcat堆空间(Head Memo"><meta name=application-name content="SAMZONG"><meta name=apple-mobile-web-app-title content="SAMZONG"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/><link rel=prev href=https://samzong.me/posts/%E6%AF%8F%E6%97%A5%E5%A4%87%E4%BB%BDmysql%E5%8D%95%E8%A1%A8%E6%95%B0%E6%8D%AE/><link rel=next href=https://samzong.me/posts/mysql-8-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4%E5%92%8C%E6%9F%A5%E7%9C%8B/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"HowTo Monitor Tomcat HeadMemory for Zabbix","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/samzong.me\/posts\/howto-monitor-tomcat-head-memory-for-zabbix\/"},"genre":"posts","keywords":"Zabbix, Tomcat","wordcount":2275,"url":"https:\/\/samzong.me\/posts\/howto-monitor-tomcat-head-memory-for-zabbix\/","datePublished":"2017-01-18T23:28:44+00:00","dateModified":"2017-01-18T23:28:44+00:00","publisher":{"@type":"Organization","name":"Samzong Lu"},"author":{"@type":"Person","name":"Samzong Lu"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG><span class=header-title-pre>🚀🚀🚀 </span>SAMZONG</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>全部文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><a href=# onclick=return!1 class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" id=language-select-desktop onchange="location=this.value"><option value=/posts/howto-monitor-tomcat-head-memory-for-zabbix/ selected>简体中文</option></select>
</a><a href=# onclick=return!1 class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG><span class=header-title-pre>🚀🚀🚀 </span>SAMZONG</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>全部文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=# onclick=return!1 class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
</a><a href=# onclick=return!1 class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" onchange="location=this.value"><option value=/posts/howto-monitor-tomcat-head-memory-for-zabbix/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","wide")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","false")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">HowTo Monitor Tomcat HeadMemory for Zabbix</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Samzong Lu</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/opensource/><i class="far fa-folder fa-fw"></i>OpenSource</a>&nbsp;<a href=/categories/zabbix/><i class="far fa-folder fa-fw"></i>Zabbix</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2017-01-18>2017-01-18</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2017-01-18>2017-01-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2275 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept=true><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#zabbix-java-gateway的工作机制>zabbix-java-gateway的工作机制</a></li><li><a href=#1-install-zabbix-java-gateway-on-zabbix-server>1. Install zabbix-java-gateway on Zabbix Server</a></li><li><a href=#2-confiure-tomcat-host-with-enable-jmx>2. Confiure Tomcat host with enable jmx</a></li></ul></li><li><a href=#option-javagatewayport>Option: JavaGatewayPort</a></li></ul></li></ul><ul><li><ul><li><a href=#option-startjavapollers>Option: StartJavaPollers</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixlistenip>Option: zabbix.listenIP</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixlistenport>Option: zabbix.listenPort</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixpidfile>Option: zabbix.pidFile</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixstartpollers>Option: zabbix.startPollers</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2017-01-18T23:28:44 title="January 18, 2017">2017-01-18</span>，文中内容可能已过时。</div></div></div><p>最近项目上由于BUG问题导致Tomcat程序在运行过程中经常内存泄漏,而本身监控系统之中没有更好的检测到Tomcat堆空间(Head Memory)的使用情况导致报警频发，这篇文章主要讲述，如何在Zabbix之中调用jmx监控服务器上Tomcat堆空间的使用情况并增加对应报警功能。</p><blockquote><p>测试环境:<br>CentOS 6.8<br>Zabbix 2.4<br>Tomcat 7.0<br></p></blockquote><p>实验前提默认是各位已经安装Zabbix Server服务器，并且至少有一台Zabbix agent服务器正常监控。关于如何搭建Zabbix监控集群，会有专门文章描述。</p><h4 id=zabbix-java-gateway的工作机制 class=headerLink><a href=#zabbix-java-gateway%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6 class=header-mark></a>zabbix-java-gateway的工作机制</h4><ul><li>首先我们需要配置我们的Tomcat服务启用监控服务，这个是默认不启用的</li><li>之后需要在Zabbix的管理页面添加对应Tomcat服务器的jmx监控接口</li><li>最后zabbix端会自动获取zabbix-java-gateway的数据并根据相应模板进行展
示</li><li>工作流: [Zabbix-Server]&ndash;>(port:10053 on zabbix server)&ndash;> [zabbix-java-gateway] &ndash;(port:12345 on tomcatserver)&ndash;> [JMX enabled]</li></ul><h4 id=1-install-zabbix-java-gateway-on-zabbix-server class=headerLink><a href=#1-install-zabbix-java-gateway-on-zabbix-server class=header-mark></a>1. Install zabbix-java-gateway on Zabbix Server</h4><p>因为我的zabbix是使用zabbix 2.4官方源安装，所以只需要用yum在安装即可:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@6 ~]# sudo  yum install -y zabbix-java-gateway
</span></span></code></pre></td></tr></table></div></div><p>如果你没有官方源可能先安装该源，注意我的服务器zabbix版本是2.4 如果你是不同的版本，请到[<a href=http://repo.zabbix.com/zabbix/ target=_blank rel="noopener noreferrer">这里</a>]查找对应版本。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 查看zabbix server版本
</span></span><span class=line><span class=cl>[root@6 ~]# zabbix_server --version
</span></span><span class=line><span class=cl>Zabbix server v2.4.8 (revision 59539) (20 April 2016)
</span></span><span class=line><span class=cl>Compilation time: May  4 2016 01:32:12
</span></span></code></pre></td></tr></table></div></div><p>在使用yum安装zabbix-java-gateway源时,会自动关联安装openjdk，尽管这段程序没多大影响，如果你想保证系统JAVA环境不受到改变的话，可以在/etc/profile文件最后，增加如下内容:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># add follows to the end
</span></span><span class=line><span class=cl>export JAVA_HOME=/usr/java/default
</span></span><span class=line><span class=cl>export PATH=$PATH:$JAVA_HOME/bin
</span></span><span class=line><span class=cl>export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span></code></pre></td></tr></table></div></div><h4 id=2-confiure-tomcat-host-with-enable-jmx class=headerLink><a href=#2-confiure-tomcat-host-with-enable-jmx class=header-mark></a>2. Confiure Tomcat host with enable jmx</h4><p>首先在$tomcatdir/bin/catalina.sh文件开头处增加如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;-Dcom.sun.management.jmxremote \
</span></span></span><span class=line><span class=cl><span class=s2>-Dcom.sun.management.jmxremote.authenticate=false \
</span></span></span><span class=line><span class=cl><span class=s2>-Dcom.sun.management.jmxremote.ssl=false \
</span></span></span><span class=line><span class=cl><span class=s2>-Dcom.sun.management.jmxremote.port=12345&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>然后,启动Tomcat，你会发现多了一个12345端口，这就是jmx的监听端口，请保证zabbix-java-gateway可以访问到这台服务器。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@6 ~]# /tomcat7/bin/startup.sh
</span></span><span class=line><span class=cl>Starting Tomcat7:
</span></span><span class=line><span class=cl>Using CATALINA_BASE:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_HOME:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_TMPDIR: /tomcat7/temp
</span></span><span class=line><span class=cl>Using JRE_HOME:        /usr
</span></span><span class=line><span class=cl>Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
</span></span><span class=line><span class=cl>Tomcat started.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[root@6 ~]# netstat -ntlp | grep 12345
</span></span><span class=line><span class=cl>tcp  0      0 :::12345   :::*     LISTEN      8793/java
</span></span><span class=line><span class=cl>[root@6 ~]#
</span></span></code></pre></td></tr></table></div></div><hr>#### ==*fix 1* == : zabbix agent与server存在复杂网络环境<p>这里疏忽了1个问题，如果您的zabbix server与agent端之间有防火墙规则，而按照我上面的所述只是增加了12345这个端口，那么很可能，您在/var/log/zabbix/zabbix_java_gateway.log 中会看到“No route to host”的报错，这是因为JMX不光开启了12345端口，还开启了另外两个随机端口，而在获取监控数据时会使用到其中一个，这就导致了无法通过固定的防火墙规则来开放该端口。其实有另外一个替代方式来使该监听端口固定下来——使用Tomcat提供的额外组件 catalina-jmx-remote.jar，这个组件是需要另外下载的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 查看当前Tomcat版本.
</span></span><span class=line><span class=cl>[root@6 bin]# ./catalina.sh version
</span></span><span class=line><span class=cl>Using CATALINA_BASE:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_HOME:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_TMPDIR: /tomcat7/temp
</span></span><span class=line><span class=cl>Using JRE_HOME:        /usr
</span></span><span class=line><span class=cl>Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
</span></span><span class=line><span class=cl>Server version: Apache Tomcat/7.0.64
</span></span><span class=line><span class=cl>Server built:   Aug 19 2015 17:18:06 UTC
</span></span><span class=line><span class=cl>Server number:  7.0.64.0
</span></span><span class=line><span class=cl>OS Name:        Linux
</span></span><span class=line><span class=cl>OS Version:     2.6.32-642.11.1.el6.x86_64
</span></span><span class=line><span class=cl>Architecture:   amd64
</span></span><span class=line><span class=cl>JVM Version:    1.8.0_111-b15
</span></span><span class=line><span class=cl>JVM Vendor:     Oracle Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 下载 catalina-jmx-remote.jar # 请注意下载版本不要高于当前tomcat版本.
</span></span><span class=line><span class=cl>wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar
</span></span></code></pre></td></tr></table></div></div><p>增加如下内容，在conf/server.xml中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;Listener className=&#34;org.apache.catalina.mbeans.JmxRemoteLifecycleListener&#34;
</span></span><span class=line><span class=cl>          rmiRegistryPortPlatform=&#34;12345&#34; rmiServerPortPlatform=&#34;12346&#34; /&gt;
</span></span></code></pre></td></tr></table></div></div><p>因为我们已经在conf/server.xml定义了rmiRegistryPortPlatform，所以要将bin/catalina.sh中CATALINA_OPTS的com.sun.management.jmxremote.port去掉，否则会因为jmxremote.port配置有优先级更高而导致配置失效。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CATALINA_OPTS=&#34;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false&#34;
</span></span></code></pre></td></tr></table></div></div><p>完成之后，重启tomcat这时会发现jmx默认端口已经固定为12345何12346，而server依然可以正常获取监控数据.</p><hr>#### 3. Configure Zabbix Server
首先需要修改zabbix_server.conf启用zabbix-java-gateway，让zabbix可以检测到服务,修改如下:
```
### Option: JavaGateway
# IP address (or hostname) of Zabbix Java gateway.
# Only required if Java pollers are started.
#
# Mandatory: no
# Default:
JavaGateway=10.211.55.4 # 设置为你的zabbixsever IP<h3 id=option-javagatewayport class=headerLink><a href=#option-javagatewayport class=header-mark></a>Option: JavaGatewayPort</h3><h1 id=port-that-zabbix-java-gateway-listens-on class=headerLink><a href=#port-that-zabbix-java-gateway-listens-on class=header-mark></a>Port that Zabbix Java gateway listens on.</h1><h1 id=heading class=headerLink><a href=#heading class=header-mark></a></h1><h1 id=mandatory-no class=headerLink><a href=#mandatory-no class=header-mark></a>Mandatory: no</h1><h1 id=range-1024-32767 class=headerLink><a href=#range-1024-32767 class=header-mark></a>Range: 1024-32767</h1><h1 id=default class=headerLink><a href=#default class=header-mark></a>Default:</h1><p>JavaGatewayPort=10053 # 设置服务端监听接口</p><h3 id=option-startjavapollers class=headerLink><a href=#option-startjavapollers class=header-mark></a>Option: StartJavaPollers</h3><h1 id=number-of-pre-forked-instances-of-java-pollers class=headerLink><a href=#number-of-pre-forked-instances-of-java-pollers class=header-mark></a>Number of pre-forked instances of Java pollers.</h1><h1 id=heading-1 class=headerLink><a href=#heading-1 class=header-mark></a></h1><h1 id=mandatory-no-1 class=headerLink><a href=#mandatory-no-1 class=header-mark></a>Mandatory: no</h1><h1 id=range-0-1000 class=headerLink><a href=#range-0-1000 class=header-mark></a>Range: 0-1000</h1><h1 id=default-1 class=headerLink><a href=#default-1 class=header-mark></a>Default:</h1><p>StartJavaPollers=5 # 设置多线程启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>然后修改zabbix\_java\_gateway.conf 配置如下:
</span></span></code></pre></td></tr></table></div></div><h3 id=option-zabbixlistenip class=headerLink><a href=#option-zabbixlistenip class=header-mark></a>Option: zabbix.listenIP</h3><h1 id=ip-address-to-listen-on class=headerLink><a href=#ip-address-to-listen-on class=header-mark></a>IP address to listen on.</h1><h1 id=heading-2 class=headerLink><a href=#heading-2 class=header-mark></a></h1><h1 id=mandatory-no-2 class=headerLink><a href=#mandatory-no-2 class=header-mark></a>Mandatory: no</h1><h1 id=default-2 class=headerLink><a href=#default-2 class=header-mark></a>Default:</h1><p>LISTEN_IP=&ldquo;10.211.55.4&rdquo; # 配置监听IP</p><h3 id=option-zabbixlistenport class=headerLink><a href=#option-zabbixlistenport class=header-mark></a>Option: zabbix.listenPort</h3><h1 id=port-to-listen-on class=headerLink><a href=#port-to-listen-on class=header-mark></a>Port to listen on.</h1><h1 id=heading-3 class=headerLink><a href=#heading-3 class=header-mark></a></h1><h1 id=mandatory-no-3 class=headerLink><a href=#mandatory-no-3 class=header-mark></a>Mandatory: no</h1><h1 id=range-1024-32767-1 class=headerLink><a href=#range-1024-32767-1 class=header-mark></a>Range: 1024-32767</h1><h1 id=default-3 class=headerLink><a href=#default-3 class=header-mark></a>Default:</h1><p>LISTEN_PORT=10053 # 配置监听端口</p><h3 id=option-zabbixpidfile class=headerLink><a href=#option-zabbixpidfile class=header-mark></a>Option: zabbix.pidFile</h3><h1 id=name-of-pid-file class=headerLink><a href=#name-of-pid-file class=header-mark></a>Name of PID file.</h1><h1 id=if-omitted-zabbix-java-gateway-is-started-as-a-console-application class=headerLink><a href=#if-omitted-zabbix-java-gateway-is-started-as-a-console-application class=header-mark></a>If omitted, Zabbix Java Gateway is started as a console application.</h1><h1 id=heading-4 class=headerLink><a href=#heading-4 class=header-mark></a></h1><h1 id=mandatory-no-4 class=headerLink><a href=#mandatory-no-4 class=header-mark></a>Mandatory: no</h1><h1 id=default-4 class=headerLink><a href=#default-4 class=header-mark></a>Default:</h1><h1 id=pid_file class=headerLink><a href=#pid_file class=header-mark></a>PID_FILE=</h1><p>PID_FILE="/var/run/zabbix/zabbix_java.pid"</p><h3 id=option-zabbixstartpollers class=headerLink><a href=#option-zabbixstartpollers class=header-mark></a>Option: zabbix.startPollers</h3><h1 id=number-of-worker-threads-to-start class=headerLink><a href=#number-of-worker-threads-to-start class=header-mark></a>Number of worker threads to start.</h1><h1 id=heading-5 class=headerLink><a href=#heading-5 class=header-mark></a></h1><h1 id=mandatory-no-5 class=headerLink><a href=#mandatory-no-5 class=header-mark></a>Mandatory: no</h1><h1 id=range-1-1000 class=headerLink><a href=#range-1-1000 class=header-mark></a>Range: 1-1000</h1><h1 id=default-5 class=headerLink><a href=#default-5 class=header-mark></a>Default:</h1><h1 id=不能大于zabbix_serverconf的值否则可能导致当连接java-gateway时没有多余的线程进行处理 class=headerLink><a href=#%e4%b8%8d%e8%83%bd%e5%a4%a7%e4%ba%8ezabbix_serverconf%e7%9a%84%e5%80%bc%e5%90%a6%e5%88%99%e5%8f%af%e8%83%bd%e5%af%bc%e8%87%b4%e5%bd%93%e8%bf%9e%e6%8e%a5java-gateway%e6%97%b6%e6%b2%a1%e6%9c%89%e5%a4%9a%e4%bd%99%e7%9a%84%e7%ba%bf%e7%a8%8b%e8%bf%9b%e8%a1%8c%e5%a4%84%e7%90%86 class=header-mark></a>不能大于zabbix_server.conf的值，否则可能导致当连接Java gateway时没有多余的线程进行处理</h1><p>START_POLLERS=5</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>最后启动启动zabbix-java-gateway，并重启zabbix-server
</span></span></code></pre></td></tr></table></div></div><p>[root@6 ~]# service zabbix-java-gateway start
Starting zabbix java gateway: [ OK ]
[root@6 ~]# service zabbix-server restart
Stopping zabbix server: [ OK ]
Starting zabbix server: [ OK ]</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>我在尝试重启发现一问题，zabbix-java-gateway通过service命令管理stop不能删除pid文件导致服务无法启动，如果你也碰到，解决办法如下:
</span></span></code></pre></td></tr></table></div></div><p>[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway</p><h1 id=line-97-注释修改为如下 class=headerLink><a href=#line-97-%e6%b3%a8%e9%87%8a%e4%bf%ae%e6%94%b9%e4%b8%ba%e5%a6%82%e4%b8%8b class=header-mark></a>line 97, 注释修改为如下：</h1><h1 id=kill-cat-pid_file--rm-pid_file class=headerLink><a href=#kill-cat-pid_file--rm-pid_file class=header-mark></a>kill <code>cat $PID_FILE</code> && rm $PID_FILE</h1><pre><code>    rm -f $PID_FILE
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#### 4. Adding jmx host on Zabbix Web consloe
</span></span><span class=line><span class=cl>首先，上传Template Tomcat Head Memory模板，这个我做了一个简单的模板，只针对了堆内存空间的监控，并针对使用率超过60%以及80%，不同的警报。需要的同学可以直接从我这里下载，然后在Configuration-Templates导入到zabbix模板库内。&lt;br&gt;
</span></span><span class=line><span class=cl>下载请点击:[Template App Tomcat Head Memory](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>然后，增加服务器的jmx监控&lt;br&gt;
</span></span><span class=line><span class=cl>![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png)
</span></span><span class=line><span class=cl>&lt;br&gt;
</span></span><span class=line><span class=cl>关联模板&lt;br&gt;
</span></span><span class=line><span class=cl>![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#### 5. View the Head Memory Monitoring.
</span></span><span class=line><span class=cl>![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png)
</span></span></code></pre></td></tr></table></div></div></div><h2>相关内容</h2><div class=related-container><div class=related-item-container><h2 class=related-title><a href=/posts/howto-set-tomcat-7-automatic-startup-with-centos-7/>HowTo set Tomcat 7 automatic startup with CentOS 7</a></h2></div><div class=related-item-container><h2 class=related-title><a href=/posts/tomcat-2-%E5%88%A9%E7%94%A8jdk%E8%87%AA%E8%BA%ABkeytool%E5%AE%9E%E7%8E%B0https/>Tomcat 利用JDK自身keytool实现HTTPS</a></h2></div><div class=related-item-container><h2 class=related-title><a href=/posts/tomcat-1-java-lang-outofmemoryerror/>Tomcat java.lang.OutOfMemoryError</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2017-01-18</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/howto-monitor-tomcat-head-memory-for-zabbix/index.md target=_blank rel="noopener noreferrer">阅读原始文档</a></span></div><div class=post-info-share><span><a href=# onclick=return!1 title="分享到 Twitter" data-sharer=twitter data-url=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/ data-title="HowTo Monitor Tomcat HeadMemory for Zabbix" data-via=samzong_lu data-hashtags=Zabbix,Tomcat><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="分享到 Facebook" data-sharer=facebook data-url=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/ data-hashtag=Zabbix><i class="fab fa-facebook-square fa-fw"></i></a><a href=# onclick=return!1 title="分享到 微博" data-sharer=weibo data-url=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/ data-title="HowTo Monitor Tomcat HeadMemory for Zabbix" data-ralateuid=3181653281><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/zabbix/>Zabbix</a>,&nbsp;<a href=/tags/tomcat/>Tomcat</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E6%AF%8F%E6%97%A5%E5%A4%87%E4%BB%BDmysql%E5%8D%95%E8%A1%A8%E6%95%B0%E6%8D%AE/ class=prev rel=prev title=每日备份MySQL单表数据><i class="fas fa-angle-left fa-fw"></i>每日备份MySQL单表数据</a>
<a href=/posts/mysql-8-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4%E5%92%8C%E6%9F%A5%E7%9C%8B/ class=next rel=next title="MySQL 索引创建、删除和查看">MySQL 索引创建、删除和查看<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/topbar/topbar.min.js></script><script type=text/javascript src=/lib/pjax/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},sharerjs:!0,table:{sort:!0},twemoji:!0}</script><script type=text/javascript src=/lib/twemoji/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript></div></body></html>