<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>HowTo Monitor Tomcat HeadMemory for Zabbix - SAMZONG</title><meta name=Description content><meta property="og:title" content="HowTo Monitor Tomcat HeadMemory for Zabbix"><meta property="og:description" content="æœ€è¿‘é¡¹ç›®ä¸Šç”±äºBUGé—®é¢˜å¯¼è‡´Tomcatç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»å¸¸å†…å­˜æ³„æ¼,è€Œæœ¬èº«ç›‘æ§ç³»ç»Ÿä¹‹ä¸­æ²¡æœ‰æ›´å¥½çš„æ£€æµ‹åˆ°Tomcatå †ç©ºé—´(Head Memo"><meta property="og:type" content="article"><meta property="og:url" content="https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-01-18T23:28:44+00:00"><meta property="article:modified_time" content="2017-01-18T23:28:44+00:00"><meta property="og:site_name" content="SAMZONG"><meta name=twitter:card content="summary"><meta name=twitter:title content="HowTo Monitor Tomcat HeadMemory for Zabbix"><meta name=twitter:description content="æœ€è¿‘é¡¹ç›®ä¸Šç”±äºBUGé—®é¢˜å¯¼è‡´Tomcatç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»å¸¸å†…å­˜æ³„æ¼,è€Œæœ¬èº«ç›‘æ§ç³»ç»Ÿä¹‹ä¸­æ²¡æœ‰æ›´å¥½çš„æ£€æµ‹åˆ°Tomcatå †ç©ºé—´(Head Memo"><meta name=application-name content="SAMZONG"><meta name=apple-mobile-web-app-title content="SAMZONG"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/><link rel=prev href=https://samzong.me/posts/%E6%AF%8F%E6%97%A5%E5%A4%87%E4%BB%BDmysql%E5%8D%95%E8%A1%A8%E6%95%B0%E6%8D%AE/><link rel=next href=https://samzong.me/posts/mysql-8-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4%E5%92%8C%E6%9F%A5%E7%9C%8B/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"HowTo Monitor Tomcat HeadMemory for Zabbix","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/samzong.me\/posts\/howto-monitor-tomcat-head-memory-for-zabbix\/"},"genre":"posts","keywords":"Zabbix, Tomcat","wordcount":2275,"url":"https:\/\/samzong.me\/posts\/howto-monitor-tomcat-head-memory-for-zabbix\/","datePublished":"2017-01-18T23:28:44+00:00","dateModified":"2017-01-18T23:28:44+00:00","publisher":{"@type":"Organization","name":"Samzong Lu"},"author":{"@type":"Person","name":"Samzong Lu"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG><span class=header-title-pre>ğŸš€ğŸš€ğŸš€ </span>SAMZONG</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>å…¨éƒ¨æ–‡ç«  </a><a class=menu-item href=/tags/>æ ‡ç­¾ </a><a class=menu-item href=/categories/>åˆ†ç±» </a><span class="menu-item delimiter"></span><a href=# onclick=return!1 class="menu-item language" title=é€‰æ‹©è¯­è¨€>ç®€ä½“ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" id=language-select-desktop onchange="location=this.value"><option value=/posts/howto-monitor-tomcat-head-memory-for-zabbix/ selected>ç®€ä½“ä¸­æ–‡</option></select>
</a><a href=# onclick=return!1 class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG><span class=header-title-pre>ğŸš€ğŸš€ğŸš€ </span>SAMZONG</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>å…¨éƒ¨æ–‡ç« </a><a class=menu-item href=/tags/ title>æ ‡ç­¾</a><a class=menu-item href=/categories/ title>åˆ†ç±»</a><a href=# onclick=return!1 class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜>
<i class="fas fa-adjust fa-fw"></i>
</a><a href=# onclick=return!1 class=menu-item title=é€‰æ‹©è¯­è¨€>ç®€ä½“ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" onchange="location=this.value"><option value=/posts/howto-monitor-tomcat-head-memory-for-zabbix/ selected>ç®€ä½“ä¸­æ–‡</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","wide")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","false")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">HowTo Monitor Tomcat HeadMemory for Zabbix</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Samzong Lu</a>
</span>&nbsp;<span class=post-category>æ”¶å½•äº </span>&nbsp;<span class=post-category>ç±»åˆ« <a href=/categories/opensource/><i class="far fa-folder fa-fw"></i>OpenSource</a>&nbsp;<a href=/categories/zabbix/><i class="far fa-folder fa-fw"></i>Zabbix</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2017-01-18>2017-01-18</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2017-01-18>2017-01-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 2275 å­—&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 5 åˆ†é’Ÿ&nbsp;</div></div><div class="details toc" id=toc-static kept=true><div class="details-summary toc-title"><span>ç›®å½•</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#zabbix-java-gatewayçš„å·¥ä½œæœºåˆ¶>zabbix-java-gatewayçš„å·¥ä½œæœºåˆ¶</a></li><li><a href=#1-install-zabbix-java-gateway-on-zabbix-server>1. Install zabbix-java-gateway on Zabbix Server</a></li><li><a href=#2-confiure-tomcat-host-with-enable-jmx>2. Confiure Tomcat host with enable jmx</a></li></ul></li><li><a href=#option-javagatewayport>Option: JavaGatewayPort</a></li></ul></li></ul><ul><li><ul><li><a href=#option-startjavapollers>Option: StartJavaPollers</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixlistenip>Option: zabbix.listenIP</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixlistenport>Option: zabbix.listenPort</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixpidfile>Option: zabbix.pidFile</a></li></ul></li></ul><ul><li><ul><li><a href=#option-zabbixstartpollers>Option: zabbix.startPollers</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>è­¦å‘Š<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>æœ¬æ–‡æœ€åæ›´æ–°äº <span class=timeago datetime=2017-01-18T23:28:44 title="January 18, 2017">2017-01-18</span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚</div></div></div><p>æœ€è¿‘é¡¹ç›®ä¸Šç”±äºBUGé—®é¢˜å¯¼è‡´Tomcatç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»å¸¸å†…å­˜æ³„æ¼,è€Œæœ¬èº«ç›‘æ§ç³»ç»Ÿä¹‹ä¸­æ²¡æœ‰æ›´å¥½çš„æ£€æµ‹åˆ°Tomcatå †ç©ºé—´(Head Memory)çš„ä½¿ç”¨æƒ…å†µå¯¼è‡´æŠ¥è­¦é¢‘å‘ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²è¿°ï¼Œå¦‚ä½•åœ¨Zabbixä¹‹ä¸­è°ƒç”¨jmxç›‘æ§æœåŠ¡å™¨ä¸ŠTomcatå †ç©ºé—´çš„ä½¿ç”¨æƒ…å†µå¹¶å¢åŠ å¯¹åº”æŠ¥è­¦åŠŸèƒ½ã€‚</p><blockquote><p>æµ‹è¯•ç¯å¢ƒ:<br>CentOS 6.8<br>Zabbix 2.4<br>Tomcat 7.0<br></p></blockquote><p>å®éªŒå‰æé»˜è®¤æ˜¯å„ä½å·²ç»å®‰è£…Zabbix ServeræœåŠ¡å™¨ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€å°Zabbix agentæœåŠ¡å™¨æ­£å¸¸ç›‘æ§ã€‚å…³äºå¦‚ä½•æ­å»ºZabbixç›‘æ§é›†ç¾¤ï¼Œä¼šæœ‰ä¸“é—¨æ–‡ç« æè¿°ã€‚</p><h4 id=zabbix-java-gatewayçš„å·¥ä½œæœºåˆ¶ class=headerLink><a href=#zabbix-java-gateway%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6 class=header-mark></a>zabbix-java-gatewayçš„å·¥ä½œæœºåˆ¶</h4><ul><li>é¦–å…ˆæˆ‘ä»¬éœ€è¦é…ç½®æˆ‘ä»¬çš„TomcatæœåŠ¡å¯ç”¨ç›‘æ§æœåŠ¡ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤ä¸å¯ç”¨çš„</li><li>ä¹‹åéœ€è¦åœ¨Zabbixçš„ç®¡ç†é¡µé¢æ·»åŠ å¯¹åº”TomcatæœåŠ¡å™¨çš„jmxç›‘æ§æ¥å£</li><li>æœ€åzabbixç«¯ä¼šè‡ªåŠ¨è·å–zabbix-java-gatewayçš„æ•°æ®å¹¶æ ¹æ®ç›¸åº”æ¨¡æ¿è¿›è¡Œå±•
ç¤º</li><li>å·¥ä½œæµ: [Zabbix-Server]&ndash;>(port:10053 on zabbix server)&ndash;> [zabbix-java-gateway] &ndash;(port:12345 on tomcatserver)&ndash;> [JMX enabled]</li></ul><h4 id=1-install-zabbix-java-gateway-on-zabbix-server class=headerLink><a href=#1-install-zabbix-java-gateway-on-zabbix-server class=header-mark></a>1. Install zabbix-java-gateway on Zabbix Server</h4><p>å› ä¸ºæˆ‘çš„zabbixæ˜¯ä½¿ç”¨zabbix 2.4å®˜æ–¹æºå®‰è£…ï¼Œæ‰€ä»¥åªéœ€è¦ç”¨yumåœ¨å®‰è£…å³å¯:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@6 ~]# sudo  yum install -y zabbix-java-gateway
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœä½ æ²¡æœ‰å®˜æ–¹æºå¯èƒ½å…ˆå®‰è£…è¯¥æºï¼Œæ³¨æ„æˆ‘çš„æœåŠ¡å™¨zabbixç‰ˆæœ¬æ˜¯2.4 å¦‚æœä½ æ˜¯ä¸åŒçš„ç‰ˆæœ¬ï¼Œè¯·åˆ°[<a href=http://repo.zabbix.com/zabbix/ target=_blank rel="noopener noreferrer">è¿™é‡Œ</a>]æŸ¥æ‰¾å¯¹åº”ç‰ˆæœ¬ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># æŸ¥çœ‹zabbix serverç‰ˆæœ¬
</span></span><span class=line><span class=cl>[root@6 ~]# zabbix_server --version
</span></span><span class=line><span class=cl>Zabbix server v2.4.8 (revision 59539) (20 April 2016)
</span></span><span class=line><span class=cl>Compilation time: May  4 2016 01:32:12
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ä½¿ç”¨yumå®‰è£…zabbix-java-gatewayæºæ—¶,ä¼šè‡ªåŠ¨å…³è”å®‰è£…openjdkï¼Œå°½ç®¡è¿™æ®µç¨‹åºæ²¡å¤šå¤§å½±å“ï¼Œå¦‚æœä½ æƒ³ä¿è¯ç³»ç»ŸJAVAç¯å¢ƒä¸å—åˆ°æ”¹å˜çš„è¯ï¼Œå¯ä»¥åœ¨/etc/profileæ–‡ä»¶æœ€åï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># add follows to the end
</span></span><span class=line><span class=cl>export JAVA_HOME=/usr/java/default
</span></span><span class=line><span class=cl>export PATH=$PATH:$JAVA_HOME/bin
</span></span><span class=line><span class=cl>export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</span></span></code></pre></td></tr></table></div></div><h4 id=2-confiure-tomcat-host-with-enable-jmx class=headerLink><a href=#2-confiure-tomcat-host-with-enable-jmx class=header-mark></a>2. Confiure Tomcat host with enable jmx</h4><p>é¦–å…ˆåœ¨$tomcatdir/bin/catalina.shæ–‡ä»¶å¼€å¤´å¤„å¢åŠ å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;-Dcom.sun.management.jmxremote \
</span></span></span><span class=line><span class=cl><span class=s2>-Dcom.sun.management.jmxremote.authenticate=false \
</span></span></span><span class=line><span class=cl><span class=s2>-Dcom.sun.management.jmxremote.ssl=false \
</span></span></span><span class=line><span class=cl><span class=s2>-Dcom.sun.management.jmxremote.port=12345&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶å,å¯åŠ¨Tomcatï¼Œä½ ä¼šå‘ç°å¤šäº†ä¸€ä¸ª12345ç«¯å£ï¼Œè¿™å°±æ˜¯jmxçš„ç›‘å¬ç«¯å£ï¼Œè¯·ä¿è¯zabbix-java-gatewayå¯ä»¥è®¿é—®åˆ°è¿™å°æœåŠ¡å™¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@6 ~]# /tomcat7/bin/startup.sh
</span></span><span class=line><span class=cl>Starting Tomcat7:
</span></span><span class=line><span class=cl>Using CATALINA_BASE:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_HOME:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_TMPDIR: /tomcat7/temp
</span></span><span class=line><span class=cl>Using JRE_HOME:        /usr
</span></span><span class=line><span class=cl>Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
</span></span><span class=line><span class=cl>Tomcat started.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[root@6 ~]# netstat -ntlp | grep 12345
</span></span><span class=line><span class=cl>tcp  0      0 :::12345   :::*     LISTEN      8793/java
</span></span><span class=line><span class=cl>[root@6 ~]#
</span></span></code></pre></td></tr></table></div></div><hr>#### ==*fix 1* == : zabbix agentä¸serverå­˜åœ¨å¤æ‚ç½‘ç»œç¯å¢ƒ<p>è¿™é‡Œç–å¿½äº†1ä¸ªé—®é¢˜ï¼Œå¦‚æœæ‚¨çš„zabbix serverä¸agentç«¯ä¹‹é—´æœ‰é˜²ç«å¢™è§„åˆ™ï¼Œè€ŒæŒ‰ç…§æˆ‘ä¸Šé¢çš„æ‰€è¿°åªæ˜¯å¢åŠ äº†12345è¿™ä¸ªç«¯å£ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ï¼Œæ‚¨åœ¨/var/log/zabbix/zabbix_java_gateway.log ä¸­ä¼šçœ‹åˆ°â€œNo route to hostâ€çš„æŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºJMXä¸å…‰å¼€å¯äº†12345ç«¯å£ï¼Œè¿˜å¼€å¯äº†å¦å¤–ä¸¤ä¸ªéšæœºç«¯å£ï¼Œè€Œåœ¨è·å–ç›‘æ§æ•°æ®æ—¶ä¼šä½¿ç”¨åˆ°å…¶ä¸­ä¸€ä¸ªï¼Œè¿™å°±å¯¼è‡´äº†æ— æ³•é€šè¿‡å›ºå®šçš„é˜²ç«å¢™è§„åˆ™æ¥å¼€æ”¾è¯¥ç«¯å£ã€‚å…¶å®æœ‰å¦å¤–ä¸€ä¸ªæ›¿ä»£æ–¹å¼æ¥ä½¿è¯¥ç›‘å¬ç«¯å£å›ºå®šä¸‹æ¥â€”â€”ä½¿ç”¨Tomcatæä¾›çš„é¢å¤–ç»„ä»¶ catalina-jmx-remote.jarï¼Œè¿™ä¸ªç»„ä»¶æ˜¯éœ€è¦å¦å¤–ä¸‹è½½çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># æŸ¥çœ‹å½“å‰Tomcatç‰ˆæœ¬.
</span></span><span class=line><span class=cl>[root@6 bin]# ./catalina.sh version
</span></span><span class=line><span class=cl>Using CATALINA_BASE:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_HOME:   /tomcat7
</span></span><span class=line><span class=cl>Using CATALINA_TMPDIR: /tomcat7/temp
</span></span><span class=line><span class=cl>Using JRE_HOME:        /usr
</span></span><span class=line><span class=cl>Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
</span></span><span class=line><span class=cl>Server version: Apache Tomcat/7.0.64
</span></span><span class=line><span class=cl>Server built:   Aug 19 2015 17:18:06 UTC
</span></span><span class=line><span class=cl>Server number:  7.0.64.0
</span></span><span class=line><span class=cl>OS Name:        Linux
</span></span><span class=line><span class=cl>OS Version:     2.6.32-642.11.1.el6.x86_64
</span></span><span class=line><span class=cl>Architecture:   amd64
</span></span><span class=line><span class=cl>JVM Version:    1.8.0_111-b15
</span></span><span class=line><span class=cl>JVM Vendor:     Oracle Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># ä¸‹è½½ catalina-jmx-remote.jar # è¯·æ³¨æ„ä¸‹è½½ç‰ˆæœ¬ä¸è¦é«˜äºå½“å‰tomcatç‰ˆæœ¬.
</span></span><span class=line><span class=cl>wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar
</span></span></code></pre></td></tr></table></div></div><p>å¢åŠ å¦‚ä¸‹å†…å®¹ï¼Œåœ¨conf/server.xmlä¸­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;Listener className=&#34;org.apache.catalina.mbeans.JmxRemoteLifecycleListener&#34;
</span></span><span class=line><span class=cl>          rmiRegistryPortPlatform=&#34;12345&#34; rmiServerPortPlatform=&#34;12346&#34; /&gt;
</span></span></code></pre></td></tr></table></div></div><p>å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨conf/server.xmlå®šä¹‰äº†rmiRegistryPortPlatformï¼Œæ‰€ä»¥è¦å°†bin/catalina.shä¸­CATALINA_OPTSçš„com.sun.management.jmxremote.portå»æ‰ï¼Œå¦åˆ™ä¼šå› ä¸ºjmxremote.porté…ç½®æœ‰ä¼˜å…ˆçº§æ›´é«˜è€Œå¯¼è‡´é…ç½®å¤±æ•ˆã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>CATALINA_OPTS=&#34;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false&#34;
</span></span></code></pre></td></tr></table></div></div><p>å®Œæˆä¹‹åï¼Œé‡å¯tomcatè¿™æ—¶ä¼šå‘ç°jmxé»˜è®¤ç«¯å£å·²ç»å›ºå®šä¸º12345ä½•12346ï¼Œè€Œserverä¾ç„¶å¯ä»¥æ­£å¸¸è·å–ç›‘æ§æ•°æ®.</p><hr>#### 3. Configure Zabbix Server
é¦–å…ˆéœ€è¦ä¿®æ”¹zabbix_server.confå¯ç”¨zabbix-java-gatewayï¼Œè®©zabbixå¯ä»¥æ£€æµ‹åˆ°æœåŠ¡,ä¿®æ”¹å¦‚ä¸‹:
```
### Option: JavaGateway
# IP address (or hostname) of Zabbix Java gateway.
# Only required if Java pollers are started.
#
# Mandatory: no
# Default:
JavaGateway=10.211.55.4 # è®¾ç½®ä¸ºä½ çš„zabbixsever IP<h3 id=option-javagatewayport class=headerLink><a href=#option-javagatewayport class=header-mark></a>Option: JavaGatewayPort</h3><h1 id=port-that-zabbix-java-gateway-listens-on class=headerLink><a href=#port-that-zabbix-java-gateway-listens-on class=header-mark></a>Port that Zabbix Java gateway listens on.</h1><h1 id=heading class=headerLink><a href=#heading class=header-mark></a></h1><h1 id=mandatory-no class=headerLink><a href=#mandatory-no class=header-mark></a>Mandatory: no</h1><h1 id=range-1024-32767 class=headerLink><a href=#range-1024-32767 class=header-mark></a>Range: 1024-32767</h1><h1 id=default class=headerLink><a href=#default class=header-mark></a>Default:</h1><p>JavaGatewayPort=10053 # è®¾ç½®æœåŠ¡ç«¯ç›‘å¬æ¥å£</p><h3 id=option-startjavapollers class=headerLink><a href=#option-startjavapollers class=header-mark></a>Option: StartJavaPollers</h3><h1 id=number-of-pre-forked-instances-of-java-pollers class=headerLink><a href=#number-of-pre-forked-instances-of-java-pollers class=header-mark></a>Number of pre-forked instances of Java pollers.</h1><h1 id=heading-1 class=headerLink><a href=#heading-1 class=header-mark></a></h1><h1 id=mandatory-no-1 class=headerLink><a href=#mandatory-no-1 class=header-mark></a>Mandatory: no</h1><h1 id=range-0-1000 class=headerLink><a href=#range-0-1000 class=header-mark></a>Range: 0-1000</h1><h1 id=default-1 class=headerLink><a href=#default-1 class=header-mark></a>Default:</h1><p>StartJavaPollers=5 # è®¾ç½®å¤šçº¿ç¨‹å¯åŠ¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ç„¶åä¿®æ”¹zabbix\_java\_gateway.conf é…ç½®å¦‚ä¸‹:
</span></span></code></pre></td></tr></table></div></div><h3 id=option-zabbixlistenip class=headerLink><a href=#option-zabbixlistenip class=header-mark></a>Option: zabbix.listenIP</h3><h1 id=ip-address-to-listen-on class=headerLink><a href=#ip-address-to-listen-on class=header-mark></a>IP address to listen on.</h1><h1 id=heading-2 class=headerLink><a href=#heading-2 class=header-mark></a></h1><h1 id=mandatory-no-2 class=headerLink><a href=#mandatory-no-2 class=header-mark></a>Mandatory: no</h1><h1 id=default-2 class=headerLink><a href=#default-2 class=header-mark></a>Default:</h1><p>LISTEN_IP=&ldquo;10.211.55.4&rdquo; # é…ç½®ç›‘å¬IP</p><h3 id=option-zabbixlistenport class=headerLink><a href=#option-zabbixlistenport class=header-mark></a>Option: zabbix.listenPort</h3><h1 id=port-to-listen-on class=headerLink><a href=#port-to-listen-on class=header-mark></a>Port to listen on.</h1><h1 id=heading-3 class=headerLink><a href=#heading-3 class=header-mark></a></h1><h1 id=mandatory-no-3 class=headerLink><a href=#mandatory-no-3 class=header-mark></a>Mandatory: no</h1><h1 id=range-1024-32767-1 class=headerLink><a href=#range-1024-32767-1 class=header-mark></a>Range: 1024-32767</h1><h1 id=default-3 class=headerLink><a href=#default-3 class=header-mark></a>Default:</h1><p>LISTEN_PORT=10053 # é…ç½®ç›‘å¬ç«¯å£</p><h3 id=option-zabbixpidfile class=headerLink><a href=#option-zabbixpidfile class=header-mark></a>Option: zabbix.pidFile</h3><h1 id=name-of-pid-file class=headerLink><a href=#name-of-pid-file class=header-mark></a>Name of PID file.</h1><h1 id=if-omitted-zabbix-java-gateway-is-started-as-a-console-application class=headerLink><a href=#if-omitted-zabbix-java-gateway-is-started-as-a-console-application class=header-mark></a>If omitted, Zabbix Java Gateway is started as a console application.</h1><h1 id=heading-4 class=headerLink><a href=#heading-4 class=header-mark></a></h1><h1 id=mandatory-no-4 class=headerLink><a href=#mandatory-no-4 class=header-mark></a>Mandatory: no</h1><h1 id=default-4 class=headerLink><a href=#default-4 class=header-mark></a>Default:</h1><h1 id=pid_file class=headerLink><a href=#pid_file class=header-mark></a>PID_FILE=</h1><p>PID_FILE="/var/run/zabbix/zabbix_java.pid"</p><h3 id=option-zabbixstartpollers class=headerLink><a href=#option-zabbixstartpollers class=header-mark></a>Option: zabbix.startPollers</h3><h1 id=number-of-worker-threads-to-start class=headerLink><a href=#number-of-worker-threads-to-start class=header-mark></a>Number of worker threads to start.</h1><h1 id=heading-5 class=headerLink><a href=#heading-5 class=header-mark></a></h1><h1 id=mandatory-no-5 class=headerLink><a href=#mandatory-no-5 class=header-mark></a>Mandatory: no</h1><h1 id=range-1-1000 class=headerLink><a href=#range-1-1000 class=header-mark></a>Range: 1-1000</h1><h1 id=default-5 class=headerLink><a href=#default-5 class=header-mark></a>Default:</h1><h1 id=ä¸èƒ½å¤§äºzabbix_serverconfçš„å€¼å¦åˆ™å¯èƒ½å¯¼è‡´å½“è¿æ¥java-gatewayæ—¶æ²¡æœ‰å¤šä½™çš„çº¿ç¨‹è¿›è¡Œå¤„ç† class=headerLink><a href=#%e4%b8%8d%e8%83%bd%e5%a4%a7%e4%ba%8ezabbix_serverconf%e7%9a%84%e5%80%bc%e5%90%a6%e5%88%99%e5%8f%af%e8%83%bd%e5%af%bc%e8%87%b4%e5%bd%93%e8%bf%9e%e6%8e%a5java-gateway%e6%97%b6%e6%b2%a1%e6%9c%89%e5%a4%9a%e4%bd%99%e7%9a%84%e7%ba%bf%e7%a8%8b%e8%bf%9b%e8%a1%8c%e5%a4%84%e7%90%86 class=header-mark></a>ä¸èƒ½å¤§äºzabbix_server.confçš„å€¼ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å½“è¿æ¥Java gatewayæ—¶æ²¡æœ‰å¤šä½™çš„çº¿ç¨‹è¿›è¡Œå¤„ç†</h1><p>START_POLLERS=5</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æœ€åå¯åŠ¨å¯åŠ¨zabbix-java-gatewayï¼Œå¹¶é‡å¯zabbix-server
</span></span></code></pre></td></tr></table></div></div><p>[root@6 ~]# service zabbix-java-gateway start
Starting zabbix java gateway: [ OK ]
[root@6 ~]# service zabbix-server restart
Stopping zabbix server: [ OK ]
Starting zabbix server: [ OK ]</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æˆ‘åœ¨å°è¯•é‡å¯å‘ç°ä¸€é—®é¢˜ï¼Œzabbix-java-gatewayé€šè¿‡serviceå‘½ä»¤ç®¡ç†stopä¸èƒ½åˆ é™¤pidæ–‡ä»¶å¯¼è‡´æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œå¦‚æœä½ ä¹Ÿç¢°åˆ°ï¼Œè§£å†³åŠæ³•å¦‚ä¸‹:
</span></span></code></pre></td></tr></table></div></div><p>[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway</p><h1 id=line-97-æ³¨é‡Šä¿®æ”¹ä¸ºå¦‚ä¸‹ class=headerLink><a href=#line-97-%e6%b3%a8%e9%87%8a%e4%bf%ae%e6%94%b9%e4%b8%ba%e5%a6%82%e4%b8%8b class=header-mark></a>line 97, æ³¨é‡Šä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</h1><h1 id=kill-cat-pid_file--rm-pid_file class=headerLink><a href=#kill-cat-pid_file--rm-pid_file class=header-mark></a>kill <code>cat $PID_FILE</code> && rm $PID_FILE</h1><pre><code>    rm -f $PID_FILE
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#### 4. Adding jmx host on Zabbix Web consloe
</span></span><span class=line><span class=cl>é¦–å…ˆï¼Œä¸Šä¼ Template Tomcat Head Memoryæ¨¡æ¿ï¼Œè¿™ä¸ªæˆ‘åšäº†ä¸€ä¸ªç®€å•çš„æ¨¡æ¿ï¼Œåªé’ˆå¯¹äº†å †å†…å­˜ç©ºé—´çš„ç›‘æ§ï¼Œå¹¶é’ˆå¯¹ä½¿ç”¨ç‡è¶…è¿‡60%ä»¥åŠ80%ï¼Œä¸åŒçš„è­¦æŠ¥ã€‚éœ€è¦çš„åŒå­¦å¯ä»¥ç›´æ¥ä»æˆ‘è¿™é‡Œä¸‹è½½ï¼Œç„¶ååœ¨Configuration-Templateså¯¼å…¥åˆ°zabbixæ¨¡æ¿åº“å†…ã€‚&lt;br&gt;
</span></span><span class=line><span class=cl>ä¸‹è½½è¯·ç‚¹å‡»:[Template App Tomcat Head Memory](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç„¶åï¼Œå¢åŠ æœåŠ¡å™¨çš„jmxç›‘æ§&lt;br&gt;
</span></span><span class=line><span class=cl>![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png)
</span></span><span class=line><span class=cl>&lt;br&gt;
</span></span><span class=line><span class=cl>å…³è”æ¨¡æ¿&lt;br&gt;
</span></span><span class=line><span class=cl>![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#### 5. View the Head Memory Monitoring.
</span></span><span class=line><span class=cl>![](https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png)
</span></span></code></pre></td></tr></table></div></div></div><h2>ç›¸å…³å†…å®¹</h2><div class=related-container><div class=related-item-container><h2 class=related-title><a href=/posts/howto-set-tomcat-7-automatic-startup-with-centos-7/>HowTo set Tomcat 7 automatic startup with CentOS 7</a></h2></div><div class=related-item-container><h2 class=related-title><a href=/posts/tomcat-2-%E5%88%A9%E7%94%A8jdk%E8%87%AA%E8%BA%ABkeytool%E5%AE%9E%E7%8E%B0https/>Tomcat åˆ©ç”¨JDKè‡ªèº«keytoolå®ç°HTTPS</a></h2></div><div class=related-item-container><h2 class=related-title><a href=/posts/tomcat-1-java-lang-outofmemoryerror/>Tomcat java.lang.OutOfMemoryError</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>æ›´æ–°äº 2017-01-18</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/posts/howto-monitor-tomcat-head-memory-for-zabbix/index.md target=_blank rel="noopener noreferrer">é˜…è¯»åŸå§‹æ–‡æ¡£</a></span></div><div class=post-info-share><span><a href=# onclick=return!1 title="åˆ†äº«åˆ° Twitter" data-sharer=twitter data-url=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/ data-title="HowTo Monitor Tomcat HeadMemory for Zabbix" data-via=samzong_lu data-hashtags=Zabbix,Tomcat><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="åˆ†äº«åˆ° Facebook" data-sharer=facebook data-url=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/ data-hashtag=Zabbix><i class="fab fa-facebook-square fa-fw"></i></a><a href=# onclick=return!1 title="åˆ†äº«åˆ° å¾®åš" data-sharer=weibo data-url=https://samzong.me/posts/howto-monitor-tomcat-head-memory-for-zabbix/ data-title="HowTo Monitor Tomcat HeadMemory for Zabbix" data-ralateuid=3181653281><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/zabbix/>Zabbix</a>,&nbsp;<a href=/tags/tomcat/>Tomcat</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>è¿”å›</a></span>&nbsp;|&nbsp;<span><a href=/>ä¸»é¡µ</a></span></section></div><div class=post-nav><a href=/posts/%E6%AF%8F%E6%97%A5%E5%A4%87%E4%BB%BDmysql%E5%8D%95%E8%A1%A8%E6%95%B0%E6%8D%AE/ class=prev rel=prev title=æ¯æ—¥å¤‡ä»½MySQLå•è¡¨æ•°æ®><i class="fas fa-angle-left fa-fw"></i>æ¯æ—¥å¤‡ä»½MySQLå•è¡¨æ•°æ®</a>
<a href=/posts/mysql-8-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4%E5%92%8C%E6%9F%A5%E7%9C%8B/ class=next rel=next title="MySQL ç´¢å¼•åˆ›å»ºã€åˆ é™¤å’ŒæŸ¥çœ‹">MySQL ç´¢å¼•åˆ›å»ºã€åˆ é™¤å’ŒæŸ¥çœ‹<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=å›åˆ°é¡¶éƒ¨><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=æŸ¥çœ‹è¯„è®º><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/topbar/topbar.min.js></script><script type=text/javascript src=/lib/pjax/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"å¤åˆ¶åˆ°å‰ªè´´æ¿",maxShownLines:10},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},sharerjs:!0,table:{sort:!0},twemoji:!0}</script><script type=text/javascript src=/lib/twemoji/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript></div></body></html>