<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥ - SAMZONG</title><meta name=Description content><meta property="og:title" content="ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥"><meta property="og:description" content="ä»inodeäº†è§£Linuxæ–‡ä»¶ç³»ç»Ÿ ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥æ˜¯ Linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå…¶æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç´¢å¼•èŠ‚ç‚¹ (index node åˆç§° inode)ï¼Œè€Œç´¢å¼•èŠ‚ç‚¹å¯¹è±¡"><meta property="og:type" content="article"><meta property="og:url" content="https://samzong.me/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-03-18T14:52:13+00:00"><meta property="article:modified_time" content="2016-03-18T14:52:13+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥"><meta name=twitter:description content="ä»inodeäº†è§£Linuxæ–‡ä»¶ç³»ç»Ÿ ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥æ˜¯ Linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå…¶æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç´¢å¼•èŠ‚ç‚¹ (index node åˆç§° inode)ï¼Œè€Œç´¢å¼•èŠ‚ç‚¹å¯¹è±¡"><meta name=application-name content="SAMZONG"><meta name=apple-mobile-web-app-title content="SAMZONG"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://samzong.me/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/><link rel=prev href=https://samzong.me/%E9%BE%99%E6%97%8F%E8%B7%AF%E6%98%8E%E9%9D%9E/><link rel=next href=https://samzong.me/centos-6-2-%E5%88%9D%E5%A7%8B%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96%E6%93%8D%E4%BD%9C/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/samzong.me\/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5\/"},"genre":"posts","keywords":"Linux","wordcount":6730,"url":"https:\/\/samzong.me\/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5\/","datePublished":"2016-03-18T14:52:13+00:00","dateModified":"2016-03-18T14:52:13+00:00","publisher":{"@type":"Organization","name":"Samzong"},"author":{"@type":"Person","name":"Samzong"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG>SAMZONG</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>ğŸ¤– å…¨éƒ¨æ–‡ç«  </a><a class=menu-item href=/tags/>ğŸ· æ ‡ç­¾ </a><a class=menu-item href=/categories/>ğŸ“– åˆ†ç±» </a><a class=menu-item href=https://github.com/samzong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i> GitHub </a><span class="menu-item delimiter"></span><a href=# onclick=return!1 class="menu-item language" title=é€‰æ‹©è¯­è¨€>ç®€ä½“ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" id=language-select-desktop onchange="location=this.value"><option value=/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/ selected>ç®€ä½“ä¸­æ–‡</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹... id=search-input-desktop>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-desktop title=æœç´¢><i class="fas fa-search fa-fw"></i></a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-desktop title=æ¸…ç©º><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=# onclick=return!1 class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=SAMZONG>SAMZONG</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹... id=search-input-mobile>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-mobile title=æœç´¢><i class="fas fa-search fa-fw"></i></a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-mobile title=æ¸…ç©º><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# onclick=return!1 class=search-cancel id=search-cancel-mobile>å–æ¶ˆ</a></div><a class=menu-item href=/posts/ title>ğŸ¤–å…¨éƒ¨æ–‡ç« </a><a class=menu-item href=/tags/ title>ğŸ·æ ‡ç­¾</a><a class=menu-item href=/categories/ title>ğŸ“–åˆ†ç±»</a><a class=menu-item href=https://github.com/samzong/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw'></i>GitHub</a><a href=# onclick=return!1 class="menu-item theme-switch" title=åˆ‡æ¢ä¸»é¢˜>
<i class="fas fa-adjust fa-fw"></i>
</a><a href=# onclick=return!1 class=menu-item title=é€‰æ‹©è¯­è¨€>ç®€ä½“ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select title="Select Language" onchange="location=this.value"><option value=/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/ selected>ç®€ä½“ä¸­æ–‡</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","wide")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","false")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Samzong</a>
</span>&nbsp;<span class=post-category>æ”¶å½•äº </span>&nbsp;<span class=post-category>ç±»åˆ« <a href=/categories/linux/><i class="far fa-folder fa-fw"></i>Linux</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2016-03-18>2016-03-18</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2016-03-18>2016-03-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;çº¦ 6730 å­—&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;é¢„è®¡é˜…è¯» 14 åˆ†é’Ÿ&nbsp;</div></div><div class="details toc" id=toc-static kept=true><div class="details-summary toc-title"><span>ç›®å½•</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>è­¦å‘Š<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>æœ¬æ–‡æœ€åæ›´æ–°äº <span class=timeago datetime=2016-03-18T14:52:13 title="March 18, 2016">2016-03-18</span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚</div></div></div><h2>ä»inodeäº†è§£Linuxæ–‡ä»¶ç³»ç»Ÿ</h2><p>Â Â Â Â Â Â Â ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥æ˜¯ Linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå…¶æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç´¢å¼•èŠ‚ç‚¹ (index node åˆç§° inode)ï¼Œè€Œç´¢å¼•èŠ‚ç‚¹å¯¹è±¡æ˜¯ Linux è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ (VFS) çš„å››ä¸ªåŸºæœ¬æ¦‚å¿µä¹‹ä¸€ã€‚é€šè¿‡å‰–æç¡¬é“¾æ¥ä¸è½¯é“¾æ¥çš„è”ç³»ä¸åŒºåˆ«ï¼Œæˆ‘ä»¬å¯æ›´å¥½çš„äº†è§£ Linux ä¸­ VFS è¿™ä¸€é€šç”¨æ–‡ä»¶æ¨¡å‹ã€‚å¹¶è®© Linux æ™®é€šç”¨æˆ·å’Œç³»ç»Ÿç®¡ç†å‘˜æ­£ç¡®ä½¿ç”¨ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥ï¼Œå¸®åŠ©æ–‡ä»¶ç³»ç»Ÿå¼€å‘è€…è·å– inode çš„ç›¸å…³çŸ¥è¯†ã€‚</p><h3>Linuxçš„æ–‡ä»¶ç³»ç»Ÿä¸ç›®å½•</h3>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç°ä»£æ“ä½œç³»ç»Ÿä¸ºè§£å†³ä¿¡æ¯èƒ½ç‹¬ç«‹äºè¿›ç¨‹ä¹‹å¤–è¢«é•¿æœŸå­˜å‚¨å¼•å…¥äº†æ–‡ä»¶ï¼Œæ–‡ä»¶ä½œä¸ºè¿›ç¨‹åˆ›å»ºä¿¡æ¯çš„é€»è¾‘å•å…ƒå¯è¢«å¤šä¸ªè¿›ç¨‹å¹¶å‘ä½¿ç”¨ã€‚åœ¨ UNIX ç³»ç»Ÿä¸­ï¼Œæ“ä½œç³»ç»Ÿä¸ºç£ç›˜ä¸Šçš„æ–‡æœ¬ä¸å›¾åƒã€é¼ æ ‡ä¸é”®ç›˜ç­‰è¾“å…¥è®¾å¤‡åŠç½‘ç»œäº¤äº’ç­‰ I/O æ“ä½œè®¾è®¡äº†ä¸€ç»„é€šç”¨ APIï¼Œä½¿ä»–ä»¬è¢«å¤„ç†æ—¶å‡å¯ç»Ÿä¸€ä½¿ç”¨å­—èŠ‚æµæ–¹å¼ã€‚æ¢è¨€ä¹‹ï¼ŒUNIX ç³»ç»Ÿä¸­é™¤è¿›ç¨‹ä¹‹å¤–çš„ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶ï¼Œè€Œ Linux ä¿æŒäº†è¿™ä¸€ç‰¹æ€§ã€‚ä¸ºäº†ä¾¿äºæ–‡ä»¶çš„ç®¡ç†ï¼ŒLinux è¿˜å¼•å…¥äº†ç›®å½•ï¼ˆæœ‰æ—¶äº¦è¢«ç§°ä¸ºæ–‡ä»¶å¤¹ï¼‰è¿™ä¸€æ¦‚å¿µã€‚ç›®å½•ä½¿æ–‡ä»¶å¯è¢«åˆ†ç±»ç®¡ç†ï¼Œä¸”ç›®å½•çš„å¼•å…¥ä½¿ Linux çš„æ–‡ä»¶ç³»ç»Ÿå½¢æˆä¸€ä¸ªå±‚çº§ç»“æ„çš„ç›®å½•æ ‘ã€‚<a href=#list1>æ¸…å•1.</a>æ‰€ç¤ºçš„æ˜¯æ™®é€š Linux ç³»ç»Ÿçš„é¡¶å±‚ç›®å½•ç»“æ„ï¼Œå…¶ä¸­ /dev æ˜¯å­˜æ”¾äº†è®¾å¤‡ç›¸å…³æ–‡ä»¶çš„ç›®å½•ã€‚<h4 id=list1>æ¸…å• 1. Linuxç³»ç»Ÿçš„é¡¶å±‚ç›®å½•ç»“æ„</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> /              æ ¹ç›®å½•
</span></span><span class=line><span class=cl>â”œâ”€â”€ bin     å­˜æ”¾ç”¨æˆ·äºŒè¿›åˆ¶æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ boot    å­˜æ”¾å†…æ ¸å¼•å¯¼é…ç½®æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ dev     å­˜æ”¾è®¾å¤‡æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ etc     å­˜æ”¾ç³»ç»Ÿé…ç½®æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ home    ç”¨æˆ·ä¸»ç›®å½•
</span></span><span class=line><span class=cl>â”œâ”€â”€ lib     åŠ¨æ€å…±äº«åº“
</span></span><span class=line><span class=cl>â”œâ”€â”€ lost+found 	æ–‡ä»¶ç³»ç»Ÿæ¢å¤æ—¶çš„æ¢å¤æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ media   å¯å¸è½½å­˜å‚¨ä»‹è´¨æŒ‚è½½ç‚¹
</span></span><span class=line><span class=cl>â”œâ”€â”€ mnt     æ–‡ä»¶ç³»ç»Ÿä¸´æ—¶æŒ‚è½½ç‚¹
</span></span><span class=line><span class=cl>â”œâ”€â”€ opt     é™„åŠ çš„åº”ç”¨ç¨‹åºåŒ…
</span></span><span class=line><span class=cl>â”œâ”€â”€ proc    ç³»ç»Ÿå†…å­˜çš„æ˜ å°„ç›®å½•ï¼Œæä¾›å†…æ ¸ä¸è¿›ç¨‹ä¿¡æ¯
</span></span><span class=line><span class=cl>â”œâ”€â”€ root    root ç”¨æˆ·ä¸»ç›®å½•
</span></span><span class=line><span class=cl>â”œâ”€â”€ sbin    å­˜æ”¾ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ srv     å­˜æ”¾æœåŠ¡ç›¸å…³æ•°æ®
</span></span><span class=line><span class=cl>â”œâ”€â”€ sys     sys è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹
</span></span><span class=line><span class=cl>â”œâ”€â”€ tmp     å­˜æ”¾ä¸´æ—¶æ–‡ä»¶
</span></span><span class=line><span class=cl>â”œâ”€â”€ usr     å­˜æ”¾ç”¨æˆ·åº”ç”¨ç¨‹åº
</span></span><span class=line><span class=cl>â””â”€â”€ var     å­˜æ”¾é‚®ä»¶ã€ç³»ç»Ÿæ—¥å¿—ç­‰å˜åŒ–æ–‡ä»¶
</span></span></code></pre></td></tr></table></div></div><p>Â Â Â Â Â Â Â Linux å°†è®¾å¤‡å½“åšæ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ<a href=#list2>æ¸…å• 2.</a>å±•ç¤ºäº†å¦‚ä½•æ‰“å¼€è®¾å¤‡æ–‡ä»¶ /dev/input/event5 å¹¶è¯»å–æ–‡ä»¶å†…å®¹ã€‚æ–‡ä»¶ event5 è¡¨ç¤ºä¸€ç§è¾“å…¥è®¾å¤‡ï¼Œå…¶å¯èƒ½æ˜¯é¼ æ ‡æˆ–é”®ç›˜ç­‰ã€‚æŸ¥çœ‹æ–‡ä»¶ /proc/bus/input/devices å¯çŸ¥ event5 å¯¹åº”è®¾å¤‡çš„ç±»å‹ã€‚è®¾å¤‡æ–‡ä»¶ /dev/input/event5 ä½¿ç”¨ read() ä»¥å­—ç¬¦æµçš„æ–¹å¼è¢«è¯»å–ã€‚ç»“æ„ä½“ input_event è¢«å®šä¹‰åœ¨å†…æ ¸å¤´æ–‡ä»¶ linux/input.h ä¸­ã€‚</p><h4 id=list2>æ¸…å• 2. æ‰“å¼€å¹¶è¯»å–è®¾å¤‡æ–‡ä»¶</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> int fd;
</span></span><span class=line><span class=cl> struct input_event ie;
</span></span><span class=line><span class=cl> fd = open(&#34;/dev/input/event5&#34;, O_RDONLY);
</span></span><span class=line><span class=cl> read(fd, &amp;ie, sizeof(struct input_event));
</span></span><span class=line><span class=cl> printf(&#34;type = %d  code = %d  value = %d\n&#34;,
</span></span><span class=line><span class=cl>			 ie.type, ie.code, ie.value);
</span></span><span class=line><span class=cl> close(fd);
</span></span></code></pre></td></tr></table></div></div><br>### ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥çš„è”ç³»ä¸åŒºåˆ«
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬çŸ¥é“æ–‡ä»¶éƒ½æœ‰æ–‡ä»¶åä¸æ•°æ®ï¼Œè¿™åœ¨ Linux ä¸Šè¢«åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šç”¨æˆ·æ•°æ® (user data) ä¸å…ƒæ•°æ® (metadata)ã€‚ç”¨æˆ·æ•°æ®ï¼Œå³æ–‡ä»¶æ•°æ®å— (data block)ï¼Œæ•°æ®å—æ˜¯è®°å½•æ–‡ä»¶çœŸå®å†…å®¹çš„åœ°æ–¹ï¼›è€Œå…ƒæ•°æ®åˆ™æ˜¯æ–‡ä»¶çš„é™„åŠ å±æ€§ï¼Œå¦‚æ–‡ä»¶å¤§å°ã€åˆ›å»ºæ—¶é—´ã€æ‰€æœ‰è€…ç­‰ä¿¡æ¯ã€‚åœ¨ Linux ä¸­ï¼Œå…ƒæ•°æ®ä¸­çš„ inode å·ï¼ˆinode æ˜¯æ–‡ä»¶å…ƒæ•°æ®çš„ä¸€éƒ¨åˆ†ä½†å…¶å¹¶ä¸åŒ…å«æ–‡ä»¶åï¼Œinode å·å³ç´¢å¼•èŠ‚ç‚¹å·ï¼‰æ‰æ˜¯æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†è€Œéæ–‡ä»¶åã€‚æ–‡ä»¶åä»…æ˜¯ä¸ºäº†æ–¹ä¾¿äººä»¬çš„è®°å¿†å’Œä½¿ç”¨ï¼Œç³»ç»Ÿæˆ–ç¨‹åºé€šè¿‡ inode å·å¯»æ‰¾æ­£ç¡®çš„æ–‡ä»¶æ•°æ®å—ã€‚<a href=#p1>å›¾ 1.</a>å±•ç¤ºäº†ç¨‹åºé€šè¿‡æ–‡ä»¶åè·å–æ–‡ä»¶å†…å®¹çš„è¿‡ç¨‹ã€‚<h4 id=p1>å›¾ 1. é€šè¿‡æ–‡ä»¶åæ‰“å¼€æ–‡ä»¶</h4>![](http://120.24.251.209/content/images/2016/03/image001.jpg)<p>Â Â Â Â Â Â Â åœ¨Linux ç³»ç»Ÿä¸­æŸ¥çœ‹ inodeå·å¯ä½¿ç”¨å‘½ä»¤stat æˆ– ls -iï¼ˆè‹¥æ˜¯ AIX ç³»ç»Ÿï¼Œåˆ™ä½¿ç”¨å‘½ä»¤ istatï¼‰ã€‚<a href=#list3>æ¸…å• 3.</a>ä¸­ä½¿ç”¨å‘½ä»¤ mv ç§»åŠ¨å¹¶é‡å‘½åæ–‡ä»¶ glibc-2.16.0.tar.xzï¼Œå…¶ç»“æœä¸å½±å“æ–‡ä»¶çš„ç”¨æˆ·æ•°æ®åŠ inode å·ï¼Œæ–‡ä»¶ç§»åŠ¨å‰å inode å·å‡ä¸ºï¼š2485677ã€‚</p><h4 id=list3>æ¸…å• 3. ç§»åŠ¨æˆ–é‡å‘½åæ–‡ä»¶</h4>```
# stat /home/harris/source/glibc-2.16.0.tar.xz
File: `/home/harris/source/glibc-2.16.0.tar.xz'
Size: 9990512 Blocks: 19520 IO Block: 4096 regular file
Device: 807h/2055d Inode: 2485677 Links: 1
Access: (0600/-rw-------) Uid: ( 1000/ harris) Gid: ( 1000/ harris)
...
...
// ç»ç½‘å‹æŒ‡å‡ºï¼Œä½¿ç”¨mvç§»åŠ¨æ—¶ä¸è·¨ç£ç›˜inodeå·ä¸å˜ï¼Œå¦‚æœè·¨ç£ç›˜inodeä¼šæ”¹å˜ã€‚
# mv /home/harris/source/glibc-2.16.0.tar.xz /home/harris/Desktop/glibc.tar.xz
# ls -i -F /home/harris/Desktop/glibc.tar.xz
2485677 /home/harris/Desktop/glibc.tar.xz
```<p>Â Â Â Â Â Â Â ä¸ºè§£å†³æ–‡ä»¶çš„å…±äº«ä½¿ç”¨ï¼ŒLinux ç³»ç»Ÿå¼•å…¥äº†ä¸¤ç§é“¾æ¥ï¼šç¡¬é“¾æ¥ (hard link) ä¸è½¯é“¾æ¥ï¼ˆåˆç§°ç¬¦å·é“¾æ¥ï¼Œå³ soft link æˆ– symbolic linkï¼‰ã€‚é“¾æ¥ä¸º Linux ç³»ç»Ÿè§£å†³äº†æ–‡ä»¶çš„å…±äº«ä½¿ç”¨ï¼Œè¿˜å¸¦æ¥äº†éšè—æ–‡ä»¶è·¯å¾„ã€å¢åŠ æƒé™å®‰å…¨åŠèŠ‚çœå­˜å‚¨ç­‰å¥½å¤„ã€‚è‹¥ä¸€ä¸ª inode å·å¯¹åº”å¤šä¸ªæ–‡ä»¶åï¼Œåˆ™ç§°è¿™äº›æ–‡ä»¶ä¸ºç¡¬é“¾æ¥ã€‚æ¢è¨€ä¹‹ï¼Œç¡¬é“¾æ¥å°±æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨äº†å¤šä¸ªåˆ«åï¼ˆè§ <a href=#p2>å›¾ 2.</a>hard link å°±æ˜¯ file çš„ä¸€ä¸ªåˆ«åï¼Œä»–ä»¬æœ‰å…±åŒçš„ inodeï¼‰ã€‚ç¡¬é“¾æ¥å¯ç”±å‘½ä»¤ link æˆ– ln åˆ›å»ºã€‚å¦‚ä¸‹æ˜¯å¯¹æ–‡ä»¶ oldfile åˆ›å»ºç¡¬é“¾æ¥ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> link oldfile newfile
</span></span><span class=line><span class=cl> ln oldfile newfile
</span></span></code></pre></td></tr></table></div></div><p>Â Â Â Â Â Â Â ç”±äºç¡¬é“¾æ¥æ˜¯æœ‰ç€ç›¸åŒ inode å·ä»…æ–‡ä»¶åä¸åŒçš„æ–‡ä»¶ï¼Œå› æ­¤ç¡¬é“¾æ¥å­˜åœ¨ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š</p><ul><li>æ–‡ä»¶æœ‰ç›¸åŒçš„ inode åŠ data blockï¼›</li><li>åªèƒ½å¯¹å·²å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œåˆ›å»ºï¼›</li><li>ä¸èƒ½äº¤å‰æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç¡¬é“¾æ¥çš„åˆ›å»ºï¼›</li><li>ä¸èƒ½å¯¹ç›®å½•è¿›è¡Œåˆ›å»ºï¼Œåªå¯å¯¹æ–‡ä»¶åˆ›å»ºï¼›</li><li>åˆ é™¤ä¸€ä¸ªç¡¬é“¾æ¥æ–‡ä»¶å¹¶ä¸å½±å“å…¶ä»–æœ‰ç›¸åŒ inode å·çš„æ–‡ä»¶ã€‚</li></ul><h4 id=list4>æ¸…å• 4. ç¡¬é“¾æ¥ç‰¹æ€§å±•ç¤º</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># ls -li
</span></span><span class=line><span class=cl> total 0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> // åªèƒ½å¯¹å·²å­˜åœ¨çš„æ–‡ä»¶åˆ›å»ºç¡¬è¿æ¥
</span></span><span class=line><span class=cl> # link old.file hard.link
</span></span><span class=line><span class=cl> link: cannot create link `hard.link&#39; to `old.file&#39;: No such file or directory
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> # echo &#34;This is an original file&#34; &gt; old.file
</span></span><span class=line><span class=cl> # cat old.file
</span></span><span class=line><span class=cl> This is an original file
</span></span><span class=line><span class=cl> # stat old.file
</span></span><span class=line><span class=cl>  File: `old.file&#39;
</span></span><span class=line><span class=cl>  Size: 25        	 Blocks: 8          IO Block: 4096   regular file
</span></span><span class=line><span class=cl> Device: 807h/2055d 	 Inode: 660650      Links: 2
</span></span><span class=line><span class=cl> Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
</span></span><span class=line><span class=cl> ...
</span></span><span class=line><span class=cl> // æ–‡ä»¶æœ‰ç›¸åŒçš„ inode å·ä»¥åŠ data block
</span></span><span class=line><span class=cl> # link old.file hard.link | ls -li
</span></span><span class=line><span class=cl> total 8
</span></span><span class=line><span class=cl> 660650 -rw-r--r-- 2 root root 25 Sep  1 17:44 hard.link
</span></span><span class=line><span class=cl> 660650 -rw-r--r-- 2 root root 25 Sep  1 17:44 old.file
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> // ä¸èƒ½äº¤å‰æ–‡ä»¶ç³»ç»Ÿ
</span></span><span class=line><span class=cl> # ln /dev/input/event5 /root/bfile.txt
</span></span><span class=line><span class=cl> ln: failed to create hard link `/root/bfile.txt&#39; =&gt; `/dev/input/event5&#39;:
</span></span><span class=line><span class=cl> Invalid cross-device link
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> // ä¸èƒ½å¯¹ç›®å½•è¿›è¡Œåˆ›å»ºç¡¬è¿æ¥
</span></span><span class=line><span class=cl> # mkdir -p old.dir/test
</span></span><span class=line><span class=cl> # ln old.dir/ hardlink.dir
</span></span><span class=line><span class=cl> ln: `old.dir/&#39;: hard link not allowed for directory
</span></span><span class=line><span class=cl> # ls -iF
</span></span><span class=line><span class=cl> 660650 hard.link  657948 old.dir/  660650 old.file
</span></span></code></pre></td></tr></table></div></div><p>Â Â Â Â Â Â Â æ–‡ä»¶ old.file ä¸ hard.link æœ‰ç€ç›¸åŒçš„ inode å·ï¼š660650 åŠæ–‡ä»¶æƒé™ï¼Œinode æ˜¯éšç€æ–‡ä»¶çš„å­˜åœ¨è€Œå­˜åœ¨ï¼Œå› æ­¤åªæœ‰å½“æ–‡ä»¶å­˜åœ¨æ—¶æ‰å¯åˆ›å»ºç¡¬é“¾æ¥ï¼Œå³å½“ inode å­˜åœ¨ä¸”é“¾æ¥è®¡æ•°å™¨ï¼ˆlink countï¼‰ä¸ä¸º 0 æ—¶ã€‚inode å·ä»…åœ¨å„æ–‡ä»¶ç³»ç»Ÿä¸‹æ˜¯å”¯ä¸€çš„ï¼Œå½“ Linux æŒ‚è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿåå°†å‡ºç° inode å·é‡å¤çš„ç°è±¡ï¼ˆå¦‚<a href=#list5>æ¸…å• 5.</a>æ‰€ç¤ºï¼Œæ–‡ä»¶ t3.jpgã€sync åŠ 123.txt å¹¶æ— å…³è”ï¼Œå´æœ‰ç€ç›¸åŒçš„ inode å·ï¼‰ï¼Œå› æ­¤ç¡¬é“¾æ¥åˆ›å»ºæ—¶ä¸å¯è·¨æ–‡ä»¶ç³»ç»Ÿã€‚è®¾å¤‡æ–‡ä»¶ç›®å½• /dev ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ devtmpfsï¼Œè€Œ /rootï¼ˆä¸æ ¹ç›®å½• / ä¸€è‡´ï¼‰ä½¿ç”¨çš„æ˜¯ç£ç›˜æ–‡ä»¶ç³»ç»Ÿ ext4ã€‚<a href=#list5>æ¸…å• 5.</a>å±•ç¤ºäº†ä½¿ç”¨å‘½ä»¤ df æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€å„æ–‡ä»¶ç³»ç»Ÿ inode ä½¿ç”¨æƒ…å†µåŠæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ã€‚</p><h4 id=list5>æ¸…å• 5. æŸ¥æ‰¾æœ‰ç›¸åŒ inode å·çš„æ–‡ä»¶</h4>```
# df -i --print-type
Filesystem Type Inodes IUsed IFree IUse% Mounted on
/dev/sda7 ext4 3147760 283483 2864277 10% /
udev devtmpfs 496088 553 495535 1% /dev
tmpfs tmpfs 499006 491 498515 1% /run
none tmpfs 499006 3 499003 1% /run/lock
none tmpfs 499006 15 498991 1% /run/shm
/dev/sda6 fuseblk 74383900 4786 74379114 1% /media/DiskE
/dev/sda8 fuseblk 29524592 19939 29504653 1% /media/DiskF<h1 id=find---inum-1114 class=headerLink><a href=#find---inum-1114 class=header-mark></a>find / -inum 1114</h1><p>/media/DiskE/Pictures/t3.jpg
/media/DiskF/123.txt
/bin/sync</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLinux ç³»ç»Ÿå­˜åœ¨ inode å·è¢«ç”¨å®Œä½†ç£ç›˜ç©ºé—´è¿˜æœ‰å‰©ä½™çš„æƒ…å†µã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª 5M å¤§å°çš„ ext4 ç±»å‹çš„ mo.img æ–‡ä»¶ï¼Œå¹¶å°†å…¶æŒ‚è½½è‡³ç›®å½• /mntã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª shell è„šæœ¬å°†æŒ‚è½½åœ¨ /mnt ä¸‹ ext4 æ–‡ä»¶ç³»ç»Ÿçš„ indoe è€—å°½ï¼ˆè§&lt;a href=&#34;#list6&#34;&gt;æ¸…å• 6.&lt;/a&gt;ï¼‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list6&#39;&gt; æ¸…å• 6.  æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿ inode è€—å°½ä½†ä»æœ‰ç£ç›˜ç©ºé—´çš„æƒ…æ™¯ &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><h1 id=dd-ifdevzero-ofmoimg-bs5120k-count1 class=headerLink><a href=#dd-ifdevzero-ofmoimg-bs5120k-count1 class=header-mark></a>dd if=/dev/zero of=mo.img bs=5120k count=1</h1><h1 id=ls--lh-moimg class=headerLink><a href=#ls--lh-moimg class=header-mark></a>ls -lh mo.img</h1><p>-rw-r&ndash;r&ndash; 1 root root 5.0M Sep 1 17:54 mo.img</p><h1 id=mkfs--t-ext4---f-moimg class=headerLink><a href=#mkfs--t-ext4---f-moimg class=header-mark></a>mkfs -t ext4 -F ./mo.img</h1><p>&mldr;
OS type: Linux
Block size=1024 (log=0)
Fragment size=1024 (log=0)
Stride=0 blocks, Stripe width=0 blocks
1280 inodes, 5120 blocks
256 blocks (5.00%) reserved for the super user
&mldr;
&mldr;
Writing superblocks and filesystem accounting information: done</p><h1 id=mount--o-loop-moimg-mnt class=headerLink><a href=#mount--o-loop-moimg-mnt class=header-mark></a>mount -o loop ./mo.img /mnt</h1><h1 id=cat-mntinode_testsh class=headerLink><a href=#cat-mntinode_testsh class=header-mark></a>cat /mnt/inode_test.sh</h1><p>#!/bin/bash</p><p>for ((i = 1; ; i++))
do
if [ $? -eq 0 ]; then
echo &ldquo;This is file_$i&rdquo; > file_$i
else
exit 0
fi
done</p><h1 id=inode_testsh class=headerLink><a href=#inode_testsh class=header-mark></a>./inode_test.sh</h1><p>./inode_test.sh: line 6: file_1269: No space left on device</p><h1 id=df--it-mnt-du--sh-mnt class=headerLink><a href=#df--it-mnt-du--sh-mnt class=header-mark></a>df -iT /mnt/; du -sh /mnt/</h1><p>Filesystem Type Inodes IUsed IFree IUse% Mounted on
/dev/loop0 ext4 1280 1280 0 100% /mnt
1.3M /mnt/</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç¡¬é“¾æ¥ä¸èƒ½å¯¹ç›®å½•åˆ›å»ºæ˜¯å—é™äºæ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ï¼ˆè§ &lt;a href=&#34;#list4&#34;&gt;æ¸…å• 4.&lt;/a&gt;å¯¹ç›®å½•åˆ›å»ºç¡¬é“¾æ¥å°†å¤±è´¥ï¼‰ã€‚ç° Linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å‡éšè—äº†ä¸¤ä¸ªä¸ªç‰¹æ®Šçš„ç›®å½•ï¼šå½“å‰ç›®å½•ï¼ˆ.ï¼‰ä¸çˆ¶ç›®å½•ï¼ˆ..ï¼‰ã€‚æŸ¥çœ‹è¿™ä¸¤ä¸ªç‰¹æ®Šç›®å½•çš„ inode å·å¯çŸ¥å…¶å®è¿™ä¸¤ç›®å½•å°±æ˜¯ä¸¤ä¸ªç¡¬é“¾æ¥ï¼ˆæ³¨æ„ç›®å½• /mnt/lost+found/ çš„ inode å·ï¼‰ã€‚è‹¥ç³»ç»Ÿå…è®¸å¯¹ç›®å½•åˆ›å»ºç¡¬é“¾æ¥ï¼Œåˆ™ä¼šäº§ç”Ÿç›®å½•ç¯ã€‚
</span></span></code></pre></td></tr></table></div></div><h1 id=ls--alif-mntlostfound class=headerLink><a href=#ls--alif-mntlostfound class=header-mark></a>ls -aliF /mnt/lost+found</h1><p>total 44
11 drwx&mdash;&mdash; 2 root root 12288 Sep 1 17:54 ./
2 drwxr-xr-x 3 root root 31744 Sep 1 17:57 ../</p><h1 id=stat--mntlostfound class=headerLink><a href=#stat--mntlostfound class=header-mark></a>stat /mnt/lost+found/</h1><p>File: `/mnt/lost+found/'
Size: 12288 Blocks: 24 IO Block: 1024 directory
Device: 700h/1792d Inode: 11 Links: 2
Access: (0700/drwx&mdash;&mdash;) Uid: ( 0/ root) Gid: ( 0/ root)
Access: 2012-09-01 17:57:17.000000000 +0800
Modify: 2012-09-01 17:54:49.000000000 +0800
Change: 2012-09-01 17:54:49.000000000 +0800
Birth: -</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥ä¸åŒï¼Œè‹¥æ–‡ä»¶ç”¨æˆ·æ•°æ®å—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯å¦ä¸€æ–‡ä»¶çš„è·¯å¾„åçš„æŒ‡å‘ï¼Œåˆ™è¯¥æ–‡ä»¶å°±æ˜¯è½¯è¿æ¥ã€‚è½¯é“¾æ¥å°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œåªæ˜¯æ•°æ®å—å†…å®¹æœ‰ç‚¹ç‰¹æ®Šã€‚è½¯é“¾æ¥æœ‰ç€è‡ªå·±çš„ inode å·ä»¥åŠç”¨æˆ·æ•°æ®å—ï¼ˆè§ &lt;a href=&#34;#p2&#34;&gt;å›¾ 2.&lt;/a&gt;ï¼‰ã€‚å› æ­¤è½¯é“¾æ¥çš„åˆ›å»ºä¸ä½¿ç”¨æ²¡æœ‰ç±»ä¼¼ç¡¬é“¾æ¥çš„è¯¸å¤šé™åˆ¶ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* è½¯é“¾æ¥æœ‰è‡ªå·±çš„æ–‡ä»¶å±æ€§åŠæƒé™ç­‰ï¼›
</span></span><span class=line><span class=cl>* å¯å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºè½¯é“¾æ¥ï¼›
</span></span><span class=line><span class=cl>* è½¯é“¾æ¥å¯äº¤å‰æ–‡ä»¶ç³»ç»Ÿï¼›
</span></span><span class=line><span class=cl>* è½¯é“¾æ¥å¯å¯¹æ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºï¼›
</span></span><span class=line><span class=cl>* åˆ›å»ºè½¯é“¾æ¥æ—¶ï¼Œé“¾æ¥è®¡æ•° i_nlink ä¸ä¼šå¢åŠ ï¼›
</span></span><span class=line><span class=cl>* åˆ é™¤è½¯é“¾æ¥å¹¶ä¸å½±å“è¢«æŒ‡å‘çš„æ–‡ä»¶ï¼Œä½†è‹¥è¢«æŒ‡å‘çš„åŸæ–‡ä»¶è¢«åˆ é™¤ï¼Œåˆ™ç›¸å…³è½¯è¿æ¥è¢«ç§°ä¸ºæ­»é“¾æ¥ï¼ˆå³ dangling linkï¼Œè‹¥è¢«æŒ‡å‘è·¯å¾„æ–‡ä»¶è¢«é‡æ–°åˆ›å»ºï¼Œæ­»é“¾æ¥å¯æ¢å¤ä¸ºæ­£å¸¸çš„è½¯é“¾æ¥ï¼‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#34;p2&#34;&gt;  å›¾ 2. è½¯é“¾æ¥çš„è®¿é—® &lt;/h4&gt;
</span></span><span class=line><span class=cl>![](http://120.24.251.209/content/images/2016/03/image002.jpg)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list7&#39;&gt; æ¸…å• 7. è½¯é“¾æ¥ç‰¹æ€§å±•ç¤º &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><h1 id=ls--li class=headerLink><a href=#ls--li class=header-mark></a>ls -li</h1><p>total 0</p><p>// å¯å¯¹ä¸å­˜åœ¨çš„æ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥</p><h1 id=ln--s-oldfile-softlink class=headerLink><a href=#ln--s-oldfile-softlink class=header-mark></a>ln -s old.file soft.link</h1><h1 id=ls--lif class=headerLink><a href=#ls--lif class=header-mark></a>ls -liF</h1><p>total 0
789467 lrwxrwxrwx 1 root root 8 Sep 1 18:00 soft.link -> old.file</p><p>// ç”±äºè¢«æŒ‡å‘çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶çš„è½¯é“¾æ¥ soft.link å°±æ˜¯æ­»é“¾æ¥</p><h1 id=cat-softlink class=headerLink><a href=#cat-softlink class=header-mark></a>cat soft.link</h1><p>cat: soft.link: No such file or directory</p><p>// åˆ›å»ºè¢«æŒ‡å‘çš„æ–‡ä»¶ old.fileï¼Œsoft.link æ¢å¤æˆæ­£å¸¸çš„è½¯é“¾æ¥</p><h1 id=echo-this-is-an-original-file_a--oldfile class=headerLink><a href=#echo-this-is-an-original-file_a--oldfile class=header-mark></a>echo &ldquo;This is an original file_A&rdquo; &#187; old.file</h1><h1 id=cat-softlink-1 class=headerLink><a href=#cat-softlink-1 class=header-mark></a>cat soft.link</h1><p>This is an original file_A</p><p>// å¯¹ä¸å­˜åœ¨çš„ç›®å½•åˆ›å»ºè½¯é“¾æ¥</p><h1 id=ln--s-olddir-softlinkdir class=headerLink><a href=#ln--s-olddir-softlinkdir class=header-mark></a>ln -s old.dir soft.link.dir</h1><h1 id=mkdir--p-olddirtest class=headerLink><a href=#mkdir--p-olddirtest class=header-mark></a>mkdir -p old.dir/test</h1><h1 id=tree---f---inodes class=headerLink><a href=#tree---f---inodes class=header-mark></a>tree . -F &ndash;inodes</h1><p>.
â”œâ”€â”€ [ 789497] old.dir/
â”‚ â””â”€â”€ [ 789498] test/
â”œâ”€â”€ [ 789495] old.file
â”œâ”€â”€ [ 789495] soft.link -> old.file
â””â”€â”€ [ 789497] soft.link.dir -> old.dir/</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å½“ç„¶è½¯é“¾æ¥çš„ç”¨æˆ·æ•°æ®ä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªè½¯é“¾æ¥çš„è·¯å¾„ï¼Œå…¶è§£æè¿‡ç¨‹æ˜¯é€’å½’çš„ã€‚ä½†éœ€æ³¨æ„ï¼šè½¯é“¾æ¥åˆ›å»ºæ—¶åŸæ–‡ä»¶çš„è·¯å¾„æŒ‡å‘ä½¿ç”¨ç»å¯¹è·¯å¾„è¾ƒå¥½ã€‚ä½¿ç”¨ç›¸å¯¹è·¯å¾„åˆ›å»ºçš„è½¯é“¾æ¥è¢«ç§»åŠ¨åè¯¥è½¯é“¾æ¥æ–‡ä»¶å°†æˆä¸ºä¸€ä¸ªæ­»é“¾æ¥ï¼ˆå¦‚ä¸‹æ‰€ç¤ºçš„è½¯é“¾æ¥ a ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„ï¼Œå› æ­¤ä¸å®œè¢«ç§»åŠ¨ï¼‰ï¼Œå› ä¸ºé“¾æ¥æ•°æ®å—ä¸­è®°å½•çš„äº¦æ˜¯ç›¸å¯¹è·¯å¾„æŒ‡å‘ã€‚
</span></span></code></pre></td></tr></table></div></div><p>$ ls -li
total 2136
656627 lrwxrwxrwx 1 harris harris 8 Sep 1 14:37 a -> data.txt
656662 lrwxrwxrwx 1 harris harris 1 Sep 1 14:37 b -> a
656228 -rw&mdash;&mdash;- 1 harris harris 2186738 Sep 1 14:37 data.txt 6</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### é“¾æ¥ç›¸å…³çš„å‘½ä»¤
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;åœ¨ Linux ä¸­æŸ¥çœ‹å½“å‰ç³»ç»Ÿå·²æŒ‚ç€çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œé™¤ä¸Šè¿°ä½¿ç”¨çš„å‘½ä»¤ dfï¼Œè¿˜å¯ä½¿ç”¨å‘½ä»¤ mount æˆ–æŸ¥çœ‹æ–‡ä»¶ /proc/mountsã€‚
</span></span></code></pre></td></tr></table></div></div><h1 id=mount class=headerLink><a href=#mount class=header-mark></a>mount</h1><p>/dev/sda7 on / type ext4 (rw,errors=remount-ro)
proc on /proc type proc (rw,noexec,nosuid,nodev)
sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
&mldr;
&mldr;
none on /run/shm type tmpfs (rw,nosuid,nodev)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å‘½ä»¤ ls æˆ– stat å¯å¸®åŠ©æˆ‘ä»¬åŒºåˆ†è½¯é“¾æ¥ä¸å…¶ä»–æ–‡ä»¶å¹¶æŸ¥çœ‹æ–‡ä»¶ inode å·ï¼Œä½†è¾ƒå¥½çš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨ find å‘½ä»¤ï¼Œå…¶ä¸ä»…å¯æŸ¥æ‰¾æŸæ–‡ä»¶çš„è½¯é“¾æ¥ï¼Œè¿˜å¯ä»¥ç”¨äºæŸ¥æ‰¾ç›¸åŒ inode çš„æ‰€æœ‰ç¡¬é“¾æ¥ã€‚ï¼ˆè§ &lt;a href=&#34;#list8&#34;&gt;æ¸…å• 8.&lt;/a&gt;ï¼‰
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list8&#39;&gt; æ¸…å• 8. ä½¿ç”¨å‘½ä»¤ find æŸ¥æ‰¾è½¯é“¾æ¥ä¸ç¡¬é“¾æ¥ &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><p>// æŸ¥æ‰¾åœ¨è·¯å¾„ /home ä¸‹çš„æ–‡ä»¶ data.txt çš„è½¯é“¾æ¥</p><h1 id=find-home--lname-datatxt class=headerLink><a href=#find-home--lname-datatxt class=header-mark></a>find /home -lname data.txt</h1><p>/home/harris/debug/test2/a</p><p>// æŸ¥çœ‹è·¯å¾„ /home æœ‰ç›¸åŒ inode çš„æ‰€æœ‰ç¡¬é“¾æ¥</p><h1 id=find-home--samefile-homeharrisdebugtest3oldfile class=headerLink><a href=#find-home--samefile-homeharrisdebugtest3oldfile class=header-mark></a>find /home -samefile /home/harris/debug/test3/old.file</h1><p>/home/harris/debug/test3/hard.link
/home/harris/debug/test3/old.file</p><h1 id=find-home--inum-660650 class=headerLink><a href=#find-home--inum-660650 class=header-mark></a>find /home -inum 660650</h1><p>/home/harris/debug/test3/hard.link
/home/harris/debug/test3/old.file</p><p>// åˆ—å‡ºè·¯å¾„ /home/harris/debug/ ä¸‹çš„æ‰€æœ‰è½¯é“¾æ¥æ–‡ä»¶</p><h1 id=find-homeharrisdebug--type-l--ls class=headerLink><a href=#find-homeharrisdebug--type-l--ls class=header-mark></a>find /home/harris/debug/ -type l -ls</h1><p>656662 0 lrwxrwxrwx 1 harris harris 1 Sep 1 14:37 /home/harris/debug/test2/b -> a
656627 0 lrwxrwxrwx 1 harris harris 8 Sep 1 14:37 /home/harris/debug/test2/a ->
data.txt
789467 0 lrwxrwxrwx 1 root root 8 Sep 1 18:00 /home/harris/debug/test/soft.link ->
old.file
789496 0 lrwxrwxrwx 1 root root 7 Sep 1 18:01
/home/harris/debug/test/soft.link.dir -> old.dir</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç³»ç»Ÿæ ¹æ®ç£ç›˜çš„å¤§å°é»˜è®¤è®¾å®šäº† inode çš„å€¼ï¼ˆè§&lt;a href=&#34;#list9&#34;&gt;æ¸…å• 9.&lt;/a&gt;ï¼‰ï¼Œå¦‚è‹¥å¿…è¦ï¼Œå¯åœ¨æ ¼å¼æ–‡ä»¶ç³»ç»Ÿå‰å¯¹è¯¥å€¼è¿›è¡Œä¿®æ”¹ã€‚å¦‚é”®å…¥å‘½ä»¤ mkfs -t ext4 -I 512/dev/sda4ï¼Œå°†ä½¿ç£ç›˜è®¾å¤‡ /dev/sda4 æ ¼å¼æˆ inode å¤§å°æ˜¯ 512 å­—èŠ‚çš„ ext4 æ–‡ä»¶ç³»ç»Ÿã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list9&#39;&gt; æ¸…å• 9. æŸ¥çœ‹ç³»ç»Ÿçš„ inode å€¼ &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><p>// æŸ¥çœ‹ç£ç›˜åˆ†åŒº /dev/sda7 ä¸Šçš„ inode å€¼</p><h1 id=dumpe2fs--h-devsda7--grep-inode-size class=headerLink><a href=#dumpe2fs--h-devsda7--grep-inode-size class=header-mark></a>dumpe2fs -h /dev/sda7 | grep &ldquo;Inode size&rdquo;</h1><p>dumpe2fs 1.42 (29-Nov-2011)
Inode size: 256</p><h1 id=tune2fs--l-devsda7--grep-inode-size class=headerLink><a href=#tune2fs--l-devsda7--grep-inode-size class=header-mark></a>tune2fs -l /dev/sda7 | grep &ldquo;Inode size&rdquo;</h1><p>Inode size: 256</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### Linux VFS
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Linux æœ‰ç€æå…¶ä¸°å¯Œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¤§ä½“ä¸Šå¯åˆ†å¦‚ä¸‹å‡ ç±»ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1. ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ nfsã€cifs ç­‰ï¼›
</span></span><span class=line><span class=cl>2. ç£ç›˜æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ ext4ã€ext3 ç­‰ï¼›
</span></span><span class=line><span class=cl>3. ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ procã€sysfsã€ramfsã€tmpfs ç­‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å®ç°ä»¥ä¸Šè¿™äº›æ–‡ä»¶ç³»ç»Ÿå¹¶åœ¨ Linux ä¸‹å…±å­˜çš„åŸºç¡€å°±æ˜¯ Linux VFSï¼ˆVirtual File System åˆç§° Virtual Filesystem Switchï¼‰ï¼Œå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚VFS ä½œä¸ºä¸€ä¸ªé€šç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒæŠ½è±¡äº†æ–‡ä»¶ç³»ç»Ÿçš„å››ä¸ªåŸºæœ¬æ¦‚å¿µï¼šæ–‡ä»¶ã€ç›®å½•é¡¹ (dentry)ã€ç´¢å¼•èŠ‚ç‚¹ (inode) åŠæŒ‚è½½ç‚¹ï¼Œå…¶åœ¨å†…æ ¸ä¸­ä¸ºç”¨æˆ·ç©ºé—´å±‚çš„æ–‡ä»¶ç³»ç»Ÿæä¾›äº†ç›¸å…³çš„æ¥å£ï¼ˆè§ &lt;a href=&#34;#p3&#34;&gt;å›¾ 3.&lt;/a&gt;æ‰€ç¤º VFS åœ¨ Linux ç³»ç»Ÿçš„æ¶æ„ï¼‰ã€‚VFS å®ç°äº† open()ã€read() ç­‰ç³»ç»Ÿè°ƒå¹¶ä½¿å¾— cp ç­‰ç”¨æˆ·ç©ºé—´ç¨‹åºå¯è·¨æ–‡ä»¶ç³»ç»Ÿã€‚VFS çœŸæ­£å®ç°äº†ä¸Šè¿°å†…å®¹ä¸­ï¼šåœ¨ Linux ä¸­é™¤è¿›ç¨‹ä¹‹å¤–ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;p3&#39;&gt; å›¾ 3. VFS åœ¨ç³»ç»Ÿä¸­çš„æ¶æ„ &lt;/h4&gt;
</span></span><span class=line><span class=cl>![](http://120.24.251.209/content/images/2016/03/image003.jpg)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Linux VFS å­˜åœ¨å››ä¸ªåŸºæœ¬å¯¹è±¡ï¼šè¶…çº§å—å¯¹è±¡ (superblock object)ã€ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ (inode object)ã€ç›®å½•é¡¹å¯¹è±¡ (dentry object) åŠæ–‡ä»¶å¯¹è±¡ (file object)ã€‚è¶…çº§å—å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå·²å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿï¼›ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ï¼›ç›®å½•é¡¹å¯¹è±¡ä»£è¡¨ä¸€ä¸ªç›®å½•é¡¹ï¼Œå¦‚è®¾å¤‡æ–‡ä»¶ event5 åœ¨è·¯å¾„ /dev/input/event5 ä¸­ï¼Œå…¶å­˜åœ¨å››ä¸ªç›®å½•é¡¹å¯¹è±¡ï¼š/ ã€dev/ ã€input/ åŠ event5ã€‚æ–‡ä»¶å¯¹è±¡ä»£è¡¨ç”±è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€‚è¿™å››ä¸ªå¯¹è±¡ä¸è¿›ç¨‹åŠç£ç›˜æ–‡ä»¶é—´çš„å…³ç³»å¦‚&lt;a href=&#34;#p4&#34;&gt;å›¾ 4.&lt;/a&gt; æ‰€ç¤ºï¼Œå…¶ä¸­ d_inode å³ä¸ºç¡¬é“¾æ¥ã€‚ä¸ºæ–‡ä»¶è·¯å¾„çš„å¿«é€Ÿè§£æï¼ŒLinux VFS è®¾è®¡äº†ç›®å½•é¡¹ç¼“å­˜ï¼ˆDirectory Entry Cacheï¼Œå³ dcacheï¼‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;p4&#39;&gt; å›¾ 4. VFS çš„å¯¹è±¡ä¹‹é—´çš„å¤„ç† &lt;/h4&gt;
</span></span><span class=line><span class=cl>![](http://120.24.251.209/content/images/2016/03/image004.jpg)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### Linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„ inode
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;åœ¨ Linux ä¸­ï¼Œç´¢å¼•èŠ‚ç‚¹ç»“æ„å­˜åœ¨äºç³»ç»Ÿå†…å­˜åŠç£ç›˜ï¼Œå…¶å¯åŒºåˆ†æˆ VFS inode ä¸å®é™…æ–‡ä»¶ç³»ç»Ÿçš„ inodeã€‚VFS inode ä½œä¸ºå®é™…æ–‡ä»¶ç³»ç»Ÿä¸­ inode çš„æŠ½è±¡ï¼Œå®šä¹‰äº†ç»“æ„ä½“ inode ä¸å…¶ç›¸å…³çš„æ“ä½œ inode_operationsï¼ˆè§å†…æ ¸æºç  include/linux/fs.hï¼‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list10&#39;&gt; æ¸…å• 10. VFS ä¸­çš„ inode ä¸ inode_operations ç»“æ„ä½“ &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><p>struct inode {
&mldr;
const struct inode_operations *i_op; // ç´¢å¼•èŠ‚ç‚¹æ“ä½œ
unsigned long i_ino; // ç´¢å¼•èŠ‚ç‚¹å·
atomic_t i_count; // å¼•ç”¨è®¡æ•°å™¨
unsigned int i_nlink; // ç¡¬é“¾æ¥æ•°ç›®
&mldr;
}</p><p>struct inode_operations {
&mldr;
int (*create) (struct inode *,struct dentry *,int, struct nameidata *);
int (*link) (struct dentry *,struct inode *,struct dentry *);
int (*unlink) (struct inode *,struct dentry *);
int (*symlink) (struct inode *,struct dentry *,const char *);
int (*mkdir) (struct inode *,struct dentry *,int);
int (*rmdir) (struct inode *,struct dentry *);
&mldr;
}</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å¦‚&lt;a href=&#34;#list10&#34;&gt;æ¸…å• 10.&lt;/a&gt; æ‰€è§ï¼Œæ¯ä¸ªæ–‡ä»¶å­˜åœ¨ä¸¤ä¸ªè®¡æ•°å™¨ï¼ši_count ä¸ i_nlinkï¼Œå³å¼•ç”¨è®¡æ•°ä¸ç¡¬é“¾æ¥è®¡æ•°ã€‚ç»“æ„ä½“ inode ä¸­çš„ i_count ç”¨äºè·Ÿè¸ªæ–‡ä»¶è¢«è®¿é—®çš„æ•°é‡ï¼Œè€Œ i_nlink åˆ™æ˜¯ä¸Šè¿°ä½¿ç”¨ ls -l ç­‰å‘½ä»¤æŸ¥çœ‹åˆ°çš„æ–‡ä»¶ç¡¬é“¾æ¥æ•°ã€‚æˆ–è€…è¯´ i_count è·Ÿè¸ªæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æƒ…å†µï¼Œè€Œ i_nlink åˆ™æ˜¯ç£ç›˜è®¡æ•°å™¨ã€‚å½“æ–‡ä»¶è¢«åˆ é™¤æ—¶ï¼Œåˆ™ i_nlink å…ˆè¢«è®¾ç½®æˆ 0ã€‚æ–‡ä»¶çš„è¿™ä¸¤ä¸ªè®¡æ•°å™¨ä½¿å¾— Linux ç³»ç»Ÿå‡çº§æˆ–ç¨‹åºæ›´æ–°å˜çš„å®¹æ˜“ã€‚ç³»ç»Ÿæˆ–ç¨‹åºå¯åœ¨ä¸å…³é—­çš„æƒ…å†µä¸‹ï¼ˆå³æ–‡ä»¶ i_count ä¸ä¸º 0ï¼‰ï¼Œå°†æ–°æ–‡ä»¶ä»¥åŒæ ·çš„æ–‡ä»¶åè¿›è¡Œæ›¿æ¢ï¼Œæ–°æ–‡ä»¶æœ‰è‡ªå·±çš„ inode åŠ data blockï¼Œæ—§æ–‡ä»¶ä¼šåœ¨ç›¸å…³è¿›ç¨‹å…³é—­åè¢«å®Œæ•´çš„åˆ é™¤ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list11&#39;&gt; æ¸…å• 11. æ–‡ä»¶ç³»ç»Ÿ ext4 ä¸­çš„ inode &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><p>struct ext4_inode {
&mldr;
__le32 i_atime; // æ–‡ä»¶å†…å®¹æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´
__le32 i_ctime; // inode ä¿®æ”¹æ—¶é—´
__le32 i_mtime; // æ–‡ä»¶å†…å®¹æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´
__le16 i_links_count; // ç¡¬é“¾æ¥è®¡æ•°
__le32 i_blocks_lo; // Block è®¡æ•°
__le32 i_block[EXT4_N_BLOCKS]; // æŒ‡å‘å…·ä½“çš„ block
&mldr;
};</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&#34;#list11&#34;&gt;æ¸…å• 11.&lt;/a&gt; å±•ç¤ºçš„æ˜¯æ–‡ä»¶ç³»ç»Ÿ ext4 ä¸­å¯¹ inode çš„å®šä¹‰ï¼ˆè§å†…æ ¸æºç  fs/ext4/ext4.hï¼‰ã€‚å…¶ä¸­ä¸‰ä¸ªæ—¶é—´çš„å®šä¹‰å¯å¯¹åº”ä¸å‘½ä»¤ stat ä¸­æŸ¥çœ‹åˆ°ä¸‰ä¸ªæ—¶é—´ã€‚i_links_count ä¸ä»…ç”¨äºæ–‡ä»¶çš„ç¡¬é“¾æ¥è®¡æ•°ï¼Œä¹Ÿç”¨äºç›®å½•çš„å­ç›®å½•æ•°è·Ÿè¸ªï¼ˆç›®å½•å¹¶ä¸æ˜¾ç¤ºç¡¬é“¾æ¥æ•°ï¼Œå‘½ä»¤ ls -ld æŸ¥çœ‹åˆ°çš„æ˜¯å­ç›®å½•æ•°ï¼‰ã€‚ç”±äºæ–‡ä»¶ç³»ç»Ÿ ext3 å¯¹ i_links_count æœ‰é™åˆ¶ï¼Œå…¶æœ€å¤§æ•°ä¸ºï¼š32000ï¼ˆè¯¥é™åˆ¶åœ¨ ext4 ä¸­è¢«å–æ¶ˆï¼‰ã€‚å°è¯•åœ¨ ext3 æ–‡ä»¶ç³»ç»Ÿä¸ŠéªŒè¯ç›®å½•å­ç›®å½•åŠæ™®é€šæ–‡ä»¶ç¡¬é“¾æ¥æœ€å¤§æ•°å¯è§ &lt;a href=&#34;#list12&#34;&gt;æ¸…å• 12.&lt;/a&gt;çš„é”™è¯¯ä¿¡æ¯ã€‚å› æ­¤å®é™…æ–‡ä»¶ç³»ç»Ÿçš„ inode ä¹‹é—´åŠä¸ VFS inode ç›¸è¾ƒæ˜¯æœ‰å·®å¼‚çš„ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;h4 id=&#39;list12&#39;&gt; æ¸…å• 12. æ–‡ä»¶ç³»ç»Ÿ ext3 ä¸­ i_links_count çš„é™åˆ¶ &lt;/h4&gt;
</span></span></code></pre></td></tr></table></div></div><h1 id=dirtestsh class=headerLink><a href=#dirtestsh class=header-mark></a>./dirtest.sh</h1><p>mkdir: cannot create directory `dir_31999&rsquo;: Too many links</p><h1 id=linkcountsh class=headerLink><a href=#linkcountsh class=header-mark></a>./linkcount.sh</h1><p>ln: failed to create hard link to `old.file&rsquo;: Too many links</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### ç»“æŸè¯­
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;æœ¬æ–‡æœ€åˆæè¿°äº† Linux ç³»ç»Ÿä¸­æ–‡ä»¶ä¸ç›®å½•è¢«å¼•å…¥çš„åŸå› åŠ Linux å¤„ç†æ–‡ä»¶çš„æ–¹å¼ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡åŒºåˆ†ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥çš„ä¸åŒï¼Œäº†è§£ Linux ä¸­çš„ç´¢å¼•èŠ‚ç‚¹çš„ç›¸å…³çŸ¥è¯†ï¼Œå¹¶ä»¥æ­¤å¼•å‡ºäº† inode çš„ç»“æ„ä½“ã€‚ç´¢å¼•èŠ‚ç‚¹ç»“æ„ä½“å­˜åœ¨åœ¨äº Linux VFS ä»¥åŠå®é™…æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ŒVFS ä½œä¸ºé€šç”¨æ–‡ä»¶æ¨¡å‹æ˜¯ Linux ä¸­â€œä¸€åˆ‡çš†æ˜¯æ–‡ä»¶â€å®ç°çš„åŸºç¡€ã€‚æ–‡ç« å¹¶æœªæ·±å…¥ Linux VFSï¼Œä¹Ÿæ²¡æ¶‰åŠå®é™…æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼Œæ–‡ç« åªæ˜¯ä» inode äº†è§£ Linux çš„æ–‡ä»¶ç³»ç»Ÿçš„ç›¸å…³å†…å®¹ã€‚è‹¥æƒ³æ·±å…¥æ–‡ä»¶ç³»ç»Ÿçš„å†…å®¹ï¼ŒæŸ¥çœ‹å†…æ ¸æ–‡æ¡£ Documentation/filesystems/ æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹å¼ã€‚
</span></span></code></pre></td></tr></table></div></div></div><h2>ç›¸å…³å†…å®¹</h2><div class=related-container><div class=related-item-container><h2 class=related-title><a href=/linux-%E4%B8%AD%E7%9A%84%E4%B8%89%E4%B8%AA%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90/>Linux ä¸­çš„ä¸‰ä¸ªç‰¹æ®Šæƒé™</a></h2></div><div class=related-item-container><h2 class=related-title><a href=/linux-%E7%AC%94%E8%AF%95%E8%AF%95%E9%A2%98/>Linux ç¬”è¯•è¯•é¢˜</a></h2></div><div class=related-item-container><h2 class=related-title><a href=/centos-6-2-%E5%88%9D%E5%A7%8B%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96%E6%93%8D%E4%BD%9C/>CentOS åˆå§‹å®‰è£…åŸºæœ¬ä¼˜åŒ–æ“ä½œ</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>æ›´æ–°äº 2016-03-18</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-mardown href=/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/index.md target=_blank rel="noopener noreferrer">é˜…è¯»åŸå§‹æ–‡æ¡£</a></span></div><div class=post-info-share><span><a href=# onclick=return!1 title="åˆ†äº«åˆ° Twitter" data-sharer=twitter data-url=https://samzong.me/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/ data-title="ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥" data-via=samzong_lu data-hashtags=Linux><i class="fab fa-twitter fa-fw"></i></a><a href=# onclick=return!1 title="åˆ†äº«åˆ° Facebook" data-sharer=facebook data-url=https://samzong.me/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/ data-hashtag=Linux><i class="fab fa-facebook-square fa-fw"></i></a><a href=# onclick=return!1 title="åˆ†äº«åˆ° å¾®åš" data-sharer=weibo data-url=https://samzong.me/%E7%90%86%E8%A7%A3-linux-%E7%9A%84%E7%A1%AC%E9%93%BE%E6%8E%A5%E4%B8%8E%E8%BD%AF%E9%93%BE%E6%8E%A5/ data-title="ç†è§£ Linux çš„ç¡¬é“¾æ¥ä¸è½¯é“¾æ¥" data-ralateuid=3181653281><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/linux/>Linux</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>è¿”å›</a></span>&nbsp;|&nbsp;<span><a href=/>ä¸»é¡µ</a></span></section></div><div class=post-nav><a href=/%E9%BE%99%E6%97%8F%E8%B7%AF%E6%98%8E%E9%9D%9E/ class=prev rel=prev title=é¾™æ—è·¯æ˜é><i class="fas fa-angle-left fa-fw"></i>é¾™æ—è·¯æ˜é</a>
<a href=/centos-6-2-%E5%88%9D%E5%A7%8B%E5%AE%89%E8%A3%85%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96%E6%93%8D%E4%BD%9C/ class=next rel=next title="CentOS åˆå§‹å®‰è£…åŸºæœ¬ä¼˜åŒ–æ“ä½œ">CentOS åˆå§‹å®‰è£…åŸºæœ¬ä¼˜åŒ–æ“ä½œ<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=å›åˆ°é¡¶éƒ¨><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=æŸ¥çœ‹è¯„è®º><i class="fas fa-comment fa-fw"></i></a></div><div id=cookieconsent-container></div><div class=assets><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/fuse/fuse.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript src=/lib/topbar/topbar.min.js></script><script type=text/javascript src=/lib/pjax/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"å¤åˆ¶åˆ°å‰ªè´´æ¿",maxShownLines:10},comment:{},cookieconsent:{content:{dismiss:" dismiss",link:"https://samzong.me",message:"è¿™æ˜¯ä¸€ä¸ªæç¤ºè¯­"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"æ²¡æœ‰æ‰¾åˆ°ç»“æœ",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},sharerjs:!0,table:{sort:!0},twemoji:!0}</script><script type=text/javascript src=/lib/twemoji/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/cookieconsent.min.js defer></script><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript></div></body></html>